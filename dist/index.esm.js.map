{"version":3,"file":"index.esm.js","sources":["../src/actions/Action.ts","../src/actions/CaretAction.ts","../node_modules/deepmerge/dist/cjs.js","../src/actions/toolbar/Toolbar.ts","../src/tooltip/TooltipContainPosition.ts","../src/blots/Image.ts","../src/actions/align/AlignFormats.ts","../src/blots/Video.ts","../src/actions/align/DefaultAligner.ts","../src/actions/toolbar/ToolbarButton.ts","../src/actions/align/AlignAction.ts","../src/actions/DeleteAction.ts","../src/actions/ResizeAction.ts","../src/specs/BlotSpec.ts","../src/specs/UnclickableBlotSpec.ts","../src/specs/IframeVideoSpec.ts","../src/actions/AttributeAction.ts","../src/actions/CompressAction.ts","../src/actions/LinkAction.ts","../src/specs/ImageSpec.ts","../src/DefaultOptions.ts","../src/BlotFormatter.ts"],"sourcesContent":["import BlotFormatter from '../BlotFormatter';\nimport ToolbarButton from './toolbar/ToolbarButton';\n\n/**\n * Represents a base class for actions used within the BlotFormatter.\n * \n * This class provides a structure for actions that can be performed by the formatter,\n * including lifecycle hooks for creation, destruction, and updates. Subclasses should\n * override the lifecycle methods as needed.\n * \n * @remarks\n * - Each action holds a reference to the parent `BlotFormatter` instance.\n * - Actions can define their own toolbar buttons by populating the `toolbarButtons` array.\n * - Debug logging is available if the formatter's options enable it.\n * \n * @example\n * ```typescript\n * class CustomAction extends Action {\n *   onCreate = (): void => {\n *     // Custom initialization logic\n *   }\n *   onDestroy = (): void => {\n *     // Custom destruction logic\n *   }\n *   onUpdate = (): void => {\n *     // Custom update logic\n *   }\n * }\n * ```\n * \n * @public\n */\nexport default class Action {\n  formatter: BlotFormatter;\n  toolbarButtons: ToolbarButton[] = [];\n  debug: boolean;\n\n  constructor(formatter: BlotFormatter) {\n    this.formatter = formatter;\n    this.debug = this.formatter.options.debug || false;\n    if (this.debug) console.debug('Action created:', this.constructor.name);\n  }\n\n  /**\n   * Called when the action is created.\n   * Override this method to implement custom initialization logic.\n   */\n  onCreate = (): void => {}\n\n  /**\n   * Called when the action is being destroyed.\n   * Override this method to implement custom cleanup logic.\n   */\n  onDestroy = (): void => {}\n\n  /**\n   * Called when the action should be updated.\n   * Override this method to implement custom update logic.\n   */\n  onUpdate = (): void => {}\n\n}\n","import Action from './Action';\nimport { Blot } from '../specs/BlotSpec';\n\n/**\n * Provides caret (text cursor) manipulation actions for the Quill editor, including moving the caret\n * backward, placing the caret before or after a specified blot, and handling keyboard navigation events.\n *\n * This class is designed to work with the Quill editor and the Blot Formatter overlay, enabling precise\n * caret placement and navigation around custom blots (such as images or embeds) within the editor.\n *\n * @remarks\n * - Integrates with the Quill editor instance and its formatting specifications.\n * - Handles keyboard events to facilitate intuitive caret movement for users.\n * - Ensures proper event listener management to prevent memory leaks.\n *\n * @public\n */\nexport default class CaretAction extends Action {\n\n  /**\n   * Moves the caret (text cursor) backward by a specified number of characters within the current selection.\n   *\n   * If the caret is at the beginning of a text node, it attempts to move to the end of the previous sibling text node.\n   * If there is no previous sibling or the selection is not valid, the caret position remains unchanged.\n   *\n   * @param n - The number of characters to move the caret back. Defaults to 1.\n   */\n  static sendCaretBack = (n = 1, debug = false): void => {\n    const selection = window.getSelection();\n    if (selection && selection.rangeCount > 0) {\n      const range = selection.getRangeAt(0);\n      const currentNode = range.startContainer;\n      const currentOffset = range.startOffset;\n\n      // Move the cursor back by n characters\n      if (currentOffset > 0) {\n        range.setStart(currentNode, currentOffset - n);\n      } else if (currentNode.previousSibling) {\n        // Move to end of previous text node\n        const prevNode = currentNode.previousSibling;\n        if (prevNode.nodeType === Node.TEXT_NODE) {\n          range.setStart(prevNode, prevNode.textContent?.length || 0);\n        }\n      }\n\n      range.collapse(true);\n      selection.removeAllRanges();\n      selection.addRange(range);\n      if (debug) {\n        console.debug('Caret moved back by', n, 'characters');\n      }\n    }\n  }\n\n  /**\n   * Places the caret (text cursor) immediately before the specified blot in the Quill editor.\n   *\n   * @param quill - The Quill editor instance.\n   * @param targetBlot - The blot before which the caret should be placed.\n   */\n  static placeCaretBeforeBlot = (quill: any, targetBlot: Blot, debug = false): void => {\n    const index = quill.getIndex(targetBlot);\n    quill.setSelection(index, 0, \"user\");\n    if (debug) {\n      console.debug('Caret placed before blot at index:', index, targetBlot);\n    }\n  }\n\n  /**\n   * Places the caret (text cursor) immediately after the specified blot in the Quill editor.\n   *\n   * This method first clears any existing selection and ensures the editor is focused.\n   * It then calculates the index of the target blot and determines whether it is the last blot in the document.\n   * - If the target blot is the last one, the caret is placed at the very end of the document.\n   * - Otherwise, the caret is positioned just after the target blot, using a combination of Quill's selection API\n   *   and a native browser adjustment to avoid placing the caret inside a formatting span wrapper.\n   *\n   * @param quill - The Quill editor instance.\n   * @param targetBlot - The blot after which the caret should be placed.\n   */\n  static placeCaretAfterBlot = (quill: any, targetBlot: Blot, debug = false): void => {\n    quill.setSelection(null); // Clear selection first\n    quill.root.focus(); // Ensure the editor is focused\n    const index = quill.getIndex(targetBlot);\n    const documentLength = quill.getLength();\n\n    // Check if this is the last blot in the document\n    if (index + 1 >= documentLength - 1) {\n      // For the last blot, place cursor at the very end\n      quill.setSelection(documentLength - 1, 0, \"user\");\n      if (debug) {\n        console.debug('Caret placed at the end of the document after blot:', targetBlot);\n      }\n    } else {\n      // overshoot by one then use native browser API to send caret back one\n      // without this, caret will be placed inside formatting span wrapper\n      if (debug) {\n        console.debug('Caret placed after character following blot at index:', index, targetBlot);\n      } \n      quill.setSelection(index + 2, 0, \"user\");\n      this.sendCaretBack(1, debug); // Move cursor back by 1 character\n    }\n  }\n\n  /**\n   * Initializes event listeners for the CaretAction.\n   *\n   * Adds a 'keyup' event listener to the document and an 'input' event listener\n   * to the Quill editor's root element. Both listeners trigger the `onKeyUp` handler.\n   *\n   * @remarks\n   * This method should be called when the action is created to ensure proper\n   * caret handling and formatting updates in response to user input.\n   */\n  onCreate = (): void => {\n    document.addEventListener('keyup', this.onKeyUp);\n    this.formatter.quill.root.addEventListener('input', this.onKeyUp);\n  }\n\n  /**\n   * Cleans up event listeners attached by this action.\n   *\n   * Removes the 'keyup' event listener from the document and the 'input' event listener\n   * from the Quill editor's root element to prevent memory leaks and unintended behavior\n   * after the action is destroyed.\n   */\n  onDestroy = (): void => {\n    document.removeEventListener('keyup', this.onKeyUp);\n    this.formatter.quill.root.removeEventListener('input', this.onKeyUp);\n  }\n\n  /**\n   * Handles the keyup event for caret navigation around a target blot in the editor.\n   *\n   * - If a modal is open or there is no current formatting specification, the handler exits early.\n   * - If the left arrow key is pressed, places the caret before the target blot and hides the formatter UI.\n   * - If the right arrow key is pressed, places the caret after the target blot and hides the formatter UI.\n   *\n   * @param e - The keyboard event triggered by the user's keyup action.\n   */\n  onKeyUp = (e: KeyboardEvent) => {\n    const modalOpen: boolean = !!document.querySelector('[data-blot-formatter-modal]')\n    if (!this.formatter.currentSpec || modalOpen) {\n      return;\n    }\n    const targetBlot = this.formatter.currentSpec.getTargetBlot();\n    if (!targetBlot) {\n      return;\n    }\n\n    // if left arrow, place cursor before targetBlot\n    // if right arrow, place cursor after targetBlot\n    if (e.code === 'ArrowLeft') {\n      CaretAction.placeCaretBeforeBlot(this.formatter.quill, targetBlot, this.debug);\n      this.formatter.hide();\n    } else if (e.code === 'ArrowRight') {\n      CaretAction.placeCaretAfterBlot(this.formatter.quill, targetBlot, this.debug);\n      this.formatter.hide();\n    }\n  };\n}\n","'use strict';\n\nvar isMergeableObject = function isMergeableObject(value) {\n\treturn isNonNullObject(value)\n\t\t&& !isSpecial(value)\n};\n\nfunction isNonNullObject(value) {\n\treturn !!value && typeof value === 'object'\n}\n\nfunction isSpecial(value) {\n\tvar stringValue = Object.prototype.toString.call(value);\n\n\treturn stringValue === '[object RegExp]'\n\t\t|| stringValue === '[object Date]'\n\t\t|| isReactElement(value)\n}\n\n// see https://github.com/facebook/react/blob/b5ac963fb791d1298e7f396236383bc955f916c1/src/isomorphic/classic/element/ReactElement.js#L21-L25\nvar canUseSymbol = typeof Symbol === 'function' && Symbol.for;\nvar REACT_ELEMENT_TYPE = canUseSymbol ? Symbol.for('react.element') : 0xeac7;\n\nfunction isReactElement(value) {\n\treturn value.$$typeof === REACT_ELEMENT_TYPE\n}\n\nfunction emptyTarget(val) {\n\treturn Array.isArray(val) ? [] : {}\n}\n\nfunction cloneUnlessOtherwiseSpecified(value, options) {\n\treturn (options.clone !== false && options.isMergeableObject(value))\n\t\t? deepmerge(emptyTarget(value), value, options)\n\t\t: value\n}\n\nfunction defaultArrayMerge(target, source, options) {\n\treturn target.concat(source).map(function(element) {\n\t\treturn cloneUnlessOtherwiseSpecified(element, options)\n\t})\n}\n\nfunction getMergeFunction(key, options) {\n\tif (!options.customMerge) {\n\t\treturn deepmerge\n\t}\n\tvar customMerge = options.customMerge(key);\n\treturn typeof customMerge === 'function' ? customMerge : deepmerge\n}\n\nfunction getEnumerableOwnPropertySymbols(target) {\n\treturn Object.getOwnPropertySymbols\n\t\t? Object.getOwnPropertySymbols(target).filter(function(symbol) {\n\t\t\treturn Object.propertyIsEnumerable.call(target, symbol)\n\t\t})\n\t\t: []\n}\n\nfunction getKeys(target) {\n\treturn Object.keys(target).concat(getEnumerableOwnPropertySymbols(target))\n}\n\nfunction propertyIsOnObject(object, property) {\n\ttry {\n\t\treturn property in object\n\t} catch(_) {\n\t\treturn false\n\t}\n}\n\n// Protects from prototype poisoning and unexpected merging up the prototype chain.\nfunction propertyIsUnsafe(target, key) {\n\treturn propertyIsOnObject(target, key) // Properties are safe to merge if they don't exist in the target yet,\n\t\t&& !(Object.hasOwnProperty.call(target, key) // unsafe if they exist up the prototype chain,\n\t\t\t&& Object.propertyIsEnumerable.call(target, key)) // and also unsafe if they're nonenumerable.\n}\n\nfunction mergeObject(target, source, options) {\n\tvar destination = {};\n\tif (options.isMergeableObject(target)) {\n\t\tgetKeys(target).forEach(function(key) {\n\t\t\tdestination[key] = cloneUnlessOtherwiseSpecified(target[key], options);\n\t\t});\n\t}\n\tgetKeys(source).forEach(function(key) {\n\t\tif (propertyIsUnsafe(target, key)) {\n\t\t\treturn\n\t\t}\n\n\t\tif (propertyIsOnObject(target, key) && options.isMergeableObject(source[key])) {\n\t\t\tdestination[key] = getMergeFunction(key, options)(target[key], source[key], options);\n\t\t} else {\n\t\t\tdestination[key] = cloneUnlessOtherwiseSpecified(source[key], options);\n\t\t}\n\t});\n\treturn destination\n}\n\nfunction deepmerge(target, source, options) {\n\toptions = options || {};\n\toptions.arrayMerge = options.arrayMerge || defaultArrayMerge;\n\toptions.isMergeableObject = options.isMergeableObject || isMergeableObject;\n\t// cloneUnlessOtherwiseSpecified is added to `options` so that custom arrayMerge()\n\t// implementations can use it. The caller may not replace it.\n\toptions.cloneUnlessOtherwiseSpecified = cloneUnlessOtherwiseSpecified;\n\n\tvar sourceIsArray = Array.isArray(source);\n\tvar targetIsArray = Array.isArray(target);\n\tvar sourceAndTargetTypesMatch = sourceIsArray === targetIsArray;\n\n\tif (!sourceAndTargetTypesMatch) {\n\t\treturn cloneUnlessOtherwiseSpecified(source, options)\n\t} else if (sourceIsArray) {\n\t\treturn options.arrayMerge(target, source, options)\n\t} else {\n\t\treturn mergeObject(target, source, options)\n\t}\n}\n\ndeepmerge.all = function deepmergeAll(array, options) {\n\tif (!Array.isArray(array)) {\n\t\tthrow new Error('first argument should be an array')\n\t}\n\n\treturn array.reduce(function(prev, next) {\n\t\treturn deepmerge(prev, next, options)\n\t}, {})\n};\n\nvar deepmerge_1 = deepmerge;\n\nmodule.exports = deepmerge_1;\n","import BlotFormatter from '../../BlotFormatter';\nimport ToolbarButton from './ToolbarButton';\n\n/**\n * Manages the creation, display, and destruction of a toolbar for BlotFormatter actions.\n *\n * The `Toolbar` class is responsible for rendering toolbar buttons associated with registered actions,\n * handling their lifecycle, and appending/removing the toolbar element from the formatter's overlay.\n *\n * @remarks\n * - The toolbar is initialized and shown via the `create()` method, which collects all action buttons and appends them to the DOM.\n * - The `destroy()` method cleans up the toolbar, removes it from the DOM, and destroys all associated buttons to prevent memory leaks.\n *\n * @example\n * ```typescript\n * const toolbar = new Toolbar(formatter);\n * toolbar.create(); // Show toolbar\n * // ... later\n * toolbar.destroy(); // Hide and clean up toolbar\n * ```\n *\n * @public\n */\nexport default class Toolbar {\n    formatter: BlotFormatter;\n    element: HTMLElement;\n    buttons: Record<string, ToolbarButton> = {};\n\n    constructor(formatter: BlotFormatter) {\n        this.formatter = formatter;\n        this.element = document.createElement('div');\n        this.element.classList.add(this.formatter.options.toolbar.mainClassName);\n        this.element.addEventListener('mousedown', (event: MouseEvent) => {\n            event.stopPropagation();\n        });\n        if (this.formatter.options.toolbar.mainStyle) {\n            Object.assign(this.element.style, this.formatter.options.toolbar.mainStyle);\n        }\n    }\n\n    /**\n     * Creates and appends toolbar action buttons to the toolbar element. \n     * Called by BlotFormatter.show() to initialize the toolbar.\n     * \n     * Iterates through all actions registered in the formatter, collects their toolbar buttons,\n     * stores each button in the `buttons` map by its action name, and appends the created button elements\n     * to the toolbar's DOM element. Finally, appends the toolbar element to the formatter's overlay.\n     */\n    create = (): void => {\n        const actionButtons: HTMLElement[] = [];\n        this.formatter.actions.forEach(action => {\n            action.toolbarButtons.forEach(button => {\n                this.buttons[button.action] = button;\n                actionButtons.push(button.create());\n            });\n        });\n        this.element.append(...actionButtons);\n        this.formatter.overlay.append(this.element);\n        if (this.formatter.options.debug) {\n            console.debug('Toolbar created with buttons:', Object.keys(this.buttons), actionButtons);\n        }\n    }\n\n    /**\n     * Cleans up the toolbar by removing its element from the overlay,\n     * destroying all associated buttons, and clearing internal references.\n     * Called by BlotFormatter.hide() to remove the toolbar from the DOM.\n     * \n     * This should be called when the toolbar is no longer needed to prevent memory leaks.\n     */\n    destroy = (): void => {\n        if (this.element) {\n            this.formatter.overlay.removeChild(this.element);\n        }\n        for (const button of Object.values(this.buttons)) {\n            button.destroy();\n        }\n        this.buttons = {};\n        this.element.innerHTML = '';\n        if (this.formatter.options.debug) {\n            console.debug('Toolbar destroyed');\n        }\n    }\n}","import type Quill from 'quill';\n\nexport default class TooltipContainPosition {\n  /**\n   * Repositions a tooltip element within a given container to ensure it does not overflow\n   * the container's boundaries. Adjusts the tooltip's `top` and `left` CSS properties if\n   * necessary to keep it fully visible. Optionally logs debug information about the repositioning.\n   *\n   * @param tooltip - The tooltip HTMLDivElement to reposition.\n   * @param container - The container HTMLElement within which the tooltip should remain visible.\n   * @param debug - If true, logs debug information to the console. Defaults to false.\n   */\n  private static _repositionTooltip = (tooltip: HTMLDivElement, container: HTMLElement, debug = false) => {\n    const tooltipRect = tooltip.getBoundingClientRect();\n    const containerRect = container.getBoundingClientRect();\n\n    // Calculate position relative to the container\n    let left = tooltipRect.left - containerRect.left;\n    let top = tooltipRect.top - containerRect.top;\n    const width = tooltipRect.width;\n    const height = tooltipRect.height;\n    const maxWidth = container.clientWidth;\n    const maxHeight = container.clientHeight;\n\n    let changed = false;\n    const newStyles: { top?: string; left?: string } = {};\n\n    // 1) Top overflow \n    if (top < 0) {\n      newStyles.top = `${tooltipRect.height}px`;\n      changed = true;\n    }\n\n    // 2) Bottom overflow\n    if (top + height > maxHeight) {\n      newStyles.top = `${maxHeight - height}px`;\n      changed = true;\n    }\n\n    // 3) Left overflow\n    if (left < 0) {\n      newStyles.left = '0px';\n      changed = true;\n    }\n\n    // 4) Right overflow\n    if (left + width > maxWidth) {\n      newStyles.left = `${maxWidth - width}px`;\n      changed = true;\n    }\n\n    if (changed) {\n      if (debug) {\n        console.debug('Repositioning tooltip', newStyles);\n      }\n\n      // Apply all style changes at once to minimize mutations\n      if (newStyles.top !== undefined) {\n        tooltip.style.top = newStyles.top;\n      }\n      if (newStyles.left !== undefined) {\n        tooltip.style.left = newStyles.left;\n      }\n\n      if (tooltip.classList.contains('ql-flip')) {\n        tooltip.classList.remove('ql-flip');\n      }\n    } else {\n      if (debug) {\n        console.debug('Tooltip position is fine, no changes needed');\n      }\n    }\n  }\n  \n  // Static property to store observers\n  private static observers = new WeakMap<HTMLDivElement, MutationObserver>();\n\n  /**\n   * Observes changes to the tooltip's attributes and triggers repositioning when necessary.\n   *\n   * @param quill - The Quill editor instance containing the tooltip.\n   * @param debug - Optional flag to enable debug logging of attribute mutations.\n   *\n   * @remarks\n   * Uses a MutationObserver to monitor changes to the tooltip's `style` and `class` attributes.\n   * When a mutation is detected, the tooltip is repositioned within the container.\n   * If `debug` is true, mutation details are logged to the console.\n   */\n  static watchTooltip(quill: Quill, debug = false): void {\n    const tooltip = quill.container.querySelector('.ql-tooltip') as HTMLDivElement;\n    const container = quill.container;\n    if (!tooltip) {\n      console.warn('No tooltip found to watch for adjustments.');\n      return;\n    }\n    // Clean up any existing observer for this tooltip\n    this.removeTooltipWatcher(tooltip, debug);\n\n    let isRepositioning = false;\n\n    const observer = new MutationObserver((mutations: MutationRecord[]) => {\n      // Ignore mutations caused by our own repositioning\n      if (isRepositioning) return;\n\n      if (debug) {\n        for (const m of mutations) {\n          console.debug('Tooltip mutation:', m.attributeName, tooltip.getAttribute(m.attributeName!));\n        }\n      }\n\n      isRepositioning = true;\n      this._repositionTooltip(tooltip, container, debug);\n      // Use setTimeout to reset the flag after the current execution context\n      setTimeout(() => {\n        isRepositioning = false;\n      }, 0);\n    });\n\n    observer.observe(tooltip, {\n      attributes: true,\n      attributeFilter: ['style', 'class'],\n    });\n\n    // Store the observer for later cleanup\n    this.observers.set(tooltip, observer);\n  }\n\n  /**\n   * Removes the MutationObserver for the specified tooltip element.\n   *\n   * @param tooltip - The HTMLDivElement or Quill instance to stop watching.\n   *                  If a Quill instance is provided, finds the tooltip within its container.\n   */\n  static removeTooltipWatcher(tooltip: HTMLDivElement | Quill, debug = false): void {\n    let tooltipElement: HTMLDivElement | null = null;\n\n    if (tooltip instanceof HTMLDivElement) {\n      tooltipElement = tooltip;\n    } else {\n      // Assume it's a Quill instance\n      tooltipElement = tooltip.container.querySelector('.ql-tooltip') as HTMLDivElement;\n    }\n\n    if (tooltipElement && this.observers.has(tooltipElement)) {\n      const observer = this.observers.get(tooltipElement);\n      observer?.disconnect();\n      this.observers.delete(tooltipElement);\n      if (debug) {\n        console.debug('Tooltip watcher removed for:', tooltipElement);\n      }\n    }\n  }\n\n  /**\n   * Initializes the tooltip adjustment watcher when the action is created.\n   * Searches for the tooltip element within the Quill container and, if found,\n   * sets up observation for tooltip adjustments. Logs a warning if the tooltip\n   * element is not present.\n   *\n   * @remarks\n   * This method should be called during the creation lifecycle of the action.\n   */\n  constructor(private readonly quill: Quill, private readonly debug = false) {\n    const tooltip = quill.container.querySelector('.ql-tooltip') as HTMLDivElement;\n    console.debug('tooltip:', tooltip);\n    if (tooltip) {\n      TooltipContainPosition.watchTooltip(quill, debug);\n      if (debug) {\n        console.debug('Tooltip watcher initialized for:', tooltip);\n      }\n    } else {\n      console.warn('No tooltip found to watch for adjustments.');\n    }\n  }\n\n  /**\n   * Cleans up resources when the action is destroyed.\n   * Specifically, it finds the tooltip element within the Quill editor container\n   * and removes its associated watcher if the tooltip exists.\n   */\n  destroy = (): void => {\n    const tooltip = this.quill.container.querySelector('.ql-tooltip') as HTMLDivElement;\n    if (tooltip) {\n      TooltipContainPosition.removeTooltipWatcher(this.quill, this.debug);\n      if (this.debug) {\n        console.debug('Tooltip watcher removed on destroy');\n      }\n    }\n  }\n\n}\n","\n/**\n * Factory function to create a custom Quill Image blot class supporting additional attributes.\n *\n * This function returns a class extending Quill's native Image blot, adding support for the `title` attribute\n * (in addition to `alt`, `height`, and `width`). The returned class overrides the static `formats` method\n * to extract these attributes from the DOM node, and the instance `format` method to set or remove them.\n *\n * @param QuillConstructor - The Quill constructor or instance used to import the base Image blot.\n * @returns A custom Image blot class supporting `alt`, `height`, `width`, and `title` attributes.\n *\n * @remarks\n * - This is useful for enabling the `title` attribute on images in Quill editors, which is not supported by default.\n * - See https://github.com/slab/quill/pull/4350 for related discussion.\n *\n * @example\n * ```typescript\n * const CustomImageBlot = createAltTitleImageBlotClass(Quill);\n * Quill.register(CustomImageBlot);\n * ```\n */\nexport const createAltTitleImageBlotClass = (QuillConstructor: any): any => {\n    const ImageBlot = QuillConstructor.import('formats/image') as any;\n\n    const ATTRIBUTES = ['alt', 'height', 'width', 'title'];\n\n    /**\n     * Represents a custom image blot for Quill editor, extending the base `ImageBlot`.\n     * \n     * This class provides custom formatting logic to allow managing the `title` attribute missing from the native Quill image blot.\n     * See PR https://github.com/slab/quill/pull/4350 for more details.\n     * \n     * @remarks\n     * - The static `formats` method extracts supported attributes from a DOM node and returns them as a record.\n     * - The `format` method sets or removes supported attributes on the image DOM node, delegating to the superclass for unsupported attributes.\n     * \n     * @example\n     * ```typescript\n     * // Extract formats from an image DOM node\n     * const formats = Image.formats(domNode);\n     * \n     * // Format an image blot\n     * imageBlot.format('alt', 'A description');\n     * ```\n     */\n    return class Image extends ImageBlot {\n        static blotName = 'image';\n        static formats(domNode: Element) {\n            return ATTRIBUTES.reduce(\n                (formats: Record<string, string | null>, attribute) => {\n                    if (domNode.hasAttribute(attribute)) {\n                        formats[attribute] = domNode.getAttribute(attribute);\n                    }\n                    return formats;\n                },\n                {},\n            );\n        }\n\n        format(name: string, value: string) {\n            if (ATTRIBUTES.indexOf(name) > -1) {\n                if (value || name === 'alt') {\n                    this.domNode.setAttribute(name, value);\n                } else {\n                    this.domNode.removeAttribute(name);\n                }\n            } else {\n                super.format(name, value);\n            }\n        }\n    }\n}\n","interface IframeAlignValue {\n  align: string;\n  width: string;\n  relativeSize: string;\n}\n\ninterface ImageAlignInputValue {\n  align: string;\n  title: string;\n}\n\ninterface ImageAlignValue extends ImageAlignInputValue {\n  width: string;\n  contenteditable: string;\n  relativeSize: string;\n}\n\n/**\n * Represents a class type for Attributors, which are used to define and manage\n * custom attributes in Quill editors. This type describes a constructor signature\n * for Attributor classes, including their prototype and the attribute name they handle.\n *\n * @template T The instance type created by the constructor.\n * @property {string} attrName - The name of the attribute managed by the Attributor.\n */\nexport type AttributorClass = {\n  new (...args: any[]): any;\n  prototype: any;\n  attrName: string;\n}\n\n/**\n * Creates a custom Quill Attributor class for handling iframe alignment.\n *\n * This attributor allows alignment of iframe elements within the Quill editor by\n * applying a CSS class and managing related dataset properties. It also handles\n * width styling and tracks whether the width is relative (percentage-based).\n *\n * @param QuillConstructor - The Quill constructor or Quill instance used to import Parchment.\n * @returns A class extending Quill's ClassAttributor, customized for iframe alignment.\n *\n * @example\n *   this.Quill = this.quill.constructor\n *   const IframeAlignClass = createIframeAlignAttributor(this.Quill);\n *   this.IframeAlign = new IframeAlignClass();\n *   this.Quill.register({\n *     'formats/iframeAlign': this.IframeAlign,\n *     'attributors/class/iframeAlign': this.IframeAlign,\n *   }, true);\n * \n * @remarks\n * - Supported alignments: 'left', 'center', 'right'.\n * - Adds/removes the `ql-iframe-align` class and manages `data-blot-align` and `--resize-width` style.\n * - Handles both string and object values for alignment.\n */\nexport const createIframeAlignAttributor = (QuillConstructor: any): AttributorClass => {\n  const parchment = QuillConstructor.import('parchment') as any;\n  const { ClassAttributor, Scope } = parchment;\n\n  return class IframeAlignAttributor extends ClassAttributor {\n    static attrName = 'iframeAlign';\n\n    constructor(private debug = false) {\n      super('iframeAlign', 'ql-iframe-align', {\n        scope: Scope.BLOCK,\n        whitelist: ['left', 'center', 'right'],\n      });\n    }\n\n    /**\n     * Adds alignment and width-related formatting to the specified HTML element node.\n     *\n     * - Sets the alignment using the provided value, which can be either a string or an object containing an `align` property.\n     * - Stores the alignment value in the element's `data-blot-align` attribute.\n     * - Handles the element's `width` attribute:\n     *   - If present, ensures the width value includes units (appends 'px' if numeric only).\n     *   - Sets the CSS custom property `--resize-width` to the processed width value.\n     *   - Sets the `data-relative-size` attribute to `'true'` if the width ends with '%', otherwise `'false'`.\n     *   - If no width is specified, removes the `--resize-width` property and sets `data-relative-size` to `'false'`.\n     *\n     * @param node - The DOM element to which alignment and width formatting will be applied.\n     * @param value - The alignment value, either as a string or an object with an `align` property.\n     * @returns `true` if the formatting was successfully applied to an HTMLElement, otherwise `false`.\n     */\n    add(node: Element, value: IframeAlignValue): boolean {\n      if (this.debug) {\n        console.debug('IframeAlignAttributor.add', node, value);\n      }\n      if (node instanceof HTMLElement) {\n        if (typeof value === 'object') {\n          super.add(node, value.align);\n          node.dataset.blotAlign = value.align;\n        } else {\n          super.add(node, value);\n          node.dataset.blotAlign = value;\n        }\n        let width: string | null = node.getAttribute('width');\n        if (width) {\n          // width style value must include units, add 'px' if numeric only\n          if (!isNaN(Number(width.trim().slice(-1)))) {\n            width = `${width}px`\n          }\n          node.style.setProperty('--resize-width', width);\n          node.dataset.relativeSize = `${width.endsWith('%')}`;\n        } else {\n          node.style.removeProperty('--resize-width');\n          node.dataset.relativeSize = 'false';\n        }\n        if (this.debug) {\n          console.debug('IframeAlignAttributor.add - node:', node, 'aligned with:', value);\n        }\n        return true;\n      } else {\n        if (this.debug) {\n          console.debug('IframeAlignAttributor.add - node is not an HTMLElement, skipping alignment');\n        }\n        return false;\n      }\n    }\n\n    /**\n     * Removes the alignment formatting from the specified DOM element.\n     * \n     * If the provided node is an instance of HTMLElement, this method first calls the\n     * parent class's `remove` method to perform any additional removal logic, and then\n     * deletes the `data-blot-align` attribute from the element's dataset.\n     *\n     * @param node - The DOM element from which to remove the alignment formatting.\n     */\n    remove(node: Element): void {\n      if (this.debug) {\n        console.debug('IframeAlignAttributor.remove', node);\n      }\n      if (node instanceof HTMLElement) {\n        super.remove(node);\n        delete node.dataset.blotAlign;\n      }\n    }\n\n    /**\n     * Extracts alignment and width information from a given DOM element.\n     *\n     * @param node - The DOM element from which to extract alignment and width values.\n     * @returns An object containing:\n     *   - `align`: The alignment class name derived from the superclass's value method.\n     *   - `width`: The width value, determined from the element's CSS custom property '--resize-width', \n     *     its 'width' attribute, or an empty string if not present.\n     *   - `relativeSize`: A string indicating whether the width ends with a '%' character, representing a relative size.\n     */\n    value(node: Element): IframeAlignValue {\n      const className = super.value(node);\n      const width = (node instanceof HTMLElement) ?\n        node.style.getPropertyValue('--resize-width') || node.getAttribute('width') || '' :\n        '';\n      const value = {\n        align: className,\n        width: width,\n        relativeSize: `${width.endsWith('%')}`\n      };\n      if (this.debug) {\n        console.debug('IframeAlignAttributor.value', node, value);\n      }\n      return value;\n    }\n\n  }\n}\n\n/**\n * Creates a custom Quill Attributor class for handling image alignment within a span wrapper.\n * \n * This attributor enables alignment formatting (`left`, `center`, `right`) for images by wrapping them in a `<span>`\n * element with a specific class and managing related attributes such as `data-title` for captions and width handling.\n * It also ensures that the image's alignment and caption are properly reflected in the DOM and Quill's internal model.\n * \n * @param QuillConstructor - The Quill constructor or instance used to import Parchment and related classes.\n * @returns A custom AttributorClass for image alignment formatting.\n * \n * @example\n *   this.Quill = this.quill.constructor\n *   const ImageAlignClass = createImageAlignAttributor(this.Quill);\n *   this.ImageAlign = new ImageAlignClass();\n *   this.Quill.register({\n *     'formats/imageAlign': this.ImageAlign,\n *     'attributors/class/imageAlign': this.ImageAlign,\n *   }, true);\n *\n * @remarks\n * - The attributor manages both string and object values for alignment, supporting additional metadata like `title`.\n * - It ensures the wrapper span is not editable and synchronizes width information for correct CSS rendering.\n * - Handles edge cases where Quill merges inline styles, ensuring the image alignment format is reapplied as needed.\n * - The `remove` and `value` methods ensure proper cleanup and retrieval of alignment state.\n */\nexport const createImageAlignAttributor = (QuillConstructor: any): AttributorClass => {\n  const parchment = QuillConstructor.import('parchment') as any;\n  const { ClassAttributor, Scope } = parchment;\n\n  return class ImageAlignAttributor extends ClassAttributor {\n    static tagName = 'SPAN';\n    static attrName = 'imageAlign';\n\n    constructor(private debug = false) {\n      super('imageAlign', 'ql-image-align', {\n        scope: Scope.INLINE,\n        whitelist: ['left', 'center', 'right'],\n      });\n    }\n\n    /**\n     * Adds or updates alignment and related formatting for an image wrapper node.\n     *\n     * This method applies alignment, caption, and width formatting to a given node containing an image.\n     * It handles both object-based and string-based alignment values, updates relevant attributes,\n     * and ensures the wrapper is styled correctly for Quill's image formatting.\n     *\n     * - If the node is an HTMLSpanElement, it sets alignment, caption (data-title), and width attributes.\n     * - If the node is not a span, it attempts to find an image child and reapply the imageAlign format.\n     * - Handles Quill's inline style merging quirks to avoid redundant wrappers.\n     *\n     * @param node - The DOM element (typically a span or container) to apply formatting to.\n     * @param value - The alignment value, which can be a string or an object containing alignment and optional title.\n     * @returns `true` if formatting was applied or handled, `false` otherwise.\n     */\n    add(node: Element, value: ImageAlignInputValue | string): boolean {\n      if (this.debug) {\n        console.debug('ImageAlignAttributor.add', node, value);\n      }\n      if (node instanceof HTMLSpanElement && value) {\n        let imageElement = node.querySelector('img') as HTMLImageElement;\n        if (typeof value === 'object' && value.align) {\n          super.add(node, value.align);\n          node.setAttribute('contenteditable', 'false');\n          // data-title used to populate caption via ::after\n          if (!!value.title) {\n            node.setAttribute('data-title', value.title);\n          } else {\n            node.removeAttribute('data-title');\n          }\n          if (value.align) {\n            imageElement.dataset.blotAlign = value.align;\n          }\n          if (this.debug) {\n            console.debug('ImageAlignAttributor.add - imageElement:', imageElement, 'aligned with:', value.align);\n          }\n        } else if (typeof value === 'string') {\n          super.add(node, value);\n          imageElement.dataset.blotAlign = value;\n          if (this.debug) {\n            console.debug('ImageAlignAttributor.add - imageElement:', imageElement, 'aligned with:', value);\n          }\n        } else {\n          if (this.debug) {\n            console.debug('ImageAlignAttributor.add - no value provided, skipping alignment');\n          }\n          return false;\n        }\n        // set width style property on wrapper if image and has imageAlign format\n        // fallback to image natural width if width attribute missing (image not resized))\n        // width needed to size wrapper correctly via css\n        // width style value must include units, add 'px' if numeric only\n        let width: string | null = this.getImageWidth(imageElement);\n        node.setAttribute('data-relative-size', `${width?.endsWith('%')}`)\n        return true;\n      } else {\n        // bug fix - Quill's inline styles merge elements and remove span element if styles nested\n        // for the first outer style, reapply imageAlign format on image \n        // for subsequent outer styles, skip reformat and just return true - will nest multiple span wrappers otherwise\n        const imageElement = node instanceof HTMLImageElement ? node : node.querySelector('img');\n        if (this.debug)\n          console.debug(`ImageAlignAttributor.add - ${node.tagName} is not a span, checking for image:`, imageElement);\n        if (imageElement instanceof HTMLImageElement) {\n          // Use QuillConstructor.find to find the image blot, using global Quill static methods will always return null \n          //   in some environments such as vite, react, etc.\n          const imageBlot = QuillConstructor.find(imageElement) as any;\n          if (this.debug) {\n            console.debug('ImageAlignAttributor.add - found image blot:', imageBlot);\n          }\n          if (\n            imageBlot &&\n            (\n              node.firstChild instanceof HTMLSpanElement ||\n              !(imageElement.parentElement?.matches('span[class^=\"ql-image-align-\"]'))\n            )\n          ) {\n            imageBlot.format('imageAlign', value);\n            if (this.debug) {\n              console.debug('ImageAlignAttributor.add - reapplying imageAlign format to image blot:', value, imageBlot);\n            }\n          }\n          return true;\n        }\n        return false;\n      }\n    }\n\n    /**\n     * Removes alignment formatting from the given DOM node.\n     *\n     * If the node is an HTMLElement, it first calls the parent class's remove method.\n     * Then, if the node's first child is also an HTMLElement, it deletes the `blotAlign`\n     * data attribute from that child element.\n     *\n     * @param node - The DOM element from which to remove alignment formatting.\n     */\n    remove(node: Element): void {\n      if (this.debug) {\n        console.debug('ImageAlignAttributor.remove', node);\n      }\n      if (node instanceof HTMLElement) {\n        super.remove(node);\n        if (node.firstChild && (node.firstChild instanceof HTMLElement)) {\n          delete node.firstChild.dataset.blotAlign;\n        }\n      }\n    }\n\n    /**\n     * Retrieves alignment and metadata information for an image element within a given DOM node.\n     *\n     * This method attempts to find an `<img>` element within the provided node, then extracts its alignment,\n     * title, and width attributes. If the width attribute is missing or invalid, it tries to determine the width\n     * either immediately (if the image is loaded) or by setting an `onload` handler. The method returns an object\n     * containing the alignment, title, width, a `contenteditable` flag, and a boolean string indicating if the width\n     * is specified as a percentage.\n     *\n     * @param node - The DOM element to search for an image and extract alignment and metadata from.\n     * @returns An object containing the image's alignment, title, width, contenteditable status, and relative size flag.\n     */\n    value(node: Element): ImageAlignValue {\n      // in case nested style, find image element and span wrapper\n      const imageElement = node.querySelector('img') as HTMLImageElement;\n      if (!imageElement) return null as any; // this can happen during certain 'undo' operations\n      const parentElement = imageElement.parentElement as HTMLElement;\n      const align = super.value(parentElement);\n      const title: string = imageElement.getAttribute('title') || '';\n      let width: string = imageElement.getAttribute('width') || '';\n      // attempt to get width if missing or image not loaded\n      if (!parseFloat(width)) {\n        if (imageElement.complete) {\n          width = this.getImageWidth(imageElement);\n        } else {\n          imageElement.onload = (event) => {\n            width = this.getImageWidth(event.target as HTMLImageElement);\n          }\n        }\n      }\n      const value = {\n        align: align,\n        title: title,\n        width: width,\n        contenteditable: 'false',\n        relativeSize: `${width.endsWith('%')}`\n      };\n      if (this.debug) {\n        console.debug('ImageAlignAttributor.value', node, value);\n      }\n      return value;\n    }\n\n    /**\n     * Retrieves the width of the given HTMLImageElement, ensuring it is set as an attribute and formatted with 'px' units.\n     * \n     * - If the 'width' attribute is not present, it uses the image's natural width and sets it as the 'width' attribute in pixels.\n     * - If the 'width' attribute exists but does not end with a non-numeric character (i.e., is a number), it appends 'px' to the value.\n     * - Updates the parent element's CSS variable '--resize-width' with the computed width.\n     * \n     * @param imageElement - The HTMLImageElement whose width is to be retrieved and set.\n     * @returns The width of the image as a string with 'px' units.\n     */\n    getImageWidth(imageElement: HTMLImageElement) {\n      let width = imageElement.getAttribute('width');\n      if (!width) {\n        width = `${imageElement.naturalWidth}px`;\n        imageElement.setAttribute('width', width);\n      } else {\n        if (!isNaN(Number(width.trim().slice(-1)))) {\n          width = `${width}px`\n          imageElement.setAttribute('width', width);\n        }\n      }\n      (imageElement.parentElement as HTMLElement).style.setProperty('--resize-width', width);\n      return width;\n    }\n\n  }\n}\n","/**\n * Factory function to create a custom Quill video blot class with responsive styling.\n *\n * @param QuillConstructor - The Quill constructor or instance used to import the base video format.\n * @returns A class extending Quill's VideoEmbed, enforcing a 16:9 aspect ratio and full width for embedded videos.\n *\n * @remarks\n * The returned class, `VideoResponsive`, overrides the default video blot to ensure videos are displayed responsively.\n * The aspect ratio is controlled via the static `aspectRatio` property and applied to the video element's style.\n *\n * @example\n * ```typescript\n * const VideoResponsive = createResponsiveVideoBlotClass(Quill);\n * Quill.register(VideoResponsive);\n * ```\n */\nexport const createResponsiveVideoBlotClass = (QuillConstructor: any): any => {\n    const VideoEmbed = QuillConstructor.import(\"formats/video\") as any;\n\n    /**\n     * A custom Quill blot for embedding responsive videos.\n     * Extends `VideoEmbed` to ensure videos use a 16:9 aspect ratio and full width.\n     *\n     * @remarks\n     * The aspect ratio is set via the `aspectRatio` static property and applied to the video element's style.\n     *\n     * @example\n     * ```typescript\n     * const videoBlot = VideoResponsive.create('https://example.com/video.mp4');\n     * ```\n     *\n     * @extends VideoEmbed\n     */\n    return class VideoResponsive extends VideoEmbed {\n        static blotName = 'video';\n        static aspectRatio: string = \"16 / 9 auto\"\n        static create(value: string) {\n            const node = super.create(value);\n            node.setAttribute('width', '100%');\n            node.style.aspectRatio = this.aspectRatio;\n            return node;\n        }\n        html() {\n            return this.domNode.outerHTML;\n        }\n    }\n}\n","import BlotFormatter from '../../BlotFormatter';\nimport { Aligner } from './Aligner';\nimport type { Alignment } from './Alignment';\nimport type { Blot } from '../../specs/BlotSpec';\nimport type { Options } from '../../Options';\n\n/**\n * The `DefaultAligner` class provides alignment management for Quill editor blots (such as images and iframes).\n * It implements the `Aligner` interface and is responsible for applying, clearing, and querying alignment\n * formatting on supported blots within the editor.\n *\n * This class supports both inline and block-level blots, and can be configured with custom alignment options.\n * It interacts with Quill's Parchment module to determine blot types and scopes, and uses formatter options\n * to control alignment and resizing behaviors.\n *\n * Key features:\n * - Registers available alignments and exposes them via `getAlignments()`.\n * - Applies alignment to blots using `setAlignment()`, handling both inline (e.g., images) and block (e.g., iframes) elements.\n * - Clears alignment formatting from blots with `clear()`.\n * - Determines blot type and scope with utility methods (`isInlineBlot`, `isBlockBlot`, `hasInlineScope`, `hasBlockScope`).\n * - Checks and retrieves current alignment with `isAligned()` and `getAlignment()`.\n * - Optionally sets relative width for images if configured.\n * - Ensures editor usability by adding a new paragraph if the editor contains only an aligned image.\n *\n * @remarks\n * This class is intended for internal use by the BlotFormatter module and expects a properly configured\n * `BlotFormatter` instance with alignment and resize options.\n *\n * @example\n * ```typescript\n * const aligner = new DefaultAligner(formatter);\n * aligner.setAlignment(blot, 'center');\n * ```\n *\n * @see Aligner\n * @see BlotFormatter\n */\nexport default class DefaultAligner implements Aligner {\n  alignments: Record<string, Alignment> = {};\n  options: Options;\n  formatter: BlotFormatter;\n  private debug: boolean;\n  private Scope: any;\n\n  constructor(formatter: BlotFormatter) {\n    this.formatter = formatter;    // Get Scope from the formatter's Quill constructor\n    this.debug = formatter.options.debug ?? false;\n    const parchment = formatter.Quill.import('parchment') as any;\n    this.Scope = parchment.Scope;\n    this.options = formatter.options;\n    this.options.align.alignments.forEach(alignment => {\n      this.alignments[alignment] = {\n        name: alignment,\n        apply: (blot: Blot | null) => {\n          this.setAlignment(blot, alignment);\n        },\n      }\n    })\n    if (this.debug) {\n      console.debug('DefaultAligner created with alignments:', this.alignments);\n    }\n  }\n\n  /**\n   * Retrieves all available alignment options.\n   *\n   * @returns {Alignment[]} An array of alignment objects defined in the `alignments` property.\n   */\n  getAlignments = (): Alignment[] => {\n    return Object.keys(this.alignments).map(k => this.alignments[k]);\n  }\n\n  /**\n   * Clears alignment formatting from the given blot if it is an image or iframe.\n   *\n   * - For image blots (`IMG`), if the parent is a `SPAN`, removes the alignment attribute from the parent.\n   * - For iframe blots (`IFRAME`), removes the alignment attribute directly from the blot.\n   *\n   * @param blot - The blot to clear alignment formatting from, or `null` if none.\n   */\n  clear = (blot: Blot | null): void => {\n    if (blot != null) {\n      if (blot.domNode.tagName === 'IMG') {\n        if (blot.parent !== null && blot.parent.domNode.tagName === 'SPAN') {\n          blot.parent.format(this.formatter.ImageAlign.attrName, false)\n          if (this.debug) {\n            console.debug('Cleared image alignment from parent span:', blot.parent);\n          }\n        }\n      } else if (blot.domNode.tagName === 'IFRAME') {\n        blot.format(this.formatter.IframeAlign.attrName, false)\n        if (this.debug) {\n          console.debug('Cleared iframe alignment:', blot);\n        }\n      }\n    }\n  }\n\n  /**\n   * Determines whether the given blot is an inline blot.\n   *\n   * Checks if the provided `blot` has a scope that matches the inline blot scope.\n   *\n   * @param blot - The blot instance to check.\n   * @returns `true` if the blot is an inline blot; otherwise, `false`.\n   */\n  isInlineBlot = (blot: Blot): boolean => {\n    return (blot.statics?.scope & this.Scope.INLINE) === this.Scope.INLINE_BLOT;\n  }\n\n  /**\n   * Determines if the provided blot is a block-level blot.\n   *\n   * Checks the blot's static scope against the BLOCK scope constant,\n   * and returns true if it matches the BLOCK_BLOT type.\n   *\n   * @param blot - The blot instance to check.\n   * @returns True if the blot is a block blot; otherwise, false.\n   */\n  isBlockBlot = (blot: Blot): boolean => {\n    return (blot.statics?.scope & this.Scope.BLOCK) === this.Scope.BLOCK_BLOT;\n  }\n\n  /**\n   * Determines whether the given blot has an inline scope.\n   *\n   * @param blot - The blot instance to check.\n   * @returns `true` if the blot's scope includes the inline scope; otherwise, `false`.\n   */\n  hasInlineScope = (blot: Blot): boolean => {\n    return (blot.statics.scope & this.Scope.INLINE) === this.Scope.INLINE;\n  }\n\n  /**\n   * Determines whether the given blot has block-level scope.\n   *\n   * @param blot - The blot instance to check.\n   * @returns `true` if the blot's scope includes block-level formatting; otherwise, `false`.\n   */\n  hasBlockScope = (blot: Blot): boolean => {\n    return (blot.statics.scope & this.Scope.BLOCK) === this.Scope.BLOCK;\n  }\n\n  /**\n   * Determines whether the given blot is aligned.\n   *\n   * If an alignment is specified, returns `true` only if the blot's alignment matches the specified alignment.\n   * If no alignment is specified, returns `true` if the blot has any alignment.\n   *\n   * @param blot - The blot to check for alignment.\n   * @param alignment - The alignment to compare against, or `null` to check for any alignment.\n   * @returns `true` if the blot is aligned (and matches the specified alignment, if provided); otherwise, `false`.\n   */\n  isAligned = (blot: Blot, alignment: Alignment | null): boolean => {\n    // true if blot is aligned, if alignment specfied then true only if alignment matches\n    const existingAlignment = this.getAlignment(blot);\n    if (alignment) {\n      return existingAlignment === alignment.name;\n    } else {\n      return (!!existingAlignment);\n    }\n  }\n\n  /**\n   * Retrieves the alignment value from the given blot's DOM node.\n   *\n   * @param blot - The blot instance whose alignment is to be determined.\n   * @returns The alignment value as a string if present, otherwise `undefined`.\n   */\n  getAlignment = (blot: Blot): string | undefined => {\n    return blot.domNode.dataset.blotAlign;\n  }\n\n  /**\n   * Sets the alignment for a given blot (content element) in the editor.\n   *\n   * This method checks if the blot is already aligned as requested. If not, it clears any existing alignment,\n   * and applies the new alignment based on the blot type (inline or block). For inline blots (such as images),\n   * it may also set a relative width attribute if required by the configuration. For block blots (such as iframes),\n   * it applies the alignment directly.\n   *\n   * Additionally, if the editor contains only an image, it ensures a new paragraph is added underneath to maintain\n   * editor usability.\n   *\n   * @param blot - The blot (content element) to align. Can be `null`, in which case no action is taken.\n   * @param alignment - The alignment to apply (e.g., 'left', 'center', 'right'). Must correspond to a key in `this.alignments`.\n   */\n  setAlignment = (blot: Blot | null, alignment: string): void => {\n    if (blot === null) {\n      if (this.debug) console.debug('DefaultAligner.setAlignment called with null blot, no action taken');\n      return;\n    }\n    const hasAlignment = this.isAligned(blot, this.alignments[alignment]);\n    if (this.debug) console.debug('hasAlignment', hasAlignment);\n    this.clear(blot);\n    if (!hasAlignment) {\n      if (this.isInlineBlot(blot) || this.hasInlineScope(blot)) {\n        if (this.debug) console.debug('setting alignment', (this.isInlineBlot(blot) || this.hasInlineScope(blot)));\n        // if no width attr and use relative mandatory, try to set relative width attr\n        if (\n          !blot.domNode.getAttribute('width') &&\n          this.options.resize.useRelativeSize &&\n          !this.options.resize.allowResizeModeChange\n        ) {\n          try {\n            const editorStyle = getComputedStyle(this.formatter.quill.root);\n            const editorWidth = this.formatter.quill.root.clientWidth -\n              parseFloat(editorStyle.paddingLeft) -\n              parseFloat(editorStyle.paddingRight);\n            blot.domNode.setAttribute(\n              'width',\n              `${Math.min(Math.round(100 * (blot.domNode as HTMLImageElement).naturalWidth / editorWidth), 100)}%`\n            )\n          } catch {\n            if (this.debug) console.debug('DefaultAligner.setAlignment Error setting image width:', blot);\n          }\n        }\n        if (this.debug) console.debug(\n          'DefaultAligner.setAlignment formatting image with',\n          this.formatter.ImageAlign.attrName,\n          {\n            align: this.alignments[alignment].name,\n            title: blot.domNode.getAttribute('title') || ''\n          }\n        )\n        blot.format(\n          this.formatter.ImageAlign.attrName,\n          {\n            align: this.alignments[alignment].name,\n            title: blot.domNode.getAttribute('title') || ''\n          }\n        );\n        // if image only item in editor, add new paragraph underneath otherwise no selectable item in editor\n        try {\n          const ops: any = this.formatter.quill.getContents().ops;\n          if (ops.length === 2 && ops[1].insert === '\\n') {\n            this.formatter.quill.insertText(this.formatter.quill.getLength(), '\\n', 'user');\n          }\n        } catch { }\n      } else if (this.isBlockBlot(blot) || this.hasBlockScope(blot)) {\n        if (this.debug) console.debug(\n          'DefaultAligner.setAlignment formatting iframe with',\n          this.formatter.IframeAlign.attrName,\n          {\n            align: this.alignments[alignment].name\n          }\n        )\n        blot.format(\n          this.formatter.IframeAlign.attrName,\n          this.alignments[alignment].name\n        );\n      }\n    }\n  }\n}\n\n","import { ToolbarOptions } from \"../../Options\";\n\nexport interface _ToolbarButton {\n    action: string;\n    element: HTMLElement | null;\n    icon: string;\n    selected: boolean;\n    visible: boolean;\n    onClick: EventListener;\n    options: ToolbarOptions;\n    create(action: string, icon: string): HTMLElement;\n}\n\n/**\n * Represents a toolbar button used in the Quill editor's formatting toolbar.\n * \n * The `ToolbarButton` class encapsulates the creation, management, and styling of a single toolbar button.\n * It provides methods for initializing the button element, handling selection and visibility states,\n * applying custom styles, and cleaning up resources when the button is destroyed.\n * Instances of this class should be added to the `toolbarButtons` array of an `Action` class.\n * \n * @implements {_ToolbarButton}\n * \n * @remarks\n * - The button's icon, action, and event handler are configured via the constructor.\n * - Customization options for styling, tooltips, and class names are provided through the `ToolbarOptions` object.\n * - Selection and visibility states are managed via getter/setter properties.\n * - The class is designed to be extended for custom selection logic via the `preselect` method.\n * \n * @example\n * ```typescript\n *     someAction.toolbarButtons = [\n *         new ToolbarButton(\n *             'someActionName',\n *             this.onClickHandler,\n *             this.formatter.options.toolbar,\n *         )\n *     ]\n * ```\n */\nexport default class ToolbarButton implements _ToolbarButton {\n    action: string;\n    icon: string;\n    onClick: EventListener;\n    options: ToolbarOptions;\n    element: HTMLElement | null = null;\n    initialVisibility: boolean = true; // preset visibility before button is created\n\n    constructor(\n        action: string,\n        onClickHandler: EventListener,\n        options: ToolbarOptions\n    ) {\n        this.action = action;\n        this.icon = options.icons[action as keyof typeof options.icons];\n        this.onClick = onClickHandler;\n        this.options = options;\n    }\n\n    /**\n     * Creates and initializes the toolbar button element.\n     * \n     * This method constructs a `span` element, sets its inner HTML to the provided icon,\n     * assigns the appropriate class name and action data attribute, and attaches the click handler.\n     * If tooltips are configured for the action, it sets the tooltip text.\n     * The button's selected and visible states are initialized, and custom styling is applied.\n     * \n     * @returns {HTMLElement} The created and configured toolbar button element.\n     */\n    create = (): HTMLElement => {\n        this.element = document.createElement('span');\n        this.element.innerHTML = this.icon;\n        this.element.className = this.options.buttonClassName;\n        this.element.dataset.action = this.action;\n        this.element.onclick = this.onClick;\n        if (this.options.tooltips && this.options.tooltips[this.action]) {\n            this.element.title = this.options.tooltips[this.action];\n        }\n        this.selected = this.preselect();\n        this.visible = this.initialVisibility;\n        this._styleButton();\n        return this.element;\n    }\n\n    /**\n     * Cleans up the toolbar button by removing its click event handler,\n     * detaching it from the DOM, and clearing the reference to the element.\n     * This method should be called when the button is no longer needed to\n     * prevent memory leaks.\n     */\n    destroy = (): void => {\n        if (this.element) {\n            this.element.onclick = null;\n            this.element.remove();\n            this.element = null;\n        }\n    }\n\n    /**\n     * Determines whether the toolbar button should appear as selected (active) when loaded.\n     * Override this method to provide custom logic for button selection state.\n     *\n     * @returns {boolean} `true` if the button should be preselected; otherwise, `false`.\n     */\n    preselect = (): boolean => {\n        // override this with logic to show if button is selected (active) when loaded\n        // someCriteria: boolean = true / false;\n        // return someCriteria;\n        return false;\n    }\n\n    /**\n     * Indicates whether the toolbar button is currently selected.\n     *\n     * Returns `true` if the underlying element's `data-selected` attribute is set to `'true'`, otherwise returns `false`.\n     */\n    get selected(): boolean {\n        return this.element?.dataset.selected === 'true';\n    }\n\n    /**\n     * Sets the selected state of the toolbar button.\n     * \n     * When set to `true`, applies the selected class and style to the button element.\n     * When set to `false`, removes the selected class and style, and reapplies the default button style if provided.\n     * Also updates the `data-selected` attribute on the element.\n     *\n     * @param value - Indicates whether the button should be in the selected state.\n     */\n    set selected(value: boolean) {\n        if (this.element) {\n            this.element.dataset.selected = value.toString();\n            // apply styles to indicate selected state\n            if (value) {\n                this.element.classList.add(this.options.buttonSelectedClassName);\n                if (this.options.buttonSelectedStyle) {\n                    Object.assign(this.element.style, this.options.buttonSelectedStyle);\n                }\n            } else {\n                this.element.classList.remove(this.options.buttonSelectedClassName);\n                if (this.options.buttonSelectedStyle) {\n                    this.element.removeAttribute('style');\n                    if (this.options.buttonStyle)\n                        Object.assign(this.element.style, this.options.buttonStyle);\n                }\n            }\n        }\n    }\n\n    /**\n     * Indicates whether the toolbar button is currently visible.\n     * Returns `true` if the button's element is not hidden (`display` is not set to `'none'`), otherwise returns `false`.\n     */\n    get visible(): boolean {\n        return this.element?.style.display !== 'none';\n    }\n\n    /**\n     * Sets the visibility of the toolbar button element.\n     * Accepts a CSS display value as a string or a boolean.\n     * If a boolean is provided, `true` sets the display to 'inline-block', and `false` sets it to 'none'.\n     * If a string is provided, it is used directly as the CSS display value.\n     *\n     * @param style - The desired visibility state, either as a CSS display string or a boolean.\n     */\n    set visible(style: string | boolean) {\n        if (this.element) {\n            if (typeof style === 'boolean') {\n                style = style ? 'inline-block' : 'none';\n            }\n            this.element.style.display = style\n        }\n    }\n\n    /**\n     * Applies custom styles to the toolbar button and its SVG child element, if provided in the options.\n     *\n     * - If `options.buttonStyle` is defined, it merges the style properties into the button's element.\n     * - If `options.svgStyle` is defined, it merges the style properties into the first child element (assumed to be an SVG).\n     *\n     * @private\n     */\n    private _styleButton = (): void => {\n        if (this.element) {\n            if (this.options.buttonStyle) {\n                Object.assign(this.element.style, this.options.buttonStyle);\n            }\n            if (this.options.svgStyle) {\n                const childElement = this.element.children[0] as HTMLElement; // Type assertion\n                if (childElement) {\n                    Object.assign(childElement.style, this.options.svgStyle);\n                }\n            }\n        }\n    }\n\n}","import Action from '../Action';\nimport BlotFormatter from '../../BlotFormatter';\nimport DefaultAligner from './DefaultAligner';\nimport ToolbarButton from '../toolbar/ToolbarButton';\nimport { Alignment } from './Alignment';\n\n/**\n * Provides alignment actions for Quill editor blots, including creating, managing,\n * and handling alignment toolbar buttons. Integrates with a `DefaultAligner` to\n * apply, clear, and detect alignment on selected blots. Handles UI state for\n * alignment buttons and supports debug logging.\n *\n * @remarks\n * This class is intended to be used as part of a Quill blot formatter extension,\n * enabling users to align embedded content (such as images or videos) via a toolbar.\n *\n * @extends Action\n *\n * @example\n * ```typescript\n * const alignAction = new AlignAction(formatter);\n * alignAction.onCreate();\n * // ... user interacts with toolbar ...\n * alignAction.onDestroy();\n * ```\n */\nexport default class AlignAction extends Action {\n  aligner: DefaultAligner;\n  alignButtons: Record<string, ToolbarButton> = {};\n\n  constructor(formatter: BlotFormatter) {\n    super(formatter);\n    this.aligner = new DefaultAligner(formatter);\n    if (formatter.options.debug) console.debug('AlignAction Aligner created:', this.aligner);\n  }\n\n  /**\n   * Creates alignment toolbar buttons for each available alignment option.\n   * \n   * Iterates over the alignments provided by the aligner and creates a `ToolbarButton`\n   * for each alignment, storing them in the `alignButtons` map. If there is a currently\n   * selected blot, it checks its alignment and preselects the corresponding button.\n   * Optionally logs debug information about the created buttons and the current alignment.\n   *\n   * @private\n   */\n  private _createAlignmentButtons = (): void => {\n    for (const alignment of Object.values(this.aligner.alignments)) {\n      this.alignButtons[alignment.name] = new ToolbarButton(\n        alignment.name,\n        this.onClickHandler,\n        this.formatter.options.toolbar\n      )\n    }\n    const targetBlot = this.formatter.currentSpec?.getTargetBlot();\n    if (targetBlot) {\n      const alignment: string | undefined = this.aligner.getAlignment(targetBlot);\n      if (alignment && this.alignButtons[alignment]) {\n        this.alignButtons[alignment].preselect = () => { return true };\n      }\n      if (this.debug) {\n        console.debug('AlignAction alignment buttons created:', this.alignButtons);\n        console.debug('Blot alignment on load:', alignment);\n      }\n    }\n  }\n\n  /**\n   * Clears the selection state of all alignment buttons.\n   *\n   * Iterates through all buttons in the `alignButtons` collection and sets their\n   * `selected` property to `false`. If debugging is enabled, logs a message to the console.\n   *\n   * @private\n   */\n  private _clearButtons = (): void => {\n    for (const button of Object.values(this.alignButtons)) {\n      button.selected = false;\n    }\n    if (this.debug) console.debug('AlignAction alignment buttons cleared');\n  }\n\n  /**\n   * Handles click events on alignment toolbar buttons.\n   *\n   * This event handler determines which alignment action was triggered by the user,\n   * retrieves the corresponding alignment configuration, and applies or clears the alignment\n   * on the currently selected blot in the editor. It also updates the toolbar button states\n   * and logs debug information if enabled.\n   *\n   * @param event - The click event triggered by the user on a toolbar button.\n   */\n  onClickHandler: EventListener = (event: Event): void => {\n    const button: HTMLElement | null = (event.target as HTMLElement)\n      .closest(`span.${this.formatter.options.toolbar.buttonClassName}`);\n    if (!!button) {\n      const action:string = button.dataset.action || '';\n      const targetBlot = this.formatter.currentSpec?.getTargetBlot();\n      if (!!action && !!targetBlot) {\n        const alignment: Alignment = this.aligner.alignments[action];\n        this._clearButtons();\n        if (this.aligner.isAligned(targetBlot, alignment)) {\n          this.aligner.clear(targetBlot);\n          if (this.debug) {\n            console.debug('AlignAction clear alignment:', action, targetBlot);\n          }\n        } else {\n          this.aligner.setAlignment(targetBlot, action);\n          this.alignButtons[action].selected = true;\n          if (this.debug) {\n            console.debug('AlignAction set alignment:', action, targetBlot);\n          }\n        }\n      }\n    }\n    this.formatter.update();\n  }\n\n  /**\n   * Initializes the alignment action by creating alignment buttons and storing them in the toolbar.\n   * If debug mode is enabled in the formatter options, logs the created alignment buttons to the console.\n   *\n   * @returns {void}\n   */\n  onCreate = (): void => {\n    this._createAlignmentButtons();\n    this.toolbarButtons = Object.values(this.alignButtons);\n    if (this.formatter.options.debug) console.debug('AlignAction alignment buttons created:', this.toolbarButtons);\n  }\n\n  /**\n   * Cleans up resources used by the alignment action.\n   * \n   * This method resets the `alignButtons` object and clears the `toolbarButtons` array.\n   * If debug mode is enabled in the formatter options, a debug message is logged to the console.\n   *\n   * @returns {void}\n   */\n  onDestroy = (): void => {\n    this.alignButtons = {};\n    this.toolbarButtons = [];\n    if (this.formatter.options.debug) console.debug('AlignAction alignment buttons destroyed');\n  }\n}\n","import Action from './Action';\n\n/**\n * Represents an action that handles deletion of a selected blot in a Quill editor.\n * \n * The `DeleteAction` class listens for keyboard and input events to detect when the user\n * presses the 'Delete' or 'Backspace' keys. If a blot is selected and no modal is open,\n * it deletes the corresponding blot from the editor and hides the formatter UI.\n * \n * @remarks\n * - Event listeners are attached on creation and removed on destruction to prevent memory leaks.\n * - The action only triggers when a blot is selected and no modal dialog with attribute `data-blot-formatter-modal` is open.\n * \n * @example\n * ```typescript\n * const deleteAction = new DeleteAction(formatter);\n * deleteAction.onCreate();\n * // ... later\n * deleteAction.onDestroy();\n * ```\n */\nexport default class DeleteAction extends Action {\n  /**\n   * Initializes event listeners for the delete action.\n   * \n   * - Adds a 'keyup' event listener to the document that triggers `_onKeyUp`.\n   * - Adds an 'input' event listener to the Quill editor's root element that also triggers `_onKeyUp`.\n   * \n   * This method should be called when the delete action is created to ensure\n   * proper handling of keyboard and input events.\n   */\n  onCreate = (): void => {\n    document.addEventListener('keyup', this._onKeyUp);\n    this.formatter.quill.root.addEventListener('input', this._onKeyUp);\n  }\n\n  /**\n   * Cleans up event listeners associated with the action.\n   * \n   * Removes the 'keyup' event listener from the document and the 'input' event listener\n   * from the Quill editor's root element to prevent memory leaks and unintended behavior\n   * after the action is destroyed.\n   */\n  onDestroy = (): void => {\n    document.removeEventListener('keyup', this._onKeyUp);\n    this.formatter.quill.root.removeEventListener('input', this._onKeyUp);\n  }\n\n  /**\n   * Handles the keyup event for delete and backspace actions.\n   * \n   * If no modal is open and a current spec is selected, checks if the pressed key is\n   * 'Delete' or 'Backspace'. If so, finds the target blot element in the Quill editor,\n   * determines its index, and deletes one character at that index. Afterwards, hides the formatter UI.\n   * \n   * @param e - The keyboard event triggered by the user.\n   */\n  private _onKeyUp = (e: KeyboardEvent): void => {\n    const modalOpen: boolean = !!document.querySelector('[data-blot-formatter-modal]')\n    if (!this.formatter.currentSpec || modalOpen) {\n      return;\n    }\n    // delete or backspace\n    if (e.code === 'Delete' || e.code === 'Backspace') {\n      if (this.debug) {\n        console.debug('DeleteAction keyup detected:', e.code);\n      }\n      // Get the target element from the current spec\n      const targetElement = this.formatter.currentSpec.getTargetElement();\n      if (targetElement) {\n        const blot = this.formatter.Quill.find(targetElement);\n        if (blot) {\n          const index = this.formatter.quill.getIndex(blot);\n          this.formatter.quill.deleteText(index, 1, \"user\"); // Deletes 1 character from index position\n        }\n      }\n      this.formatter.hide();\n    }\n  };\n}\n","import Action from './Action';\nimport BlotFormatter from '../BlotFormatter';\nimport ToolbarButton from './toolbar/ToolbarButton';\n\ninterface HandleStyle {\n  width?: string;\n  height?: string;\n}\n\n/**\n * Provides interactive resizing functionality for elements within a Quill editor overlay.\n * \n * `ResizeAction` manages the creation, positioning, and behavior of resize handles for supported elements\n * (such as images, videos, and iframes), allowing users to adjust their size via mouse or touch gestures.\n * It supports both absolute (pixel-based) and relative (percentage-based) sizing modes, aspect ratio maintenance,\n * and optional oversize protection for images. The class also integrates with a toolbar for toggling resize modes,\n * displays live size information, and ensures proper cleanup of DOM elements and event listeners.\n * \n * @remarks\n * - Handles mouse and touch events for resizing, including pinch-to-resize gestures.\n * - Maintains aspect ratio and supports custom aspect ratios for unclickable elements.\n * - Integrates with a toolbar for resize mode switching.\n * - Displays live size info and manages fade-out transitions.\n * - Supports oversize protection for images and SVG detection.\n * - Ensures proper cleanup to prevent memory leaks.\n * \n * @example\n * ```typescript\n * const resizeAction = new ResizeAction(formatter);\n * resizeAction.onCreate();\n * // ... user interacts with overlay ...\n * resizeAction.onDestroy();\n * ```\n */\nexport default class ResizeAction extends Action {\n  private _topLeftHandle: HTMLElement;\n  private _topRightHandle: HTMLElement;\n  private _bottomRightHandle: HTMLElement;\n  private _bottomLeftHandle: HTMLElement;\n  private _dragHandle: HTMLElement | null | undefined = null;\n  private _dragStartX: number = 0;\n  private _dragCursorStyle: HTMLElement;\n  private _preDragWidth: number = 0;\n  private _pinchStartDistance: number = 0;\n  private _calculatedAspectRatio: number = 0;\n  private _computedAspectRatio: string | undefined = undefined;\n  private _target: HTMLElement | null | undefined;\n  private _editorStyle: CSSStyleDeclaration | undefined;\n  private _editorWidth: number = 0;\n  private _useRelativeSize: boolean;\n  private _resizeModeButton: ToolbarButton | null = null;\n  private _isUnclickable: boolean = false;\n  private _hasResized: boolean = false;\n  private _formattedWidth: string = '';\n  private _sizeInfoTimerId: ReturnType<typeof setTimeout> | null = null;\n  private _isImage: boolean = false;\n  private _isSVG: boolean = false;\n  private _naturalWidth: number | undefined = undefined;\n\n  constructor(formatter: BlotFormatter) {\n    super(formatter);\n    this._topLeftHandle = this._createHandle('top-left', 'nwse-resize');\n    this._topRightHandle = this._createHandle('top-right', 'nesw-resize');\n    this._bottomRightHandle = this._createHandle('bottom-right', 'nwse-resize');\n    this._bottomLeftHandle = this._createHandle('bottom-left', 'nesw-resize');\n    this._dragCursorStyle = document.createElement('style');\n    this._useRelativeSize = this.formatter.options.resize.useRelativeSize;\n    if (formatter.options.resize.allowResizeModeChange) {\n      this._resizeModeButton = this._createResizeModeButton();\n      this.toolbarButtons = [\n        this._resizeModeButton\n      ]\n    }\n  }\n\n  /**\n   * Initializes the resize action by setting up the target element, determining its type,\n   * and appending resize handles to the overlay. Also attaches mouse and touch event listeners\n   * to the overlay for handling user interactions. Finally, positions the handles according to\n   * the specified style options.\n   *\n   * @remarks\n   * This method should be called when the resize action is created to ensure all necessary\n   * DOM elements and event listeners are properly initialized.\n   */\n  onCreate = (): void => {\n    this._target = this.formatter.currentSpec?.getTargetElement();\n    this._isUnclickable = this.formatter.currentSpec?.isUnclickable || false;\n    this._isImage = this._target instanceof HTMLImageElement;\n    if (this._isImage) {\n      this._isSVG = this._isSvgImage();\n    }\n\n    this.formatter.overlay.append(\n      this._topLeftHandle, this._topRightHandle,\n      this._bottomRightHandle, this._bottomLeftHandle\n    );\n    this.formatter.overlay.addEventListener('mousedown', this._onOverlayMouseDown)\n    this.formatter.overlay.addEventListener('mouseup', this._onOverlayMouseUp)\n\n    const passiveFalse = { passive: false } as EventListenerOptions;\n    this.formatter.overlay.addEventListener('touchstart', this._onOverlayTouchStart, passiveFalse);\n    this.formatter.overlay.addEventListener('touchmove', this._onOverlayTouchMove, passiveFalse);\n    this.formatter.overlay.addEventListener('touchend', this._onOverlayTouchEnd, passiveFalse);\n\n    const handleStyle: HandleStyle = this.formatter.options.resize.handleStyle || {};\n    this._repositionHandles(handleStyle);\n    if (this.debug) {\n      console.debug('ResizeAction created with target:', this._target, 'isUnclickable:', this._isUnclickable);\n    }\n  }\n\n  /**\n   * Cleans up resources and event listeners associated with the resize action.\n   * \n   * This method resets internal state, removes resize handles from the overlay,\n   * detaches mouse and touch event listeners, and triggers an update on the formatter.\n   * \n   * Should be called when the resize action is no longer needed to prevent memory leaks\n   * and unintended behavior.\n   */\n  onDestroy = (): void => {\n    this._target = null;\n    this._isUnclickable = false;\n    this._isImage = false;\n    this._naturalWidth = undefined;\n    this._isSVG = false;\n    this._setCursor('');\n    [\n      this._topLeftHandle, this._topRightHandle,\n      this._bottomRightHandle, this._bottomLeftHandle\n    ].forEach(handle => { handle.remove(); });\n    this.formatter.overlay.removeEventListener('mousedown', this._onOverlayMouseDown);\n    this.formatter.overlay.removeEventListener('mouseup', this._onOverlayMouseUp);\n\n    const passiveFalse = { passive: false } as EventListenerOptions;\n    this.formatter.overlay.removeEventListener('touchstart', this._onOverlayTouchStart, passiveFalse);\n    this.formatter.overlay.removeEventListener('touchmove', this._onOverlayTouchMove, passiveFalse);\n    this.formatter.overlay.removeEventListener('touchend', this._onOverlayTouchEnd, passiveFalse);\n    this.formatter.update();\n  }\n\n  /**\n   * Creates a resize handle element for the specified position with the given cursor style.\n   *\n   * The handle is styled using the class name and optional style provided in the formatter's options.\n   * It also sets a `data-position` attribute and attaches a pointer down event listener.\n   *\n   * @param position - The position identifier for the handle (e.g., 'top-left', 'bottom-right').\n   * @param cursor - The CSS cursor style to apply when hovering over the handle.\n   * @returns The created HTMLElement representing the resize handle.\n   */\n  private _createHandle = (position: string, cursor: string): HTMLElement => {\n    // create resize handles\n    const box = document.createElement('div');\n    box.classList.add(this.formatter.options.resize.handleClassName);\n    box.setAttribute('data-position', position);\n    box.style.cursor = cursor;\n    if (this.formatter.options.resize.handleStyle) {\n      Object.assign(box.style, this.formatter.options.resize.handleStyle);\n    }\n    box.addEventListener('pointerdown', this._onHandlePointerDown);\n    return box;\n  }\n\n  /**\n   * Repositions the resize handles around an element based on the provided handle style.\n   *\n   * @param handleStyle - Optional style object containing width and height properties for the handles.\n   *                      If provided, the handles are offset by half their width and height to center them.\n   *                      If not provided, default offsets of '0px' are used.\n   *\n   * The method updates the `left`, `right`, `top`, and `bottom` CSS properties of the four handles\n   * (`_topLeftHandle`, `_topRightHandle`, `_bottomRightHandle`, `_bottomLeftHandle`) to ensure they are\n   * correctly positioned relative to the element being resized.\n   */\n  private _repositionHandles = (handleStyle?: HandleStyle): void => {\n    // Cache offset calculations\n    const handleXOffset = handleStyle?.width ? `${-parseFloat(handleStyle.width) / 2}px` : '0px';\n    const handleYOffset = handleStyle?.height ? `${-parseFloat(handleStyle.height) / 2}px` : '0px';\n\n    // Use direct property assignment instead of Object.assign for better performance\n    const { style: topLeftStyle } = this._topLeftHandle;\n    topLeftStyle.left = handleXOffset;\n    topLeftStyle.top = handleYOffset;\n\n    const { style: topRightStyle } = this._topRightHandle;\n    topRightStyle.right = handleXOffset;\n    topRightStyle.top = handleYOffset;\n\n    const { style: bottomRightStyle } = this._bottomRightHandle;\n    bottomRightStyle.right = handleXOffset;\n    bottomRightStyle.bottom = handleYOffset;\n\n    const { style: bottomLeftStyle } = this._bottomLeftHandle;\n    bottomLeftStyle.left = handleXOffset;\n    bottomLeftStyle.bottom = handleYOffset;\n  }\n\n  /**\n   * Sets the cursor style for the document body and all its children.\n   * When a non-empty value is provided, it applies the specified cursor style\n   * globally by injecting a style element into the document head.\n   * When an empty value is provided, it removes the previously injected style element,\n   * reverting the cursor to its default behavior.\n   *\n   * @param value - The CSS cursor value to apply (e.g., 'pointer', 'col-resize').\n   */\n  private _setCursor = (value: string): void => {\n    if (!document.body) {\n      console.warn('ResizeAction: Cannot set cursor - document.body is null');\n      return;\n    }\n\n    try {\n      if (value) {\n        this._dragCursorStyle.innerHTML = `body, body * { cursor: ${value} !important; }`;\n        if (!document.head.contains(this._dragCursorStyle)) {\n          document.head.appendChild(this._dragCursorStyle);\n        }\n      } else {\n        if (document.head.contains(this._dragCursorStyle)) {\n          document.head.removeChild(this._dragCursorStyle);\n        }\n      }\n    } catch (error) {\n      console.error('ResizeAction: Error setting cursor style:', error);\n    }\n  }\n\n  /**\n   * Activates or deactivates the resize mode for the target element.\n   * \n   * When activated, prepares the target for resizing by determining the resize mode (absolute or relative),\n   * calculating editor and target dimensions, handling aspect ratio logic, and displaying size information.\n   * When deactivated, applies the finalized width to the _target, updates toolbar button states, sets style attributes,\n   * clears cached natural width, updates the formatter, and hides the size info box.\n   * \n   * @param activate - If `true`, activates resize mode; if `false`, finalizes and deactivates resize mode.\n   */\n  private _resizeMode = (activate: boolean): void => {\n    if (activate) {\n      // activate resize mode, show size info\n      this._hasResized = false;\n      this._formattedWidth = '';\n      if (!!this._target) {\n        // determine resize mode to use (absolute/relative)\n        this._useRelativeSize = this.formatter._useRelative(this._target);\n        // get inner editor width to calculate % values\n        this._editorStyle = getComputedStyle(this.formatter.quill.root);\n        this._editorWidth = this.formatter.quill.root.clientWidth -\n          parseFloat(this._editorStyle.paddingLeft) -\n          parseFloat(this._editorStyle.paddingRight);\n\n        const rect = this._target.getBoundingClientRect();\n        // prevent division by zero in the case that rect.height is 0 for some reason\n        if (rect.height === undefined || rect.height === 0) {\n          rect.height = this._target.clientHeight + 1;\n        }\n        this._preDragWidth = rect.width;\n        this._computedAspectRatio = getComputedStyle(this._target).aspectRatio || 'auto'\n        this._calculatedAspectRatio = rect.width / rect.height;\n\n        if (this._useRelativeSize) {\n          if (this._isUnclickable) {\n            // strip height for relative iframe sizing, rely on aspect-ratio instead\n            if (this._computedAspectRatio === 'auto') {\n              // relative size on iframe requires aspect-ratio to be set - use default from options\n              this._target.style.aspectRatio = this.formatter.options.video.defaultAspectRatio;\n              console.warn(\n                `No iframe aspect-ratio set. Set an aspect ratio either via custom blot or css.\\n` +\n                `Using temporary aspect ratio \"${this.formatter.options.video.defaultAspectRatio}\"`\n              );\n            }\n          }\n        } else {\n          if (this._isUnclickable && this._computedAspectRatio !== 'auto') {\n            // if aspect-ratio set via blot or css, try to use that ratio for new height instead\n            const ratio = this._computedAspectRatio.match(/(\\d+)\\s*\\/\\s*(\\d+)/);\n            if (ratio) {\n              try {\n                this._calculatedAspectRatio = parseFloat(ratio[1]) / parseFloat(ratio[2]);\n              } catch { }\n            }\n          }\n        }\n        // get natural width if oversize protection on and resize mode is absolute (not relative) - excludes SVG\n        if (this._isImage && !this._useRelativeSize && !this._isSVG && this.formatter.options.resize.imageOversizeProtection) {\n          this._naturalWidth = (this._target as HTMLImageElement).naturalWidth;\n        }\n        // show size info box\n        this._showSizeInfo(true, rect.width, rect.height);\n        if (this.debug) {\n          console.debug('ResizeAction resize mode activated:', {\n            target: this._target,\n            useRelativeSize: this._useRelativeSize,\n            editorWidth: this._editorWidth,\n            preDragWidth: this._preDragWidth,\n            aspectRatio: this._calculatedAspectRatio,\n            computedAspectRatio: this._computedAspectRatio\n          });\n        }\n      }\n    } else {\n      if (this._target && this._hasResized) {\n        // round dimensions to whole numbers\n        let width: string = this._roundDimension(this._formattedWidth);\n        this._target.setAttribute('width', width);\n        // set resize mode button selected status if inuded in toolbar\n        if (this.formatter.toolbar.buttons['resizeMode']) {\n          this.formatter.toolbar.buttons['resizeMode'].selected = this.isRelative;\n        }\n        // set --resize-width style attribute and data-relative-size attribute\n        if (this._isUnclickable) {\n          this._target.style.setProperty('--resize-width', `${width}`);\n          this._target.dataset.relativeSize = `${this.isRelative}`\n        } else {\n          if (this.isAligned && this._target.parentElement) {\n            this._target.parentElement.style.setProperty('--resize-width', `${width}`);\n            this._target.parentElement.dataset.relativeSize = `${this.isRelative}`\n          }\n        }\n        if (this.debug) {\n          console.debug('ResizeAction resize mode deactivated:', {\n            target: this._target,\n            width: width,\n            isRelative: this.isRelative,\n            isAligned: this.isAligned\n          });\n        }\n      }\n      // clear any cached image natural width\n      this._naturalWidth = undefined;\n\n      this.formatter.update();\n      // fade out size info box\n      this._showSizeInfo(false);\n    }\n  };\n\n  /**\n   * Handles the pointer down event on a resize handle.\n   * \n   * Initiates the resize mode, sets up the drag handle, and stores the starting X position.\n   * Adds event listeners for pointer move and pointer up to enable drag behavior.\n   * \n   * @param event - The pointer event triggered when the user presses down on a resize handle.\n   */\n  private _onHandlePointerDown = (event: PointerEvent): void => {\n    this._resizeMode(true);\n    if (event.target instanceof HTMLElement && !!this._target) {\n      this._dragHandle = event.target;\n      this._setCursor(this._dragHandle.style.cursor);\n      this._dragStartX = event.clientX;\n      // enable drag behaviour until pointer up event\n      document.addEventListener('pointermove', this._onHandleDrag);\n      document.addEventListener('pointerup', this._onHandlePointerUp);\n    }\n  };\n\n  /**\n   * Handles the drag event for a resize handle, updating the target element's width.\n   *\n   * Calculates the new width based on the pointer's movement and the initial drag position.\n   * Ensures the new width stays within the editor's bounds and does not shrink below the minimum allowed width.\n   * Applies the new width to both the target element and its overlay.\n   *\n   * @param event - The pointer event triggered during dragging.\n   */\n  private _onHandleDrag = (event: PointerEvent): void => {\n    // If no target element or drag handle is set, exit early\n    if (!this._target || !this._dragHandle) return;\n\n    // Mark that a resize has occurred\n    this._hasResized = true;\n\n    // Calculate horizontal movement since drag started\n    const deltaX = event.clientX - this._dragStartX;\n\n    // Determine if the dragged handle is on the left side\n    const isLeftHandle =\n      this._dragHandle === this._topLeftHandle ||\n      this._dragHandle === this._bottomLeftHandle;\n\n    // Calculate new width: subtract delta for left handles, add for right handles\n    const newWidth = Math.round(\n      isLeftHandle ? this._preDragWidth - deltaX : this._preDragWidth + deltaX\n    );\n\n    // Constrain the new width between minimum and editor width\n    const constrainedWidth = Math.max(\n      Math.min(newWidth, this._editorWidth),\n      this.formatter.options.resize.minimumWidthPx\n    );\n\n    // Resize the target element to the constrained width\n    this._resizeTarget(constrainedWidth);\n  };\n\n  /**\n   * Handles the pointer up event on the resize handle.\n   * \n   * This method disables resize mode, resets the cursor style,\n   * and removes the event listeners for pointer movement and pointer up events.\n   * It is typically called when the user releases the pointer after resizing.\n   */\n  private _onHandlePointerUp = (): void => {\n    // disable resize mode, reset cursor, tidy up\n    this._setCursor('');\n    this._resizeMode(false);\n    // remove resize event listeners\n    document.removeEventListener('pointermove', this._onHandleDrag);\n    document.removeEventListener('pointerup', this._onHandlePointerUp);\n  };\n\n  /**\n   * Handles the touch start event on the overlay element.\n   * If the overlay itself is the _target, enables resize mode.\n   * When two fingers touch the target element, prevents default scrolling,\n   * calculates the initial distance between the fingers for pinch-to-resize,\n   * and stores the initial width of the target element.\n   *\n   * @param event - The touch event triggered on the overlay.\n   */\n  private _onOverlayTouchStart = (event: TouchEvent): void => {\n    if (event.target === this.formatter.overlay) {\n      this._resizeMode(true);\n      if (!!this._target && event.touches.length === 2) {\n        event.preventDefault(); // Prevent default touch behavior like scrolling\n        // Calculate the initial distance between two fingers\n        this._pinchStartDistance = this._calculateDistance(event.touches[0], event.touches[1]);\n        // Get the initial width of the element\n        this._preDragWidth = this._target.clientWidth;\n      }\n    }\n  }\n\n  /**\n   * Handles touch move events on the overlay for resizing the target element via pinch gestures.\n   *\n   * When two fingers are detected on the overlay, calculates the distance between them to determine\n   * the scale factor for resizing. The new width is constrained between a minimum of 10px and the\n   * maximum editor width. Prevents default touch behavior such as scrolling during the gesture.\n   *\n   * @param event - The touch event triggered by user interaction.\n   */\n  private _onOverlayTouchMove = (event: TouchEvent): void => {\n    if (event.target === this.formatter.overlay) {\n      if (!!this._target && event.touches.length === 2 && this._pinchStartDistance !== null && this._preDragWidth !== null) {\n        event.preventDefault(); // Prevent default touch behaviour like scrolling\n        if (this._target) {\n          this._hasResized = true;\n          // Calculate the current distance between two fingers\n          const currentDistance = this._calculateDistance(event.touches[0], event.touches[1]);\n          // Calculate the scale factor & new width\n          const scale = currentDistance / this._pinchStartDistance;\n          let newWidth: number = Math.round(this._preDragWidth * scale);\n          // ensure width does not grow beyond editor width or shrink below 10px\n          newWidth = Math.max(Math.min(newWidth, this._editorWidth), 10);\n          // resize target + overlay\n          this._resizeTarget(newWidth);\n        }\n      }\n    }\n  }\n\n  /**\n   * Handles the touch end event on the overlay element.\n   * If the touch event's target is the formatter's overlay, it disables resize mode.\n   *\n   * @param event - The touch event triggered on the overlay.\n   */\n  private _onOverlayTouchEnd = (event: TouchEvent): void => {\n    if (event.target === this.formatter.overlay) {\n      this._resizeMode(false);\n    }\n  }\n\n  /**\n   * Handles the mouse down event on the overlay element.\n   * If the event target is the formatter's overlay, enables resize mode.\n   *\n   * @param event - The mouse event triggered by the user interaction.\n   */\n  private _onOverlayMouseDown = (event: MouseEvent): void => {\n    if (event.target === this.formatter.overlay) {\n      this._resizeMode(true);\n    }\n  }\n\n  /**\n   * Handles the mouse up event on the overlay element.\n   * If the event target is the formatter's overlay, it disables resize mode.\n   *\n   * @param event - The mouse event triggered when the user releases the mouse button.\n   */\n  private _onOverlayMouseUp = (event: MouseEvent): void => {\n    if (event.target === this.formatter.overlay) {\n      this._resizeMode(false);\n    }\n  }\n\n  /**\n   * Resizes the target element to the specified width, maintaining aspect ratio and updating related UI elements.\n   *\n   * - Limits the new width if image oversize protection is enabled.\n   * - Calculates the new height based on the aspect ratio.\n   * - Updates the size information display.\n   * - Sets the new width and height attributes on the target element.\n   * - Applies the width style property to the wrapper if the image is aligned.\n   * - Handles special cases for unclickable elements and absolute sizing.\n   * - Triggers an update to the overlay position.\n   *\n   * @param newWidth - The desired new width for the target element.\n   */\n  private _resizeTarget = (newWidth: number): void => {\n    if (!this._target) {\n      console.warn('ResizeAction: Cannot resize - target element is null');\n      return;\n    }\n\n    try {\n      // if image oversize protection on, limit newWidth\n      // this._naturalWidth only has value when target is image and protextion is on (set in _resizeMode)\n      newWidth = Math.min(this._naturalWidth ?? Infinity, newWidth);\n      // update size info display\n      const newHeight: number = newWidth / this._calculatedAspectRatio;\n      this._updateSizeInfo(newWidth, newHeight);\n      // set new dimensions on _target\n      if (this.formatter._useRelative(this._target)) {\n        this._formattedWidth = `${100 * newWidth / this._editorWidth}%`;\n      } else {\n        this._formattedWidth = `${newWidth}px`;\n      }\n      this._target.setAttribute('width', this._formattedWidth);\n      this._target.setAttribute('height', 'auto');\n\n      // update width style property to wrapper if image and has imageAlign format\n      // width needed to size wrapper correctly via css\n      // set fixed height to unclickable if using absolute size mode and no aspect ratio given\n      if (this._isUnclickable) {\n        if (!this._useRelativeSize && this._computedAspectRatio === 'auto') {\n          this._target.setAttribute('height', `${newHeight | 0}px`);\n        }\n        this._target.style.setProperty('--resize-width', this._formattedWidth);\n      } else {\n        if (this.isAligned && !!this._target.parentElement) {\n          this._target.parentElement.style.setProperty('--resize-width', this._formattedWidth);\n        }\n        if (!this._useRelativeSize && !this.formatter.options.image.autoHeight) {\n          this._target.setAttribute('height', `${newHeight | 0}px`);\n        }\n      }\n      // updates overlay position\n      this.formatter.update();\n    } catch (error) {\n      console.error('ResizeAction: Error resizing target element:', error);\n    }\n  }\n\n  /**\n   * Shows or hides the size information box for the formatter.\n   *\n   * When `show` is `true`, cancels any existing size info timer, updates the size info\n   * if `width` and `height` are provided, and makes the size info box visible.\n   * When `show` is `false`, fades out and closes the size info box.\n   *\n   * @param show - Whether to show (`true`) or hide (`false`) the size info box.\n   * @param width - The width to display in the size info box (optional).\n   * @param height - The height to display in the size info box (optional).\n   */\n  private _showSizeInfo = (show: boolean, width: number | null = null, height: number | null = null): void => {\n    if (show) {\n      this._cancelSizeInfoTimer();\n      if (width !== null && height !== null) {\n        this._updateSizeInfo(width, height);\n      }\n      this.formatter.sizeInfo.style.transition = '';\n      this.formatter.sizeInfo.style.opacity = '1';\n    }\n    else {\n      // fade out size info box\n      this._closeSizeInfo();\n    }\n  }\n\n  /**\n   * Updates the size information display for the selected blot.\n   *\n   * - Rounds the provided width and height to the nearest integer.\n   * - Formats the size string as \"width x height px\".\n   * - If the size is relative, displays the percentage relative to the editor width,\n   *   with the actual pixel size in brackets.\n   * - If the size is absolute and the blot has not been resized:\n   *   - If the target element has a `width` attribute that differs from the displayed width,\n   *     shows the attribute value and its calculated height, with the displayed size in brackets.\n   *   - If the target is an image and its natural dimensions differ from the displayed size,\n   *     shows the natural dimensions with the displayed size in brackets.\n   * - Updates the `sizeInfo` element in the formatter with the computed size string.\n   *\n   * @param width - The displayed width of the blot.\n   * @param height - The displayed height of the blot.\n   */\n  private _updateSizeInfo = (width: number, height: number): void => {\n    // Round width and height to nearest integer for display\n    const roundedWidth = Math.round(width);\n    const roundedHeight = Math.round(height);\n    // Default size string in \"width x height px\" format\n    let size = `${roundedWidth} x ${roundedHeight}px`;\n\n    if (this.isRelative) {\n      // If using relative sizing, calculate percentage of editor width\n      const percentage = Math.round(100 * width / this._editorWidth);\n      // Show percentage and actual pixel size in brackets\n      size = `${percentage}% (${size})`;\n    } else if (!this._hasResized && this._target) {\n      // If not resized yet and target exists, check for set width attribute\n      const setWidth = this._target.getAttribute('width');\n      if (setWidth) {\n        // If set width differs from current width, show set width and calculated height\n        const setWidthNum = parseFloat(setWidth);\n        if (setWidthNum !== width) {\n          const aspectRatio = width / height;\n          const calculatedHeight = Math.round(setWidthNum / aspectRatio);\n          size = `${setWidth} x ${calculatedHeight}px (${size})`;\n        }\n      } else if (this._target instanceof HTMLImageElement) {\n        // For images, if natural width differs, show natural dimensions\n        const { naturalWidth, naturalHeight } = this._target;\n        if (naturalWidth !== width) {\n          size = `${naturalWidth} x ${naturalHeight}px (${size})`;\n        }\n      }\n    }\n\n    // Update the formatter's size info element with the computed size string\n    this.formatter.sizeInfo.innerText = size;\n  }\n\n  get isRelative(): boolean {\n    return this._target?.getAttribute('width')?.endsWith('%') || false;\n  }\n\n  get isAligned(): boolean {\n    if (this._target) {\n      return this._target.hasAttribute('data-blot-align');\n    } else {\n      return false;\n    }\n  }\n\n  /**\n   * Creates a toolbar button for toggling the resize mode.\n   *\n   * The button is initialized with a unique identifier, a click handler, and toolbar options.\n   * The `preselect` property is set to indicate whether the resize mode is currently relative.\n   *\n   * @returns {ToolbarButton} The configured resize mode toolbar button.\n   */\n  private _createResizeModeButton = (): ToolbarButton => {\n    const button = new ToolbarButton(\n      'resizeMode',\n      this._onResizeModeClickHandler,\n      this.formatter.options.toolbar,\n    );\n    button.preselect = () => {\n      return this.isRelative;\n    }\n    return button\n  }\n\n  /**\n   * Handles the click event for the resize mode control.\n   * Stops the event from propagating further and swaps the resize mode.\n   *\n   * @param event - The event object triggered by the click.\n   */\n  private _onResizeModeClickHandler: EventListener = (event: Event): void => {\n    event.stopImmediatePropagation();\n    this._swapResizeMode(true);\n  }\n\n  /**\n   * Swaps the resize mode of the target element between relative (percentage-based) and absolute (pixel-based) sizing.\n   * Updates the _target's width and height attributes, as well as relevant CSS custom properties and data attributes,\n   * depending on the current resize mode and alignment. Also updates the toolbar button state and optionally displays\n   * size information.\n   *\n   * @param showInfo - If true, displays size information after resizing.\n   */\n  private _swapResizeMode = (showInfo: boolean = false): void => {\n    if (this._target) {\n      const rect: DOMRect = this._target.getBoundingClientRect();\n      this._editorStyle = getComputedStyle(this.formatter.quill.root);\n      this._editorWidth = this.formatter.quill.root.clientWidth -\n        parseFloat(this._editorStyle.paddingLeft) -\n        parseFloat(this._editorStyle.paddingRight);\n      let newWidth, newHeight: string;\n      if (this.isRelative) {\n        newWidth = `${Math.round(rect.width)}px`;\n        newHeight = this.formatter.options.image.autoHeight \n          ? 'auto' \n          : `${Math.round(rect.height)}px`;\n      } else {\n        newWidth = `${Math.round(100 * rect.width / this._editorWidth)}%`;\n        newHeight = 'auto';\n      }\n      this._target.setAttribute('width', `${newWidth}`);\n      this._target.setAttribute('height', `${newHeight}`);\n      if (this.formatter.currentSpec?.isUnclickable) {\n        this._target.style.setProperty('--resize-width', `${newWidth}`);\n        this._target.dataset.relativeSize = `${this.isRelative}`;\n      } else {\n        if (this.isAligned && this._target.parentElement) {\n          this._target.parentElement.style.setProperty('--resize-width', `${newWidth}`);\n          this._target.parentElement.dataset.relativeSize = `${this.isRelative}`;\n        }\n      }\n      this.formatter.toolbar.buttons['resizeMode'].selected = this.isRelative;\n      this.formatter.update();\n      if (showInfo) {\n        this._showSizeInfo(true, rect.width, rect.height);\n        this._showSizeInfo(false);\n      }\n      if (this.debug) {\n        console.debug('ResizeAction resize mode swapped:', {\n          target: this._target,\n          newWidth: newWidth,\n          isRelative: this.isRelative,\n          isAligned: this.isAligned\n        });\n      }\n    }\n  }\n\n  /**\n   * Initiates a timer to fade out the size information element after a delay.\n   * Sets the opacity of the `sizeInfo` element to 0 with a transition effect after 1 second.\n   * Stores the timer ID in `_sizeInfoTimerId` for potential future reference or cancellation.\n   */\n  private _closeSizeInfo = (): void => {\n    this._sizeInfoTimerId = setTimeout(() => {\n      this.formatter.sizeInfo.style.transition = 'opacity 1s';\n      this.formatter.sizeInfo.style.opacity = '0';\n    }, 1000);\n  }\n\n  /**\n   * Cancels the active size info timer, if one exists.\n   * Clears the timeout associated with `_sizeInfoTimerId` and resets the timer ID to `null`.\n   */\n  private _cancelSizeInfoTimer = (): void => {\n    if (this._sizeInfoTimerId !== null) {\n      clearTimeout(this._sizeInfoTimerId);\n      this._sizeInfoTimerId = null;\n    }\n  }\n\n  /**\n   * Calculates the Euclidean distance between two touch points.\n   *\n   * @param touch1 - The first touch point.\n   * @param touch2 - The second touch point.\n   * @returns The distance in pixels between the two touch points.\n   */\n  private _calculateDistance = (touch1: Touch, touch2: Touch): number => {\n    const dx = touch2.clientX - touch1.clientX;\n    const dy = touch2.clientY - touch1.clientY;\n    return Math.sqrt(dx * dx + dy * dy);\n  }\n\n  /**\n   * Rounds the numeric part of a dimension string to the nearest integer, preserving any prefix or suffix.\n   *\n   * Examples:\n   * - '-$34.565c' becomes '-$35c'\n   * - '21.244px' becomes '21px'\n   *\n   * @param dim - The dimension string containing a number and optional prefix/suffix.\n   * @returns The dimension string with the numeric part rounded to the nearest integer.\n   */\n  private _roundDimension = (dim: string): string => {\n    // round string number with units (prefix and/or suffix): '-$34.565c' -> '-$35c', '21.244px' -> '24px'\n    return dim.replace(/([^0-9.-]*)(-?[\\d.]+)(.*)/, (_, prefix, num, suffix) => `${prefix}${Math.round(Number(num))}${suffix}`);\n  }\n\n  /**\n   * Determines whether the target image is an SVG image.\n   *\n   * Checks if the target is an HTMLImageElement and then verifies:\n   * - If the image source is a data URL, it checks for the 'image/svg+xml' MIME type.\n   * - Otherwise, it checks if the image source URL ends with '.svg'.\n   *\n   * @returns {boolean} True if the target image is an SVG, otherwise false.\n   */\n  private _isSvgImage = (): boolean => {\n    if (this._target instanceof HTMLImageElement) {\n      if (this._target.src.startsWith('data:image/')) {\n        return this._target.src.includes('image/svg+xml');\n      }\n      return this._target.src.endsWith('.svg');\n    }\n    return false;\n  }\n}\n","import Action from '../actions/Action';\nimport AlignAction from '../actions/align/AlignAction';\nimport BlotFormatter from '../BlotFormatter';\nimport CaretAction from '../actions/CaretAction';\nimport DeleteAction from '../actions/DeleteAction';\nimport ResizeAction from '../actions/ResizeAction';\n\nexport interface Blot {\n  domNode: HTMLElement;\n  parent: Blot | null;\n  next: Blot | null;\n  prev: Blot | null;\n  statics: any | null;\n  format(name: string, value: any): void | undefined;\n  formats(): { [key: string]: any };\n  length(): number;\n}\n\n/**\n * Abstract base class representing a specification for a Quill blot.\n *\n * `BlotSpec` provides a framework for defining custom blot behaviors and actions\n * within the Quill editor. Subclasses can override methods to implement specific\n * initialization, action handling, and element targeting logic for different blot types.\n *\n * @remarks\n * - Designed to be extended by concrete blot specification classes.\n * - Manages formatter instance and provides utility methods for blot manipulation.\n *\n * @example\n * ```typescript\n * class ImageBlotSpec extends BlotSpec {\n *   // Custom implementation for image blots\n * }\n * ```\n *\n * @property formatter - The `BlotFormatter` instance associated with this spec.\n * @property isUnclickable - Indicates whether the blot is unclickable.\n *\n * @method init - Initializes the blot specification. Intended to be overridden.\n * @method getActions - Returns an array of enabled `Action` objects for the current formatter. Intended to be extended.\n * @method getTargetElement - Returns the target HTML element for the blot. Intended to be overridden.\n * @method getTargetBlot - Retrieves the target blot associated with the current selection.\n * @method getOverlayElement - Returns the overlay element associated with the blot.\n * @method setSelection - Clears the current selection in the Quill editor.\n * @method onHide - Callback invoked when the blot is hidden. Intended to be overridden.\n */\nexport default class BlotSpec {\n  // abstract class for Blot specifications\n\n  formatter: BlotFormatter;\n  isUnclickable: boolean = false;\n\n  constructor(formatter: BlotFormatter) {\n    this.formatter = formatter;\n  }\n\n  /**\n   * Initializes the blot specification.\n   *\n   * This method is intended to perform any setup required for the blot spec.\n   * It can be overridden by subclasses to provide specific initialization logic.\n   * \n   */\n  init = (): void => {}\n\n  /**\n   * Returns an array of `Action` instances based on the formatter's configuration options.\n   * \n   * The returned actions may include:\n   * - `AlignAction` if aligning is allowed (`options.align.allowAligning`)\n   * - `ResizeAction` if resizing is allowed (`options.resize.allowResizing`)\n   * - `DeleteAction` if keyboard deletion is allowed (`options.delete.allowKeyboardDelete`)\n   * - Always includes `CaretAction`\n   *\n   * It can be overridden by subclasses to provide additional actions specific to the blot type.\n   * \n   * @returns {Array<Action>} An array of enabled `Action` objects for the current formatter.\n   */\n  getActions(): Array<Action> {\n    const actions: Array<Action> = [];\n    if (this.formatter.options.align.allowAligning) {\n      actions.push(new AlignAction(this.formatter));\n    }\n    if (this.formatter.options.resize.allowResizing) {\n      actions.push(new ResizeAction(this.formatter));\n    }\n    if (this.formatter.options.delete.allowKeyboardDelete) {\n      actions.push(new DeleteAction(this.formatter));\n    }\n    actions.push(new CaretAction(this.formatter));\n\n    return actions;\n  }\n\n  /**\n   * Returns the target HTML element associated with this blot.\n   * \n   * This method is intended to be overridden by subclasses to provide the specific target element\n   * for the blot type.\n   *\n   * @returns {HTMLElement | null} The target element, or `null` if none exists.\n   */\n  getTargetElement = (): HTMLElement | null => {\n    return null;\n  }\n\n  /**\n   * Retrieves the target blot associated with the current selection.\n   *\n   * This method first obtains the target DOM element using `getTargetElement()`.\n   * If a target element exists, it uses the Quill instance to find and return the corresponding blot.\n   * If no target element is found, it returns `null`.\n   * \n   * @remarks\n   * This method uses the quill instance constructor to overcome issue encountered with `Quill.find()`\n   * with certain environments where the `Quill` global differs from the one used in the quill instance.\n   * In those cases, the `find()` method will always return `null`. These environments include: vite,\n   * react and angular.\n   *\n   * @returns {Blot | null} The blot corresponding to the target element, or `null` if not found.\n   */\n  getTargetBlot = (): Blot | null => {\n    const target = this.getTargetElement();\n    if (!!target) {\n      return this.formatter.Quill.find(target) as Blot | null;\n    } else {\n      return null;\n    }\n  }\n\n  /**\n   * Returns the overlay element associated with the blot.\n   * \n   * @returns {HTMLElement | null} The overlay element, or `null` if none exists.\n   */\n  getOverlayElement = (): HTMLElement | null => {\n    return this.getTargetElement();\n  }\n\n  /**\n   * Clears the current selection in the Quill editor by setting it to `null`.\n   * This effectively removes any active text selection.\n   *\n   * @remarks\n   * Useful for resetting the editor's selection state, such as after formatting actions.\n   */\n  setSelection = (): void => {\n    this.formatter.quill.setSelection(null);\n  }\n\n  /**\n   * Callback invoked when the blot is hidden.\n   * Override this method to implement custom hide behavior.\n   */\n  onHide = (): void => {}\n}\n","import BlotFormatter from '../BlotFormatter';\nimport BlotSpec from './BlotSpec';\n\nconst PROXY_IMAGE_CLASS = 'blot-formatter__proxy-image';\n\ntype UnclickableProxy = {\n  unclickable: HTMLElement;\n  proxyImage: HTMLElement;\n};\ntype UnclickableProxies = Record<string, UnclickableProxy>;\n\n/**\n * Represents a Quill BlotSpec for managing \"unclickable\" elements within the editor.\n * \n * This class overlays transparent proxy images on unclickable HTML elements (such as videos)\n * to intercept user interactions and enable custom formatting behaviour. It tracks proxies,\n * synchronizes their positions with the underlying elements, and manages event listeners\n * for editor changes, scrolling, and resizing.\n * \n * Key Features:\n * - Automatically creates and removes proxy overlays for unclickable elements.\n * - Repositions proxies on editor scroll and resize events.\n * - Handles click events on proxies to trigger formatter overlays.\n * - Passes through wheel and touch events for smooth scrolling.\n * \n * @remarks\n * - Proxies are managed using a randomly generated ID stored in the element's dataset.\n * - The proxy container is appended to the Quill editor's container and holds all proxy images.\n * - Designed to work with Quill's BlotFormatter extension for custom video or media formatting.\n * \n * @extends BlotSpec\n */\nexport default class UnclickableBlotSpec extends BlotSpec {\n  selector: string;\n  unclickable: HTMLElement | null;\n  proxyContainer: HTMLElement;\n  unclickableProxies: UnclickableProxies;\n  isUnclickable: boolean = true;\n\n  constructor(formatter: BlotFormatter) {\n    super(formatter);\n    this.selector = formatter.options.video.selector;\n    this.unclickable = null;\n    this.proxyContainer = this._createProxyContainer();\n    this.unclickableProxies = {};\n  }\n\n  /**\n   * Initializes event listeners and observers for unclickable blot proxies.\n   * - Sets up a listener for Quill's 'text-change' event to handle updates.\n   * - Adds a scroll event listener to the Quill root to reposition proxy images when scrolling occurs.\n   * - Observes editor resize events to maintain correct proxy positioning.\n   */\n  init = (): void => {\n    // create unclickable proxies, position proxies over unclickables\n    this.formatter.quill.on('text-change', this._onTextChange);\n    // reposition proxy image if quill root scrolls (only if target is child of quill root)\n    this.formatter.quill.root.addEventListener('scroll', () => {\n      this._repositionProxyImages();\n    });\n    this._observeEditorResize();\n  }\n\n  /**\n   * Observes the Quill editor's root element for resize events and triggers repositioning\n   * of proxy images when the editor's dimensions change (e.g., due to screen resize or editor grow/shrink).\n   * Uses a debounced approach to avoid excessive repositioning by waiting 200ms after the last resize event.\n   *\n   * @remarks\n   * This method sets up a `ResizeObserver` on the editor's root element and calls\n   * `_repositionProxyImages` whenever a resize is detected, with debouncing to improve performance.\n   */\n  private _observeEditorResize = (): void => {\n    // reposition proxies if editor dimensions change (e.g. screen resize or editor grow/shrink)\n    let resizeTimeout: number | null = null;\n    const resizeObserver = new ResizeObserver((entries) => {\n      for (const entry of entries) {\n        // Clear the previous timeout if there was one\n        if (resizeTimeout) {\n          clearTimeout(resizeTimeout);\n        }\n        // Set a new timeout to run after 200ms\n        resizeTimeout = window.setTimeout(() => {\n          this._repositionProxyImages();\n        }, 200);\n      }\n    });\n    // Start observing the element for size changes\n    resizeObserver.observe(this.formatter.quill.root);\n  }\n\n  /**\n   * Returns the target HTML element associated with this instance.\n   * \n   * @returns {HTMLElement | null} The unclickable HTML element, or `null` if not set.\n   */\n  getTargetElement = (): HTMLElement | null => {\n    return this.unclickable;\n  }\n\n  /**\n   * Returns the overlay HTML element associated with the blot, or `null` if none exists.\n   *\n   * @returns {HTMLElement | null} The unclickable overlay element, or `null` if not set.\n   */\n  getOverlayElement = (): HTMLElement | null => {\n    return this.unclickable;\n  }\n\n  /**\n   * Handles changes to the text content within the Quill editor.\n   *\n   * This method performs the following actions:\n   * 1. Checks if any \"unclickable\" elements tracked by proxies have been deleted from the editor.\n   *    If so, it removes their corresponding proxy images and cleans up the tracking object.\n   * 2. Searches for new \"unclickable\" elements that do not yet have a proxy image and creates proxies for them.\n   * 3. Repositions all proxy images to ensure they are correctly aligned with their associated elements.\n   *\n   * This method is intended to be called whenever the editor's content changes to keep proxy images in sync.\n   */\n  private _onTextChange = (): void => {\n    // check if any unclickable has been deleted, remove proxy if so\n    Object.entries(this.unclickableProxies).forEach(([key, { unclickable, proxyImage }]) => {\n      try {\n        if (!this.formatter.quill.root.contains(unclickable)) {\n          proxyImage.remove();\n          delete this.unclickableProxies[key];\n        }\n      } catch { }\n    });\n    // add proxy for any new unclickables\n    this.formatter.quill.root.querySelectorAll(`${this.selector}:not([data-blot-formatter-id])`)\n      .forEach((unclickable: HTMLElement) => {\n        this._createUnclickableProxyImage(unclickable);\n      });\n    this._repositionProxyImages();\n  };\n\n  /**\n   * Creates a transparent proxy image overlay for an unclickable HTML element.\n   * The proxy image is linked to the unclickable element via a randomly generated ID,\n   * which is stored in the element's dataset and used as a key in the `unclickableProxies` record.\n   * The proxy image is styled to be absolutely positioned and unselectable, and is appended to the proxy container.\n   * Event listeners are attached to the proxy image to handle click, context menu, wheel, and touch events,\n   * allowing interaction to be managed or passed through as needed.\n   *\n   * @param unclickable - The target HTMLElement to overlay with a transparent proxy image.\n   */\n  private _createUnclickableProxyImage = (unclickable: HTMLElement): void => {\n    const id = Array.from(crypto.getRandomValues(new Uint8Array(5)), (n) =>\n      String.fromCharCode(97 + (n % 26))\n    ).join('');\n    unclickable.dataset.blotFormatterId = id;\n\n    const canvas = document.createElement('canvas');\n    const context = canvas.getContext('2d');\n    if (context) {\n      context.globalAlpha = 0;\n      context.fillRect(0, 0, 1, 1);\n    }\n\n    const proxyImage = document.createElement('img');\n    proxyImage.src = canvas.toDataURL('image/png');\n    proxyImage.classList.add(PROXY_IMAGE_CLASS);\n    proxyImage.dataset.blotFormatterId = id;\n\n    const mergedStyle: Record<string, any> = {\n      ...this.formatter.options.video.proxyStyle,\n      ...{\n        position: 'absolute',\n        margin: '0',\n        userSelect: 'none',\n      }\n    }\n\n    Object.assign(proxyImage.style, mergedStyle);\n\n    proxyImage.style.setProperty('-webkit-user-select', 'none');\n    proxyImage.style.setProperty('-moz-user-select', 'none');\n    proxyImage.style.setProperty('-ms-user-select', 'none');\n\n    if (this.formatter.options.debug) {\n      proxyImage.style.setProperty('border', '3px solid red');\n    }\n\n    this.proxyContainer.appendChild(proxyImage);\n\n    // on click, hide proxy, show overlay\n    proxyImage.addEventListener('click', this._onProxyImageClick);\n    // disable context menu on proxy\n    proxyImage.addEventListener('contextmenu', (event) => {\n      event.stopPropagation();\n      event.preventDefault();\n    });\n    // scroll the quill root on pointer wheel event & touch scroll\n    proxyImage.addEventListener('wheel', this.formatter._passWheelEventThrough);\n    proxyImage.addEventListener('touchstart', this.formatter._onTouchScrollStart, { passive: false });\n    proxyImage.addEventListener('touchmove', this.formatter._onTouchScrollMove, { passive: false });\n\n    // used to reposition proxy and identify target unclickable\n    this.unclickableProxies[id] = {\n      unclickable: unclickable,\n      proxyImage: proxyImage\n    }\n\n    if (this.formatter.options.debug) {\n      console.debug('UnclickableBlotSpec created proxy for unclickable:', unclickable, 'with ID:', id, 'and proxy image:', proxyImage);\n    }\n  }\n\n  /**\n   * Repositions proxy images to overlay their corresponding \"unclickable\" elements\n   * within the Quill editor container. Calculates each unclickable element's position\n   * relative to the container, accounting for scroll offsets, and updates the proxy image's\n   * style properties (`left`, `top`, `width`, `height`) accordingly.\n   *\n   * Handles errors gracefully by logging any issues encountered during positioning.\n   *\n   * @private\n   */\n  private _repositionProxyImages = (): void => {\n    if (Object.keys(this.unclickableProxies).length > 0) {\n      const containerRect: DOMRect = this.formatter.quill.container.getBoundingClientRect();\n      const containerScrollLeft: number = this.formatter.quill.container.scrollLeft;\n      const containerScrollTop: number = this.formatter.quill.container.scrollTop;\n\n      Object.entries(this.unclickableProxies).forEach(([key, { unclickable, proxyImage }]) => {\n        try {\n          // Calculate the unclickable's position relative to the container\n          const unclickableRect: DOMRect = unclickable.getBoundingClientRect();\n          Object.assign(proxyImage.style, {\n              // display: 'block',\n              left: `${unclickableRect.left - containerRect.left - 1 + containerScrollLeft}px`,\n              top: `${unclickableRect.top - containerRect.top + containerScrollTop}px`,\n              width: `${unclickableRect.width}px`,\n              height: `${unclickableRect.height}px`,\n            },\n          );\n        } catch (error) {\n          const msg: string = `Error positioning proxy image with id ${key}: `\n          console.error(msg, `${error instanceof Error ? error.message : error}`);\n        }\n      });\n    }\n  }\n\n\n  /**\n   * Handles click events on proxy images representing unclickable blots.\n   * Retrieves the associated unclickable blot using the proxy's dataset ID,\n   * updates the `unclickable` property, and displays the formatter overlay.\n   *\n   * @param event - The mouse event triggered by clicking the proxy image.\n   */\n  private _onProxyImageClick = (event: MouseEvent): void => {\n    // get target unclickable (unclickable), show overlay\n    const targetElement = event.target as HTMLElement;\n    const id = targetElement.dataset.blotFormatterId;\n    this.unclickable = this.unclickableProxies[`${id}`].unclickable;\n    this.formatter.show(this);\n  };\n\n  /**\n   * Creates a proxy container element (`div`) with the class 'proxy-container' and appends it\n   * to the Quill editor's container. This container is used to hold all proxy images.\n   *\n   * @returns {HTMLElement} The newly created proxy container element.\n   * @private\n   */\n  private _createProxyContainer = (): HTMLElement => {\n    // create a child div on quill.container to hold all the proxy images\n    const proxyContainer = document.createElement('div');\n    proxyContainer.classList.add('proxy-container');\n    this.formatter.quill.container.appendChild(proxyContainer);\n    return proxyContainer;\n  }\n\n}\n","import BlotFormatter from '../BlotFormatter';\nimport UnclickableBlotSpec from './UnclickableBlotSpec';\n\n/**\n * Represents a specification for handling iframe-based video blots within the Quill editor.\n * Extends {@link UnclickableBlotSpec} to provide formatting capabilities for video iframes\n * that should not be clickable.\n *\n * @remarks\n * This class is intended to be used with the BlotFormatter to manage video embeds\n * that use iframes, such as YouTube or Vimeo videos.\n *\n * @param formatter - The {@link BlotFormatter} instance used to apply formatting logic.\n */\nexport default class IframeVideoSpec extends UnclickableBlotSpec {\n  constructor(formatter: BlotFormatter) {\n    super(formatter);\n  }\n}\n","import Action from './Action';\nimport BlotFormatter from '../BlotFormatter';\nimport ToolbarButton from './toolbar/ToolbarButton';\nimport type { Blot } from '../specs/BlotSpec';\n\ninterface AltTitleModal {\n    element: HTMLDivElement;\n    form: HTMLFormElement;\n    altInput: HTMLTextAreaElement;\n    titleInput: HTMLTextAreaElement;\n    cancelButton: HTMLButtonElement;\n}\n\nexport default class AttributeAction extends Action {\n    modal: AltTitleModal;\n    targetElement: HTMLElement | null | undefined = null;\n    currentBlot: Blot | null | undefined = null;\n\n    constructor(formatter: BlotFormatter) {\n        super(formatter);\n        this.toolbarButtons = [\n            new ToolbarButton(\n                'attribute',\n                this._onClickHandler,\n                this.formatter.options.toolbar,\n            )\n        ]\n        this.modal = this._createModal();\n    }\n\n    /**\n     * Initializes the target element and current blot for the action.\n     * Retrieves the target element and blot from the current formatter specification.\n     *\n     * @remarks\n     * This method should be called when the action is created to ensure\n     * that the necessary references are set up for further processing.\n     */\n    onCreate = (): void => {\n        this.targetElement = this.formatter.currentSpec?.getTargetElement();\n        this.currentBlot = this.formatter.currentSpec?.getTargetBlot();\n    }\n\n    /**\n     * Cleans up resources when the action is destroyed.\n     * Sets the target element to null and removes the modal element from the DOM.\n     */\n    onDestroy = (): void => {\n        this.targetElement = null;\n        this.modal.form.removeEventListener('submit', this._onSubmitHandler);\n        this.modal.form.removeEventListener('cancel', this._hideAltTitleModal);\n        this.modal.element.removeEventListener('pointerdown', this._onPointerDownHandler);\n        this.modal.cancelButton.removeEventListener('click', this._hideAltTitleModal);\n        this.modal.element.remove();\n    }\n\n    /**\n     * Event handler for click events that triggers the display of the Alt Title modal.\n     * \n     * @private\n     * @remarks\n     * This handler is assigned to UI elements to allow users to edit or view the Alt Title attribute.\n     */\n    private _onClickHandler: EventListener = (): void => {\n        this._showAltTitleModal();\n    }\n\n    /**\n     * Displays the modal for editing the 'alt' and 'title' attributes of the target element.\n     * \n     * If a target element is present, this method sets the modal's input fields to the current\n     * 'alt' and 'title' attribute values of the target element (or empty strings if not set),\n     * and appends the modal element to the document body.\n     *\n     * @private\n     */\n    private _showAltTitleModal = (): void => {\n        if (this.targetElement) {\n            this.modal.altInput.value = this.targetElement.getAttribute('alt') || '';\n            this.modal.titleInput.value = this.targetElement.getAttribute('title') || '';\n            document.body.append(this.modal.element);\n            if (this.formatter.options.debug) {\n                console.debug('Showing Alt Title modal for:', this.targetElement);\n            }\n        }\n    }\n\n    /**\n     * Hides and removes the alt/title modal from the DOM.\n     *\n     * This method removes the modal's element, effectively closing the modal UI.\n     * It is typically called when the modal should no longer be visible to the user.\n     *\n     * @private\n     */\n    private _hideAltTitleModal = (): void => {\n        this.modal.element.remove();\n    }\n\n    /**\n     * Updates the `alt` and `title` attributes of the target image element based on user input.\n     * If a title is provided, it sets the `title` attribute; otherwise, it removes it.\n     * Additionally, if an image alignment format is applied, it updates the alignment format\n     * to include the new title value.\n     *\n     * @private\n     */\n    private _setAltTitle = (): void => {\n        if (this.targetElement) {\n            const alt: string = typeof this.modal.altInput.value === \"string\" \n                ? this.modal.altInput.value \n                : \"\";\n            const title: string = this.modal.titleInput.value;\n            this.targetElement.setAttribute('alt', alt);\n            if (title) {\n                this.targetElement.setAttribute('title', title);\n            } else {\n                this.targetElement.removeAttribute('title');\n            }\n            if (this.formatter.options.debug) {\n                console.debug('Setting alt:', alt, 'title:', title, 'on target element:', this.targetElement);\n            }\n            // Update align format if applied\n            const imageAlignment = this.currentBlot?.parent?.formats()[this.formatter.ImageAlign.attrName]?.align;\n            if (this.currentBlot && imageAlignment) {\n                if (this.formatter.options.debug) {\n                    console.debug('Updating title of image with alignment:', imageAlignment);\n                }\n                // Reapply the existing alignment format if it exists\n                this.currentBlot.parent?.format(this.formatter.ImageAlign.attrName, false)\n                this.currentBlot.format(\n                    this.formatter.ImageAlign.attrName,\n                    {\n                        align: imageAlignment,\n                        title: title\n                    }\n                );\n            }\n        }\n    }\n\n    /**\n     * Creates and configures a modal dialog for editing image `alt` and `title` attributes.\n     *\n     * The modal includes:\n     * - A unique identifier for each instance.\n     * - A form with labeled textareas for `alt` and `title` values.\n     * - Submit and cancel buttons, with customizable icons and styles.\n     * - Event listeners for submitting, cancelling, and closing the modal by clicking outside.\n     *\n     * Styles and labels are sourced from `this.formatter.options.image.altTitleModalOptions` and `this.formatter.options.overlay.labels`.\n     *\n     * @returns {AltTitleModal} An object containing references to the modal element, form, alt and title inputs, and the cancel button.\n     */\n    private _createModal = (): AltTitleModal => {\n        const uuid: string = Array.from(crypto.getRandomValues(new Uint8Array(5)), (n) =>\n            String.fromCharCode(97 + (n % 26))\n        ).join('');\n\n        // Create modal background\n        const modal = document.createElement('div');\n        modal.id = `${uuid}-modal`;\n        modal.setAttribute('data-blot-formatter-modal', '');\n\n        // Create modal container\n        const modalContainer = document.createElement('div');\n\n        // Create form element\n        const form = document.createElement('form');\n        form.id = `${uuid}-form`;\n\n        // Create label for alt\n        const labelAlt = document.createElement('label');\n        labelAlt.setAttribute('for', 'alt');\n        labelAlt.textContent = this.formatter.options.overlay.labels?.alt || this.formatter.options.image.altTitleModalOptions.labels.alt;\n\n        // Create textarea for alt\n        const textareaAlt = document.createElement('textarea');\n        textareaAlt.name = 'alt';\n        textareaAlt.rows = 3;\n\n        // Create label for title\n        const labelTitle = document.createElement('label');\n        labelTitle.setAttribute('for', 'title');\n        labelTitle.textContent = this.formatter.options.overlay.labels?.title || this.formatter.options.image.altTitleModalOptions.labels.title;\n\n        // Create textarea for title\n        const textareaTitle = document.createElement('textarea');\n        textareaTitle.name = 'title';\n        textareaTitle.rows = 3;\n\n        // Create submit button\n        const buttonDiv = document.createElement('div');\n        const submitButton = document.createElement('button');\n        submitButton.type = 'submit';\n        submitButton.innerHTML = this.formatter.options.image.altTitleModalOptions.icons.submitButton;\n        buttonDiv.appendChild(submitButton);\n\n        // Append elements to the form\n        form.appendChild(labelAlt);\n        form.appendChild(textareaAlt);\n        form.appendChild(labelTitle);\n        form.appendChild(textareaTitle);\n        form.appendChild(buttonDiv);\n\n        // Create cancel button\n        const cancelButton = document.createElement('button');\n        cancelButton.id = `${uuid}-cancel`;\n        cancelButton.type = 'button';\n        cancelButton.innerHTML = this.formatter.options.image.altTitleModalOptions.icons.cancelButton;\n\n        // styles\n        if (this.formatter.options.image.altTitleModalOptions.styles) {\n            Object.assign(modal.style, this.formatter.options.image.altTitleModalOptions.styles.modalBackground);\n            Object.assign(modalContainer.style, this.formatter.options.image.altTitleModalOptions.styles.modalContainer);\n            Object.assign(labelAlt.style, this.formatter.options.image.altTitleModalOptions.styles.label);\n            Object.assign(textareaAlt.style, this.formatter.options.image.altTitleModalOptions.styles.textarea);\n            Object.assign(labelTitle.style, this.formatter.options.image.altTitleModalOptions.styles.label);\n            Object.assign(textareaTitle.style, this.formatter.options.image.altTitleModalOptions.styles.textarea);\n            Object.assign(submitButton.style, this.formatter.options.image.altTitleModalOptions.styles.submitButton);\n            Object.assign(cancelButton.style, this.formatter.options.image.altTitleModalOptions.styles.cancelButton);\n        }\n\n        // Append form and cancel button to the modal container\n        modalContainer.appendChild(form);\n        modalContainer.appendChild(cancelButton);\n\n        // Append modal container to the modal background\n        modal.appendChild(modalContainer);\n\n        // event listeners\n        form.addEventListener('submit', this._onSubmitHandler);\n        form.addEventListener('cancel', this._hideAltTitleModal);\n        modal.addEventListener('pointerdown', this._onPointerDownHandler);\n        cancelButton.addEventListener('click', this._hideAltTitleModal);\n\n        return {\n            element: modal,\n            form: form,\n            altInput: textareaAlt,\n            titleInput: textareaTitle,\n            cancelButton: cancelButton\n        };\n    }\n\n    private _onSubmitHandler = (event: SubmitEvent): void => {\n        event.preventDefault();\n        this._setAltTitle();\n        this._hideAltTitleModal();\n    }\n\n    private _onPointerDownHandler = (event: PointerEvent): void => {\n        if (event.target === this.modal.element) {\n            this._hideAltTitleModal();\n        }\n    }\n}\n","import Action from './Action';\nimport BlotFormatter from '../BlotFormatter';\nimport ToolbarButton from './toolbar/ToolbarButton';\nimport { CompressorOptions } from '../Options';\n\ntype CompressModal = {\n    element: HTMLDivElement;\n    moreInfoButton: HTMLButtonElement;\n    continueButton: HTMLButtonElement;\n    cancelButton: HTMLButtonElement;\n    moreInfoText: HTMLDivElement;\n}\n\ntype ImageDetails = {\n    naturalWidth: number;\n    naturalHeight: number;\n    targetWidth: number | null;\n    targetHeight: number | null;\n    size: number;\n    canCompress: boolean;\n}\n\n/**\n * CompressAction provides an interactive UI and logic for compressing images embedded in a Quill editor.\n * \n * This action enables users to reduce the file size of images by resizing and re-encoding them as JPEGs,\n * while preserving the aspect ratio and respecting user-defined options such as maximum width and JPEG quality.\n * \n * Key features:\n * - Determines image eligibility for compression (must be a data URL, not SVG or GIF).\n * - Parses image dimensions from HTML attributes, supporting various units (px, %, em, rem).\n * - Calculates image size from base64 data URLs.\n * - Presents a modal dialog for user interaction, including prompts, more info, and feedback.\n * - Handles image compression via canvas resizing and JPEG encoding.\n * - Updates the image in the editor if compression is successful and provides feedback on size reduction.\n * - Cleans up resources and UI elements when the action is destroyed.\n * \n * Usage:\n * - Instantiate with a BlotFormatter instance.\n * - Call `onCreate` to initialize and update toolbar button visibility.\n * - Call `onDestroy` to clean up when the action is no longer needed.\n * \n * @remarks\n * This class is intended for use within the Quill Blot Formatter extension and assumes integration with its toolbar and modal infrastructure.\n */\nexport default class CompressAction extends Action {\n    options: CompressorOptions;\n    modal: CompressModal;\n    targetElement: HTMLElement | null | undefined = null;\n    imageDetails: ImageDetails | null = null;\n\n    /**\n     * Determines whether the given HTML element is eligible for image compression.\n     *\n     * Eligibility criteria:\n     * - The element must be an `<img>` tag.\n     * - The image source must be a data URL (`data:image/`).\n     * - The image must not be an SVG (`svg+xml`) or GIF (`gif`).\n     *\n     * @param targetElement - The HTML element to check for compression eligibility.\n     * @returns `true` if the element is an eligible image for compression, otherwise `false`.\n     */\n    static isEligibleForCompression = (targetElement: HTMLElement | null | undefined, debug: boolean = false): boolean => {\n        // Must be image tag with data url and not gif or svg\n        let isEligible = false;\n        if (targetElement instanceof HTMLImageElement) {\n            if (targetElement.src.startsWith(\"data:image/\")) {\n                const mimeType = targetElement.src.substring(5, targetElement.src.indexOf(\";\"));\n                isEligible = mimeType !== \"svg+xml\" && mimeType !== \"gif\";\n            }\n        }\n        if (debug) {\n            console.debug('Image eligibility check:', {\n                element: targetElement,\n                isEligible\n            });\n        }\n        return isEligible;\n    }\n\n    constructor(formatter: BlotFormatter) {\n        super(formatter);\n        this.options = this.formatter.options.image.compressorOptions;\n        this.toolbarButtons = [\n            new ToolbarButton(\n                'compress',\n                this._onClickHandler,\n                this.formatter.options.toolbar,\n            )\n        ]\n        this.modal = this._createModal();\n    }\n\n    /**\n     * Initializes the CompressAction by setting the target element and updating the initial visibility\n     * of the first toolbar button based on whether the target element is eligible for compression.\n     *\n     * This method should be called when the action is created. It ensures that the toolbar button\n     * reflects the current eligibility state of the target element.\n     */\n    onCreate = (): void => {\n        this.targetElement = this.formatter.currentSpec?.getTargetElement();\n        // class should not be instantiated if not eligible - double check here\n        const isEligibleForCompression = CompressAction.isEligibleForCompression(this.targetElement, this.debug);\n        this.toolbarButtons[0].initialVisibility = isEligibleForCompression;\n        if (this.debug) {\n            console.debug('CompressAction initialized with target element:', this.targetElement, 'is eligible:', isEligibleForCompression);\n        }\n    }\n\n    /**\n     * Cleans up resources when the action is destroyed.\n     * Sets the target element to null and hides the modal dialog.\n     */\n    onDestroy = (): void => {\n        this.targetElement = null;\n        this._hideModal();\n\n        this.modal.continueButton.removeEventListener('click', this._onContinueClick);\n        this.modal.moreInfoButton.removeEventListener('click', this._onMoreInfoClick);\n        this.modal.cancelButton.removeEventListener('click', this._hideModal);\n        this.modal.element.removeEventListener('pointerdown', this._onBackgroundClick);\n    }\n\n    /**\n     * Handles the click event for the compress action.\n     * When triggered, it displays the modal dialog for compression options.\n     *\n     * @param event - The click event object.\n     */\n    private _onClickHandler: EventListener = () => {\n        this._showModal();\n    }\n\n    /**\n     * Displays a modal dialog for image compression if the target element is an image.\n     * If the image can be compressed, shows additional information and appends the modal to the document body.\n     * Otherwise, displays feedback indicating that no compression is possible.\n     *\n     * @private\n     */\n    private _showModal = (): void => {\n        if (this.targetElement instanceof HTMLImageElement) {\n            this.imageDetails = this._getImageDetails(this.targetElement);\n            if (this.imageDetails.canCompress) {\n                this.modal.moreInfoButton.style.visibility = 'visible';\n                this.modal.moreInfoText.style.display = 'none';\n                document.body.append(this.modal.element);\n            } else {\n                this._displayFeedback(this.options.text.nothingToDo);\n            }\n        }\n    }\n\n    /**\n     * Removes the modal element from the DOM, effectively hiding the modal.\n     *\n     * @private\n     */\n    private _hideModal = (): void => {\n        this.modal.element.remove();\n    }\n\n    /**\n     * Parses the `width` and `height` attributes of an HTMLImageElement and returns their numeric values.\n     * Handles values specified in pixels (`px`), percentages (`%`), em/rem units, or plain numbers.\n     * If the attribute is a percentage, uses the maximum width from options if available.\n     * For em/rem units, assumes 16px per unit.\n     * If the height is not specified or cannot be parsed, attempts to calculate it using the aspect ratio\n     * from the image's natural dimensions if width is available.\n     * \n     * @param img - The HTMLImageElement whose dimensions are to be parsed.\n     * @returns A tuple containing the parsed width and height as numbers, or `null` if parsing fails.\n     */\n    private _parseDimensions = (img: HTMLImageElement): [number | null, number | null] => {\n        let width: string | null = img.getAttribute('width');\n        let height: string | null = img.getAttribute('height');\n        let parsedWidth: number | null = null;\n        let parsedHeight: number | null = null;\n\n        // Parse width\n        if (width) {\n            if (width.toLowerCase().endsWith('px')) {\n                parsedWidth = parseFloat(width);\n            } else if (width.endsWith('%')) {\n                parsedWidth = this.options.maxWidth ?? null;\n            } else if (width.toLowerCase().endsWith('em') || width.toLowerCase().endsWith('rem')) {\n                parsedWidth = parseFloat(width) * 16; // assume 16px per unit\n            } else if (!isNaN(parseFloat(width))) {\n                parsedWidth = parseFloat(width); // Parse as number only if it's plain numeric string\n            } else {\n                // unknown width attribute, return null to skip resizing\n                return [null, null];\n            }\n        }\n\n        // Parse height\n        if (height) {\n            if (!isNaN(parseFloat(height))) {\n                parsedHeight = parseFloat(height);\n            } else if (height.toLowerCase().endsWith('px')) {\n                parsedHeight = parseFloat(height);\n            } else if (height.toLowerCase().endsWith('em') || height.toLowerCase().endsWith('rem')) {\n                parsedHeight = parseFloat(height) * 16; // assume 16px per unit\n            } else {\n                // use aspect ratio if width is available and natural dimensions are valid\n                if (parsedWidth && img.naturalWidth > 0 && img.naturalHeight > 0) {\n                    parsedHeight = parsedWidth / (img.naturalWidth / img.naturalHeight);\n                } else {\n                    return [null, null];\n                }\n            }\n        }\n\n        return [parsedWidth, parsedHeight];\n    }\n\n    /**\n     * Calculates the approximate byte size of an image from its data URL.\n     *\n     * @param img - The HTMLImageElement whose size is to be determined.\n     * @returns The size of the image in bytes if the `src` attribute is a valid base64-encoded data URL,\n     *          or `null` if the `src` is not a valid image data URL or does not contain base64 data.\n     */\n    private _getImageSize = (img: HTMLImageElement): number | null => {\n        const dataUrl = img.getAttribute('src');\n        if (!dataUrl || !dataUrl.startsWith('data:image/')) {\n            // Return null if the src is not a valid data URL or doesn't contain image data\n            return null;\n        }\n        // Extract the base64-encoded part of the data URL\n        const base64Data = dataUrl.split(',')[1]; // Ignore the data type metadata before the comma\n        if (!base64Data) {\n            return null;\n        }\n        // Return the byte size of the base64 string\n        return Math.ceil((base64Data.length * 3) / 4);\n    }\n\n    /**\n     * Displays a feedback message in the formatter's sizeInfo element.\n     * The message is shown with full opacity, then fades out after 2.5 seconds.\n     *\n     * @param msg - The feedback message to display.\n     */\n    private _displayFeedback = (msg: string): void => {\n        this.formatter.sizeInfo.innerHTML = msg;\n        this.formatter.sizeInfo.style.transition = '';\n        this.formatter.sizeInfo.style.opacity = '1';\n        setTimeout(() => {\n            this.formatter.sizeInfo.style.transition = 'opacity 1s';\n            this.formatter.sizeInfo.style.opacity = '0';\n        }, 2500);\n    }\n\n    /**\n     * Retrieves detailed information about an image element, including its natural and target dimensions,\n     * file size, and whether it is eligible for compression based on the provided options.\n     *\n     * @param img - The HTMLImageElement to extract details from.\n     * @returns An {@link ImageDetails} object containing the image's natural and target dimensions,\n     *          file size, and compression eligibility.\n     */\n    private _getImageDetails = (img: HTMLImageElement): ImageDetails => {\n        let [width, height] = this._parseDimensions(img);\n        if (!width && ((this.options.maxWidth ?? Infinity) < img.naturalWidth)) {\n            width = this.options.maxWidth as number;\n            height = width / (img.naturalWidth / img.naturalHeight);\n        }\n        const details = {\n            naturalWidth: img.naturalWidth,\n            naturalHeight: img.naturalHeight,\n            targetWidth: width,\n            targetHeight: height,\n            size: this._getImageSize(img) as number,\n            canCompress: !!(width && height && (width < img.naturalWidth) && CompressAction.isEligibleForCompression(img, this.debug))\n        }\n        if (this.debug) {\n            console.debug('Image details:', {\n                element: img,\n                ...details,\n            });\n        }\n        return details;\n    }\n\n    /**\n     * Compresses a given HTMLImageElement by resizing it to target dimensions and reducing its quality.\n     * If compression results in a smaller image, the image's `src` is updated with the compressed data URL.\n     * Displays feedback about the compression result, including size reduction and new dimensions.\n     *\n     * @param img - The HTMLImageElement to compress.\n     * @returns `true` if the compression process was initiated, `false` if image loading failed.\n     *\n     * @remarks\n     * - Compression only occurs if `imageDetails.canCompress` is `true`.\n     * - The image is resized to `imageDetails.targetWidth` and `imageDetails.targetHeight`.\n     * - JPEG quality is determined by `options.jpegQuality`.\n     * - Feedback is displayed using `_displayFeedback`.\n     * - If compression is not possible, a \"nothing to do\" message is shown.\n     */\n    private _compressImage = (img: HTMLImageElement): boolean => {\n        if (this.imageDetails?.canCompress) {\n            const newImg = new Image();\n            newImg.src = img.src;\n            // Once the image has loaded, resize it\n            newImg.onload = () => {\n                if (this.debug) {\n                    console.debug('Compressing Image Copy loaded:', newImg);\n                }\n                // Create a canvas element\n                const canvas = document.createElement('canvas');\n                canvas.width = this.imageDetails!.targetWidth as number;\n                canvas.height = this.imageDetails!.targetHeight as number;\n                // Draw the image onto the canvas\n                const ctx = canvas.getContext('2d') as CanvasRenderingContext2D;\n                ctx.drawImage(newImg, 0, 0, canvas.width, canvas.height);\n                // Get the resized image data URL in JPEG format with a quality of this.options.jpegQuality\n                const resizedDataUrl = canvas.toDataURL('image/jpeg', this.options.jpegQuality);\n                // Convert data URLs to byte length\n                const originalSize = new TextEncoder().encode(img.src).length;\n                const resizedSize = new TextEncoder().encode(resizedDataUrl).length;\n                // Check if the resized image is smaller than the original\n                if (resizedSize < originalSize) {\n                    // Set the resized image data URL to the original image\n                    img.src = resizedDataUrl;\n                }\n                const sizeDiff: string = `${Math.ceil((this.imageDetails!.size - (this._getImageSize(img) as number)) / 1024)}kB`\n                const msg: string = `${this.options.text.reducedLabel}: ${sizeDiff}<br>\n                            ${this.imageDetails!.naturalWidth} x ${this.imageDetails!.naturalHeight}px  ${canvas.width} x ${Math.round(canvas.height)}px\n                        `;\n                if (this.debug) {\n                    console.debug('Image compressed:', {\n                        'original size': originalSize,\n                        'resized size': resizedSize,\n                        'size diff': sizeDiff,\n                        'new dimensions': { width: canvas.width, height: Math.round(canvas.height) }\n                    });\n                }\n                this._displayFeedback(msg);\n                return true;\n            };\n            newImg.onerror = (error) => {\n                console.error('Image loading failed:', error);\n                this._displayFeedback(`Image loading failed: ${error}`);\n                return false;\n            };\n        } else {\n            this._displayFeedback(this.options.text.nothingToDo);\n        };\n        return true;\n    }\n\n    /**\n     * Creates and configures a modal dialog for the compress action.\n     *\n     * The modal includes a prompt, an optional \"more info\" section, and three buttons:\n     * Cancel, More Info, and Continue. Styles and content are applied based on the\n     * provided options. Event listeners are attached to handle user interactions:\n     * - Continue: triggers image compression and hides the modal.\n     * - More Info: displays additional information and hides the button.\n     * - Cancel: hides the modal.\n     * - Clicking the background: hides the modal if the background itself is clicked.\n     *\n     * @returns {CompressModal} An object containing the modal background element,\n     *          the \"More Info\" button, and the \"More Info\" text element.\n     */\n    private _createModal = (): CompressModal => {\n        const modalBackground: HTMLDivElement = document.createElement('div');\n        modalBackground.setAttribute('data-blot-formatter-compress-modal', '');\n        const modalContainer: HTMLDivElement = document.createElement('div');\n        const modalDefaultPrompt: HTMLDivElement = document.createElement('div');\n        const modalMoreInfo: HTMLDivElement = document.createElement('div');\n        const modalButtonContainer: HTMLDivElement = document.createElement('div');\n        const cancelButton: HTMLButtonElement = document.createElement('button');\n        const moreInfoButton: HTMLButtonElement = document.createElement('button');\n        const continueButton: HTMLButtonElement = document.createElement('button');\n        modalMoreInfo.style.display = 'none';\n        modalButtonContainer.append(cancelButton, moreInfoButton, continueButton);\n        modalContainer.append(modalDefaultPrompt, modalMoreInfo, modalButtonContainer);\n        modalBackground.appendChild(modalContainer);\n        modalDefaultPrompt.innerHTML = this.options.text.prompt;\n        modalMoreInfo.innerHTML = this.options.text.moreInfo || '';\n        if (this.options.styles) {\n            Object.assign(modalBackground.style, this.options.styles.modalBackground);\n            Object.assign(modalContainer.style, this.options.styles.modalContainer);\n            Object.assign(modalButtonContainer.style, this.options.styles.buttonContainer);\n            Object.assign(cancelButton.style, { ...this.options.styles.buttons, ...this.options.buttons.cancel.style });\n            if (this.options.text.moreInfo) {\n                Object.assign(moreInfoButton.style, { ...this.options.styles.buttons, ...this.options.buttons.moreInfo.style });\n            } else {\n                moreInfoButton.style.visibility = 'hidden';\n            }\n            Object.assign(continueButton.style, { ...this.options.styles.buttons, ...this.options.buttons.continue.style });\n        }\n        cancelButton.innerHTML = this.options.icons.cancel;\n        moreInfoButton.innerHTML = this.options.icons.moreInfo;\n        continueButton.innerHTML = this.options.icons.continue;\n\n        // event listeners\n        continueButton.addEventListener('click', this._onContinueClick);\n        moreInfoButton.addEventListener('click', this._onMoreInfoClick);\n        cancelButton.addEventListener('click', this._hideModal);\n        modalBackground.addEventListener('pointerdown', this._onBackgroundClick);\n        return {\n            element: modalBackground,\n            moreInfoButton: moreInfoButton,\n            cancelButton: cancelButton,\n            continueButton: continueButton,\n            moreInfoText: modalMoreInfo,\n        }\n    }\n\n    private _onContinueClick = (): void => {\n        if (this.targetElement instanceof HTMLImageElement) {\n            this._compressImage(this.targetElement);\n        }\n        this._hideModal();\n    }\n\n    private _onMoreInfoClick = (): void => {\n        this.modal.moreInfoText.innerHTML = this.options.text.moreInfo || '';\n        this.modal.moreInfoText.style.display = 'block';\n        this.modal.moreInfoButton.style.visibility = 'hidden';\n    }\n\n    private _onBackgroundClick = (event: PointerEvent) => {\n        event.stopImmediatePropagation();\n        if (event.target === this.modal.element) {\n            if (this.debug) {\n                console.debug('Modal background clicked, hiding modal');\n            }\n            this._hideModal();\n        }\n    }\n\n}","import Action from './Action';\nimport BlotFormatter from '../BlotFormatter';\nimport type Quill from 'quill';\nimport ToolbarButton from './toolbar/ToolbarButton';\nimport type { Blot } from '../specs/BlotSpec';\nimport type { LinkOptions } from '../Options';\n\n/**\n * Handles the link editing action for image blots within the Quill editor.\n * \n * `LinkAction` provides UI and logic for adding, editing, and removing links on image blots.\n * It manages the display and positioning of a modal dialog for link input, attaches and removes\n * event listeners for modal interaction, and applies or removes link formats on the target blot.\n * \n * @remarks\n * - Integrates with the BlotFormatter overlay and toolbar system.\n * - Ensures modal dialog is accessible and correctly positioned relative to the editor.\n * - Cleans up all resources and event listeners on destruction.\n * \n * @extends Action\n * \n * @public\n */\nexport default class LinkAction extends Action {\n    targetElement: HTMLElement | null | undefined = null;\n    currentBlot: Blot | null | undefined = null;\n    toolbarButton: ToolbarButton;\n    linkOptions: LinkOptions;\n    modal?: {\n        dialog: HTMLDialogElement;\n        background: HTMLDivElement;\n        form: HTMLFormElement;\n        label: HTMLLabelElement;\n        input: HTMLInputElement;\n        okButton: HTMLButtonElement;\n        cancelButton: HTMLButtonElement;\n        removeButton: HTMLButtonElement;\n    }\n\n    constructor(formatter: BlotFormatter) {\n        super(formatter);\n        this.linkOptions = this.formatter.options.image.linkOptions;\n        this.toolbarButton = new ToolbarButton(\n            'link',\n            this._onClickHandler,\n            this.formatter.options.toolbar\n        );\n        // override preselect method to show button active if img has link on load\n        this.toolbarButton.preselect = () => {\n            return !!this.getLink();\n        };\n        this.toolbarButtons = [this.toolbarButton];\n        (window as any).LinkAction = this; // For debugging purposes\n    }\n\n    /**\n     * Initializes the action by setting the `targetElement` property.\n     * Retrieves the target element from the current formatter specification, if available.\n     * This method is typically called when the action is created.\n     */\n    onCreate = (): void => {\n        this.targetElement = this.formatter.currentSpec?.getTargetElement();\n        this.currentBlot = this.formatter.currentSpec?.getTargetBlot();\n    }\n\n    /**\n     * Cleans up resources when the action is destroyed.\n     * - Sets the target element to null.\n     * - Removes any attached event listeners.\n     * - Hides the link modal if it is visible.\n     */\n    onDestroy = (): void => {\n        this.targetElement = null;\n        this._removeEventListeners();\n        this.hideLinkModal();\n    }\n\n    /**\n     * Attaches all necessary event listeners to the modal elements for handling\n     * link-related actions such as submitting the form, blocking certain key events,\n     * handling input changes, canceling, removing links, and managing background/context menu interactions.\n     *\n     * This method should be called after the modal elements are initialized to ensure\n     * proper event handling within the link modal dialog.\n     * \n     * @private\n     */\n    private _addEventListeners = (): void => {\n        if (this.modal) {\n            this.modal.form.addEventListener('submit', this._formSubmitHandler);\n            this.modal.cancelButton.addEventListener('click', this.hideLinkModal);\n            this.modal.removeButton.addEventListener('click', this.removeLink);\n            this.modal.background.addEventListener('click', this._onBackgroundClick);\n            this.modal.input.addEventListener('contextmenu', this._trapContextEvent);\n        }\n    }\n\n    /**\n     * Removes all event listeners attached to the modal elements.\n     * \n     * This method detaches event handlers from the modal's dialog, form, input,\n     * cancel button, remove button, background, and input context menu to prevent\n     * memory leaks and unintended behavior when the modal is no longer in use.\n     * \n     * @private\n     */\n    private _removeEventListeners = (): void => {\n        if (this.modal) {\n            this.modal.form.removeEventListener('submit', this._formSubmitHandler);\n            this.modal.cancelButton.removeEventListener('click', this.hideLinkModal);\n            this.modal.removeButton.removeEventListener('click', this.removeLink);\n            this.modal.background.removeEventListener('click', this._onBackgroundClick);\n            this.modal.input.removeEventListener('contextmenu', this._trapContextEvent);\n        }\n    }\n\n    /**\n     * Prevents the event from propagating further in the event chain.\n     * This method is typically used to trap context menu or similar events,\n     * ensuring that no other event listeners are triggered for the same event.\n     *\n     * @param e - The event to be stopped.\n     */\n    private _trapContextEvent = (e: Event): void => {\n        e.stopImmediatePropagation();\n    }\n\n    /**\n     * Event handler that is triggered when the associated element is clicked.\n     * Invokes the `showLinkModal` method to display the link editing modal.\n     *\n     * @private\n     * @remarks\n     * This handler is typically bound to a UI element to allow users to edit or add links.\n     */\n    private _onClickHandler: EventListener = (): void => {\n        this.showLinkModal();\n    }\n\n    /**\n     * Handles click events on the modal background.\n     * \n     * If the click event's target is the modal background, this method prevents the default behavior,\n     * stops the event from propagating further, and hides the link modal.\n     *\n     * @param e - The mouse event triggered by the user's click.\n     */\n    private _onBackgroundClick = (e: MouseEvent): void => {\n        if (e.target === this.modal?.background) {\n            e.stopImmediatePropagation();\n            e.preventDefault();\n            this.hideLinkModal();\n            if (this.debug) {\n                console.debug('LinkAction modal background clicked, hiding modal');\n            }   \n        }\n    }\n\n    /**\n     * Displays the link modal dialog for editing or inserting a link.\n     * \n     * If a target element is present, this method constructs the modal,\n     * appends it to the formatter's overlay, and sets up necessary event listeners.\n     * The modal is initially hidden to prevent flicker, then shown after being\n     * positioned correctly relative to the target element.\n     *\n     * @returns {void}\n     */\n    showLinkModal = (): void => {\n        if (this.targetElement) {\n            this.modal = this._buildModal();\n            if (!this.modal) return;\n\n            this.formatter.overlay.append(this.modal.dialog, this.modal.background);\n            this._addEventListeners();\n\n            // Hide to prevent flicker and force layout\n            this.modal.dialog.style.visibility = 'hidden';\n            this.modal.dialog.show();\n            this._positionModal(this.modal.dialog);\n            // Show after positioning\n            this.modal.dialog.style.visibility = \"visible\";\n            // Focus the input field\n            this.modal.input.focus();\n            this.modal.input.select();\n        }\n    }\n\n    /**\n     * Builds and returns the modal elements used for editing or inserting a link.\n     *\n     * This method creates a dialog element containing a form with a label, input field for the URL,\n     * and three buttons: OK (submit), Remove, and Cancel. It also creates a background mask element.\n     * All elements are styled and configured according to the `linkOptions` provided to the class.\n     *\n     * @returns An object containing references to the created modal elements:\n     * - `dialog`: The dialog element that serves as the modal container.\n     * - `background`: The background mask element for the modal.\n     * - `form`: The form element inside the dialog.\n     * - `label`: The label element for the input.\n     * - `input`: The input element for entering the link URL.\n     * - `okButton`: The submit button for confirming the link.\n     * - `cancelButton`: The button for cancelling the operation.\n     * - `removeButton`: The button for removing the link.\n     */\n    private _buildModal = (): typeof this.modal => {\n        const dialog = document.createElement('dialog');\n        dialog.className = this.linkOptions.modal.dialog.className;\n        dialog.dataset.blotFormatterModal = '';\n        Object.assign(dialog.style, this.linkOptions.modal.dialog.style);\n\n        // Create form\n        const form = document.createElement('form');\n        form.method = 'dialog';\n        form.className = this.linkOptions.modal.form.className;\n        Object.assign(form.style, this.linkOptions.modal.form.style);\n\n        // Label\n        const label = document.createElement('label');\n        label.htmlFor = 'link-url';\n        label.textContent = this.linkOptions.modal.label.text;\n        label.className = this.linkOptions.modal.label.className;\n        Object.assign(label.style, this.linkOptions.modal.label.style);\n\n        // Input\n        const input = document.createElement('input');\n        input.type = 'url';\n        input.id = 'link-url';\n        input.name = 'url';\n        input.value = this.getLink() || '';\n        input.select();\n        input.autofocus = true;\n        input.className = this.linkOptions.modal.input.className;\n        Object.assign(input.style, this.linkOptions.modal.input.style);\n        input.placeholder = this.linkOptions.modal.input.placeholder || '';\n\n        // OK button\n        const okButton = document.createElement('button');\n        okButton.type = 'submit';\n        okButton.innerHTML = this.linkOptions.modal.buttons.submit.icon;\n        okButton.className = this.linkOptions.modal.buttons.submit.className;\n        Object.assign(okButton.style, this.linkOptions.modal.buttons.submit.style);\n\n        // Cancel button\n        const cancelButton = document.createElement('button');\n        cancelButton.type = 'button';\n        cancelButton.innerHTML = this.linkOptions.modal.buttons.cancel.icon;\n        cancelButton.className = this.linkOptions.modal.buttons.cancel.className;\n        Object.assign(cancelButton.style, this.linkOptions.modal.buttons.cancel.style);\n\n        // Remove button\n        const removeButton = document.createElement('button');\n        removeButton.type = 'button';\n        removeButton.innerHTML = this.linkOptions.modal.buttons.remove.icon;\n        removeButton.className = this.linkOptions.modal.buttons.remove.className;\n        Object.assign(removeButton.style, this.linkOptions.modal.buttons.remove.style);\n\n        // Append modal\n        form.appendChild(label);\n        form.appendChild(input);\n        form.appendChild(okButton);\n        form.appendChild(removeButton);\n        form.appendChild(cancelButton);\n        dialog.appendChild(form);\n\n        // Background mask\n        const background = document.createElement('div');\n        background.className = this.linkOptions.modal.background.className || '';\n        Object.assign(background.style, this.linkOptions.modal.background.style);\n\n        return {\n            dialog,\n            background,\n            form,\n            label,\n            input,\n            okButton,\n            cancelButton,\n            removeButton\n        };\n    }\n\n    /**\n     * Positions the given dialog element centered over the formatter's overlay,\n     * ensuring it stays within the bounds of the Quill editor root element.\n     *\n     * The method calculates the overlay and Quill root bounding rectangles,\n     * determines the dialog's dimensions, and computes the appropriate\n     * `left` and `top` CSS properties to center the dialog over the overlay.\n     * The horizontal & vertical position is clamped so the dialog does not overflow\n     * the Quill root element.\n     *\n     * @param dialog - The HTMLDialogElement to position.\n     */\n    private _positionModal = (dialog: HTMLDialogElement): void => {\n        const overlayRect = this.formatter.overlay.getBoundingClientRect();\n        const quillRect = this.formatter.quill.root.getBoundingClientRect();\n        const offsetParentRect = dialog.offsetParent?.getBoundingClientRect() ?? { top: 0, left: 0 };\n\n        const dialogWidth = dialog.offsetWidth;\n        const dialogHeight = dialog.offsetHeight;\n\n        // Center horizontally relative to overlay\n        let left = overlayRect.left + overlayRect.width / 2 - dialogWidth / 2 - offsetParentRect.left;\n        let top = overlayRect.top + overlayRect.height / 2 - dialogHeight / 2 - offsetParentRect.top;\n\n        // Clamp left to stay within quill root, in same coordinate space\n        const minLeft = quillRect.left - offsetParentRect.left;\n        const maxLeft = quillRect.right - dialogWidth - offsetParentRect.left;\n        left = Math.min(Math.max(left, minLeft), maxLeft);\n\n        const minTop = quillRect.top - offsetParentRect.top;\n        const maxTop = quillRect.bottom - dialogHeight - offsetParentRect.top;\n        top = Math.min(Math.max(top, minTop), maxTop);\n\n        // Apply positioning\n        dialog.style.position = \"absolute\";\n        dialog.style.left = `${left}px`;\n        dialog.style.top = `${top}px`;\n    }\n\n    /**\n     * Hides and cleans up the link modal dialog.\n     *\n     * This method closes and removes the modal dialog and its background overlay if they exist,\n     * removes any associated event listeners, and resets the modal reference to undefined.\n     */\n    hideLinkModal = (): void => {\n        if (this.modal?.dialog?.open) this.modal.dialog.close();\n        this.modal?.dialog?.remove();\n        if (this.modal?.background)\n            this.modal.background.remove();\n        this._removeEventListeners();\n        this.modal = undefined;\n    }\n\n    /**\n     * Handles the form submission event for the link action.\n     * \n     * Prevents the default form submission behavior, extracts the URL from the form data,\n     * and applies or removes a link on the current blot based on the URL's presence.\n     *\n     * @param event - The form submission event.\n     */\n    private _formSubmitHandler = (event: Event): void => {\n        event.preventDefault();\n        const form = event.target as HTMLFormElement;\n        const formData = new FormData(form);\n        const url = (formData.get('url') as string).trim();\n        if (this.debug) {\n            console.debug('LinkAction form submitted with URL:', url);\n        }\n        if (this.currentBlot) {\n            if (url) {\n                this.applyLink(url);\n            } else {\n                this.removeLink();\n            }\n        }\n    }\n\n    /**\n     * Retrieves the link format associated with the current blot, if any.\n     *\n     * @returns {any | null} The link URL if the current blot has a link format, otherwise `null`.\n     *\n     * @remarks\n     * This method checks if the current blot exists and has a DOM node. It then retrieves the index of the blot\n     * in the Quill editor and fetches its formats. If a link format is present, it returns the link value; otherwise, it returns `null`.\n     */\n    getLink = (): any => {\n        const blot = this.currentBlot;\n        if (!blot || !blot.domNode) return null;\n        const index = this.formatter.quill.getIndex(blot);\n        const formats = this.formatter.quill.getFormat(index, 1, this.formatter.Quill.sources.SILENT);\n        if (this.debug) {\n            console.debug('LinkAction getLink called, formats:', formats);\n        }\n        return formats.link || null;\n    }\n\n    /**\n     * Removes the link format from the current image blot's parent wrapper, if present.\n     * \n     * Traverses up the blot hierarchy from the current image blot to find a parent blot\n     * with a 'link' format. If found, it removes the link format from that wrapper.\n     * After removing the link, it hides the link modal and deselects the toolbar button.\n     *\n     * @returns {void}\n     */\n    removeLink = (): void => {\n        const imageBlot = this.currentBlot;\n        if (!imageBlot || !imageBlot.domNode) return;\n        let wrapperBlot = imageBlot.parent;\n        // Traverse upward until we find the inline wrapper with the link format\n        while (wrapperBlot && typeof wrapperBlot.formats === 'function') {\n            const formats = wrapperBlot.formats();\n            if (formats.link) {\n                wrapperBlot.format('link', null);\n                break;\n            }\n            wrapperBlot = wrapperBlot.parent;\n        }\n        if (this.debug) {\n            console.debug('LinkAction removeLink called, removed link from blot:', wrapperBlot);\n        }\n        this.hideLinkModal();\n        this.toolbarButton.selected = false;\n    }\n\n    /**\n     * Applies a link to the current blot if the provided URL is different from the existing link.\n     * Removes any existing link, formats the current blot with the new link, and updates the toolbar button state.\n     * Hides the link modal after applying the link.\n     *\n     * @param url - The URL to apply as a link to the current blot.\n     */\n    applyLink = (url: string): void => {\n        if (url !== this.getLink()) {\n            this.removeLink();\n            this.currentBlot?.format('link', url);\n            this.toolbarButton.selected = (!!url);\n        }\n        this.hideLinkModal();\n    }\n}","import Action from '../actions/Action';\nimport AttributeAction from '../actions/AttributeAction';\nimport BlotFormatter from '../BlotFormatter';\nimport BlotSpec from './BlotSpec';\nimport CompressAction from '../actions/CompressAction';\nimport LinkAction from '../actions/LinkAction';\n\n/**\n * Represents a specification for handling image elements within a Quill editor instance.\n * \n * `ImageSpec` extends `BlotSpec` to provide image-specific functionality, including:\n * - Initializing event listeners for image selection.\n * - Determining available actions (link editing, alt/title editing, compression) based on formatter options.\n * - Managing the currently selected image element.\n * - Handling UI display and cleanup when the image overlay is shown or hidden.\n * \n * @remarks\n * This class is intended to be used as part of the Quill Blot Formatter extension for rich image editing.\n * \n * @extends BlotSpec\n */\nexport default class ImageSpec extends BlotSpec {\n  img: HTMLElement | null;\n\n  constructor(formatter: BlotFormatter) {\n    super(formatter);\n    this.img = null;\n  }\n\n  /**\n   * Initializes the image spec by attaching a click event listener to the Quill editor's root element.\n   * The event listener triggers the `onClick` handler when the root element is clicked.\n   */\n  init = (): void => {\n    this.formatter.quill.root.addEventListener('click', this.onClick);\n  }\n\n  /**\n   * Returns an array of available actions for the image spec, based on the current formatter options and image eligibility.\n   *\n   * The returned actions may include:\n   * - `LinkAction`: If link editing is allowed (`image.linkOptions.allowLinkEdit`).\n   * - `AttributeAction`: If alt/title editing is allowed (`image.allowAltTitleEdit`).\n   * - `CompressAction`: If compression is allowed (`image.allowCompressor`) and the image is eligible for compression.\n   *\n   * @returns {Array<Action>} The list of actions applicable to the current image spec.\n   */\n  getActions = (): Array<Action> => {\n    const actions = super.getActions();\n    if (this.formatter.options.image.linkOptions.allowLinkEdit) {\n      actions.push(new LinkAction(this.formatter));\n    }\n    if (this.formatter.options.image.allowAltTitleEdit) {\n      actions.push(new AttributeAction(this.formatter));\n    }\n    if (this.formatter.options.image.allowCompressor && CompressAction.isEligibleForCompression(this.img)) {\n      actions.push(new CompressAction(this.formatter));\n    }\n    return actions;\n  }\n\n  /**\n   * Returns the target HTML element associated with this instance.\n   *\n   * @returns {HTMLElement | null} The image element if available, otherwise `null`.\n   */\n  getTargetElement = (): HTMLElement | null => {\n    return this.img;\n  }\n\n  /**\n   * Handles the hide event by resetting the image reference to null.\n   * This is typically called when the overlay should no longer be displayed or interacted with.\n   */\n  onHide = (): void => {\n    this.img = null;\n  }\n\n  /**\n   * Handles click events on image elements.\n   * \n   * If the clicked element is an HTMLImageElement, prevents the default behaviour\n   * (such as opening links), stores a reference to the image, and displays the formatter UI.\n   * \n   * @param event - The mouse event triggered by the click.\n   */\n  onClick = (event: MouseEvent): void => {\n    const el = event.target;\n    if (this.formatter.enabled && el instanceof HTMLImageElement) {\n      // prevent <a> links from opening\n      event.stopImmediatePropagation();\n      event.preventDefault();\n      this.img = el;\n      this.formatter.show(this);\n    }\n  };\n}\n","import IframeVideoSpec from './specs/IframeVideoSpec';\nimport ImageSpec from './specs/ImageSpec';\nimport type { Options } from './Options';\n\nconst closeButtonIcon = `<svg viewBox=\"0 0 16 16\" fill=\"currentColor\" style=\"height:100%;width:auto\"><path d=\"M2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2zm3.354 4.646L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 1 1 .708-.708\"/></svg>`;\nconst okButtonIcon = `<svg viewBox=\"0 0 24 24\" fill=\"currentcolor\" style=\"height:100%;width:auto\"><path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M 12,24 C 6.34314,24 3.514716,24 1.757364,22.2426 0,20.48532 0,17.6568 0,12 0,6.34314 0,3.514716 1.757364,1.757364 3.514716,0 6.34314,0 12,0 17.6568,0 20.48532,0 22.2426,1.757364 24,3.514716 24,6.34314 24,12 24,17.6568 24,20.48532 22.2426,22.2426 20.48532,24 17.6568,24 12,24 Z M 16.83636,8.363604 c 0.35148,0.351468 0.35148,0.921324 0,1.272756 l -6,6 c -0.35148,0.35148 -0.92124,0.35148 -1.272756,0 l -2.4,-2.4 c -0.351468,-0.35148 -0.351468,-0.92124 0,-1.27272 0.351468,-0.35148 0.921324,-0.35148 1.272792,0 L 10.2,13.72716 15.56364,8.363604 c 0.35148,-0.351468 0.92124,-0.351468 1.27272,0 z\" style=\"stroke-width:1.2\" /></svg>`;\nconst infoButtonIcon = `<svg viewBox=\"0 0 512 512\" fill=\"currentcolor\" style=\"height:100%;width:auto\"><path d=\"M464 256A208 208 0 1 0 48 256a208 208 0 1 0 416 0zM0 256a256 256 0 1 1 512 0A256 256 0 1 1 0 256zm169.8-90.7c7.9-22.3 29.1-37.3 52.8-37.3l58.3 0c34.9 0 63.1 28.3 63.1 63.1c0 22.6-12.1 43.5-31.7 54.8L280 264.4c-.2 13-10.9 23.6-24 23.6c-13.3 0-24-10.7-24-24l0-13.5c0-8.6 4.6-16.5 12.1-20.8l44.3-25.4c4.7-2.7 7.6-7.7 7.6-13.1c0-8.4-6.8-15.1-15.1-15.1l-58.3 0c-3.4 0-6.4 2.1-7.5 5.3l-.4 1.2c-4.4 12.5-18.2 19-30.6 14.6s-19-18.2-14.6-30.6l.4-1.2zM224 352a32 32 0 1 1 64 0 32 32 0 1 1 -64 0z\" /></svg>`;\n\nexport const DefaultOptions: Options = {\n  specs: [\n    ImageSpec,\n    IframeVideoSpec,\n  ],\n  overlay: {\n    className: 'blot-formatter__overlay',\n    style: {\n      position: 'absolute',\n      boxSizing: 'border-box',\n      border: '1px dashed #444',\n      backgroundColor: 'rgba(255, 255, 255, 0.35)',\n      maxWidth: \"100%\",\n      zIndex: 9999\n    },\n    sizeInfoStyle: {\n      position: 'absolute',\n      color: 'rgba(255, 255, 255, 0.7)',\n      backgroundColor: 'rgba(0, 0, 0, 0.7)',\n      top: '50%',\n      left: '50%',\n      transform: 'translate(-50%, -50%)',\n      padding: '1em',\n      textWrap: 'nowrap',\n      fontSize: '1rem',\n      opacity: 0,\n      lineHeight: 1.2,\n    },\n  },\n  align: {\n    allowAligning: true,\n    alignments: ['left', 'center', 'right']\n  },\n  resize: {\n    allowResizing: true,\n    allowResizeModeChange: false,\n    imageOversizeProtection: false,\n    handleClassName: 'blot-formatter__resize-handle',\n    handleStyle: {\n      position: 'absolute',\n      height: '12px',\n      width: '12px',\n      backgroundColor: 'white',\n      border: '1px solid #777',\n      boxSizing: 'border-box',\n      opacity: '0.80',\n      zIndex: 999\n    },\n    useRelativeSize: false,\n    minimumWidthPx: 25,\n  },\n  delete: {\n    allowKeyboardDelete: true,\n  },\n  toolbar: {\n    icons: {\n      left: `<svg viewbox=\"0 0 18 18\"><line class=\"ql-stroke\" x1=\"3\" x2=\"15\" y1=\"9\" y2=\"9\"></line><line class=\"ql-stroke\" x1=\"3\" x2=\"13\" y1=\"14\" y2=\"14\"></line><line class=\"ql-stroke\" x1=\"3\" x2=\"9\" y1=\"4\" y2=\"4\"></line></svg>`,\n      center: `<svg viewbox=\"0 0 18 18\"><line class=\"ql-stroke\" x1=\"15\" x2=\"3\" y1=\"9\" y2=\"9\"></line><line class=\"ql-stroke\" x1=\"14\" x2=\"4\" y1=\"14\" y2=\"14\"></line><line class=\"ql-stroke\" x1=\"12\" x2=\"6\" y1=\"4\" y2=\"4\"></line></svg>`,\n      right: `<svg viewbox=\"0 0 18 18\"><line class=\"ql-stroke\" x1=\"15\" x2=\"3\" y1=\"9\" y2=\"9\"></line><line class=\"ql-stroke\" x1=\"15\" x2=\"5\" y1=\"14\" y2=\"14\"></line><line class=\"ql-stroke\" x1=\"15\" x2=\"9\" y1=\"4\" y2=\"4\"></line></svg>`,\n      attribute: `<svg viewBox=\"0 0 24 24\" fill=\"none\" class=\"ql-stroke\"><path d=\"M10 19H12M12 19H14M12 19V5M12 5H6V6M12 5H18V6\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/></svg>`,\n      resizeMode: `<svg viewBox=\"0 0 24 24\" class=\"ql-stroke\"><path d=\"m 7.7056591,11.853515 q -1.515179,0 -2.4160962,-0.993056 -0.9009172,-1.0032944 -0.9009172,-2.6720388 0,-1.8223098 0.9521057,-2.8665548 0.9521057,-1.0544826 2.5696616,-1.0544826 1.5663674,0 2.426334,0.9725811 0.870204,0.972581 0.870204,2.7334647 0,1.7608836 -0.972581,2.8256044 -0.9623435,1.054482 -2.5287109,1.054482 z M 7.8489868,5.3935293 q -0.9725811,0 -1.5356544,0.7268764 -0.5630732,0.7166387 -0.5630732,1.9758752 0,1.2387612 0.5528356,1.9349241 0.5528355,0.685926 1.5049412,0.685926 0.9623434,0 1.5049413,-0.716639 0.5425978,-0.7166384 0.5425978,-1.9861126 0,-1.2387612 -0.5425978,-1.9246868 Q 8.7806171,5.3935293 7.8489868,5.3935293 Z M 17.533847,4.4926121 8.1151669,19.275845 H 6.6511764 L 16.059619,4.4926121 Z M 16.448651,19.398697 q -1.515179,0 -2.416096,-1.003294 -0.900917,-1.003294 -0.900917,-2.661801 0,-1.82231 0.962343,-2.876793 0.962344,-1.06472 2.559424,-1.06472 1.55613,0 2.426334,0.982819 0.870204,0.982819 0.870204,2.75394 0,1.750646 -0.972581,2.815366 -0.962343,1.054483 -2.528711,1.054483 z m 0.143328,-6.449748 q -0.982819,0 -1.545892,0.716638 -0.552836,0.716639 -0.552836,1.986113 0,1.218286 0.552836,1.914449 0.552835,0.685926 1.504941,0.685926 0.962343,0 1.504941,-0.716639 0.542598,-0.726876 0.542598,-1.986113 0,-1.248998 -0.542598,-1.924686 -0.53236,-0.675688 -1.46399,-0.675688 z\" style=\"fill:currentColor;stroke:currentColor;stroke-width:0.3\"/></svg>`,\n      compress: `<svg viewBox=\"0 0 28 28\"><path d=\"m 19.250001,9.3125004 c 0.240623,0 0.437498,0.1968749 0.437498,0.4374991 V 18.49453 l -0.136717,-0.177734 -3.718751,-4.812498 c -0.123046,-0.161329 -0.317188,-0.254297 -0.51953,-0.254297 -0.202345,0 -0.39375,0.09297 -0.519532,0.254297 l -2.269532,2.936715 -0.833984,-1.167577 c -0.123047,-0.172265 -0.319922,-0.273437 -0.533204,-0.273437 -0.213281,0 -0.410156,0.101172 -0.533202,0.276172 l -2.1875003,3.0625 -0.1230462,0.169532 v -0.0082 -8.7500002 c 0,-0.2406242 0.1968749,-0.4374991 0.4374991,-0.4374991 z M 8.7499996,8 C 7.7847663,8 7,8.7847662 7,9.7499995 V 18.5 c 0,0.965233 0.7847663,1.75 1.7499996,1.75 H 19.250001 C 20.215235,20.25 21,19.465233 21,18.5 V 9.7499995 C 21,8.7847662 20.215235,8 19.250001,8 Z M 10.9375,13.250001 a 1.3125025,1.312501 0 1 0 0,-2.625002 1.3125025,1.312501 0 1 0 0,2.625002 z\" /><path d=\"m 25.298508,20 h -3.58209 C 21.286567,20 21,20.286571 21,20.716427 v 3.582131 c 0,0.429856 0.286567,0.716426 0.716418,0.716426 v 0 c 0.429851,0 0.716418,-0.28657 0.716418,-0.716426 v -2.865705 h 2.865672 c 0.429851,0 0.716418,-0.28657 0.716418,-0.716426 C 26.014926,20.286571 25.728359,20 25.298508,20 Z\" /><path d=\"M 6.298508,20 H 2.716418 C 2.2865673,20 2,20.286571 2,20.716427 c 0,0.429856 0.2865673,0.716426 0.716418,0.716426 H 5.58209 v 2.865705 c 0,0.429856 0.286567,0.716426 0.716418,0.716426 v 0 c 0.429851,0 0.716418,-0.28657 0.716418,-0.716426 V 20.716427 C 7.014926,20.286571 6.728359,20 6.298508,20 Z\" /><path d=\"M 6.298507,3 C 5.868656,3 5.582089,3.28657 5.582089,3.716426 V 6.582131 H 2.716417 C 2.286567,6.582131 2,6.868702 2,7.298557 2,7.728413 2.286567,8.014984 2.716417,8.014984 h 3.58209 c 0.429845,0 0.716412,-0.286571 0.716412,-0.716427 V 3.716426 C 7.014919,3.28657 6.728352,3 6.298507,3 Z\" /><path d=\"m 21.716418,8.014984 h 3.582089 c 0.429851,0 0.716418,-0.286571 0.716418,-0.716427 0,-0.429855 -0.286567,-0.716426 -0.716418,-0.716426 H 22.432836 V 3.716426 C 22.432836,3.28657 22.146269,3 21.716418,3 21.286567,3 21,3.28657 21,3.716426 v 3.582131 c 0,0.429856 0.286567,0.716427 0.716418,0.716427 z\" /></svg>`,\n      link: `<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 18 18\" style=\"fill: none;stroke: #444;stroke-linecap: round;stroke-linejoin: round;stroke-width: 1.5;\"><line x1=\"7\" x2=\"11\" y1=\"7\" y2=\"11\"/><path class=\"ql-even\" d=\"M8.9,4.577a3.476,3.476,0,0,1,.36,4.679A3.476,3.476,0,0,1,4.577,8.9C3.185,7.5,2.035,6.4,4.217,4.217S7.5,3.185,8.9,4.577Z\"/><path class=\"ql-even\" d=\"M13.423,9.1a3.476,3.476,0,0,0-4.679-.36,3.476,3.476,0,0,0,.36,4.679c1.392,1.392,2.5,2.542,4.679.36S14.815,10.5,13.423,9.1Z\"/></svg>`,\n    },\n    tooltips: {\n      left: 'Align Left',\n      center: 'Align Center',\n      right: 'Align Right',\n      attribute: 'Set Alt/Title',\n      resizeMode: 'Use Relative (%)/Absolute (px) Sizing',\n      compress: 'Compress Image',\n      link: 'Add/Edit Link',\n    },\n    mainClassName: 'blot-formatter__toolbar',\n    mainStyle: {\n      position: 'absolute',\n      display: 'flex',\n      top: '0',\n      right: '0',\n      left: '0',\n      transform: 'translateY(-50%)',\n      justifyContent: 'center',\n      flexWrap: 'wrap',\n      color: '#333',\n      zIndex: '1',\n    },\n    buttonClassName: 'blot-formatter__toolbar-button',\n    buttonStyle: {\n      display: 'inline-block',\n      width: '27px',\n      height: '26px',\n      background: 'white',\n      border: '1px solid #999',\n      cursor: 'pointer',\n      margin: '0 -1px 0 0'\n    },\n    buttonSelectedClassName: 'blot-formatter__toolbar-button--selected',\n    buttonSelectedStyle: {\n      filter: 'invert(20%)',\n    },\n    svgStyle: {\n      display: 'inline-block',\n      width: '100%',\n      height: '100%',\n      background: 'white',\n      verticalAlign: 'top',\n    },\n  },\n  image: {\n    allowAltTitleEdit: true,\n    registerImageTitleBlot: false,\n    registerArrowRightFix: true,\n    altTitleModalOptions: {\n      styles: {\n        modalBackground: {\n          position: 'fixed',\n          top: 0,\n          left: 0,\n          width: '100%',\n          height: '100%',\n          backgroundColor: 'rgba(0,0,0,0.5)',\n          display: 'flex',\n          alignItems: 'center',\n          justifyContent: 'center',\n          zIndex: 9999\n        },\n        modalContainer: {\n          backgroundColor: '#f2f2f2',\n          padding: '5px 10px 10px 10px',\n          borderRadius: '5px',\n          position: 'relative',\n          width: '90%',\n          maxWidth: '500px',\n          boxShadow: '6px 6px 5px #00000075'\n        },\n        label: {\n          display: 'block',\n          color: 'black',\n          margin: '7px 0 5px 0',\n          fontSize: '14px'\n        },\n        textarea: {\n          backgroundColor: 'white',\n          fontSize: '13px',\n          display: 'block',\n          resize: 'none',\n          width: '100%',\n          padding: '5px',\n          border: '1px solid lightgray',\n          borderRadius: '4px',\n          boxSizing: 'border-box'\n        },\n        submitButton: {\n          display: 'block',\n          marginLeft: 'auto',\n          marginTop: '5px',\n          cursor: 'pointer',\n          border: 0,\n          padding: 0,\n          width: '2rem',\n          height: '2rem',\n          color: '#198754'\n        },\n        cancelButton: {\n          display: 'flex',\n          width: '1.5rem',\n          height: '1.5rem',\n          position: 'absolute',\n          padding: 0,\n          top: '-0.7rem',\n          right: '-0.7rem',\n          background: 'white',\n          border: 'none',\n          borderRadius: '5px',\n          cursor: 'pointer',\n          alignItems: 'center',\n          color: 'rgb(197, 74, 71)'\n        },\n      },\n      icons: {\n        submitButton: okButtonIcon,\n        cancelButton: closeButtonIcon,\n      },\n      labels: {\n        alt: 'Alt Text',\n        title: 'Image Title'\n      }\n    },\n    allowCompressor: false,\n    compressorOptions: {\n      jpegQuality: 0.8,\n      styles: {\n        modalBackground: {\n          position: 'fixed',\n          top: 0,\n          left: 0,\n          width: '100%',\n          height: '100%',\n          backgroundColor: 'rgba(0,0,0,0.5)',\n          display: 'flex',\n          alignItems: 'center',\n          justifyContent: 'center',\n          zIndex: 9999\n        },\n        modalContainer: {\n          backgroundColor: 'rgb(253, 253, 253)',\n          border: '1px solid #ccc',\n          boxShadow: '6px 6px 5px #00000075',\n          padding: '15px',\n          borderRadius: '8px',\n          position: 'relative',\n          maxWidth: 'min(90%, 400px)',\n          textAlign: 'justify',\n          userSelect: 'none',\n        },\n        buttonContainer: {\n          gridTemplateColumns: 'auto 1fr auto',\n          display: 'grid',\n          gap: '1em',\n          justifyItems: 'center',\n          borderTop: '1px solid lightgray',\n          paddingTop: '12px'\n        },\n        buttons: {\n          width: '1.5rem',\n          height: '1.5rem',\n          padding: 0,\n          backgroundColor: 'transparent',\n          border: 0,\n          cursor: 'pointer',\n        }\n      },\n      buttons: {\n        continue: {\n          className: 'blot-formatter__compress-continue',\n          style: {\n            color: '#198754'\n          }\n        },\n        cancel: {\n          className: 'blot-formatter__compress-cancel',\n          style: {\n            color: 'rgb(197, 74, 71)'\n          }\n        },\n        moreInfo: {\n          className: 'blot-formatter__compress-more-info',\n          style: {\n            color: 'royalblue'\n          }\n        }\n      },\n      text: {\n        prompt: `<p style=\"font-style: large;margin: 0 0 0.5em;\">Compress image to its resized width?</p>`,\n        moreInfo: `<p style=\"font-size: smaller; line-height: 1.2;\">You can reduce the file size and save disk space by compressing pictures. The compression reduces both the file size and picture dimensions based on the width setting.</p><p style=\"font-size: smaller;\"><strong>NOTE:</strong> This process cannot be undone.</p>`,\n        reducedLabel: 'Reduced',\n        nothingToDo: 'Image already optimised.'\n      },\n      icons: {\n        cancel: `<span style=\"color: rgb(197, 74, 71);\">${closeButtonIcon}</span>`,\n        moreInfo: infoButtonIcon,\n        continue: okButtonIcon\n      }\n    },\n    linkOptions: {\n      allowLinkEdit: true,\n      modal: {\n        dialog: {\n          className: 'blot-formatter__link-modal',\n          style: { // NOTE: positioning handled programatically\n            margin: 0,\n            backgroundColor: '#fdfdfd',\n            border: '1px solid #ccc',\n            boxShadow: '6px 6px 5px #00000075',\n            color: '#444',\n            padding: '6px 13px 6px 10px',\n            whiteSpace: 'nowrap',\n            borderRadius: '5px',\n            minWidth: '300px',\n            maxWidth: '90%',\n            overflow: 'visible',\n            zIndex: 101, // Ensure it is above the background\n          }\n        },\n        background: {\n          className: 'blot-formatter__link-modal-background',\n          style: {\n            position: 'fixed',\n            inset: 0,\n            background: 'rgba(0, 0, 0, 0.5)',\n            zIndex: 100,\n          }\n        },\n        form: {\n          className: 'blot-formatter__link-form',\n          style: {\n            display: 'flex',\n            flexWrap: 'nowrap',\n            columnGap: '5px',\n            alignItems: 'center',\n            margin: 0\n          }\n        },\n        label: {\n          className: 'blot-formatter__link-label',\n          style: {\n            paddingRight: '5px',\n            fontSize: '13px',\n          },\n          text: 'URL:',\n        },\n        input: {\n          className: 'blot-formatter__link-input',\n          style: {\n            border: '1px solid #ccc',\n            borderRadius: '4px',\n            boxSizing: 'border-box',\n            fontSize: '13px',\n            height: '26px',\n            margin: '0 0.2rem 0 0',\n            padding: '3px 5px',\n            width: '100%',\n            outline: '1px auto #df9001c2',\n          },\n          placeholder: 'https://example.com',\n        },\n        buttons: {\n          submit: {\n            className: 'blot-formatter__link-submit',\n            style: {\n              border: 'none',\n              borderRadius: '3px',\n              padding: '0',\n              cursor: 'pointer',\n              background: 'transparent',\n              width: '26px',\n              height: '26px',\n              color: '#198754',\n              display: 'flex',\n              alignContent: 'center',\n              justifyContent: 'center',\n            },\n            icon: `<svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"currentColor\" viewBox=\"0 0 16 16\" style=\"height:100%;width:auto\"><path d=\"M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z\"/><path d=\"M10.97 4.97a.75.75 0 0 1 1.071 1.05l-3.992 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425z\"/></svg>`,\n            tooltip: 'Create Link'\n          },\n          cancel: {\n            className: 'blot-formatter__link-cancel',\n            style: {\n              display: 'flex',\n              width: '18px',\n              height: '18px',\n              position: 'absolute',\n              top: '-8px',\n              right: '-10px',\n              padding: '0',\n              background: 'white',\n              border: '1px solid rgb(157, 58, 56)',\n              borderRadius: '5px',\n              cursor: 'pointer',\n              alignItems: 'center',\n              color: 'rgb(197, 74, 71)',\n            },\n            icon: closeButtonIcon,\n            tooltip: 'Cancel'\n          },\n          remove: {\n            className: 'blot-formatter__link-remove',\n            style: {\n              border: 'none',\n              padding: '0',\n              cursor: 'pointer',\n              background: 'transparent',\n              width: '26px',\n              height: '26px',\n              fill: '#c54a47',\n              display: 'flex',\n              placeContent: 'center',\n              justifyContent: 'center',\n            },\n            icon: `<svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:svg=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 16 16\" style=\"height:100%;width:auto\"><path d=\"M 6.265625,3.3457031 6.125,3.625 H 4.25 c -0.3457031,0 -0.625,0.2792969 -0.625,0.625 0,0.3457031 0.2792969,0.625 0.625,0.625 h 7.5 c 0.345703,0 0.625,-0.2792969 0.625,-0.625 0,-0.3457031 -0.279297,-0.625 -0.625,-0.625 H 9.875 L 9.734375,3.3457031 C 9.6289062,3.1328125 9.4121094,3 9.1757812,3 H 6.8242188 C 6.5878906,3 6.3710938,3.1328125 6.265625,3.3457031 Z M 11.75,5.5 h -7.5 l 0.4140625,6.621094 C 4.6953125,12.615234 5.1054688,13 5.5996094,13 h 4.8007816 c 0.49414,0 0.904297,-0.384766 0.935547,-0.878906 z\" style=\"display:inline;stroke-width:0.0195312\"/><path d=\"m 14,1 a 1,1 0 0 1 1,1 v 12 a 1,1 0 0 1 -1,1 H 2 A 1,1 0 0 1 1,14 V 2 A 1,1 0 0 1 2,1 Z M 2,0 A 2,2 0 0 0 0,2 v 12 a 2,2 0 0 0 2,2 h 12 a 2,2 0 0 0 2,-2 V 2 A 2,2 0 0 0 14,0 Z\" style=\"display:inline\"/></svg>`,\n            tooltip: 'Remove Link'\n          }\n        }\n      }\n    },\n    autoHeight: true\n  },\n  video: {\n    selector: 'iframe.ql-video',\n    registerCustomVideoBlot: false,\n    registerBackspaceFix: true,\n    defaultAspectRatio: '16/9 auto',\n    proxyStyle: {}\n  }\n};\n","import Action from './actions/Action';\nimport BlotSpec from './specs/BlotSpec';\nimport CaretAction from './actions/CaretAction';\nimport deepmerge from 'deepmerge';\nimport type Quill from 'quill';\nimport Toolbar from './actions/toolbar/Toolbar';\nimport TooltipContainPosition from './tooltip/TooltipContainPosition';\nimport type { AttributorClass } from './actions/align/AlignFormats';\nimport { createAltTitleImageBlotClass } from './blots/Image';\nimport { createIframeAlignAttributor, createImageAlignAttributor } from './actions/align/AlignFormats';\nimport { createResponsiveVideoBlotClass } from './blots/Video';\nimport { DefaultOptions } from './DefaultOptions';\nimport type { Options } from './Options';\n\nconst dontMerge = (destination: Array<any>, source: Array<any>) => source;\n\n/**\n * Represents the possible positions of a pointer relative to the formatter overlay.\n *\n * - `LEFT`: The pointer is positioned to the left of the overlay.\n * - `RIGHT`: The pointer is positioned to the right of the overlay.\n * - `ABOVE`: The pointer is positioned above the overlay.\n * - `BELOW`: The pointer is positioned below the overlay.\n * - `INSIDE`: The pointer is positioned inside the overlay.\n */\nenum PointerPosition {\n  LEFT = 'left',\n  RIGHT = 'right',\n  ABOVE = 'above',\n  BELOW = 'below',\n  INSIDE = 'inside',\n}\n\ntype PxString = `${number}px`;\ntype CssRectPx = {\n  left: PxString;\n  top: PxString;\n  width: PxString;\n  height: PxString;\n};\n\n/**\n * BlotFormatter is a Quill module that provides an interactive overlay for formatting embedded blots\n * (such as images, iframes, and videos) within the Quill rich text editor. It enables resizing, alignment,\n * and other custom actions on supported blots via a floating UI, and manages all related event handling,\n * DOM manipulation, and integration with Quill's API.\n *\n * Features:\n * - Displays an overlay with handles and a toolbar for formatting selected blots.\n * - Supports custom actions, alignment, and resizing (with both relative and absolute sizing).\n * - Integrates with Quill's keyboard bindings to fix known issues with embedded content.\n * - Handles touch and mouse interactions, including scrolling and context menu suppression.\n * - Registers and manages custom blots and attributors for advanced formatting.\n * - Provides robust cleanup and destruction of all event listeners and DOM elements.\n * - Exposes debugging hooks and logs when enabled via options.\n *\n * Usage:\n * Instantiate with a Quill editor instance and optional configuration options.\n * The formatter automatically attaches to the editor and manages its own lifecycle.\n *\n * Example:\n * ```typescript\n * const quill = new Quill('#editor', { ... });\n * const blotFormatter = new BlotFormatter(quill, { debug: true });\n * ```\n *\n * @template Options - The configuration options type for the formatter.\n * @template BlotSpec - The specification interface for supported blots.\n * @template Action - The interface for custom actions available in the overlay.\n *\n * @public\n */\nexport default class BlotFormatter {\n  Quill: typeof Quill;\n  quill: any;\n  options: Options;\n  currentSpec: BlotSpec | null;\n  specs: BlotSpec[];\n  overlay: HTMLElement;\n  toolbar: Toolbar;\n  sizeInfo: HTMLElement;\n  actions: Action[];\n  private _enabled: boolean = true;\n  private _startX: number = 0; // touch scroll tracking\n  private _startY: number = 0;\n  private _abortController?: AbortController;\n  private _resizeObserver?: ResizeObserver;\n  private _tooltipContainPosition?: TooltipContainPosition;\n  ImageAlign: AttributorClass;\n  IframeAlign: AttributorClass;\n\n  constructor(quill: any, options: Partial<Options> = {}) {\n    this.Quill = quill.constructor;\n    this.quill = quill;\n    this.currentSpec = null;\n    this.actions = [];\n    if (options.debug) {\n      (window as any).blotFormatter = this;\n    }\n\n    // Register the custom align formats with Quill\n    const ImageAlignClass = createImageAlignAttributor(this.Quill);\n    const IframeAlignClass = createIframeAlignAttributor(this.Quill);\n\n    // Create instances of the classes\n    this.ImageAlign = new ImageAlignClass(options.debug);\n    this.IframeAlign = new IframeAlignClass(options.debug);\n\n    // Register the align formats with Quill\n    if (options.debug) console.debug('Registering custom align formats', this.ImageAlign, this.IframeAlign);\n    this.Quill.register({\n      'formats/imageAlign': this.ImageAlign,\n      'attributors/class/imageAlign': this.ImageAlign,\n      'formats/iframeAlign': this.IframeAlign,\n      'attributors/class/iframeAlign': this.IframeAlign,\n    }, true);\n\n    // merge custom options with default\n    this.options = deepmerge(DefaultOptions, options, { arrayMerge: dontMerge });\n    if (options.debug) console.debug('BlotFormatter options', this.options);\n\n    // set enabled, add css to hide proxy images when editor is disabled\n    this._enabled = !(this.quill.options.readOnly || this.quill.container.classList.contains('ql-disabled'));\n    const style = document.createElement('style');\n    style.innerHTML = `.ql-disabled .blot-formatter__proxy-image {display: none;}`;\n    document.head.appendChild(style);\n\n    // create overlay & size info plus associated event listeners \n    [this.overlay, this.sizeInfo] = this._createOverlay();\n    this._addEventListeners();\n    // create overlay toolbar\n    this.toolbar = new Toolbar(this);\n    if (options.debug) console.debug('BlotFormatter toolbar', this.toolbar);\n    // define which specs to be formatted, initialise each\n    this.specs = this.options.specs.map(\n      (SpecClass: new (formatter: BlotFormatter) => BlotSpec) => new SpecClass(this)\n    );\n    this.specs.forEach(spec => spec.init());\n    if (options.debug) console.debug('BlotFormatter specs', this.specs);\n    // set position relative on quill container for absolute positioning of overlay & proxies \n    this.quill.container.style.position = this.quill.container.style.position || 'relative';\n    // register custom blots as per options\n    this._registerCustomBlots();\n    // register keyboard bindings as per options\n    this._keyboardBindings();\n    // add tooltip position fix if enabled\n    if (this.options.debug) console.debug('tooltip option', this.options.tooltip?.containTooltipPosition)\n    if (this.options.tooltip?.containTooltipPosition) {\n      this._tooltipContainPosition = new TooltipContainPosition(this.quill, this.options.debug);\n    }\n\n  }\n\n  /**\n   * Destroys the BlotFormatter instance, cleaning up event listeners, actions, toolbar,\n   * and DOM references. Also removes any global references and clears internal state.\n   * Logs a debug message if the `debug` option is enabled.\n   * Catches and logs any errors that occur during the destruction process.\n   */\n  destroy = (): void => {\n    try {\n      this.hide();\n      this._removeEventListeners();\n      this._destroyActions();\n      this.toolbar?.destroy();\n\n      // Clean up DOM references\n      if (this.overlay?.parentNode) {\n        this.overlay.parentNode.removeChild(this.overlay);\n      }\n\n      // Clear references\n      this.currentSpec = null;\n      this.specs = [];\n      this.actions = [];\n\n      if (this.options.tooltip?.containTooltipPosition && this._tooltipContainPosition) {\n        this._tooltipContainPosition?.destroy();\n      }\n\n      // Remove global reference\n      if ((window as any).bf === this) {\n        delete (window as any).bf;\n      }\n\n      this.quill = null;\n      if (this.options.debug) console.debug('BlotFormatter destroyed');\n    } catch (error) {\n      console.error('BlotFormatter.destroy error:', error);\n    }\n  };\n\n  /**\n   * Indicates whether the blot formatter is currently active.\n   *\n   * When `true`, formatting controls and interactions are available.\n   * When `false`, the formatter is disabled and will not react to user input. Proxy images are hidden by css.\n   *\n   * @returns True if the formatter is enabled; otherwise false.\n   */\n  get enabled(): boolean {\n    return this._enabled;\n  }\n\n  /**\n   * Enables or disables the blot formatter UI.\n   *\n   * When set to false, any currently visible formatter interface (such as\n   * overlays, resize handles, or toolbars) is immediately hidden via `hide()`.\n   * While disabled, user interactions that would normally trigger the formatter\n   * are ignored until re-enabled.\n   *\n   * @param value True to enable the formatter; false to disable it and hide all active UI.\n   */\n  set enabled(value: boolean) {\n    if (!value) this.hide();\n    this._enabled = value;\n  }\n\n  /**\n   * MutationObserver monitoring the Quill editor container's class attribute to track disabled state.\n   *\n   * When the container gains or loses the 'ql-disabled' CSS class, this observer updates the\n   * formatter's `enabled` property accordingly, ensuring the formatter UI is automatically\n   * disabled/enabled in sync with the editor.\n   *\n   * Behavior:\n   * - Listens only for attribute mutations on the 'class' attribute.\n   * - Sets `this.enabled` to false if 'ql-disabled' is present; true otherwise.\n   *\n   * Rationale:\n   * Centralizes Quill's disabled state propagation without requiring explicit event hooks or\n   * modifications to Quill's core. This avoids polling and keeps formatter state consistent.\n   *\n   * Lifecycle:\n   * - Should be started after the editor container is available.\n   * - Must be disconnected during teardown (e.g., in a destroy/dispose method) to prevent memory leaks.\n   *\n   * Caveats:\n   * - Assumes the presence and semantic meaning of the 'ql-disabled' class as used by Quill.\n   * - If external code mutates classes frequently, this may fire often; the handler is intentionally lightweight.\n   */\n  private _qlDisabledObserver = new MutationObserver(mutations => {\n    mutations.forEach(mutation => {\n      if (mutation.type === 'attributes' && mutation.attributeName === 'class') {\n        this.enabled = !this.quill.container.classList.contains('ql-disabled');\n      }\n    });\n  });\n\n  /**\n   * Displays the blot formatter overlay for the specified blot.\n   *\n   * This method performs the following actions:\n   * - Hides any open Quill tooltips (such as hyperlink dialogs).\n   * - Optionally exposes the formatter instance for debugging.\n   * - Clears any existing overlay if active on another blot.\n   * - Sets the current blot specification and selection.\n   * - Disables user selection to prevent unwanted interactions.\n   * - Appends the overlay to the Quill editor container.\n   * - Repositions the overlay to match the blot's position.\n   * - Creates action buttons or controls for the current blot.\n   * - Initializes the toolbar for the formatter.\n   * - Adds a document-level pointerdown event listener to handle outside clicks.\n   * - Logs debug information if enabled in options.\n   *\n   * @param spec - The specification of the blot (*BlotSpec*) to be formatted.\n   * @returns void\n   */\n  show = (spec: BlotSpec): void => {\n    try {\n      // exit early if editor is readOnly or disabled\n      if (!this.enabled) return;\n      // hide any open tooltips (closes open hyperlink dialog and more)\n      this.quill.container.querySelectorAll('.ql-tooltip:not(.ql-hidden)').forEach(\n        (tooltip: HTMLElement) => {\n          tooltip.classList.add('ql-hidden');\n        }\n      );\n      // expose formatter for debugging\n      if (this.options.debug) (window as any).blotFormatter = this;\n      // clear overlay in case show called while overlay active on other blot\n      this.hide();\n      this.currentSpec = spec;\n      this.currentSpec.setSelection();\n      this._setUserSelect('none');\n      this.quill.container.appendChild(this.overlay);\n      this._repositionOverlay();\n      this._createActions(spec);\n      this.toolbar.create();\n      this._scrollToolbarIntoView(this.toolbar.element);\n      document.addEventListener('pointerdown', this._onDocumentPointerDown);\n      if (this.options.debug) console.debug('BlotFormatter show', spec);\n    } catch (error) {\n      console.error('Error showing BlotFormatter:', error);\n      this.hide();\n      // Re-throw the error to ensure it can be handled by the caller if needed\n      throw error;\n    }\n  }\n\n  /**\n   * Hides the blot formatter overlay and performs necessary cleanup.\n   *\n   * If a pointer event is provided, determines the click position relative to the target blot\n   * and places the caret before or after the blot accordingly. Calls the `onHide` method of the\n   * current spec, removes the overlay from the DOM, removes event listeners, resets user selection,\n   * destroys toolbar and actions, and emits a `TEXT_CHANGE` event to ensure the editor state is updated.\n   *\n   * @param event - Optional pointer event that triggered the hide action. Used to determine caret placement.\n   */\n  hide = (event: PointerEvent | null = null): void => {\n    if (this.currentSpec) {\n      if (event) {\n        const targetBlot = this.currentSpec!.getTargetBlot();\n        if (targetBlot) {\n          const position = this._getClickPosition(event);\n          if (position === PointerPosition.LEFT) {\n            if (this.options.debug) console.debug('Click position: LEFT');\n            CaretAction.placeCaretBeforeBlot(this.quill, targetBlot);\n          } else if (position === PointerPosition.RIGHT) {\n            if (this.options.debug) console.debug('Click position: RIGHT');\n            CaretAction.placeCaretAfterBlot(this.quill, targetBlot);\n          }\n        }\n      }\n      this.currentSpec.onHide();\n      this.currentSpec = null;\n      this.quill.container.removeChild(this.overlay);\n      document.removeEventListener('pointerdown', this._onDocumentPointerDown);\n      this.overlay.style.setProperty('display', 'none');\n      this._setUserSelect('');\n      this._destroyActions();\n      this.toolbar.destroy();\n      // TEXT_CHANGE event clears resize cursor from image when form is saved while overlay still active\n      this.quill.emitter.emit(\n        this.quill.constructor.events.TEXT_CHANGE, 0, this.quill.getLength(), 'api'\n      );\n    }\n    if (this.options.debug) console.debug('BlotFormatter hide');\n  }\n\n  /**\n   * Updates the state of the BlotFormatter overlay and its associated actions.\n   *\n   * This method repositions the overlay to match the current selection or formatting context,\n   * triggers the `onUpdate` method for each registered action, and logs a debug message if\n   * debugging is enabled in the options.\n   *\n   * @returns {void}\n   */\n  update = (): void => {\n    this._repositionOverlay();\n    this.actions.forEach(action => action.onUpdate());\n    if (this.options.debug) console.debug('BlotFormatter update');\n  }\n\n  /**\n   * Initializes the actions for the given blot specification.\n   * \n   * This method retrieves the list of actions from the provided `spec` using `getActions()`,\n   * calls the `onCreate()` lifecycle method on each action, and assigns the resulting array\n   * to the `actions` property. If debugging is enabled in the options, it logs each created action.\n   *\n   * @param spec - The blot specification containing the actions to initialize.\n   */\n  private _createActions = (spec: BlotSpec): void => {\n    this.actions = spec.getActions().map((action: Action) => {\n      action.onCreate();\n      if (this.options.debug) console.debug('BlotFormatter action created', action);\n      return action;\n    });\n  }\n\n  /**\n   * Destroys all registered actions by calling their `onDestroy` method and clearing the actions array.\n   * If debugging is enabled in the options, logs a debug message to the console.\n   *\n   * @private\n   */\n  private _destroyActions = (): void => {\n    this.actions.forEach((action: Action) => action.onDestroy());\n    this.actions = [];\n    if (this.options.debug) console.debug('BlotFormatter actions destroyed');\n  }\n\n  /**\n   * Creates and configures the overlay and size info HTML elements used for formatting blots.\n   *\n   * The overlay element is styled and configured to be non-selectable, and the size info element\n   * is appended to the overlay. Both elements can be customized via the `options.overlay` property.\n   * \n   * @returns A tuple containing the overlay HTMLElement and the size info HTMLElement.\n   */\n  private _createOverlay = (): [HTMLElement, HTMLElement] => {\n    const overlay = document.createElement('div');\n    // set up overlay element\n    overlay.classList.add(this.options.overlay.className);\n    if (this.options.overlay.style) {\n      Object.assign(overlay.style, this.options.overlay.style);\n    }\n    // prevent overlay being selectable\n    overlay.style.userSelect = 'none';\n    overlay.style.setProperty('-webkit-user-select', 'none');\n    overlay.style.setProperty('-moz-user-select', 'none');\n    overlay.style.setProperty('-ms-user-select', 'none');\n\n    const sizeInfo = document.createElement('div');\n    if (this.options.overlay.sizeInfoStyle) {\n      Object.assign(sizeInfo.style, this.options.overlay.sizeInfoStyle);\n    }\n    overlay.appendChild(sizeInfo);\n    if (this.options.debug) console.debug('BlotFormatter overlay created', overlay, sizeInfo);\n    return [overlay, sizeInfo]\n  }\n\n  /**\n   * Ensures that the toolbar element is visible within the viewport of the Quill editor.\n   * If the toolbar is positioned above the visible area of the editor, it scrolls the target element into view\n   * with an offset equal to the toolbar's height, then recalculates the toolbar's position.\n   * If the toolbar is still above the viewport, it scrolls the window to bring the toolbar into view smoothly.\n   *\n   * @param toolbarElement - The HTML element representing the toolbar to be scrolled into view.\n   * @returns A promise that resolves when any necessary scrolling has completed.\n   */\n  private _scrollToolbarIntoView = async (toolbarElement: HTMLElement): Promise<void> => {\n    let toolbarRect = toolbarElement.getBoundingClientRect();\n    const quillRect = this.quill.container.getBoundingClientRect();\n\n    const targetElement = this.currentSpec?.getTargetElement();\n    if (toolbarRect.top - quillRect.top < 0) {\n      if (targetElement) {\n        // Wait for the smooth scroll to complete\n        await this._scrollIntoViewWithOffset(targetElement, toolbarRect.height);\n        // Now recalculate the toolbar position\n        toolbarRect = toolbarElement.getBoundingClientRect();\n      }\n    }\n    // If toolbar is still above the viewport, scroll the window\n    if (toolbarRect.top < 0) {\n      if (this.options.debug) {\n        console.debug(`Scrolling window ${toolbarRect.top - toolbarRect.height}px to bring toolbar into view`);\n      }\n      window.scrollBy({ top: toolbarRect.top - toolbarRect.height, behavior: 'smooth' });\n    }\n  }\n\n  /**\n   * Scrolls the first scrollable ancestor of the given element into view with a specified offset.\n   * If the element is outside the visible bounds of its scrollable ancestor, the ancestor is scrolled\n   * so that the element is visible with the given offset from the top. Returns a promise that resolves\n   * when scrolling has completed (or immediately if no scrolling was necessary).\n   *\n   * @param el - The target HTMLElement to scroll into view.\n   * @param offset - The number of pixels to offset from the top of the scrollable ancestor (default: 10).\n   * @returns A promise that resolves when scrolling is finished.\n   */\n  private _scrollIntoViewWithOffset = (el: HTMLElement, offset = 10): Promise<void> => {\n    return new Promise((resolve) => {\n      let scrollingElement: Element | null = null;\n\n      for (let ancestor = el.parentElement; ancestor; ancestor = ancestor.parentElement) {\n        const { overflowY } = getComputedStyle(ancestor);\n        if (!['auto', 'scroll'].includes(overflowY) || ancestor.scrollHeight <= ancestor.clientHeight) continue;\n\n        const containerRect = ancestor.getBoundingClientRect();\n        const elRect = el.getBoundingClientRect();\n\n        if (elRect.top < containerRect.top + offset) {\n          scrollingElement = ancestor;\n          ancestor.scrollTo({\n            top: ancestor.scrollTop + elRect.top - containerRect.top - offset\n          });\n          if (this.options.debug) {\n            console.debug(`Scrolling ancestor ${ancestor.tagName} to bring element into view with offset ${offset}px`);\n          }\n          break; // Only scroll the first scrollable ancestor\n        }\n      }\n\n      if (scrollingElement) {\n        // Wait for smooth scroll to complete\n        const checkScrollEnd = () => {\n          let lastScrollTop = scrollingElement!.scrollTop;\n          const checkInterval = setInterval(() => {\n            if (scrollingElement!.scrollTop === lastScrollTop) {\n              // Scroll has stopped\n              clearInterval(checkInterval);\n              resolve();\n            } else {\n              lastScrollTop = scrollingElement!.scrollTop;\n            }\n          }, 50); // Check every 50ms\n        };\n\n        // Start checking after a brief delay\n        setTimeout(checkScrollEnd, 100);\n      } else {\n        // No scrolling occurred\n        resolve();\n      }\n    });\n  };\n\n  /**\n   * Adds all necessary event listeners to the overlay and Quill root elements.\n   *\n   * - For the overlay:\n   *   - Forwards mouse wheel and touch move events to allow scrolling.\n   *   - Disables the context menu to prevent default browser actions.\n   * - For the Quill root:\n   *   - Repositions the overlay on scroll and resize events.\n   *   - Dismisses the overlay when clicking on the Quill root.\n   * - For the quill container\n   *   - Observes class attribute changes to detect disabled state.\n   *\n   * This method ensures proper interaction and synchronization between the overlay\n   * and the Quill editor, handling user input and UI updates.\n   *\n   * @private\n   */\n  private _addEventListeners = (): void => {\n    this._abortController = new AbortController();\n    const { signal } = this._abortController;\n\n    // overlay event listeners\n    // scroll the quill root on mouse wheel & touch move event - do not use default 'passive' on these\n    this.overlay.addEventListener('wheel', this._passWheelEventThrough, { passive: false, signal });\n    this.overlay.addEventListener('touchstart', this._onTouchScrollStart, { passive: false, signal });\n    this.overlay.addEventListener('touchmove', this._onTouchScrollMove, { passive: false, signal });\n    // disable context menu on overlay\n    this.overlay.addEventListener('contextmenu', this._preventContextMenu, { signal });\n    // dismiss overlay if active and click on quill root\n    this.quill.root.addEventListener('click', this._onClick, { signal });\n\n    // quill root event listeners\n    // scroll visible overlay if editor is scrollable\n    this.quill.root.addEventListener('scroll', this._repositionOverlay, { signal });\n\n    this._resizeObserver = new ResizeObserver(this._repositionOverlay);\n    this._resizeObserver.observe(this.quill.root);\n\n    // observe quill container for disabled state changes\n    this._qlDisabledObserver.observe(this.quill.container, {\n      attributes: true,\n      attributeFilter: ['class']\n    });\n  }\n\n  /**\n   * Removes event listeners and observers associated with the instance.\n   * \n   * Aborts any ongoing operations managed by the internal AbortController,\n   * and disconnects the internal ResizeObserver to stop observing changes.\n   *\n   * @private\n   */\n  private _removeEventListeners = (): void => {\n    this._abortController?.abort();\n    this._resizeObserver?.disconnect();\n    this._qlDisabledObserver.disconnect();\n  };\n\n  /**\n   * Prevents the default context menu from appearing and stops the event from propagating further.\n   *\n   * @param event - The event object associated with the context menu action.\n   */\n  private _preventContextMenu = (event: Event): void => {\n    event.stopPropagation();\n    event.preventDefault();\n  };\n\n  /**\n   * Repositions the overlay element to align with the currently selected blot's overlay target.\n   *\n   * Calculates the position and size of the overlay based on the bounding rectangles of the\n   * Quill container and the overlay target element. Updates the overlay's style to match\n   * the target's position and dimensions, ensuring it is correctly displayed over the selected blot.\n   * Optionally logs debug information if the `debug` option is enabled.\n   *\n   * @private\n   */\n  private _repositionOverlay = (): void => {\n    if (this.currentSpec) {\n      const overlayTarget = this.currentSpec.getOverlayElement();\n      if (overlayTarget) {\n        const containerRect: DOMRect = this.quill.container.getBoundingClientRect();\n        const specRect: DOMRect = overlayTarget.getBoundingClientRect();\n        const overlayRect: CssRectPx = {\n          left: `${specRect.left - containerRect.left - 1 + this.quill.container.scrollLeft}px`,\n          top: `${specRect.top - containerRect.top + this.quill.container.scrollTop}px`,\n          width: `${specRect.width}px`,\n          height: `${specRect.height}px`,\n        };\n        Object.assign(this.overlay.style, {\n          display: 'block',\n          ...overlayRect\n        });\n        if (this.options.debug)\n          console.debug('Blotformatter _repositionOverlay', 'specRect:', specRect, 'overlayRect:', overlayRect);\n      }\n    }\n  }\n\n  /**\n   * Sets the CSS `user-select` property (and its vendor-prefixed variants) to the specified value\n   * on both the Quill editor root element and the document's root element.\n   *\n   * This method is typically used to enable or disable text selection within the editor and the page,\n   * which can be useful during formatting operations to prevent unwanted user interactions.\n   *\n   * @param value - The value to set for the `user-select` property (e.g., `'none'`, `'auto'`).\n   */\n  private _setUserSelect = (value: string): void => {\n    const props: string[] = [\n      'userSelect',\n      'mozUserSelect',\n      'webkitUserSelect',\n      'msUserSelect',\n    ];\n\n    props.forEach((prop: string) => {\n      // set on contenteditable document element and quill root\n      this.quill.root.style.setProperty(prop, value);\n      if (document.documentElement) {\n        document.documentElement.style.setProperty(prop, value);\n      }\n    });\n    if (this.options.debug) console.debug('BlotFormatter _setUserSelect', value);\n  }\n\n  /**\n   * Handles the `pointerdown` event on the document to determine whether the blot formatter overlay should be dismissed.\n   *\n   * If the pointer event target is outside the Quill editor, not within a blot formatter modal,\n   * and not a proxy image used by the blot formatter, the overlay is hidden.\n   *\n   * @param event - The pointer event triggered by user interaction.\n   */\n  private _onDocumentPointerDown = (event: PointerEvent): void => {\n    // if clicked outside of quill editor and not a blot formatter modal or iframe proxy image, dismiss overlay \n    const target = event.target as HTMLElement;\n    if (!(\n      this.quill.root.parentNode.contains(target) ||\n      target.closest('[data-blot-formatter-modal]') ||\n      target.classList.contains('blot-formatter__proxy-image')\n    )) {\n      this.hide(event);\n    }\n  }\n\n  /**\n   * Handles pointer click events on the editor.\n   * \n   * If debugging is enabled in the options, logs the click event to the console.\n   * Then, hides the formatter UI in response to the click event.\n   *\n   * @param event - The pointer event triggered by the user's click.\n   */\n  private _onClick = (event: PointerEvent): void => {\n    if (this.options.debug) console.debug('BlotFormatter _onClick', event);\n    if (this.enabled) this.hide(event);\n  }\n\n  /**\n   * Handles the wheel event by scrolling the Quill editor's root element.\n   * This method is intended to be used when the overlay or proxy receives a wheel event,\n   * ensuring that the scroll action is passed through to the underlying Quill editor.\n   *\n   * @param event - The wheel event containing scroll delta values.\n   *\n   * @remarks\n   * If the `debug` option is enabled, this method logs the scroll delta values to the console.\n   */\n  _passWheelEventThrough = (event: WheelEvent): void => {\n    // scroll the quill root element when overlay or proxy wheel scrolled\n    this.quill.root.scrollLeft += event.deltaX;\n    this.quill.root.scrollTop += event.deltaY;\n    if (this.options.debug)\n      console.debug(`BlotFormatter scrolling Quill root x: ${event.deltaX}, y: ${event.deltaY}`);\n  };\n\n  /**\n   * Handles the touch start event for scrolling interactions.\n   * Records the initial X and Y positions of the first touch point.\n   * Optionally logs debug information if enabled in options.\n   *\n   * @param event - The touch event triggered when the user starts touching the screen.\n   */\n  _onTouchScrollStart = (event: TouchEvent): void => {\n    // Record the initial touch positions\n    if (event.touches.length === 1) {\n      const touch = event.touches[0];\n      this._startX = touch.clientX;\n      this._startY = touch.clientY;\n      if (this.options.debug)\n        console.debug('BlotFormatter _onTouchScrollStart', `X: ${this._startX}, Y: ${this._startY}`);\n    }\n  };\n\n  /**\n   * Handles touch move events to enable custom scrolling behavior within the Quill editor root element.\n   * \n   * This method allows for both vertical and horizontal scrolling using touch gestures,\n   * and prevents default browser scrolling when appropriate to provide a smoother, controlled experience.\n   * It updates the scroll position of the editor root based on the movement of the touch point,\n   * and ensures scrolling does not exceed the bounds of the content.\n   * \n   * @param event - The touch event triggered by the user's finger movement.\n   * \n   * @remarks\n   * - Only processes single-touch events.\n   * - Prevents default scrolling if the editor can be scrolled further in the direction of the gesture.\n   * - Updates the starting touch coordinates after each move to track incremental movement.\n   * - Logs debug information if the `debug` option is enabled.\n   */\n  _onTouchScrollMove = (event: TouchEvent): void => {\n    if (event.touches.length === 1) {\n      const touch = event.touches[0];\n      const deltaX = this._startX - touch.clientX;\n      const deltaY = this._startY - touch.clientY;\n\n      // Early return if minimal movement\n      if (Math.abs(deltaX) < 2 && Math.abs(deltaY) < 2) return;\n\n      const root = this.quill.root;\n\n      // Check if we can scroll further vertically and horizontally\n      const atTop = root.scrollTop === 0;\n      const atBottom = root.scrollTop + root.clientHeight === root.scrollHeight;\n      const atLeft = root.scrollLeft === 0;\n      const atRight = root.scrollLeft + root.clientWidth === root.scrollWidth;\n\n      // Determine if we're scrolling vertically or horizontally\n      const isScrollingVertically = Math.abs(deltaY) > Math.abs(deltaX);\n      const isScrollingHorizontally = Math.abs(deltaX) > Math.abs(deltaY);\n\n      let preventDefault = false;\n\n      // If scrolling vertically\n      if (isScrollingVertically) {\n        if (!(atTop && deltaY < 0) && !(atBottom && deltaY > 0)) {\n          preventDefault = true; // Prevent default only if we can scroll further\n          root.scrollTop += deltaY;\n        }\n      }\n\n      // If scrolling horizontally\n      if (isScrollingHorizontally) {\n        if (!(atLeft && deltaX < 0) && !(atRight && deltaX > 0)) {\n          preventDefault = true; // Prevent default only if we can scroll further\n          root.scrollLeft += deltaX;\n        }\n      }\n\n      if (preventDefault) {\n        event.preventDefault(); // Prevent default scrolling if necessary\n      }\n\n      // Update start positions for the next move event\n      this._startX = touch.clientX;\n      this._startY = touch.clientY;\n      if (this.options.debug)\n        console.debug('BlotFormatter touch scroll end', `X: ${this._startX}, Y: ${this._startY}`);\n    }\n  };\n\n  /**\n   * Registers custom Quill blots based on the provided options.\n   *\n   * - If `options.image.registerImageTitleBlot` is enabled, registers a custom Image blot\n   *   that supports a title attribute.\n   * - If `options.video.registerCustomVideoBlot` is enabled, registers a custom Video blot\n   *   with responsive behavior and sets its default aspect ratio from the options.\n   *\n   * Debug information is logged to the console if `options.debug` is true.\n   *\n   * @private\n   */\n  private _registerCustomBlots = (): void => {\n    // register image bot with title attribute support\n    if (this.options.image.registerImageTitleBlot) {\n      const ImageAltTitleBlot = createAltTitleImageBlotClass(this.Quill);\n      if (this.options.debug) console.debug('Registering custom Image blot', ImageAltTitleBlot);\n      this.Quill.register({ 'formats/image': ImageAltTitleBlot }, true);\n      if (this.options.debug) {\n        console.debug('formats/image after register:', this.Quill.import('formats/image'));\n      }\n    }\n    // register custom video blot with initial width 100% & aspect ratio from options\n    if (this.options.video.registerCustomVideoBlot) {\n      const VideoResponsive = createResponsiveVideoBlotClass(this.Quill);\n      if (this.options.debug) {\n        console.debug('Registering custom Video blot', VideoResponsive);\n        console.debug('Setting default aspect ratio for Video blot', this.options.video.defaultAspectRatio);\n      }\n      // set default aspect ratio for video responsive blot\n      VideoResponsive.aspectRatio = this.options.video.defaultAspectRatio;\n      this.Quill.register({ 'formats/video': VideoResponsive }, true);\n      if (this.options.debug) {\n        console.debug('formats/video after register:', this.Quill.import('formats/video'));\n      }\n    }\n  }\n\n  /**\n   * Registers custom keyboard bindings to address specific Quill editor issues and enhance user experience.\n   *\n   * - Adds a Backspace key binding to fix Quill bug #4364, ensuring proper deletion behavior for embedded videos (e.g., iframes).\n   *   This is enabled if `options.video.registerBackspaceFix` is true.\n   * - Adds an ArrowRight key binding to fix cursor navigation issues when moving past images,\n   *   ensuring the cursor does not get stuck or hidden at the image location.\n   *   This is enabled if `options.image.registerArrowRightFix` is true.\n   *\n   * Both bindings are conditionally registered based on the provided options.\n   * Debug information is logged to the console if `options.debug` is enabled.\n   *\n   * @private\n   */\n  private _keyboardBindings = (): void => {\n    // add backspace keyboard bindings\n    // patch that fixes Quill bug #4364 (https://github.com/slab/quill/issues/4364)\n    if (this.options.video.registerBackspaceFix) {\n      if (!this.quill.keyboard.bindings.Backspace) {\n        this.quill.keyboard.bindings.Backspace = []\n      }\n      const backspaceRule = {\n        key: 'Backspace',\n        empty: true,\n        line: {\n          domNode: {\n            tagName: \"IFRAME\"\n          }\n        },\n        handler: (range: any) => {\n          this.quill.deleteText(range.index - 1, 1, \"user\");\n        }\n      }\n      this.quill.keyboard.bindings.Backspace.unshift(backspaceRule);\n      if (this.options.debug)\n        console.debug('BlotFormatter added Backspace keyboard binding', backspaceRule);\n    }\n\n    // handles moving the cursor past the image when format set\n    // without this, cursor stops and stays hidden at the image location\n    if (this.options.image.registerArrowRightFix) {\n      if (!this.quill.keyboard.bindings.ArrowRight) {\n        this.quill.keyboard.bindings.ArrowRight = []\n      }\n      const arrowRightFixRule = {\n        key: 'ArrowRight',\n        collapsed: true,\n        empty: false,\n        suffix: /^$/,\n        line: {\n          domNode: {\n            tagName: \"P\"\n          }\n        },\n        handler: (range: any, context: any) => {\n          const index = range.index + range.length;\n          const documentLength = this.quill.getLength();\n          if (index + 1 >= documentLength - 1) {\n            // For the last blot, place cursor at the very end\n            this.quill.setSelection(documentLength - 1, 0, \"user\");\n          } else {\n            // overshoot by one then use native browser API to send caret back one\n            // without this, caret will be placed inside formatting span wrapper\n            this.quill.setSelection(index + 2, 0, \"user\");\n            CaretAction.sendCaretBack(1); // Move cursor back by 1 character\n          }\n        }\n      };\n      this.quill.keyboard.bindings.ArrowRight.unshift(arrowRightFixRule);\n      if (this.options.debug)\n        console.debug('BlotFormatter added ArrowRightFix keyboard binding', arrowRightFixRule);\n    }\n  }\n\n  /**\n   * Determines whether the resizing of the target element should use relative sizing (percentages)\n   * or absolute sizing (pixels), based on the current configuration and the element's width attribute.\n   *\n   * @param targetElement - The HTML element whose sizing mode is being determined.\n   * @returns `true` if relative sizing should be used, `false` otherwise.\n   *\n   * The method checks the `useRelativeSize` option and, if `allowResizeModeChange` is enabled,\n   * inspects the element's `width` attribute to decide whether to use relative or absolute sizing.\n   * If debugging is enabled, logs the decision to the console.\n   */\n  _useRelative = (targetElement: HTMLElement): boolean => {\n    let _useRelative: boolean = this.options.resize.useRelativeSize;\n    if (this.options.resize.allowResizeModeChange) {\n      // if no width set, use useRelativeSize by default else respect existing type\n      const width: string | null = targetElement.getAttribute('width');\n      if (!width) {\n        _useRelative = this.options.resize.useRelativeSize;\n      } else {\n        _useRelative = width.endsWith('%');\n      }\n    }\n    if (this.options.debug) {\n      console.debug('BlotFormatter _useRelative', _useRelative, 'for element', targetElement);\n    }\n    return _useRelative;\n  }\n\n  /**\n   * Determines the relative position of a pointer event with respect to the overlay element.\n   *\n   * @param event - The pointer event to evaluate.\n   * @returns The position of the pointer relative to the overlay, as a `PointerPosition` enum value.\n   *\n   * The possible return values are:\n   * - `PointerPosition.ABOVE` if the pointer is above the overlay.\n   * - `PointerPosition.BELOW` if the pointer is below the overlay.\n   * - `PointerPosition.LEFT` if the pointer is to the left of the overlay.\n   * - `PointerPosition.RIGHT` if the pointer is to the right of the overlay.\n   * - `PointerPosition.INSIDE` if the pointer is inside the overlay.\n   *\n   * If the `debug` option is enabled, logs the determined position and event to the console.\n   */\n  private _getClickPosition = (event: PointerEvent): PointerPosition => {\n    const target = this.overlay;\n    const rect = target.getBoundingClientRect();\n    let position: PointerPosition;\n    if (event.clientY < rect.top) {\n      position = PointerPosition.ABOVE;\n    } else if (event.clientY > rect.bottom) {\n      position = PointerPosition.BELOW;\n    } else if (event.clientX < rect.left) {\n      position = PointerPosition.LEFT;\n    } else if (event.clientX > rect.right) {\n      position = PointerPosition.RIGHT;\n    } else {\n      position = PointerPosition.INSIDE;\n    }\n    if (this.options.debug) {\n      console.debug('BlotFormatter _getClickPosition', position, 'for event', event);\n    }\n    return position;\n  }\n}\n"],"names":["Action","formatter","CaretAction","n","debug","selection","range","currentNode","currentOffset","prevNode","quill","targetBlot","index","documentLength","e","modalOpen","isMergeableObject","value","isNonNullObject","isSpecial","stringValue","isReactElement","canUseSymbol","REACT_ELEMENT_TYPE","emptyTarget","val","cloneUnlessOtherwiseSpecified","options","deepmerge","defaultArrayMerge","target","source","element","getMergeFunction","key","customMerge","getEnumerableOwnPropertySymbols","symbol","getKeys","propertyIsOnObject","object","property","propertyIsUnsafe","mergeObject","destination","sourceIsArray","targetIsArray","sourceAndTargetTypesMatch","array","prev","next","deepmerge_1","cjs","Toolbar","event","actionButtons","action","button","TooltipContainPosition","tooltip","container","tooltipRect","containerRect","left","top","width","height","maxWidth","maxHeight","changed","newStyles","isRepositioning","observer","mutations","m","tooltipElement","createAltTitleImageBlotClass","QuillConstructor","ImageBlot","ATTRIBUTES","domNode","formats","attribute","name","createIframeAlignAttributor","parchment","ClassAttributor","Scope","node","className","createImageAlignAttributor","imageElement","imageBlot","parentElement","align","title","createResponsiveVideoBlotClass","VideoEmbed","DefaultAligner","alignment","blot","k","existingAlignment","hasAlignment","editorStyle","editorWidth","ops","ToolbarButton","onClickHandler","style","childElement","AlignAction","DeleteAction","targetElement","ResizeAction","passiveFalse","handleStyle","handle","position","cursor","box","handleXOffset","handleYOffset","topLeftStyle","topRightStyle","bottomRightStyle","bottomLeftStyle","error","activate","rect","ratio","deltaX","isLeftHandle","newWidth","constrainedWidth","scale","newHeight","show","roundedWidth","roundedHeight","size","setWidth","setWidthNum","aspectRatio","calculatedHeight","naturalWidth","naturalHeight","showInfo","touch1","touch2","dx","dy","dim","_","prefix","num","suffix","BlotSpec","actions","PROXY_IMAGE_CLASS","UnclickableBlotSpec","resizeTimeout","entries","entry","unclickable","proxyImage","id","canvas","context","mergedStyle","containerScrollLeft","containerScrollTop","unclickableRect","msg","proxyContainer","IframeVideoSpec","AttributeAction","alt","imageAlignment","uuid","modal","modalContainer","form","labelAlt","textareaAlt","labelTitle","textareaTitle","buttonDiv","submitButton","cancelButton","CompressAction","isEligible","mimeType","isEligibleForCompression","img","parsedWidth","parsedHeight","dataUrl","base64Data","details","newImg","resizedDataUrl","originalSize","resizedSize","sizeDiff","modalBackground","modalDefaultPrompt","modalMoreInfo","modalButtonContainer","moreInfoButton","continueButton","LinkAction","dialog","label","input","okButton","removeButton","background","overlayRect","quillRect","offsetParentRect","dialogWidth","dialogHeight","minLeft","maxLeft","minTop","maxTop","url","wrapperBlot","ImageSpec","el","closeButtonIcon","okButtonIcon","infoButtonIcon","DefaultOptions","dontMerge","BlotFormatter","ImageAlignClass","IframeAlignClass","SpecClass","spec","mutation","overlay","sizeInfo","toolbarElement","toolbarRect","offset","resolve","scrollingElement","ancestor","overflowY","elRect","lastScrollTop","checkInterval","signal","overlayTarget","specRect","prop","touch","deltaY","root","atTop","atBottom","atLeft","atRight","isScrollingVertically","isScrollingHorizontally","preventDefault","ImageAltTitleBlot","VideoResponsive","backspaceRule","arrowRightFixRule","_useRelative"],"mappings":"AAgCA,MAAqBA,EAAO;AAAA,EAC1B;AAAA,EACA,iBAAkC,CAAA;AAAA,EAClC;AAAA,EAEA,YAAYC,GAA0B;AACpC,SAAK,YAAYA,GACjB,KAAK,QAAQ,KAAK,UAAU,QAAQ,SAAS,IACzC,KAAK,SAAO,QAAQ,MAAM,mBAAmB,KAAK,YAAY,IAAI;AAAA,EACxE;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,WAAW,MAAY;AAAA,EAAC;AAAA;AAAA;AAAA;AAAA;AAAA,EAMxB,YAAY,MAAY;AAAA,EAAC;AAAA;AAAA;AAAA;AAAA;AAAA,EAMzB,WAAW,MAAY;AAAA,EAAC;AAE1B;AC5CA,MAAqBC,UAAoBF,EAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAU9C,OAAO,gBAAgB,CAACG,IAAI,GAAGC,IAAQ,OAAgB;AACrD,UAAMC,IAAY,OAAO,aAAA;AACzB,QAAIA,KAAaA,EAAU,aAAa,GAAG;AACzC,YAAMC,IAAQD,EAAU,WAAW,CAAC,GAC9BE,IAAcD,EAAM,gBACpBE,IAAgBF,EAAM;AAG5B,UAAIE,IAAgB;AAClB,QAAAF,EAAM,SAASC,GAAaC,IAAgBL,CAAC;AAAA,eACpCI,EAAY,iBAAiB;AAEtC,cAAME,IAAWF,EAAY;AAC7B,QAAIE,EAAS,aAAa,KAAK,aAC7BH,EAAM,SAASG,GAAUA,EAAS,aAAa,UAAU,CAAC;AAAA,MAE9D;AAEA,MAAAH,EAAM,SAAS,EAAI,GACnBD,EAAU,gBAAA,GACVA,EAAU,SAASC,CAAK,GACpBF,KACF,QAAQ,MAAM,uBAAuBD,GAAG,YAAY;AAAA,IAExD;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQA,OAAO,uBAAuB,CAACO,GAAYC,GAAkBP,IAAQ,OAAgB;AACnF,UAAMQ,IAAQF,EAAM,SAASC,CAAU;AACvC,IAAAD,EAAM,aAAaE,GAAO,GAAG,MAAM,GAC/BR,KACF,QAAQ,MAAM,sCAAsCQ,GAAOD,CAAU;AAAA,EAEzE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAcA,OAAO,sBAAsB,CAACD,GAAYC,GAAkBP,IAAQ,OAAgB;AAClF,IAAAM,EAAM,aAAa,IAAI,GACvBA,EAAM,KAAK,MAAA;AACX,UAAME,IAAQF,EAAM,SAASC,CAAU,GACjCE,IAAiBH,EAAM,UAAA;AAG7B,IAAIE,IAAQ,KAAKC,IAAiB,KAEhCH,EAAM,aAAaG,IAAiB,GAAG,GAAG,MAAM,GAC5CT,KACF,QAAQ,MAAM,uDAAuDO,CAAU,MAK7EP,KACF,QAAQ,MAAM,yDAAyDQ,GAAOD,CAAU,GAE1FD,EAAM,aAAaE,IAAQ,GAAG,GAAG,MAAM,GACvC,KAAK,cAAc,GAAGR,CAAK;AAAA,EAE/B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAYA,WAAW,MAAY;AACrB,aAAS,iBAAiB,SAAS,KAAK,OAAO,GAC/C,KAAK,UAAU,MAAM,KAAK,iBAAiB,SAAS,KAAK,OAAO;AAAA,EAClE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASA,YAAY,MAAY;AACtB,aAAS,oBAAoB,SAAS,KAAK,OAAO,GAClD,KAAK,UAAU,MAAM,KAAK,oBAAoB,SAAS,KAAK,OAAO;AAAA,EACrE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAWA,UAAU,CAACU,MAAqB;AAC9B,UAAMC,IAAqB,CAAC,CAAC,SAAS,cAAc,6BAA6B;AACjF,QAAI,CAAC,KAAK,UAAU,eAAeA;AACjC;AAEF,UAAMJ,IAAa,KAAK,UAAU,YAAY,cAAA;AAC9C,IAAKA,MAMDG,EAAE,SAAS,eACbZ,EAAY,qBAAqB,KAAK,UAAU,OAAOS,GAAY,KAAK,KAAK,GAC7E,KAAK,UAAU,KAAA,KACNG,EAAE,SAAS,iBACpBZ,EAAY,oBAAoB,KAAK,UAAU,OAAOS,GAAY,KAAK,KAAK,GAC5E,KAAK,UAAU,KAAA;AAAA,EAEnB;AACF;;;;;;;;AC9JA,MAAIK,IAAoB,SAA2BC,GAAO;AACzD,WAAOC,EAAgBD,CAAK,KACxB,CAACE,EAAUF,CAAK;AAAA,EACrB;AAEA,WAASC,EAAgBD,GAAO;AAC/B,WAAO,CAAC,CAACA,KAAS,OAAOA,KAAU;AAAA,EACpC;AAEA,WAASE,EAAUF,GAAO;AACzB,QAAIG,IAAc,OAAO,UAAU,SAAS,KAAKH,CAAK;AAEtD,WAAOG,MAAgB,qBACnBA,MAAgB,mBAChBC,EAAeJ,CAAK;AAAA,EACzB;AAGA,MAAIK,IAAe,OAAO,UAAW,cAAc,OAAO,KACtDC,IAAqBD,IAAe,OAAO,IAAI,eAAe,IAAI;AAEtE,WAASD,EAAeJ,GAAO;AAC9B,WAAOA,EAAM,aAAaM;AAAA,EAC3B;AAEA,WAASC,EAAYC,GAAK;AACzB,WAAO,MAAM,QAAQA,CAAG,IAAI,CAAA,IAAK,CAAA;AAAA,EAClC;AAEA,WAASC,EAA8BT,GAAOU,GAAS;AACtD,WAAQA,EAAQ,UAAU,MAASA,EAAQ,kBAAkBV,CAAK,IAC/DW,EAAUJ,EAAYP,CAAK,GAAGA,GAAOU,CAAO,IAC5CV;AAAA,EACJ;AAEA,WAASY,EAAkBC,GAAQC,GAAQJ,GAAS;AACnD,WAAOG,EAAO,OAAOC,CAAM,EAAE,IAAI,SAASC,GAAS;AAClD,aAAON,EAA8BM,GAASL,CAAO;AAAA,IACvD,CAAE;AAAA,EACF;AAEA,WAASM,EAAiBC,GAAKP,GAAS;AACvC,QAAI,CAACA,EAAQ;AACZ,aAAOC;AAER,QAAIO,IAAcR,EAAQ,YAAYO,CAAG;AACzC,WAAO,OAAOC,KAAgB,aAAaA,IAAcP;AAAA,EAC1D;AAEA,WAASQ,EAAgCN,GAAQ;AAChD,WAAO,OAAO,wBACX,OAAO,sBAAsBA,CAAM,EAAE,OAAO,SAASO,GAAQ;AAC9D,aAAO,OAAO,qBAAqB,KAAKP,GAAQO,CAAM;AAAA,IACzD,CAAG,IACC,CAAA;AAAA,EACJ;AAEA,WAASC,EAAQR,GAAQ;AACxB,WAAO,OAAO,KAAKA,CAAM,EAAE,OAAOM,EAAgCN,CAAM,CAAC;AAAA,EAC1E;AAEA,WAASS,EAAmBC,GAAQC,GAAU;AAC7C,QAAI;AACH,aAAOA,KAAYD;AAAA,IACrB,QAAY;AACV,aAAO;AAAA,IACT;AAAA,EACA;AAGA,WAASE,EAAiBZ,GAAQI,GAAK;AACtC,WAAOK,EAAmBT,GAAQI,CAAG,KACjC,EAAE,OAAO,eAAe,KAAKJ,GAAQI,CAAG,KACvC,OAAO,qBAAqB,KAAKJ,GAAQI,CAAG;AAAA,EAClD;AAEA,WAASS,EAAYb,GAAQC,GAAQJ,GAAS;AAC7C,QAAIiB,IAAc,CAAA;AAClB,WAAIjB,EAAQ,kBAAkBG,CAAM,KACnCQ,EAAQR,CAAM,EAAE,QAAQ,SAASI,GAAK;AACrC,MAAAU,EAAYV,CAAG,IAAIR,EAA8BI,EAAOI,CAAG,GAAGP,CAAO;AAAA,IACxE,CAAG,GAEFW,EAAQP,CAAM,EAAE,QAAQ,SAASG,GAAK;AACrC,MAAIQ,EAAiBZ,GAAQI,CAAG,MAI5BK,EAAmBT,GAAQI,CAAG,KAAKP,EAAQ,kBAAkBI,EAAOG,CAAG,CAAC,IAC3EU,EAAYV,CAAG,IAAID,EAAiBC,GAAKP,CAAO,EAAEG,EAAOI,CAAG,GAAGH,EAAOG,CAAG,GAAGP,CAAO,IAEnFiB,EAAYV,CAAG,IAAIR,EAA8BK,EAAOG,CAAG,GAAGP,CAAO;AAAA,IAExE,CAAE,GACMiB;AAAA,EACR;AAEA,WAAShB,EAAUE,GAAQC,GAAQJ,GAAS;AAC3C,IAAAA,IAAUA,KAAW,CAAA,GACrBA,EAAQ,aAAaA,EAAQ,cAAcE,GAC3CF,EAAQ,oBAAoBA,EAAQ,qBAAqBX,GAGzDW,EAAQ,gCAAgCD;AAExC,QAAImB,IAAgB,MAAM,QAAQd,CAAM,GACpCe,IAAgB,MAAM,QAAQhB,CAAM,GACpCiB,IAA4BF,MAAkBC;AAElD,WAAKC,IAEMF,IACHlB,EAAQ,WAAWG,GAAQC,GAAQJ,CAAO,IAE1CgB,EAAYb,GAAQC,GAAQJ,CAAO,IAJnCD,EAA8BK,GAAQJ,CAAO;AAAA,EAMtD;AAEA,EAAAC,EAAU,MAAM,SAAsBoB,GAAOrB,GAAS;AACrD,QAAI,CAAC,MAAM,QAAQqB,CAAK;AACvB,YAAM,IAAI,MAAM,mCAAmC;AAGpD,WAAOA,EAAM,OAAO,SAASC,GAAMC,GAAM;AACxC,aAAOtB,EAAUqB,GAAMC,GAAMvB,CAAO;AAAA,IACtC,GAAI,CAAA,CAAE;AAAA,EACN;AAEA,MAAIwB,IAAcvB;AAElB,SAAAwB,IAAiBD;;;;AC7GjB,MAAqBE,EAAQ;AAAA,EACzB;AAAA,EACA;AAAA,EACA,UAAyC,CAAA;AAAA,EAEzC,YAAYpD,GAA0B;AAClC,SAAK,YAAYA,GACjB,KAAK,UAAU,SAAS,cAAc,KAAK,GAC3C,KAAK,QAAQ,UAAU,IAAI,KAAK,UAAU,QAAQ,QAAQ,aAAa,GACvE,KAAK,QAAQ,iBAAiB,aAAa,CAACqD,MAAsB;AAC9D,MAAAA,EAAM,gBAAA;AAAA,IACV,CAAC,GACG,KAAK,UAAU,QAAQ,QAAQ,aAC/B,OAAO,OAAO,KAAK,QAAQ,OAAO,KAAK,UAAU,QAAQ,QAAQ,SAAS;AAAA,EAElF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAUA,SAAS,MAAY;AACjB,UAAMC,IAA+B,CAAA;AACrC,SAAK,UAAU,QAAQ,QAAQ,CAAAC,MAAU;AACrC,MAAAA,EAAO,eAAe,QAAQ,CAAAC,MAAU;AACpC,aAAK,QAAQA,EAAO,MAAM,IAAIA,GAC9BF,EAAc,KAAKE,EAAO,QAAQ;AAAA,MACtC,CAAC;AAAA,IACL,CAAC,GACD,KAAK,QAAQ,OAAO,GAAGF,CAAa,GACpC,KAAK,UAAU,QAAQ,OAAO,KAAK,OAAO,GACtC,KAAK,UAAU,QAAQ,SACvB,QAAQ,MAAM,iCAAiC,OAAO,KAAK,KAAK,OAAO,GAAGA,CAAa;AAAA,EAE/F;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASA,UAAU,MAAY;AAClB,IAAI,KAAK,WACL,KAAK,UAAU,QAAQ,YAAY,KAAK,OAAO;AAEnD,eAAWE,KAAU,OAAO,OAAO,KAAK,OAAO;AAC3C,MAAAA,EAAO,QAAA;AAEX,SAAK,UAAU,CAAA,GACf,KAAK,QAAQ,YAAY,IACrB,KAAK,UAAU,QAAQ,SACvB,QAAQ,MAAM,mBAAmB;AAAA,EAEzC;AACJ;ACjFA,MAAqBC,EAAuB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAgK1C,YAA6BhD,GAA+BN,IAAQ,IAAO;AAA9C,SAAA,QAAAM,GAA+B,KAAA,QAAAN;AAC1D,UAAMuD,IAAUjD,EAAM,UAAU,cAAc,aAAa;AAC3D,YAAQ,MAAM,YAAYiD,CAAO,GAC7BA,KACFD,EAAuB,aAAahD,GAAON,CAAK,GAC5CA,KACF,QAAQ,MAAM,oCAAoCuD,CAAO,KAG3D,QAAQ,KAAK,4CAA4C;AAAA,EAE7D;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAjKA,OAAe,qBAAqB,CAACA,GAAyBC,GAAwBxD,IAAQ,OAAU;AACtG,UAAMyD,IAAcF,EAAQ,sBAAA,GACtBG,IAAgBF,EAAU,sBAAA;AAGhC,QAAIG,IAAOF,EAAY,OAAOC,EAAc,MACxCE,IAAMH,EAAY,MAAMC,EAAc;AAC1C,UAAMG,IAAQJ,EAAY,OACpBK,IAASL,EAAY,QACrBM,IAAWP,EAAU,aACrBQ,IAAYR,EAAU;AAE5B,QAAIS,IAAU;AACd,UAAMC,IAA6C,CAAA;AAGnD,IAAIN,IAAM,MACRM,EAAU,MAAM,GAAGT,EAAY,MAAM,MACrCQ,IAAU,KAIRL,IAAME,IAASE,MACjBE,EAAU,MAAM,GAAGF,IAAYF,CAAM,MACrCG,IAAU,KAIRN,IAAO,MACTO,EAAU,OAAO,OACjBD,IAAU,KAIRN,IAAOE,IAAQE,MACjBG,EAAU,OAAO,GAAGH,IAAWF,CAAK,MACpCI,IAAU,KAGRA,KACEjE,KACF,QAAQ,MAAM,yBAAyBkE,CAAS,GAI9CA,EAAU,QAAQ,WACpBX,EAAQ,MAAM,MAAMW,EAAU,MAE5BA,EAAU,SAAS,WACrBX,EAAQ,MAAM,OAAOW,EAAU,OAG7BX,EAAQ,UAAU,SAAS,SAAS,KACtCA,EAAQ,UAAU,OAAO,SAAS,KAGhCvD,KACF,QAAQ,MAAM,6CAA6C;AAAA,EAGjE;AAAA;AAAA,EAGA,OAAe,YAAY,oBAAI,QAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAa/B,OAAO,aAAaM,GAAcN,IAAQ,IAAa;AACrD,UAAMuD,IAAUjD,EAAM,UAAU,cAAc,aAAa,GACrDkD,IAAYlD,EAAM;AACxB,QAAI,CAACiD,GAAS;AACZ,cAAQ,KAAK,4CAA4C;AACzD;AAAA,IACF;AAEA,SAAK,qBAAqBA,GAASvD,CAAK;AAExC,QAAImE,IAAkB;AAEtB,UAAMC,IAAW,IAAI,iBAAiB,CAACC,MAAgC;AAErE,UAAI,CAAAF,GAEJ;AAAA,YAAInE;AACF,qBAAWsE,KAAKD;AACd,oBAAQ,MAAM,qBAAqBC,EAAE,eAAef,EAAQ,aAAae,EAAE,aAAc,CAAC;AAI9F,QAAAH,IAAkB,IAClB,KAAK,mBAAmBZ,GAASC,GAAWxD,CAAK,GAEjD,WAAW,MAAM;AACf,UAAAmE,IAAkB;AAAA,QACpB,GAAG,CAAC;AAAA;AAAA,IACN,CAAC;AAED,IAAAC,EAAS,QAAQb,GAAS;AAAA,MACxB,YAAY;AAAA,MACZ,iBAAiB,CAAC,SAAS,OAAO;AAAA,IAAA,CACnC,GAGD,KAAK,UAAU,IAAIA,GAASa,CAAQ;AAAA,EACtC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQA,OAAO,qBAAqBb,GAAiCvD,IAAQ,IAAa;AAChF,QAAIuE,IAAwC;AAE5C,IAAIhB,aAAmB,iBACrBgB,IAAiBhB,IAGjBgB,IAAiBhB,EAAQ,UAAU,cAAc,aAAa,GAG5DgB,KAAkB,KAAK,UAAU,IAAIA,CAAc,MACpC,KAAK,UAAU,IAAIA,CAAc,GACxC,WAAA,GACV,KAAK,UAAU,OAAOA,CAAc,GAChCvE,KACF,QAAQ,MAAM,gCAAgCuE,CAAc;AAAA,EAGlE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EA6BA,UAAU,MAAY;AAEpB,IADgB,KAAK,MAAM,UAAU,cAAc,aAAa,MAE9DjB,EAAuB,qBAAqB,KAAK,OAAO,KAAK,KAAK,GAC9D,KAAK,SACP,QAAQ,MAAM,oCAAoC;AAAA,EAGxD;AAEF;ACzKO,MAAMkB,IAA+B,CAACC,MAA+B;AACxE,QAAMC,IAAYD,EAAiB,OAAO,eAAe,GAEnDE,IAAa,CAAC,OAAO,UAAU,SAAS,OAAO;AAqBrD,SAAO,cAAoBD,EAAU;AAAA,IACjC,OAAO,WAAW;AAAA,IAClB,OAAO,QAAQE,GAAkB;AAC7B,aAAOD,EAAW;AAAA,QACd,CAACE,GAAwCC,OACjCF,EAAQ,aAAaE,CAAS,MAC9BD,EAAQC,CAAS,IAAIF,EAAQ,aAAaE,CAAS,IAEhDD;AAAA,QAEX,CAAA;AAAA,MAAC;AAAA,IAET;AAAA,IAEA,OAAOE,GAAclE,GAAe;AAChC,MAAI8D,EAAW,QAAQI,CAAI,IAAI,KACvBlE,KAASkE,MAAS,QAClB,KAAK,QAAQ,aAAaA,GAAMlE,CAAK,IAErC,KAAK,QAAQ,gBAAgBkE,CAAI,IAGrC,MAAM,OAAOA,GAAMlE,CAAK;AAAA,IAEhC;AAAA,EAAA;AAER,GChBamE,IAA8B,CAACP,MAA2C;AACrF,QAAMQ,IAAYR,EAAiB,OAAO,WAAW,GAC/C,EAAE,iBAAAS,GAAiB,OAAAC,EAAA,IAAUF;AAEnC,SAAO,cAAoCC,EAAgB;AAAA,IAGzD,YAAoBlF,IAAQ,IAAO;AACjC,YAAM,eAAe,mBAAmB;AAAA,QACtC,OAAOmF,EAAM;AAAA,QACb,WAAW,CAAC,QAAQ,UAAU,OAAO;AAAA,MAAA,CACtC,GAJiB,KAAA,QAAAnF;AAAA,IAKpB;AAAA,IAPA,OAAO,WAAW;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAwBlB,IAAIoF,GAAevE,GAAkC;AAInD,UAHI,KAAK,SACP,QAAQ,MAAM,6BAA6BuE,GAAMvE,CAAK,GAEpDuE,aAAgB,aAAa;AAC/B,QAAI,OAAOvE,KAAU,YACnB,MAAM,IAAIuE,GAAMvE,EAAM,KAAK,GAC3BuE,EAAK,QAAQ,YAAYvE,EAAM,UAE/B,MAAM,IAAIuE,GAAMvE,CAAK,GACrBuE,EAAK,QAAQ,YAAYvE;AAE3B,YAAIgD,IAAuBuB,EAAK,aAAa,OAAO;AACpD,eAAIvB,KAEG,MAAM,OAAOA,EAAM,KAAA,EAAO,MAAM,EAAE,CAAC,CAAC,MACvCA,IAAQ,GAAGA,CAAK,OAElBuB,EAAK,MAAM,YAAY,kBAAkBvB,CAAK,GAC9CuB,EAAK,QAAQ,eAAe,GAAGvB,EAAM,SAAS,GAAG,CAAC,OAElDuB,EAAK,MAAM,eAAe,gBAAgB,GAC1CA,EAAK,QAAQ,eAAe,UAE1B,KAAK,SACP,QAAQ,MAAM,qCAAqCA,GAAM,iBAAiBvE,CAAK,GAE1E;AAAA,MACT;AACE,eAAI,KAAK,SACP,QAAQ,MAAM,4EAA4E,GAErF;AAAA,IAEX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAWA,OAAOuE,GAAqB;AAC1B,MAAI,KAAK,SACP,QAAQ,MAAM,gCAAgCA,CAAI,GAEhDA,aAAgB,gBAClB,MAAM,OAAOA,CAAI,GACjB,OAAOA,EAAK,QAAQ;AAAA,IAExB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAYA,MAAMA,GAAiC;AACrC,YAAMC,IAAY,MAAM,MAAMD,CAAI,GAC5BvB,IAASuB,aAAgB,gBAC7BA,EAAK,MAAM,iBAAiB,gBAAgB,KAAKA,EAAK,aAAa,OAAO,MAAK,IAE3EvE,IAAQ;AAAA,QACZ,OAAOwE;AAAA,QACP,OAAAxB;AAAA,QACA,cAAc,GAAGA,EAAM,SAAS,GAAG,CAAC;AAAA,MAAA;AAEtC,aAAI,KAAK,SACP,QAAQ,MAAM,+BAA+BuB,GAAMvE,CAAK,GAEnDA;AAAA,IACT;AAAA,EAAA;AAGJ,GA2BayE,IAA6B,CAACb,MAA2C;AACpF,QAAMQ,IAAYR,EAAiB,OAAO,WAAW,GAC/C,EAAE,iBAAAS,GAAiB,OAAAC,EAAA,IAAUF;AAEnC,SAAO,cAAmCC,EAAgB;AAAA,IAIxD,YAAoBlF,IAAQ,IAAO;AACjC,YAAM,cAAc,kBAAkB;AAAA,QACpC,OAAOmF,EAAM;AAAA,QACb,WAAW,CAAC,QAAQ,UAAU,OAAO;AAAA,MAAA,CACtC,GAJiB,KAAA,QAAAnF;AAAA,IAKpB;AAAA,IARA,OAAO,UAAU;AAAA,IACjB,OAAO,WAAW;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAwBlB,IAAIoF,GAAevE,GAA+C;AAIhE,UAHI,KAAK,SACP,QAAQ,MAAM,4BAA4BuE,GAAMvE,CAAK,GAEnDuE,aAAgB,mBAAmBvE,GAAO;AAC5C,YAAI0E,IAAeH,EAAK,cAAc,KAAK;AAC3C,YAAI,OAAOvE,KAAU,YAAYA,EAAM;AACrC,gBAAM,IAAIuE,GAAMvE,EAAM,KAAK,GAC3BuE,EAAK,aAAa,mBAAmB,OAAO,GAEtCvE,EAAM,QACVuE,EAAK,aAAa,cAAcvE,EAAM,KAAK,IAE3CuE,EAAK,gBAAgB,YAAY,GAE/BvE,EAAM,UACR0E,EAAa,QAAQ,YAAY1E,EAAM,QAErC,KAAK,SACP,QAAQ,MAAM,4CAA4C0E,GAAc,iBAAiB1E,EAAM,KAAK;AAAA,iBAE7F,OAAOA,KAAU;AAC1B,gBAAM,IAAIuE,GAAMvE,CAAK,GACrB0E,EAAa,QAAQ,YAAY1E,GAC7B,KAAK,SACP,QAAQ,MAAM,4CAA4C0E,GAAc,iBAAiB1E,CAAK;AAAA;AAGhG,iBAAI,KAAK,SACP,QAAQ,MAAM,kEAAkE,GAE3E;AAMT,YAAIgD,IAAuB,KAAK,cAAc0B,CAAY;AAC1D,eAAAH,EAAK,aAAa,sBAAsB,GAAGvB,GAAO,SAAS,GAAG,CAAC,EAAE,GAC1D;AAAA,MACT,OAAO;AAIL,cAAM0B,IAAeH,aAAgB,mBAAmBA,IAAOA,EAAK,cAAc,KAAK;AAGvF,YAFI,KAAK,SACP,QAAQ,MAAM,8BAA8BA,EAAK,OAAO,uCAAuCG,CAAY,GACzGA,aAAwB,kBAAkB;AAG5C,gBAAMC,IAAYf,EAAiB,KAAKc,CAAY;AACpD,iBAAI,KAAK,SACP,QAAQ,MAAM,gDAAgDC,CAAS,GAGvEA,MAEEJ,EAAK,sBAAsB,mBAC3B,CAAEG,EAAa,eAAe,QAAQ,gCAAgC,OAGxEC,EAAU,OAAO,cAAc3E,CAAK,GAChC,KAAK,SACP,QAAQ,MAAM,0EAA0EA,GAAO2E,CAAS,IAGrG;AAAA,QACT;AACA,eAAO;AAAA,MACT;AAAA,IACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAWA,OAAOJ,GAAqB;AAC1B,MAAI,KAAK,SACP,QAAQ,MAAM,+BAA+BA,CAAI,GAE/CA,aAAgB,gBAClB,MAAM,OAAOA,CAAI,GACbA,EAAK,cAAeA,EAAK,sBAAsB,eACjD,OAAOA,EAAK,WAAW,QAAQ;AAAA,IAGrC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAcA,MAAMA,GAAgC;AAEpC,YAAMG,IAAeH,EAAK,cAAc,KAAK;AAC7C,UAAI,CAACG,EAAc,QAAO;AAC1B,YAAME,IAAgBF,EAAa,eAC7BG,IAAQ,MAAM,MAAMD,CAAa,GACjCE,IAAgBJ,EAAa,aAAa,OAAO,KAAK;AAC5D,UAAI1B,IAAgB0B,EAAa,aAAa,OAAO,KAAK;AAE1D,MAAK,WAAW1B,CAAK,MACf0B,EAAa,WACf1B,IAAQ,KAAK,cAAc0B,CAAY,IAEvCA,EAAa,SAAS,CAACrC,MAAU;AAC/B,QAAAW,IAAQ,KAAK,cAAcX,EAAM,MAA0B;AAAA,MAC7D;AAGJ,YAAMrC,IAAQ;AAAA,QACZ,OAAA6E;AAAA,QACA,OAAAC;AAAA,QACA,OAAA9B;AAAA,QACA,iBAAiB;AAAA,QACjB,cAAc,GAAGA,EAAM,SAAS,GAAG,CAAC;AAAA,MAAA;AAEtC,aAAI,KAAK,SACP,QAAQ,MAAM,8BAA8BuB,GAAMvE,CAAK,GAElDA;AAAA,IACT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAYA,cAAc0E,GAAgC;AAC5C,UAAI1B,IAAQ0B,EAAa,aAAa,OAAO;AAC7C,aAAK1B,IAIE,MAAM,OAAOA,EAAM,KAAA,EAAO,MAAM,EAAE,CAAC,CAAC,MACvCA,IAAQ,GAAGA,CAAK,MAChB0B,EAAa,aAAa,SAAS1B,CAAK,MAL1CA,IAAQ,GAAG0B,EAAa,YAAY,MACpCA,EAAa,aAAa,SAAS1B,CAAK,IAOzC0B,EAAa,cAA8B,MAAM,YAAY,kBAAkB1B,CAAK,GAC9EA;AAAA,IACT;AAAA,EAAA;AAGJ,GCjXa+B,IAAiC,CAACnB,MAA+B;AAC1E,QAAMoB,IAAapB,EAAiB,OAAO,eAAe;AAgB1D,SAAO,cAA8BoB,EAAW;AAAA,IAC5C,OAAO,WAAW;AAAA,IAClB,OAAO,cAAsB;AAAA,IAC7B,OAAO,OAAOhF,GAAe;AACzB,YAAMuE,IAAO,MAAM,OAAOvE,CAAK;AAC/B,aAAAuE,EAAK,aAAa,SAAS,MAAM,GACjCA,EAAK,MAAM,cAAc,KAAK,aACvBA;AAAA,IACX;AAAA,IACA,OAAO;AACH,aAAO,KAAK,QAAQ;AAAA,IACxB;AAAA,EAAA;AAER;ACTA,MAAqBU,EAAkC;AAAA,EACrD,aAAwC,CAAA;AAAA,EACxC;AAAA,EACA;AAAA,EACQ;AAAA,EACA;AAAA,EAER,YAAYjG,GAA0B;AACpC,SAAK,YAAYA,GACjB,KAAK,QAAQA,EAAU,QAAQ,SAAS;AACxC,UAAMoF,IAAYpF,EAAU,MAAM,OAAO,WAAW;AACpD,SAAK,QAAQoF,EAAU,OACvB,KAAK,UAAUpF,EAAU,SACzB,KAAK,QAAQ,MAAM,WAAW,QAAQ,CAAAkG,MAAa;AACjD,WAAK,WAAWA,CAAS,IAAI;AAAA,QAC3B,MAAMA;AAAA,QACN,OAAO,CAACC,MAAsB;AAC5B,eAAK,aAAaA,GAAMD,CAAS;AAAA,QACnC;AAAA,MAAA;AAAA,IAEJ,CAAC,GACG,KAAK,SACP,QAAQ,MAAM,2CAA2C,KAAK,UAAU;AAAA,EAE5E;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,gBAAgB,MACP,OAAO,KAAK,KAAK,UAAU,EAAE,IAAI,CAAAE,MAAK,KAAK,WAAWA,CAAC,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAWjE,QAAQ,CAACD,MAA4B;AACnC,IAAIA,KAAQ,SACNA,EAAK,QAAQ,YAAY,QACvBA,EAAK,WAAW,QAAQA,EAAK,OAAO,QAAQ,YAAY,WAC1DA,EAAK,OAAO,OAAO,KAAK,UAAU,WAAW,UAAU,EAAK,GACxD,KAAK,SACP,QAAQ,MAAM,6CAA6CA,EAAK,MAAM,KAGjEA,EAAK,QAAQ,YAAY,aAClCA,EAAK,OAAO,KAAK,UAAU,YAAY,UAAU,EAAK,GAClD,KAAK,SACP,QAAQ,MAAM,6BAA6BA,CAAI;AAAA,EAIvD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAUA,eAAe,CAACA,OACNA,EAAK,SAAS,QAAQ,KAAK,MAAM,YAAY,KAAK,MAAM;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAYlE,cAAc,CAACA,OACLA,EAAK,SAAS,QAAQ,KAAK,MAAM,WAAW,KAAK,MAAM;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASjE,iBAAiB,CAACA,OACRA,EAAK,QAAQ,QAAQ,KAAK,MAAM,YAAY,KAAK,MAAM;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASjE,gBAAgB,CAACA,OACPA,EAAK,QAAQ,QAAQ,KAAK,MAAM,WAAW,KAAK,MAAM;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAahE,YAAY,CAACA,GAAYD,MAAyC;AAEhE,UAAMG,IAAoB,KAAK,aAAaF,CAAI;AAChD,WAAID,IACKG,MAAsBH,EAAU,OAE/B,CAAC,CAACG;AAAA,EAEd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQA,eAAe,CAACF,MACPA,EAAK,QAAQ,QAAQ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAiB9B,eAAe,CAACA,GAAmBD,MAA4B;AAC7D,QAAIC,MAAS,MAAM;AACjB,MAAI,KAAK,SAAO,QAAQ,MAAM,oEAAoE;AAClG;AAAA,IACF;AACA,UAAMG,IAAe,KAAK,UAAUH,GAAM,KAAK,WAAWD,CAAS,CAAC;AAGpE,QAFI,KAAK,SAAO,QAAQ,MAAM,gBAAgBI,CAAY,GAC1D,KAAK,MAAMH,CAAI,GACX,CAACG;AACH,UAAI,KAAK,aAAaH,CAAI,KAAK,KAAK,eAAeA,CAAI,GAAG;AAGxD,YAFI,KAAK,SAAO,QAAQ,MAAM,qBAAsB,KAAK,aAAaA,CAAI,KAAK,KAAK,eAAeA,CAAI,CAAE,GAGvG,CAACA,EAAK,QAAQ,aAAa,OAAO,KAClC,KAAK,QAAQ,OAAO,mBACpB,CAAC,KAAK,QAAQ,OAAO;AAErB,cAAI;AACF,kBAAMI,IAAc,iBAAiB,KAAK,UAAU,MAAM,IAAI,GACxDC,IAAc,KAAK,UAAU,MAAM,KAAK,cAC5C,WAAWD,EAAY,WAAW,IAClC,WAAWA,EAAY,YAAY;AACrC,YAAAJ,EAAK,QAAQ;AAAA,cACX;AAAA,cACA,GAAG,KAAK,IAAI,KAAK,MAAM,MAAOA,EAAK,QAA6B,eAAeK,CAAW,GAAG,GAAG,CAAC;AAAA,YAAA;AAAA,UAErG,QAAQ;AACN,YAAI,KAAK,SAAO,QAAQ,MAAM,0DAA0DL,CAAI;AAAA,UAC9F;AAEF,QAAI,KAAK,SAAO,QAAQ;AAAA,UACtB;AAAA,UACA,KAAK,UAAU,WAAW;AAAA,UAC1B;AAAA,YACE,OAAO,KAAK,WAAWD,CAAS,EAAE;AAAA,YAClC,OAAOC,EAAK,QAAQ,aAAa,OAAO,KAAK;AAAA,UAAA;AAAA,QAC/C,GAEFA,EAAK;AAAA,UACH,KAAK,UAAU,WAAW;AAAA,UAC1B;AAAA,YACE,OAAO,KAAK,WAAWD,CAAS,EAAE;AAAA,YAClC,OAAOC,EAAK,QAAQ,aAAa,OAAO,KAAK;AAAA,UAAA;AAAA,QAC/C;AAGF,YAAI;AACF,gBAAMM,IAAW,KAAK,UAAU,MAAM,cAAc;AACpD,UAAIA,EAAI,WAAW,KAAKA,EAAI,CAAC,EAAE,WAAW;AAAA,KACxC,KAAK,UAAU,MAAM,WAAW,KAAK,UAAU,MAAM,UAAA,GAAa;AAAA,GAAM,MAAM;AAAA,QAElF,QAAQ;AAAA,QAAE;AAAA,MACZ,MAAA,EAAW,KAAK,YAAYN,CAAI,KAAK,KAAK,cAAcA,CAAI,OACtD,KAAK,SAAO,QAAQ;AAAA,QACtB;AAAA,QACA,KAAK,UAAU,YAAY;AAAA,QAC3B;AAAA,UACE,OAAO,KAAK,WAAWD,CAAS,EAAE;AAAA,QAAA;AAAA,MACpC,GAEFC,EAAK;AAAA,QACH,KAAK,UAAU,YAAY;AAAA,QAC3B,KAAK,WAAWD,CAAS,EAAE;AAAA,MAAA;AAAA,EAInC;AACF;ACtNA,MAAqBQ,EAAwC;AAAA,EACzD;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA,UAA8B;AAAA,EAC9B,oBAA6B;AAAA;AAAA,EAE7B,YACInD,GACAoD,GACAjF,GACF;AACE,SAAK,SAAS6B,GACd,KAAK,OAAO7B,EAAQ,MAAM6B,CAAoC,GAC9D,KAAK,UAAUoD,GACf,KAAK,UAAUjF;AAAA,EACnB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAYA,SAAS,OACL,KAAK,UAAU,SAAS,cAAc,MAAM,GAC5C,KAAK,QAAQ,YAAY,KAAK,MAC9B,KAAK,QAAQ,YAAY,KAAK,QAAQ,iBACtC,KAAK,QAAQ,QAAQ,SAAS,KAAK,QACnC,KAAK,QAAQ,UAAU,KAAK,SACxB,KAAK,QAAQ,YAAY,KAAK,QAAQ,SAAS,KAAK,MAAM,MAC1D,KAAK,QAAQ,QAAQ,KAAK,QAAQ,SAAS,KAAK,MAAM,IAE1D,KAAK,WAAW,KAAK,UAAA,GACrB,KAAK,UAAU,KAAK,mBACpB,KAAK,aAAA,GACE,KAAK;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAShB,UAAU,MAAY;AAClB,IAAI,KAAK,YACL,KAAK,QAAQ,UAAU,MACvB,KAAK,QAAQ,OAAA,GACb,KAAK,UAAU;AAAA,EAEvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQA,YAAY,MAID;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQX,IAAI,WAAoB;AACpB,WAAO,KAAK,SAAS,QAAQ,aAAa;AAAA,EAC9C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAWA,IAAI,SAASV,GAAgB;AACzB,IAAI,KAAK,YACL,KAAK,QAAQ,QAAQ,WAAWA,EAAM,SAAA,GAElCA,KACA,KAAK,QAAQ,UAAU,IAAI,KAAK,QAAQ,uBAAuB,GAC3D,KAAK,QAAQ,uBACb,OAAO,OAAO,KAAK,QAAQ,OAAO,KAAK,QAAQ,mBAAmB,MAGtE,KAAK,QAAQ,UAAU,OAAO,KAAK,QAAQ,uBAAuB,GAC9D,KAAK,QAAQ,wBACb,KAAK,QAAQ,gBAAgB,OAAO,GAChC,KAAK,QAAQ,eACb,OAAO,OAAO,KAAK,QAAQ,OAAO,KAAK,QAAQ,WAAW;AAAA,EAI9E;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,IAAI,UAAmB;AACnB,WAAO,KAAK,SAAS,MAAM,YAAY;AAAA,EAC3C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAUA,IAAI,QAAQ4F,GAAyB;AACjC,IAAI,KAAK,YACD,OAAOA,KAAU,cACjBA,IAAQA,IAAQ,iBAAiB,SAErC,KAAK,QAAQ,MAAM,UAAUA;AAAA,EAErC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAUQ,eAAe,MAAY;AAC/B,QAAI,KAAK,YACD,KAAK,QAAQ,eACb,OAAO,OAAO,KAAK,QAAQ,OAAO,KAAK,QAAQ,WAAW,GAE1D,KAAK,QAAQ,WAAU;AACvB,YAAMC,IAAe,KAAK,QAAQ,SAAS,CAAC;AAC5C,MAAIA,KACA,OAAO,OAAOA,EAAa,OAAO,KAAK,QAAQ,QAAQ;AAAA,IAE/D;AAAA,EAER;AAEJ;AC1KA,MAAqBC,UAAoB/G,EAAO;AAAA,EAC9C;AAAA,EACA,eAA8C,CAAA;AAAA,EAE9C,YAAYC,GAA0B;AACpC,UAAMA,CAAS,GACf,KAAK,UAAU,IAAIiG,EAAejG,CAAS,GACvCA,EAAU,QAAQ,iBAAe,MAAM,gCAAgC,KAAK,OAAO;AAAA,EACzF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAYQ,0BAA0B,MAAY;AAC5C,eAAWkG,KAAa,OAAO,OAAO,KAAK,QAAQ,UAAU;AAC3D,WAAK,aAAaA,EAAU,IAAI,IAAI,IAAIQ;AAAA,QACtCR,EAAU;AAAA,QACV,KAAK;AAAA,QACL,KAAK,UAAU,QAAQ;AAAA,MAAA;AAG3B,UAAMxF,IAAa,KAAK,UAAU,aAAa,cAAA;AAC/C,QAAIA,GAAY;AACd,YAAMwF,IAAgC,KAAK,QAAQ,aAAaxF,CAAU;AAC1E,MAAIwF,KAAa,KAAK,aAAaA,CAAS,MAC1C,KAAK,aAAaA,CAAS,EAAE,YAAY,MAAe,KAEtD,KAAK,UACP,QAAQ,MAAM,0CAA0C,KAAK,YAAY,GACzE,QAAQ,MAAM,2BAA2BA,CAAS;AAAA,IAEtD;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAUQ,gBAAgB,MAAY;AAClC,eAAW1C,KAAU,OAAO,OAAO,KAAK,YAAY;AAClD,MAAAA,EAAO,WAAW;AAEpB,IAAI,KAAK,SAAO,QAAQ,MAAM,uCAAuC;AAAA,EACvE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAYA,iBAAgC,CAACH,MAAuB;AACtD,UAAMG,IAA8BH,EAAM,OACvC,QAAQ,QAAQ,KAAK,UAAU,QAAQ,QAAQ,eAAe,EAAE;AACnE,QAAMG,GAAQ;AACZ,YAAMD,IAAgBC,EAAO,QAAQ,UAAU,IACzC9C,IAAa,KAAK,UAAU,aAAa,cAAA;AAC/C,UAAM6C,KAAY7C,GAAY;AAC5B,cAAMwF,IAAuB,KAAK,QAAQ,WAAW3C,CAAM;AAC3D,aAAK,cAAA,GACD,KAAK,QAAQ,UAAU7C,GAAYwF,CAAS,KAC9C,KAAK,QAAQ,MAAMxF,CAAU,GACzB,KAAK,SACP,QAAQ,MAAM,gCAAgC6C,GAAQ7C,CAAU,MAGlE,KAAK,QAAQ,aAAaA,GAAY6C,CAAM,GAC5C,KAAK,aAAaA,CAAM,EAAE,WAAW,IACjC,KAAK,SACP,QAAQ,MAAM,8BAA8BA,GAAQ7C,CAAU;AAAA,MAGpE;AAAA,IACF;AACA,SAAK,UAAU,OAAA;AAAA,EACjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQA,WAAW,MAAY;AACrB,SAAK,wBAAA,GACL,KAAK,iBAAiB,OAAO,OAAO,KAAK,YAAY,GACjD,KAAK,UAAU,QAAQ,iBAAe,MAAM,0CAA0C,KAAK,cAAc;AAAA,EAC/G;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAUA,YAAY,MAAY;AACtB,SAAK,eAAe,CAAA,GACpB,KAAK,iBAAiB,CAAA,GAClB,KAAK,UAAU,QAAQ,SAAO,QAAQ,MAAM,yCAAyC;AAAA,EAC3F;AACF;AC1HA,MAAqBqG,UAAqBhH,EAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAU/C,WAAW,MAAY;AACrB,aAAS,iBAAiB,SAAS,KAAK,QAAQ,GAChD,KAAK,UAAU,MAAM,KAAK,iBAAiB,SAAS,KAAK,QAAQ;AAAA,EACnE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASA,YAAY,MAAY;AACtB,aAAS,oBAAoB,SAAS,KAAK,QAAQ,GACnD,KAAK,UAAU,MAAM,KAAK,oBAAoB,SAAS,KAAK,QAAQ;AAAA,EACtE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAWQ,WAAW,CAACc,MAA2B;AAC7C,UAAMC,IAAqB,CAAC,CAAC,SAAS,cAAc,6BAA6B;AACjF,QAAI,GAAC,KAAK,UAAU,eAAeA,OAI/BD,EAAE,SAAS,YAAYA,EAAE,SAAS,cAAa;AACjD,MAAI,KAAK,SACP,QAAQ,MAAM,gCAAgCA,EAAE,IAAI;AAGtD,YAAMmG,IAAgB,KAAK,UAAU,YAAY,iBAAA;AACjD,UAAIA,GAAe;AACjB,cAAMb,IAAO,KAAK,UAAU,MAAM,KAAKa,CAAa;AACpD,YAAIb,GAAM;AACR,gBAAMxF,IAAQ,KAAK,UAAU,MAAM,SAASwF,CAAI;AAChD,eAAK,UAAU,MAAM,WAAWxF,GAAO,GAAG,MAAM;AAAA,QAClD;AAAA,MACF;AACA,WAAK,UAAU,KAAA;AAAA,IACjB;AAAA,EACF;AACF;AC7CA,MAAqBsG,UAAqBlH,EAAO;AAAA,EACvC;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA,cAA8C;AAAA,EAC9C,cAAsB;AAAA,EACtB;AAAA,EACA,gBAAwB;AAAA,EACxB,sBAA8B;AAAA,EAC9B,yBAAiC;AAAA,EACjC,uBAA2C;AAAA,EAC3C;AAAA,EACA;AAAA,EACA,eAAuB;AAAA,EACvB;AAAA,EACA,oBAA0C;AAAA,EAC1C,iBAA0B;AAAA,EAC1B,cAAuB;AAAA,EACvB,kBAA0B;AAAA,EAC1B,mBAAyD;AAAA,EACzD,WAAoB;AAAA,EACpB,SAAkB;AAAA,EAClB,gBAAoC;AAAA,EAE5C,YAAYC,GAA0B;AACpC,UAAMA,CAAS,GACf,KAAK,iBAAiB,KAAK,cAAc,YAAY,aAAa,GAClE,KAAK,kBAAkB,KAAK,cAAc,aAAa,aAAa,GACpE,KAAK,qBAAqB,KAAK,cAAc,gBAAgB,aAAa,GAC1E,KAAK,oBAAoB,KAAK,cAAc,eAAe,aAAa,GACxE,KAAK,mBAAmB,SAAS,cAAc,OAAO,GACtD,KAAK,mBAAmB,KAAK,UAAU,QAAQ,OAAO,iBAClDA,EAAU,QAAQ,OAAO,0BAC3B,KAAK,oBAAoB,KAAK,wBAAA,GAC9B,KAAK,iBAAiB;AAAA,MACpB,KAAK;AAAA,IAAA;AAAA,EAGX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAYA,WAAW,MAAY;AACrB,SAAK,UAAU,KAAK,UAAU,aAAa,iBAAA,GAC3C,KAAK,iBAAiB,KAAK,UAAU,aAAa,iBAAiB,IACnE,KAAK,WAAW,KAAK,mBAAmB,kBACpC,KAAK,aACP,KAAK,SAAS,KAAK,YAAA,IAGrB,KAAK,UAAU,QAAQ;AAAA,MACrB,KAAK;AAAA,MAAgB,KAAK;AAAA,MAC1B,KAAK;AAAA,MAAoB,KAAK;AAAA,IAAA,GAEhC,KAAK,UAAU,QAAQ,iBAAiB,aAAa,KAAK,mBAAmB,GAC7E,KAAK,UAAU,QAAQ,iBAAiB,WAAW,KAAK,iBAAiB;AAEzE,UAAMkH,IAAe,EAAE,SAAS,GAAA;AAChC,SAAK,UAAU,QAAQ,iBAAiB,cAAc,KAAK,sBAAsBA,CAAY,GAC7F,KAAK,UAAU,QAAQ,iBAAiB,aAAa,KAAK,qBAAqBA,CAAY,GAC3F,KAAK,UAAU,QAAQ,iBAAiB,YAAY,KAAK,oBAAoBA,CAAY;AAEzF,UAAMC,IAA2B,KAAK,UAAU,QAAQ,OAAO,eAAe,CAAA;AAC9E,SAAK,mBAAmBA,CAAW,GAC/B,KAAK,SACP,QAAQ,MAAM,qCAAqC,KAAK,SAAS,kBAAkB,KAAK,cAAc;AAAA,EAE1G;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAWA,YAAY,MAAY;AACtB,SAAK,UAAU,MACf,KAAK,iBAAiB,IACtB,KAAK,WAAW,IAChB,KAAK,gBAAgB,QACrB,KAAK,SAAS,IACd,KAAK,WAAW,EAAE,GAClB;AAAA,MACE,KAAK;AAAA,MAAgB,KAAK;AAAA,MAC1B,KAAK;AAAA,MAAoB,KAAK;AAAA,IAAA,EAC9B,QAAQ,CAAAC,MAAU;AAAE,MAAAA,EAAO,OAAA;AAAA,IAAU,CAAC,GACxC,KAAK,UAAU,QAAQ,oBAAoB,aAAa,KAAK,mBAAmB,GAChF,KAAK,UAAU,QAAQ,oBAAoB,WAAW,KAAK,iBAAiB;AAE5E,UAAMF,IAAe,EAAE,SAAS,GAAA;AAChC,SAAK,UAAU,QAAQ,oBAAoB,cAAc,KAAK,sBAAsBA,CAAY,GAChG,KAAK,UAAU,QAAQ,oBAAoB,aAAa,KAAK,qBAAqBA,CAAY,GAC9F,KAAK,UAAU,QAAQ,oBAAoB,YAAY,KAAK,oBAAoBA,CAAY,GAC5F,KAAK,UAAU,OAAA;AAAA,EACjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAYQ,gBAAgB,CAACG,GAAkBC,MAAgC;AAEzE,UAAMC,IAAM,SAAS,cAAc,KAAK;AACxC,WAAAA,EAAI,UAAU,IAAI,KAAK,UAAU,QAAQ,OAAO,eAAe,GAC/DA,EAAI,aAAa,iBAAiBF,CAAQ,GAC1CE,EAAI,MAAM,SAASD,GACf,KAAK,UAAU,QAAQ,OAAO,eAChC,OAAO,OAAOC,EAAI,OAAO,KAAK,UAAU,QAAQ,OAAO,WAAW,GAEpEA,EAAI,iBAAiB,eAAe,KAAK,oBAAoB,GACtDA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAaQ,qBAAqB,CAACJ,MAAoC;AAEhE,UAAMK,IAAgBL,GAAa,QAAQ,GAAG,CAAC,WAAWA,EAAY,KAAK,IAAI,CAAC,OAAO,OACjFM,IAAgBN,GAAa,SAAS,GAAG,CAAC,WAAWA,EAAY,MAAM,IAAI,CAAC,OAAO,OAGnF,EAAE,OAAOO,EAAA,IAAiB,KAAK;AACrC,IAAAA,EAAa,OAAOF,GACpBE,EAAa,MAAMD;AAEnB,UAAM,EAAE,OAAOE,EAAA,IAAkB,KAAK;AACtC,IAAAA,EAAc,QAAQH,GACtBG,EAAc,MAAMF;AAEpB,UAAM,EAAE,OAAOG,EAAA,IAAqB,KAAK;AACzC,IAAAA,EAAiB,QAAQJ,GACzBI,EAAiB,SAASH;AAE1B,UAAM,EAAE,OAAOI,EAAA,IAAoB,KAAK;AACxC,IAAAA,EAAgB,OAAOL,GACvBK,EAAgB,SAASJ;AAAA,EAC3B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAWQ,aAAa,CAACzG,MAAwB;AAC5C,QAAI,CAAC,SAAS,MAAM;AAClB,cAAQ,KAAK,yDAAyD;AACtE;AAAA,IACF;AAEA,QAAI;AACF,MAAIA,KACF,KAAK,iBAAiB,YAAY,0BAA0BA,CAAK,kBAC5D,SAAS,KAAK,SAAS,KAAK,gBAAgB,KAC/C,SAAS,KAAK,YAAY,KAAK,gBAAgB,KAG7C,SAAS,KAAK,SAAS,KAAK,gBAAgB,KAC9C,SAAS,KAAK,YAAY,KAAK,gBAAgB;AAAA,IAGrD,SAAS8G,GAAO;AACd,cAAQ,MAAM,6CAA6CA,CAAK;AAAA,IAClE;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAYQ,cAAc,CAACC,MAA4B;AACjD,QAAIA;AAIF,UAFA,KAAK,cAAc,IACnB,KAAK,kBAAkB,IACjB,KAAK,SAAS;AAElB,aAAK,mBAAmB,KAAK,UAAU,aAAa,KAAK,OAAO,GAEhE,KAAK,eAAe,iBAAiB,KAAK,UAAU,MAAM,IAAI,GAC9D,KAAK,eAAe,KAAK,UAAU,MAAM,KAAK,cAC5C,WAAW,KAAK,aAAa,WAAW,IACxC,WAAW,KAAK,aAAa,YAAY;AAE3C,cAAMC,IAAO,KAAK,QAAQ,sBAAA;AAS1B,aAPIA,EAAK,WAAW,UAAaA,EAAK,WAAW,OAC/CA,EAAK,SAAS,KAAK,QAAQ,eAAe,IAE5C,KAAK,gBAAgBA,EAAK,OAC1B,KAAK,uBAAuB,iBAAiB,KAAK,OAAO,EAAE,eAAe,QAC1E,KAAK,yBAAyBA,EAAK,QAAQA,EAAK,QAE5C,KAAK;AACP,UAAI,KAAK,kBAEH,KAAK,yBAAyB,WAEhC,KAAK,QAAQ,MAAM,cAAc,KAAK,UAAU,QAAQ,MAAM,oBAC9D,QAAQ;AAAA,YACN;AAAA,gCACiC,KAAK,UAAU,QAAQ,MAAM,kBAAkB;AAAA,UAAA;AAAA,iBAKlF,KAAK,kBAAkB,KAAK,yBAAyB,QAAQ;AAE/D,gBAAMC,IAAQ,KAAK,qBAAqB,MAAM,oBAAoB;AAClE,cAAIA;AACF,gBAAI;AACF,mBAAK,yBAAyB,WAAWA,EAAM,CAAC,CAAC,IAAI,WAAWA,EAAM,CAAC,CAAC;AAAA,YAC1E,QAAQ;AAAA,YAAE;AAAA,QAEd;AAGF,QAAI,KAAK,YAAY,CAAC,KAAK,oBAAoB,CAAC,KAAK,UAAU,KAAK,UAAU,QAAQ,OAAO,4BAC3F,KAAK,gBAAiB,KAAK,QAA6B,eAG1D,KAAK,cAAc,IAAMD,EAAK,OAAOA,EAAK,MAAM,GAC5C,KAAK,SACP,QAAQ,MAAM,uCAAuC;AAAA,UACnD,QAAQ,KAAK;AAAA,UACb,iBAAiB,KAAK;AAAA,UACtB,aAAa,KAAK;AAAA,UAClB,cAAc,KAAK;AAAA,UACnB,aAAa,KAAK;AAAA,UAClB,qBAAqB,KAAK;AAAA,QAAA,CAC3B;AAAA,MAEL;AAAA,WACK;AACL,UAAI,KAAK,WAAW,KAAK,aAAa;AAEpC,YAAIhE,IAAgB,KAAK,gBAAgB,KAAK,eAAe;AAC7D,aAAK,QAAQ,aAAa,SAASA,CAAK,GAEpC,KAAK,UAAU,QAAQ,QAAQ,eACjC,KAAK,UAAU,QAAQ,QAAQ,WAAc,WAAW,KAAK,aAG3D,KAAK,kBACP,KAAK,QAAQ,MAAM,YAAY,kBAAkB,GAAGA,CAAK,EAAE,GAC3D,KAAK,QAAQ,QAAQ,eAAe,GAAG,KAAK,UAAU,MAElD,KAAK,aAAa,KAAK,QAAQ,kBACjC,KAAK,QAAQ,cAAc,MAAM,YAAY,kBAAkB,GAAGA,CAAK,EAAE,GACzE,KAAK,QAAQ,cAAc,QAAQ,eAAe,GAAG,KAAK,UAAU,KAGpE,KAAK,SACP,QAAQ,MAAM,yCAAyC;AAAA,UACrD,QAAQ,KAAK;AAAA,UACb,OAAAA;AAAA,UACA,YAAY,KAAK;AAAA,UACjB,WAAW,KAAK;AAAA,QAAA,CACjB;AAAA,MAEL;AAEA,WAAK,gBAAgB,QAErB,KAAK,UAAU,OAAA,GAEf,KAAK,cAAc,EAAK;AAAA,IAC1B;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAUQ,uBAAuB,CAACX,MAA8B;AAC5D,SAAK,YAAY,EAAI,GACjBA,EAAM,kBAAkB,eAAiB,KAAK,YAChD,KAAK,cAAcA,EAAM,QACzB,KAAK,WAAW,KAAK,YAAY,MAAM,MAAM,GAC7C,KAAK,cAAcA,EAAM,SAEzB,SAAS,iBAAiB,eAAe,KAAK,aAAa,GAC3D,SAAS,iBAAiB,aAAa,KAAK,kBAAkB;AAAA,EAElE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAWQ,gBAAgB,CAACA,MAA8B;AAErD,QAAI,CAAC,KAAK,WAAW,CAAC,KAAK,YAAa;AAGxC,SAAK,cAAc;AAGnB,UAAM6E,IAAS7E,EAAM,UAAU,KAAK,aAG9B8E,IACJ,KAAK,gBAAgB,KAAK,kBAC1B,KAAK,gBAAgB,KAAK,mBAGtBC,IAAW,KAAK;AAAA,MACpBD,IAAe,KAAK,gBAAgBD,IAAS,KAAK,gBAAgBA;AAAA,IAAA,GAI9DG,IAAmB,KAAK;AAAA,MAC5B,KAAK,IAAID,GAAU,KAAK,YAAY;AAAA,MACpC,KAAK,UAAU,QAAQ,OAAO;AAAA,IAAA;AAIhC,SAAK,cAAcC,CAAgB;AAAA,EACrC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASQ,qBAAqB,MAAY;AAEvC,SAAK,WAAW,EAAE,GAClB,KAAK,YAAY,EAAK,GAEtB,SAAS,oBAAoB,eAAe,KAAK,aAAa,GAC9D,SAAS,oBAAoB,aAAa,KAAK,kBAAkB;AAAA,EACnE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAWQ,uBAAuB,CAAChF,MAA4B;AAC1D,IAAIA,EAAM,WAAW,KAAK,UAAU,YAClC,KAAK,YAAY,EAAI,GACf,KAAK,WAAWA,EAAM,QAAQ,WAAW,MAC7CA,EAAM,eAAA,GAEN,KAAK,sBAAsB,KAAK,mBAAmBA,EAAM,QAAQ,CAAC,GAAGA,EAAM,QAAQ,CAAC,CAAC,GAErF,KAAK,gBAAgB,KAAK,QAAQ;AAAA,EAGxC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAWQ,sBAAsB,CAACA,MAA4B;AACzD,QAAIA,EAAM,WAAW,KAAK,UAAU,WAC5B,KAAK,WAAWA,EAAM,QAAQ,WAAW,KAAK,KAAK,wBAAwB,QAAQ,KAAK,kBAAkB,SAC9GA,EAAM,eAAA,GACF,KAAK,UAAS;AAChB,WAAK,cAAc;AAInB,YAAMiF,IAFkB,KAAK,mBAAmBjF,EAAM,QAAQ,CAAC,GAAGA,EAAM,QAAQ,CAAC,CAAC,IAElD,KAAK;AACrC,UAAI+E,IAAmB,KAAK,MAAM,KAAK,gBAAgBE,CAAK;AAE5D,MAAAF,IAAW,KAAK,IAAI,KAAK,IAAIA,GAAU,KAAK,YAAY,GAAG,EAAE,GAE7D,KAAK,cAAcA,CAAQ;AAAA,IAC7B;AAAA,EAGN;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQQ,qBAAqB,CAAC/E,MAA4B;AACxD,IAAIA,EAAM,WAAW,KAAK,UAAU,WAClC,KAAK,YAAY,EAAK;AAAA,EAE1B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQQ,sBAAsB,CAACA,MAA4B;AACzD,IAAIA,EAAM,WAAW,KAAK,UAAU,WAClC,KAAK,YAAY,EAAI;AAAA,EAEzB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQQ,oBAAoB,CAACA,MAA4B;AACvD,IAAIA,EAAM,WAAW,KAAK,UAAU,WAClC,KAAK,YAAY,EAAK;AAAA,EAE1B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAeQ,gBAAgB,CAAC+E,MAA2B;AAClD,QAAI,CAAC,KAAK,SAAS;AACjB,cAAQ,KAAK,sDAAsD;AACnE;AAAA,IACF;AAEA,QAAI;AAGF,MAAAA,IAAW,KAAK,IAAI,KAAK,iBAAiB,OAAUA,CAAQ;AAE5D,YAAMG,IAAoBH,IAAW,KAAK;AAC1C,WAAK,gBAAgBA,GAAUG,CAAS,GAEpC,KAAK,UAAU,aAAa,KAAK,OAAO,IAC1C,KAAK,kBAAkB,GAAG,MAAMH,IAAW,KAAK,YAAY,MAE5D,KAAK,kBAAkB,GAAGA,CAAQ,MAEpC,KAAK,QAAQ,aAAa,SAAS,KAAK,eAAe,GACvD,KAAK,QAAQ,aAAa,UAAU,MAAM,GAKtC,KAAK,kBACH,CAAC,KAAK,oBAAoB,KAAK,yBAAyB,UAC1D,KAAK,QAAQ,aAAa,UAAU,GAAGG,IAAY,CAAC,IAAI,GAE1D,KAAK,QAAQ,MAAM,YAAY,kBAAkB,KAAK,eAAe,MAEjE,KAAK,aAAe,KAAK,QAAQ,iBACnC,KAAK,QAAQ,cAAc,MAAM,YAAY,kBAAkB,KAAK,eAAe,GAEjF,CAAC,KAAK,oBAAoB,CAAC,KAAK,UAAU,QAAQ,MAAM,cAC1D,KAAK,QAAQ,aAAa,UAAU,GAAGA,IAAY,CAAC,IAAI,IAI5D,KAAK,UAAU,OAAA;AAAA,IACjB,SAAST,GAAO;AACd,cAAQ,MAAM,gDAAgDA,CAAK;AAAA,IACrE;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAaQ,gBAAgB,CAACU,GAAexE,IAAuB,MAAMC,IAAwB,SAAe;AAC1G,IAAIuE,KACF,KAAK,qBAAA,GACDxE,MAAU,QAAQC,MAAW,QAC/B,KAAK,gBAAgBD,GAAOC,CAAM,GAEpC,KAAK,UAAU,SAAS,MAAM,aAAa,IAC3C,KAAK,UAAU,SAAS,MAAM,UAAU,OAIxC,KAAK,eAAA;AAAA,EAET;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAmBQ,kBAAkB,CAACD,GAAeC,MAAyB;AAEjE,UAAMwE,IAAe,KAAK,MAAMzE,CAAK,GAC/B0E,IAAgB,KAAK,MAAMzE,CAAM;AAEvC,QAAI0E,IAAO,GAAGF,CAAY,MAAMC,CAAa;AAE7C,QAAI,KAAK;AAIP,MAAAC,IAAO,GAFY,KAAK,MAAM,MAAM3E,IAAQ,KAAK,YAAY,CAEzC,MAAM2E,CAAI;AAAA,aACrB,CAAC,KAAK,eAAe,KAAK,SAAS;AAE5C,YAAMC,IAAW,KAAK,QAAQ,aAAa,OAAO;AAClD,UAAIA,GAAU;AAEZ,cAAMC,IAAc,WAAWD,CAAQ;AACvC,YAAIC,MAAgB7E,GAAO;AACzB,gBAAM8E,IAAc9E,IAAQC,GACtB8E,IAAmB,KAAK,MAAMF,IAAcC,CAAW;AAC7D,UAAAH,IAAO,GAAGC,CAAQ,MAAMG,CAAgB,OAAOJ,CAAI;AAAA,QACrD;AAAA,MACF,WAAW,KAAK,mBAAmB,kBAAkB;AAEnD,cAAM,EAAE,cAAAK,GAAc,eAAAC,EAAA,IAAkB,KAAK;AAC7C,QAAID,MAAiBhF,MACnB2E,IAAO,GAAGK,CAAY,MAAMC,CAAa,OAAON,CAAI;AAAA,MAExD;AAAA,IACF;AAGA,SAAK,UAAU,SAAS,YAAYA;AAAA,EACtC;AAAA,EAEA,IAAI,aAAsB;AACxB,WAAO,KAAK,SAAS,aAAa,OAAO,GAAG,SAAS,GAAG,KAAK;AAAA,EAC/D;AAAA,EAEA,IAAI,YAAqB;AACvB,WAAI,KAAK,UACA,KAAK,QAAQ,aAAa,iBAAiB,IAE3C;AAAA,EAEX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAUQ,0BAA0B,MAAqB;AACrD,UAAMnF,IAAS,IAAIkD;AAAA,MACjB;AAAA,MACA,KAAK;AAAA,MACL,KAAK,UAAU,QAAQ;AAAA,IAAA;AAEzB,WAAAlD,EAAO,YAAY,MACV,KAAK,YAEPA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQQ,4BAA2C,CAACH,MAAuB;AACzE,IAAAA,EAAM,yBAAA,GACN,KAAK,gBAAgB,EAAI;AAAA,EAC3B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAUQ,kBAAkB,CAAC6F,IAAoB,OAAgB;AAC7D,QAAI,KAAK,SAAS;AAChB,YAAMlB,IAAgB,KAAK,QAAQ,sBAAA;AACnC,WAAK,eAAe,iBAAiB,KAAK,UAAU,MAAM,IAAI,GAC9D,KAAK,eAAe,KAAK,UAAU,MAAM,KAAK,cAC5C,WAAW,KAAK,aAAa,WAAW,IACxC,WAAW,KAAK,aAAa,YAAY;AAC3C,UAAII,GAAUG;AACd,MAAI,KAAK,cACPH,IAAW,GAAG,KAAK,MAAMJ,EAAK,KAAK,CAAC,MACpCO,IAAY,KAAK,UAAU,QAAQ,MAAM,aACrC,SACA,GAAG,KAAK,MAAMP,EAAK,MAAM,CAAC,SAE9BI,IAAW,GAAG,KAAK,MAAM,MAAMJ,EAAK,QAAQ,KAAK,YAAY,CAAC,KAC9DO,IAAY,SAEd,KAAK,QAAQ,aAAa,SAAS,GAAGH,CAAQ,EAAE,GAChD,KAAK,QAAQ,aAAa,UAAU,GAAGG,CAAS,EAAE,GAC9C,KAAK,UAAU,aAAa,iBAC9B,KAAK,QAAQ,MAAM,YAAY,kBAAkB,GAAGH,CAAQ,EAAE,GAC9D,KAAK,QAAQ,QAAQ,eAAe,GAAG,KAAK,UAAU,MAElD,KAAK,aAAa,KAAK,QAAQ,kBACjC,KAAK,QAAQ,cAAc,MAAM,YAAY,kBAAkB,GAAGA,CAAQ,EAAE,GAC5E,KAAK,QAAQ,cAAc,QAAQ,eAAe,GAAG,KAAK,UAAU,KAGxE,KAAK,UAAU,QAAQ,QAAQ,WAAc,WAAW,KAAK,YAC7D,KAAK,UAAU,OAAA,GACXc,MACF,KAAK,cAAc,IAAMlB,EAAK,OAAOA,EAAK,MAAM,GAChD,KAAK,cAAc,EAAK,IAEtB,KAAK,SACP,QAAQ,MAAM,qCAAqC;AAAA,QACjD,QAAQ,KAAK;AAAA,QACb,UAAAI;AAAA,QACA,YAAY,KAAK;AAAA,QACjB,WAAW,KAAK;AAAA,MAAA,CACjB;AAAA,IAEL;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOQ,iBAAiB,MAAY;AACnC,SAAK,mBAAmB,WAAW,MAAM;AACvC,WAAK,UAAU,SAAS,MAAM,aAAa,cAC3C,KAAK,UAAU,SAAS,MAAM,UAAU;AAAA,IAC1C,GAAG,GAAI;AAAA,EACT;AAAA;AAAA;AAAA;AAAA;AAAA,EAMQ,uBAAuB,MAAY;AACzC,IAAI,KAAK,qBAAqB,SAC5B,aAAa,KAAK,gBAAgB,GAClC,KAAK,mBAAmB;AAAA,EAE5B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASQ,qBAAqB,CAACe,GAAeC,MAA0B;AACrE,UAAMC,IAAKD,EAAO,UAAUD,EAAO,SAC7BG,IAAKF,EAAO,UAAUD,EAAO;AACnC,WAAO,KAAK,KAAKE,IAAKA,IAAKC,IAAKA,CAAE;AAAA,EACpC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAYQ,kBAAkB,CAACC,MAElBA,EAAI,QAAQ,6BAA6B,CAACC,GAAGC,GAAQC,GAAKC,MAAW,GAAGF,CAAM,GAAG,KAAK,MAAM,OAAOC,CAAG,CAAC,CAAC,GAAGC,CAAM,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAYpH,cAAc,MAChB,KAAK,mBAAmB,mBACtB,KAAK,QAAQ,IAAI,WAAW,aAAa,IACpC,KAAK,QAAQ,IAAI,SAAS,eAAe,IAE3C,KAAK,QAAQ,IAAI,SAAS,MAAM,IAElC;AAEX;ACrvBA,MAAqBC,EAAS;AAAA;AAAA,EAG5B;AAAA,EACA,gBAAyB;AAAA,EAEzB,YAAY5J,GAA0B;AACpC,SAAK,YAAYA;AAAA,EACnB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASA,OAAO,MAAY;AAAA,EAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAepB,aAA4B;AAC1B,UAAM6J,IAAyB,CAAA;AAC/B,WAAI,KAAK,UAAU,QAAQ,MAAM,iBAC/BA,EAAQ,KAAK,IAAI/C,EAAY,KAAK,SAAS,CAAC,GAE1C,KAAK,UAAU,QAAQ,OAAO,iBAChC+C,EAAQ,KAAK,IAAI5C,EAAa,KAAK,SAAS,CAAC,GAE3C,KAAK,UAAU,QAAQ,OAAO,uBAChC4C,EAAQ,KAAK,IAAI9C,EAAa,KAAK,SAAS,CAAC,GAE/C8C,EAAQ,KAAK,IAAI5J,EAAY,KAAK,SAAS,CAAC,GAErC4J;AAAA,EACT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAUA,mBAAmB,MACV;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAkBT,gBAAgB,MAAmB;AACjC,UAAMhI,IAAS,KAAK,iBAAA;AACpB,WAAMA,IACG,KAAK,UAAU,MAAM,KAAKA,CAAM,IAEhC;AAAA,EAEX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,oBAAoB,MACX,KAAK,iBAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAUd,eAAe,MAAY;AACzB,SAAK,UAAU,MAAM,aAAa,IAAI;AAAA,EACxC;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,SAAS,MAAY;AAAA,EAAC;AACxB;ACzJA,MAAMiI,IAAoB;AA6B1B,MAAqBC,UAA4BH,EAAS;AAAA,EACxD;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA,gBAAyB;AAAA,EAEzB,YAAY5J,GAA0B;AACpC,UAAMA,CAAS,GACf,KAAK,WAAWA,EAAU,QAAQ,MAAM,UACxC,KAAK,cAAc,MACnB,KAAK,iBAAiB,KAAK,sBAAA,GAC3B,KAAK,qBAAqB,CAAA;AAAA,EAC5B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQA,OAAO,MAAY;AAEjB,SAAK,UAAU,MAAM,GAAG,eAAe,KAAK,aAAa,GAEzD,KAAK,UAAU,MAAM,KAAK,iBAAiB,UAAU,MAAM;AACzD,WAAK,uBAAA;AAAA,IACP,CAAC,GACD,KAAK,qBAAA;AAAA,EACP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAWQ,uBAAuB,MAAY;AAEzC,QAAIgK,IAA+B;AAcnC,IAbuB,IAAI,eAAe,CAACC,MAAY;AACrD,iBAAWC,KAASD;AAElB,QAAID,KACF,aAAaA,CAAa,GAG5BA,IAAgB,OAAO,WAAW,MAAM;AACtC,eAAK,uBAAA;AAAA,QACP,GAAG,GAAG;AAAA,IAEV,CAAC,EAEc,QAAQ,KAAK,UAAU,MAAM,IAAI;AAAA,EAClD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,mBAAmB,MACV,KAAK;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQd,oBAAoB,MACX,KAAK;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAcN,gBAAgB,MAAY;AAElC,WAAO,QAAQ,KAAK,kBAAkB,EAAE,QAAQ,CAAC,CAAC/H,GAAK,EAAE,aAAAkI,GAAa,YAAAC,EAAA,CAAY,MAAM;AACtF,UAAI;AACF,QAAK,KAAK,UAAU,MAAM,KAAK,SAASD,CAAW,MACjDC,EAAW,OAAA,GACX,OAAO,KAAK,mBAAmBnI,CAAG;AAAA,MAEtC,QAAQ;AAAA,MAAE;AAAA,IACZ,CAAC,GAED,KAAK,UAAU,MAAM,KAAK,iBAAiB,GAAG,KAAK,QAAQ,gCAAgC,EACxF,QAAQ,CAACkI,MAA6B;AACrC,WAAK,6BAA6BA,CAAW;AAAA,IAC/C,CAAC,GACH,KAAK,uBAAA;AAAA,EACP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAYQ,+BAA+B,CAACA,MAAmC;AACzE,UAAME,IAAK,MAAM;AAAA,MAAK,OAAO,gBAAgB,IAAI,WAAW,CAAC,CAAC;AAAA,MAAG,CAACnK,MAChE,OAAO,aAAa,KAAMA,IAAI,EAAG;AAAA,IAAA,EACjC,KAAK,EAAE;AACT,IAAAiK,EAAY,QAAQ,kBAAkBE;AAEtC,UAAMC,IAAS,SAAS,cAAc,QAAQ,GACxCC,IAAUD,EAAO,WAAW,IAAI;AACtC,IAAIC,MACFA,EAAQ,cAAc,GACtBA,EAAQ,SAAS,GAAG,GAAG,GAAG,CAAC;AAG7B,UAAMH,IAAa,SAAS,cAAc,KAAK;AAC/C,IAAAA,EAAW,MAAME,EAAO,UAAU,WAAW,GAC7CF,EAAW,UAAU,IAAIN,CAAiB,GAC1CM,EAAW,QAAQ,kBAAkBC;AAErC,UAAMG,IAAmC;AAAA,MACvC,GAAG,KAAK,UAAU,QAAQ,MAAM;AAAA,MAE9B,UAAU;AAAA,MACV,QAAQ;AAAA,MACR,YAAY;AAAA,IACd;AAGF,WAAO,OAAOJ,EAAW,OAAOI,CAAW,GAE3CJ,EAAW,MAAM,YAAY,uBAAuB,MAAM,GAC1DA,EAAW,MAAM,YAAY,oBAAoB,MAAM,GACvDA,EAAW,MAAM,YAAY,mBAAmB,MAAM,GAElD,KAAK,UAAU,QAAQ,SACzBA,EAAW,MAAM,YAAY,UAAU,eAAe,GAGxD,KAAK,eAAe,YAAYA,CAAU,GAG1CA,EAAW,iBAAiB,SAAS,KAAK,kBAAkB,GAE5DA,EAAW,iBAAiB,eAAe,CAAC/G,MAAU;AACpD,MAAAA,EAAM,gBAAA,GACNA,EAAM,eAAA;AAAA,IACR,CAAC,GAED+G,EAAW,iBAAiB,SAAS,KAAK,UAAU,sBAAsB,GAC1EA,EAAW,iBAAiB,cAAc,KAAK,UAAU,qBAAqB,EAAE,SAAS,IAAO,GAChGA,EAAW,iBAAiB,aAAa,KAAK,UAAU,oBAAoB,EAAE,SAAS,IAAO,GAG9F,KAAK,mBAAmBC,CAAE,IAAI;AAAA,MAC5B,aAAAF;AAAA,MACA,YAAAC;AAAA,IAAA,GAGE,KAAK,UAAU,QAAQ,SACzB,QAAQ,MAAM,sDAAsDD,GAAa,YAAYE,GAAI,oBAAoBD,CAAU;AAAA,EAEnI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAYQ,yBAAyB,MAAY;AAC3C,QAAI,OAAO,KAAK,KAAK,kBAAkB,EAAE,SAAS,GAAG;AACnD,YAAMvG,IAAyB,KAAK,UAAU,MAAM,UAAU,sBAAA,GACxD4G,IAA8B,KAAK,UAAU,MAAM,UAAU,YAC7DC,IAA6B,KAAK,UAAU,MAAM,UAAU;AAElE,aAAO,QAAQ,KAAK,kBAAkB,EAAE,QAAQ,CAAC,CAACzI,GAAK,EAAE,aAAAkI,GAAa,YAAAC,EAAA,CAAY,MAAM;AACtF,YAAI;AAEF,gBAAMO,IAA2BR,EAAY,sBAAA;AAC7C,iBAAO;AAAA,YAAOC,EAAW;AAAA,YAAO;AAAA;AAAA,cAE5B,MAAM,GAAGO,EAAgB,OAAO9G,EAAc,OAAO,IAAI4G,CAAmB;AAAA,cAC5E,KAAK,GAAGE,EAAgB,MAAM9G,EAAc,MAAM6G,CAAkB;AAAA,cACpE,OAAO,GAAGC,EAAgB,KAAK;AAAA,cAC/B,QAAQ,GAAGA,EAAgB,MAAM;AAAA,YAAA;AAAA,UACnC;AAAA,QAEJ,SAAS7C,GAAO;AACd,gBAAM8C,IAAc,yCAAyC3I,CAAG;AAChE,kBAAQ,MAAM2I,GAAK,GAAG9C,aAAiB,QAAQA,EAAM,UAAUA,CAAK,EAAE;AAAA,QACxE;AAAA,MACF,CAAC;AAAA,IACH;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAUQ,qBAAqB,CAACzE,MAA4B;AAGxD,UAAMgH,IADgBhH,EAAM,OACH,QAAQ;AACjC,SAAK,cAAc,KAAK,mBAAmB,GAAGgH,CAAE,EAAE,EAAE,aACpD,KAAK,UAAU,KAAK,IAAI;AAAA,EAC1B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASQ,wBAAwB,MAAmB;AAEjD,UAAMQ,IAAiB,SAAS,cAAc,KAAK;AACnD,WAAAA,EAAe,UAAU,IAAI,iBAAiB,GAC9C,KAAK,UAAU,MAAM,UAAU,YAAYA,CAAc,GAClDA;AAAA,EACT;AAEF;ACvQA,MAAqBC,UAAwBf,EAAoB;AAAA,EAC/D,YAAY/J,GAA0B;AACpC,UAAMA,CAAS;AAAA,EACjB;AACF;ACLA,MAAqB+K,UAAwBhL,EAAO;AAAA,EAChD;AAAA,EACA,gBAAgD;AAAA,EAChD,cAAuC;AAAA,EAEvC,YAAYC,GAA0B;AAClC,UAAMA,CAAS,GACf,KAAK,iBAAiB;AAAA,MAClB,IAAI0G;AAAA,QACA;AAAA,QACA,KAAK;AAAA,QACL,KAAK,UAAU,QAAQ;AAAA,MAAA;AAAA,IAC3B,GAEJ,KAAK,QAAQ,KAAK,aAAA;AAAA,EACtB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAUA,WAAW,MAAY;AACnB,SAAK,gBAAgB,KAAK,UAAU,aAAa,iBAAA,GACjD,KAAK,cAAc,KAAK,UAAU,aAAa,cAAA;AAAA,EACnD;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,YAAY,MAAY;AACpB,SAAK,gBAAgB,MACrB,KAAK,MAAM,KAAK,oBAAoB,UAAU,KAAK,gBAAgB,GACnE,KAAK,MAAM,KAAK,oBAAoB,UAAU,KAAK,kBAAkB,GACrE,KAAK,MAAM,QAAQ,oBAAoB,eAAe,KAAK,qBAAqB,GAChF,KAAK,MAAM,aAAa,oBAAoB,SAAS,KAAK,kBAAkB,GAC5E,KAAK,MAAM,QAAQ,OAAA;AAAA,EACvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASQ,kBAAiC,MAAY;AACjD,SAAK,mBAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAWQ,qBAAqB,MAAY;AACrC,IAAI,KAAK,kBACL,KAAK,MAAM,SAAS,QAAQ,KAAK,cAAc,aAAa,KAAK,KAAK,IACtE,KAAK,MAAM,WAAW,QAAQ,KAAK,cAAc,aAAa,OAAO,KAAK,IAC1E,SAAS,KAAK,OAAO,KAAK,MAAM,OAAO,GACnC,KAAK,UAAU,QAAQ,SACvB,QAAQ,MAAM,gCAAgC,KAAK,aAAa;AAAA,EAG5E;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAUQ,qBAAqB,MAAY;AACrC,SAAK,MAAM,QAAQ,OAAA;AAAA,EACvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAUQ,eAAe,MAAY;AAC/B,QAAI,KAAK,eAAe;AACpB,YAAMsE,IAAc,OAAO,KAAK,MAAM,SAAS,SAAU,WACnD,KAAK,MAAM,SAAS,QACpB,IACAlF,IAAgB,KAAK,MAAM,WAAW;AAC5C,WAAK,cAAc,aAAa,OAAOkF,CAAG,GACtClF,IACA,KAAK,cAAc,aAAa,SAASA,CAAK,IAE9C,KAAK,cAAc,gBAAgB,OAAO,GAE1C,KAAK,UAAU,QAAQ,SACvB,QAAQ,MAAM,gBAAgBkF,GAAK,UAAUlF,GAAO,sBAAsB,KAAK,aAAa;AAGhG,YAAMmF,IAAiB,KAAK,aAAa,QAAQ,UAAU,KAAK,UAAU,WAAW,QAAQ,GAAG;AAChG,MAAI,KAAK,eAAeA,MAChB,KAAK,UAAU,QAAQ,SACvB,QAAQ,MAAM,2CAA2CA,CAAc,GAG3E,KAAK,YAAY,QAAQ,OAAO,KAAK,UAAU,WAAW,UAAU,EAAK,GACzE,KAAK,YAAY;AAAA,QACb,KAAK,UAAU,WAAW;AAAA,QAC1B;AAAA,UACI,OAAOA;AAAA,UACP,OAAAnF;AAAA,QAAA;AAAA,MACJ;AAAA,IAGZ;AAAA,EACJ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAeQ,eAAe,MAAqB;AACxC,UAAMoF,IAAe,MAAM;AAAA,MAAK,OAAO,gBAAgB,IAAI,WAAW,CAAC,CAAC;AAAA,MAAG,CAAChL,MACxE,OAAO,aAAa,KAAMA,IAAI,EAAG;AAAA,IAAA,EACnC,KAAK,EAAE,GAGHiL,IAAQ,SAAS,cAAc,KAAK;AAC1C,IAAAA,EAAM,KAAK,GAAGD,CAAI,UAClBC,EAAM,aAAa,6BAA6B,EAAE;AAGlD,UAAMC,IAAiB,SAAS,cAAc,KAAK,GAG7CC,IAAO,SAAS,cAAc,MAAM;AAC1C,IAAAA,EAAK,KAAK,GAAGH,CAAI;AAGjB,UAAMI,IAAW,SAAS,cAAc,OAAO;AAC/C,IAAAA,EAAS,aAAa,OAAO,KAAK,GAClCA,EAAS,cAAc,KAAK,UAAU,QAAQ,QAAQ,QAAQ,OAAO,KAAK,UAAU,QAAQ,MAAM,qBAAqB,OAAO;AAG9H,UAAMC,IAAc,SAAS,cAAc,UAAU;AACrD,IAAAA,EAAY,OAAO,OACnBA,EAAY,OAAO;AAGnB,UAAMC,IAAa,SAAS,cAAc,OAAO;AACjD,IAAAA,EAAW,aAAa,OAAO,OAAO,GACtCA,EAAW,cAAc,KAAK,UAAU,QAAQ,QAAQ,QAAQ,SAAS,KAAK,UAAU,QAAQ,MAAM,qBAAqB,OAAO;AAGlI,UAAMC,IAAgB,SAAS,cAAc,UAAU;AACvD,IAAAA,EAAc,OAAO,SACrBA,EAAc,OAAO;AAGrB,UAAMC,IAAY,SAAS,cAAc,KAAK,GACxCC,IAAe,SAAS,cAAc,QAAQ;AACpD,IAAAA,EAAa,OAAO,UACpBA,EAAa,YAAY,KAAK,UAAU,QAAQ,MAAM,qBAAqB,MAAM,cACjFD,EAAU,YAAYC,CAAY,GAGlCN,EAAK,YAAYC,CAAQ,GACzBD,EAAK,YAAYE,CAAW,GAC5BF,EAAK,YAAYG,CAAU,GAC3BH,EAAK,YAAYI,CAAa,GAC9BJ,EAAK,YAAYK,CAAS;AAG1B,UAAME,IAAe,SAAS,cAAc,QAAQ;AACpD,WAAAA,EAAa,KAAK,GAAGV,CAAI,WACzBU,EAAa,OAAO,UACpBA,EAAa,YAAY,KAAK,UAAU,QAAQ,MAAM,qBAAqB,MAAM,cAG7E,KAAK,UAAU,QAAQ,MAAM,qBAAqB,WAClD,OAAO,OAAOT,EAAM,OAAO,KAAK,UAAU,QAAQ,MAAM,qBAAqB,OAAO,eAAe,GACnG,OAAO,OAAOC,EAAe,OAAO,KAAK,UAAU,QAAQ,MAAM,qBAAqB,OAAO,cAAc,GAC3G,OAAO,OAAOE,EAAS,OAAO,KAAK,UAAU,QAAQ,MAAM,qBAAqB,OAAO,KAAK,GAC5F,OAAO,OAAOC,EAAY,OAAO,KAAK,UAAU,QAAQ,MAAM,qBAAqB,OAAO,QAAQ,GAClG,OAAO,OAAOC,EAAW,OAAO,KAAK,UAAU,QAAQ,MAAM,qBAAqB,OAAO,KAAK,GAC9F,OAAO,OAAOC,EAAc,OAAO,KAAK,UAAU,QAAQ,MAAM,qBAAqB,OAAO,QAAQ,GACpG,OAAO,OAAOE,EAAa,OAAO,KAAK,UAAU,QAAQ,MAAM,qBAAqB,OAAO,YAAY,GACvG,OAAO,OAAOC,EAAa,OAAO,KAAK,UAAU,QAAQ,MAAM,qBAAqB,OAAO,YAAY,IAI3GR,EAAe,YAAYC,CAAI,GAC/BD,EAAe,YAAYQ,CAAY,GAGvCT,EAAM,YAAYC,CAAc,GAGhCC,EAAK,iBAAiB,UAAU,KAAK,gBAAgB,GACrDA,EAAK,iBAAiB,UAAU,KAAK,kBAAkB,GACvDF,EAAM,iBAAiB,eAAe,KAAK,qBAAqB,GAChES,EAAa,iBAAiB,SAAS,KAAK,kBAAkB,GAEvD;AAAA,MACH,SAAST;AAAA,MACT,MAAAE;AAAA,MACA,UAAUE;AAAA,MACV,YAAYE;AAAA,MACZ,cAAAG;AAAA,IAAA;AAAA,EAER;AAAA,EAEQ,mBAAmB,CAACvI,MAA6B;AACrD,IAAAA,EAAM,eAAA,GACN,KAAK,aAAA,GACL,KAAK,mBAAA;AAAA,EACT;AAAA,EAEQ,wBAAwB,CAACA,MAA8B;AAC3D,IAAIA,EAAM,WAAW,KAAK,MAAM,WAC5B,KAAK,mBAAA;AAAA,EAEb;AACJ;ACnNA,MAAqBwI,UAAuB9L,EAAO;AAAA,EAC/C;AAAA,EACA;AAAA,EACA,gBAAgD;AAAA,EAChD,eAAoC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAapC,OAAO,2BAA2B,CAACiH,GAA+C7G,IAAiB,OAAmB;AAElH,QAAI2L,IAAa;AACjB,QAAI9E,aAAyB,oBACrBA,EAAc,IAAI,WAAW,aAAa,GAAG;AAC7C,YAAM+E,IAAW/E,EAAc,IAAI,UAAU,GAAGA,EAAc,IAAI,QAAQ,GAAG,CAAC;AAC9E,MAAA8E,IAAaC,MAAa,aAAaA,MAAa;AAAA,IACxD;AAEJ,WAAI5L,KACA,QAAQ,MAAM,4BAA4B;AAAA,MACtC,SAAS6G;AAAA,MACT,YAAA8E;AAAA,IAAA,CACH,GAEEA;AAAA,EACX;AAAA,EAEA,YAAY9L,GAA0B;AAClC,UAAMA,CAAS,GACf,KAAK,UAAU,KAAK,UAAU,QAAQ,MAAM,mBAC5C,KAAK,iBAAiB;AAAA,MAClB,IAAI0G;AAAA,QACA;AAAA,QACA,KAAK;AAAA,QACL,KAAK,UAAU,QAAQ;AAAA,MAAA;AAAA,IAC3B,GAEJ,KAAK,QAAQ,KAAK,aAAA;AAAA,EACtB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASA,WAAW,MAAY;AACnB,SAAK,gBAAgB,KAAK,UAAU,aAAa,iBAAA;AAEjD,UAAMsF,IAA2BH,EAAe,yBAAyB,KAAK,eAAe,KAAK,KAAK;AACvG,SAAK,eAAe,CAAC,EAAE,oBAAoBG,GACvC,KAAK,SACL,QAAQ,MAAM,mDAAmD,KAAK,eAAe,gBAAgBA,CAAwB;AAAA,EAErI;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,YAAY,MAAY;AACpB,SAAK,gBAAgB,MACrB,KAAK,WAAA,GAEL,KAAK,MAAM,eAAe,oBAAoB,SAAS,KAAK,gBAAgB,GAC5E,KAAK,MAAM,eAAe,oBAAoB,SAAS,KAAK,gBAAgB,GAC5E,KAAK,MAAM,aAAa,oBAAoB,SAAS,KAAK,UAAU,GACpE,KAAK,MAAM,QAAQ,oBAAoB,eAAe,KAAK,kBAAkB;AAAA,EACjF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQQ,kBAAiC,MAAM;AAC3C,SAAK,WAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASQ,aAAa,MAAY;AAC7B,IAAI,KAAK,yBAAyB,qBAC9B,KAAK,eAAe,KAAK,iBAAiB,KAAK,aAAa,GACxD,KAAK,aAAa,eAClB,KAAK,MAAM,eAAe,MAAM,aAAa,WAC7C,KAAK,MAAM,aAAa,MAAM,UAAU,QACxC,SAAS,KAAK,OAAO,KAAK,MAAM,OAAO,KAEvC,KAAK,iBAAiB,KAAK,QAAQ,KAAK,WAAW;AAAA,EAG/D;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOQ,aAAa,MAAY;AAC7B,SAAK,MAAM,QAAQ,OAAA;AAAA,EACvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAaQ,mBAAmB,CAACC,MAA0D;AAClF,QAAIjI,IAAuBiI,EAAI,aAAa,OAAO,GAC/ChI,IAAwBgI,EAAI,aAAa,QAAQ,GACjDC,IAA6B,MAC7BC,IAA8B;AAGlC,QAAInI;AACA,UAAIA,EAAM,YAAA,EAAc,SAAS,IAAI;AACjC,QAAAkI,IAAc,WAAWlI,CAAK;AAAA,eACvBA,EAAM,SAAS,GAAG;AACzB,QAAAkI,IAAc,KAAK,QAAQ,YAAY;AAAA,eAChClI,EAAM,YAAA,EAAc,SAAS,IAAI,KAAKA,EAAM,YAAA,EAAc,SAAS,KAAK;AAC/E,QAAAkI,IAAc,WAAWlI,CAAK,IAAI;AAAA,eAC3B,CAAC,MAAM,WAAWA,CAAK,CAAC;AAC/B,QAAAkI,IAAc,WAAWlI,CAAK;AAAA;AAG9B,eAAO,CAAC,MAAM,IAAI;AAK1B,QAAIC;AACA,UAAI,CAAC,MAAM,WAAWA,CAAM,CAAC;AACzB,QAAAkI,IAAe,WAAWlI,CAAM;AAAA,eACzBA,EAAO,YAAA,EAAc,SAAS,IAAI;AACzC,QAAAkI,IAAe,WAAWlI,CAAM;AAAA,eACzBA,EAAO,YAAA,EAAc,SAAS,IAAI,KAAKA,EAAO,YAAA,EAAc,SAAS,KAAK;AACjF,QAAAkI,IAAe,WAAWlI,CAAM,IAAI;AAAA,eAGhCiI,KAAeD,EAAI,eAAe,KAAKA,EAAI,gBAAgB;AAC3D,QAAAE,IAAeD,KAAeD,EAAI,eAAeA,EAAI;AAAA;AAErD,eAAO,CAAC,MAAM,IAAI;AAK9B,WAAO,CAACC,GAAaC,CAAY;AAAA,EACrC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASQ,gBAAgB,CAACF,MAAyC;AAC9D,UAAMG,IAAUH,EAAI,aAAa,KAAK;AACtC,QAAI,CAACG,KAAW,CAACA,EAAQ,WAAW,aAAa;AAE7C,aAAO;AAGX,UAAMC,IAAaD,EAAQ,MAAM,GAAG,EAAE,CAAC;AACvC,WAAKC,IAIE,KAAK,KAAMA,EAAW,SAAS,IAAK,CAAC,IAHjC;AAAA,EAIf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQQ,mBAAmB,CAACzB,MAAsB;AAC9C,SAAK,UAAU,SAAS,YAAYA,GACpC,KAAK,UAAU,SAAS,MAAM,aAAa,IAC3C,KAAK,UAAU,SAAS,MAAM,UAAU,KACxC,WAAW,MAAM;AACb,WAAK,UAAU,SAAS,MAAM,aAAa,cAC3C,KAAK,UAAU,SAAS,MAAM,UAAU;AAAA,IAC5C,GAAG,IAAI;AAAA,EACX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAUQ,mBAAmB,CAACqB,MAAwC;AAChE,QAAI,CAACjI,GAAOC,CAAM,IAAI,KAAK,iBAAiBgI,CAAG;AAC/C,IAAI,CAACjI,MAAW,KAAK,QAAQ,YAAY,SAAYiI,EAAI,iBACrDjI,IAAQ,KAAK,QAAQ,UACrBC,IAASD,KAASiI,EAAI,eAAeA,EAAI;AAE7C,UAAMK,IAAU;AAAA,MACZ,cAAcL,EAAI;AAAA,MAClB,eAAeA,EAAI;AAAA,MACnB,aAAajI;AAAA,MACb,cAAcC;AAAA,MACd,MAAM,KAAK,cAAcgI,CAAG;AAAA,MAC5B,aAAa,CAAC,EAAEjI,KAASC,KAAWD,IAAQiI,EAAI,gBAAiBJ,EAAe,yBAAyBI,GAAK,KAAK,KAAK;AAAA,IAAA;AAE5H,WAAI,KAAK,SACL,QAAQ,MAAM,kBAAkB;AAAA,MAC5B,SAASA;AAAA,MACT,GAAGK;AAAA,IAAA,CACN,GAEEA;AAAA,EACX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAiBQ,iBAAiB,CAACL,MAAmC;AACzD,QAAI,KAAK,cAAc,aAAa;AAChC,YAAMM,IAAS,IAAI,MAAA;AACnB,MAAAA,EAAO,MAAMN,EAAI,KAEjBM,EAAO,SAAS,MAAM;AAClB,QAAI,KAAK,SACL,QAAQ,MAAM,kCAAkCA,CAAM;AAG1D,cAAMjC,IAAS,SAAS,cAAc,QAAQ;AAC9C,QAAAA,EAAO,QAAQ,KAAK,aAAc,aAClCA,EAAO,SAAS,KAAK,aAAc,cAEvBA,EAAO,WAAW,IAAI,EAC9B,UAAUiC,GAAQ,GAAG,GAAGjC,EAAO,OAAOA,EAAO,MAAM;AAEvD,cAAMkC,IAAiBlC,EAAO,UAAU,cAAc,KAAK,QAAQ,WAAW,GAExEmC,IAAe,IAAI,YAAA,EAAc,OAAOR,EAAI,GAAG,EAAE,QACjDS,IAAc,IAAI,YAAA,EAAc,OAAOF,CAAc,EAAE;AAE7D,QAAIE,IAAcD,MAEdR,EAAI,MAAMO;AAEd,cAAMG,IAAmB,GAAG,KAAK,MAAM,KAAK,aAAc,OAAQ,KAAK,cAAcV,CAAG,KAAgB,IAAI,CAAC,MACvGrB,IAAc,GAAG,KAAK,QAAQ,KAAK,YAAY,KAAK+B,CAAQ;AAAA,8BACpD,KAAK,aAAc,YAAY,MAAM,KAAK,aAAc,aAAa,QAAQrC,EAAO,KAAK,MAAM,KAAK,MAAMA,EAAO,MAAM,CAAC;AAAA;AAEtI,eAAI,KAAK,SACL,QAAQ,MAAM,qBAAqB;AAAA,UAC/B,iBAAiBmC;AAAA,UACjB,gBAAgBC;AAAA,UAChB,aAAaC;AAAA,UACb,kBAAkB,EAAE,OAAOrC,EAAO,OAAO,QAAQ,KAAK,MAAMA,EAAO,MAAM,EAAA;AAAA,QAAE,CAC9E,GAEL,KAAK,iBAAiBM,CAAG,GAClB;AAAA,MACX,GACA2B,EAAO,UAAU,CAACzE,OACd,QAAQ,MAAM,yBAAyBA,CAAK,GAC5C,KAAK,iBAAiB,yBAAyBA,CAAK,EAAE,GAC/C;AAAA,IAEf;AACI,WAAK,iBAAiB,KAAK,QAAQ,KAAK,WAAW;AAEvD,WAAO;AAAA,EACX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAgBQ,eAAe,MAAqB;AACxC,UAAM8E,IAAkC,SAAS,cAAc,KAAK;AACpE,IAAAA,EAAgB,aAAa,sCAAsC,EAAE;AACrE,UAAMxB,IAAiC,SAAS,cAAc,KAAK,GAC7DyB,IAAqC,SAAS,cAAc,KAAK,GACjEC,IAAgC,SAAS,cAAc,KAAK,GAC5DC,IAAuC,SAAS,cAAc,KAAK,GACnEnB,IAAkC,SAAS,cAAc,QAAQ,GACjEoB,IAAoC,SAAS,cAAc,QAAQ,GACnEC,IAAoC,SAAS,cAAc,QAAQ;AACzE,WAAAH,EAAc,MAAM,UAAU,QAC9BC,EAAqB,OAAOnB,GAAcoB,GAAgBC,CAAc,GACxE7B,EAAe,OAAOyB,GAAoBC,GAAeC,CAAoB,GAC7EH,EAAgB,YAAYxB,CAAc,GAC1CyB,EAAmB,YAAY,KAAK,QAAQ,KAAK,QACjDC,EAAc,YAAY,KAAK,QAAQ,KAAK,YAAY,IACpD,KAAK,QAAQ,WACb,OAAO,OAAOF,EAAgB,OAAO,KAAK,QAAQ,OAAO,eAAe,GACxE,OAAO,OAAOxB,EAAe,OAAO,KAAK,QAAQ,OAAO,cAAc,GACtE,OAAO,OAAO2B,EAAqB,OAAO,KAAK,QAAQ,OAAO,eAAe,GAC7E,OAAO,OAAOnB,EAAa,OAAO,EAAE,GAAG,KAAK,QAAQ,OAAO,SAAS,GAAG,KAAK,QAAQ,QAAQ,OAAO,OAAO,GACtG,KAAK,QAAQ,KAAK,WAClB,OAAO,OAAOoB,EAAe,OAAO,EAAE,GAAG,KAAK,QAAQ,OAAO,SAAS,GAAG,KAAK,QAAQ,QAAQ,SAAS,OAAO,IAE9GA,EAAe,MAAM,aAAa,UAEtC,OAAO,OAAOC,EAAe,OAAO,EAAE,GAAG,KAAK,QAAQ,OAAO,SAAS,GAAG,KAAK,QAAQ,QAAQ,SAAS,OAAO,IAElHrB,EAAa,YAAY,KAAK,QAAQ,MAAM,QAC5CoB,EAAe,YAAY,KAAK,QAAQ,MAAM,UAC9CC,EAAe,YAAY,KAAK,QAAQ,MAAM,UAG9CA,EAAe,iBAAiB,SAAS,KAAK,gBAAgB,GAC9DD,EAAe,iBAAiB,SAAS,KAAK,gBAAgB,GAC9DpB,EAAa,iBAAiB,SAAS,KAAK,UAAU,GACtDgB,EAAgB,iBAAiB,eAAe,KAAK,kBAAkB,GAChE;AAAA,MACH,SAASA;AAAA,MACT,gBAAAI;AAAA,MACA,cAAApB;AAAA,MACA,gBAAAqB;AAAA,MACA,cAAcH;AAAA,IAAA;AAAA,EAEtB;AAAA,EAEQ,mBAAmB,MAAY;AACnC,IAAI,KAAK,yBAAyB,oBAC9B,KAAK,eAAe,KAAK,aAAa,GAE1C,KAAK,WAAA;AAAA,EACT;AAAA,EAEQ,mBAAmB,MAAY;AACnC,SAAK,MAAM,aAAa,YAAY,KAAK,QAAQ,KAAK,YAAY,IAClE,KAAK,MAAM,aAAa,MAAM,UAAU,SACxC,KAAK,MAAM,eAAe,MAAM,aAAa;AAAA,EACjD;AAAA,EAEQ,qBAAqB,CAACzJ,MAAwB;AAClD,IAAAA,EAAM,yBAAA,GACFA,EAAM,WAAW,KAAK,MAAM,YACxB,KAAK,SACL,QAAQ,MAAM,wCAAwC,GAE1D,KAAK,WAAA;AAAA,EAEb;AAEJ;AC7ZA,MAAqB6J,UAAmBnN,EAAO;AAAA,EAC3C,gBAAgD;AAAA,EAChD,cAAuC;AAAA,EACvC;AAAA,EACA;AAAA,EACA;AAAA,EAWA,YAAYC,GAA0B;AAClC,UAAMA,CAAS,GACf,KAAK,cAAc,KAAK,UAAU,QAAQ,MAAM,aAChD,KAAK,gBAAgB,IAAI0G;AAAA,MACrB;AAAA,MACA,KAAK;AAAA,MACL,KAAK,UAAU,QAAQ;AAAA,IAAA,GAG3B,KAAK,cAAc,YAAY,MACpB,CAAC,CAAC,KAAK,QAAA,GAElB,KAAK,iBAAiB,CAAC,KAAK,aAAa,GACxC,OAAe,aAAa;AAAA,EACjC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,WAAW,MAAY;AACnB,SAAK,gBAAgB,KAAK,UAAU,aAAa,iBAAA,GACjD,KAAK,cAAc,KAAK,UAAU,aAAa,cAAA;AAAA,EACnD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQA,YAAY,MAAY;AACpB,SAAK,gBAAgB,MACrB,KAAK,sBAAA,GACL,KAAK,cAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAYQ,qBAAqB,MAAY;AACrC,IAAI,KAAK,UACL,KAAK,MAAM,KAAK,iBAAiB,UAAU,KAAK,kBAAkB,GAClE,KAAK,MAAM,aAAa,iBAAiB,SAAS,KAAK,aAAa,GACpE,KAAK,MAAM,aAAa,iBAAiB,SAAS,KAAK,UAAU,GACjE,KAAK,MAAM,WAAW,iBAAiB,SAAS,KAAK,kBAAkB,GACvE,KAAK,MAAM,MAAM,iBAAiB,eAAe,KAAK,iBAAiB;AAAA,EAE/E;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAWQ,wBAAwB,MAAY;AACxC,IAAI,KAAK,UACL,KAAK,MAAM,KAAK,oBAAoB,UAAU,KAAK,kBAAkB,GACrE,KAAK,MAAM,aAAa,oBAAoB,SAAS,KAAK,aAAa,GACvE,KAAK,MAAM,aAAa,oBAAoB,SAAS,KAAK,UAAU,GACpE,KAAK,MAAM,WAAW,oBAAoB,SAAS,KAAK,kBAAkB,GAC1E,KAAK,MAAM,MAAM,oBAAoB,eAAe,KAAK,iBAAiB;AAAA,EAElF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASQ,oBAAoB,CAAC7F,MAAmB;AAC5C,IAAAA,EAAE,yBAAA;AAAA,EACN;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAUQ,kBAAiC,MAAY;AACjD,SAAK,cAAA;AAAA,EACT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAUQ,qBAAqB,CAACA,MAAwB;AAClD,IAAIA,EAAE,WAAW,KAAK,OAAO,eACzBA,EAAE,yBAAA,GACFA,EAAE,eAAA,GACF,KAAK,cAAA,GACD,KAAK,SACL,QAAQ,MAAM,mDAAmD;AAAA,EAG7E;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAYA,gBAAgB,MAAY;AACxB,QAAI,KAAK,eAAe;AAEpB,UADA,KAAK,QAAQ,KAAK,YAAA,GACd,CAAC,KAAK,MAAO;AAEjB,WAAK,UAAU,QAAQ,OAAO,KAAK,MAAM,QAAQ,KAAK,MAAM,UAAU,GACtE,KAAK,mBAAA,GAGL,KAAK,MAAM,OAAO,MAAM,aAAa,UACrC,KAAK,MAAM,OAAO,KAAA,GAClB,KAAK,eAAe,KAAK,MAAM,MAAM,GAErC,KAAK,MAAM,OAAO,MAAM,aAAa,WAErC,KAAK,MAAM,MAAM,MAAA,GACjB,KAAK,MAAM,MAAM,OAAA;AAAA,IACrB;AAAA,EACJ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAmBQ,cAAc,MAAyB;AAC3C,UAAMsM,IAAS,SAAS,cAAc,QAAQ;AAC9C,IAAAA,EAAO,YAAY,KAAK,YAAY,MAAM,OAAO,WACjDA,EAAO,QAAQ,qBAAqB,IACpC,OAAO,OAAOA,EAAO,OAAO,KAAK,YAAY,MAAM,OAAO,KAAK;AAG/D,UAAM9B,IAAO,SAAS,cAAc,MAAM;AAC1C,IAAAA,EAAK,SAAS,UACdA,EAAK,YAAY,KAAK,YAAY,MAAM,KAAK,WAC7C,OAAO,OAAOA,EAAK,OAAO,KAAK,YAAY,MAAM,KAAK,KAAK;AAG3D,UAAM+B,IAAQ,SAAS,cAAc,OAAO;AAC5C,IAAAA,EAAM,UAAU,YAChBA,EAAM,cAAc,KAAK,YAAY,MAAM,MAAM,MACjDA,EAAM,YAAY,KAAK,YAAY,MAAM,MAAM,WAC/C,OAAO,OAAOA,EAAM,OAAO,KAAK,YAAY,MAAM,MAAM,KAAK;AAG7D,UAAMC,IAAQ,SAAS,cAAc,OAAO;AAC5C,IAAAA,EAAM,OAAO,OACbA,EAAM,KAAK,YACXA,EAAM,OAAO,OACbA,EAAM,QAAQ,KAAK,QAAA,KAAa,IAChCA,EAAM,OAAA,GACNA,EAAM,YAAY,IAClBA,EAAM,YAAY,KAAK,YAAY,MAAM,MAAM,WAC/C,OAAO,OAAOA,EAAM,OAAO,KAAK,YAAY,MAAM,MAAM,KAAK,GAC7DA,EAAM,cAAc,KAAK,YAAY,MAAM,MAAM,eAAe;AAGhE,UAAMC,IAAW,SAAS,cAAc,QAAQ;AAChD,IAAAA,EAAS,OAAO,UAChBA,EAAS,YAAY,KAAK,YAAY,MAAM,QAAQ,OAAO,MAC3DA,EAAS,YAAY,KAAK,YAAY,MAAM,QAAQ,OAAO,WAC3D,OAAO,OAAOA,EAAS,OAAO,KAAK,YAAY,MAAM,QAAQ,OAAO,KAAK;AAGzE,UAAM1B,IAAe,SAAS,cAAc,QAAQ;AACpD,IAAAA,EAAa,OAAO,UACpBA,EAAa,YAAY,KAAK,YAAY,MAAM,QAAQ,OAAO,MAC/DA,EAAa,YAAY,KAAK,YAAY,MAAM,QAAQ,OAAO,WAC/D,OAAO,OAAOA,EAAa,OAAO,KAAK,YAAY,MAAM,QAAQ,OAAO,KAAK;AAG7E,UAAM2B,IAAe,SAAS,cAAc,QAAQ;AACpD,IAAAA,EAAa,OAAO,UACpBA,EAAa,YAAY,KAAK,YAAY,MAAM,QAAQ,OAAO,MAC/DA,EAAa,YAAY,KAAK,YAAY,MAAM,QAAQ,OAAO,WAC/D,OAAO,OAAOA,EAAa,OAAO,KAAK,YAAY,MAAM,QAAQ,OAAO,KAAK,GAG7ElC,EAAK,YAAY+B,CAAK,GACtB/B,EAAK,YAAYgC,CAAK,GACtBhC,EAAK,YAAYiC,CAAQ,GACzBjC,EAAK,YAAYkC,CAAY,GAC7BlC,EAAK,YAAYO,CAAY,GAC7BuB,EAAO,YAAY9B,CAAI;AAGvB,UAAMmC,IAAa,SAAS,cAAc,KAAK;AAC/C,WAAAA,EAAW,YAAY,KAAK,YAAY,MAAM,WAAW,aAAa,IACtE,OAAO,OAAOA,EAAW,OAAO,KAAK,YAAY,MAAM,WAAW,KAAK,GAEhE;AAAA,MACH,QAAAL;AAAA,MACA,YAAAK;AAAA,MACA,MAAAnC;AAAA,MACA,OAAA+B;AAAA,MACA,OAAAC;AAAA,MACA,UAAAC;AAAA,MACA,cAAA1B;AAAA,MACA,cAAA2B;AAAA,IAAA;AAAA,EAER;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAcQ,iBAAiB,CAACJ,MAAoC;AAC1D,UAAMM,IAAc,KAAK,UAAU,QAAQ,sBAAA,GACrCC,IAAY,KAAK,UAAU,MAAM,KAAK,sBAAA,GACtCC,IAAmBR,EAAO,cAAc,sBAAA,KAA2B,EAAE,KAAK,GAAG,MAAM,EAAA,GAEnFS,IAAcT,EAAO,aACrBU,IAAeV,EAAO;AAG5B,QAAIrJ,IAAO2J,EAAY,OAAOA,EAAY,QAAQ,IAAIG,IAAc,IAAID,EAAiB,MACrF5J,IAAM0J,EAAY,MAAMA,EAAY,SAAS,IAAII,IAAe,IAAIF,EAAiB;AAGzF,UAAMG,IAAUJ,EAAU,OAAOC,EAAiB,MAC5CI,IAAUL,EAAU,QAAQE,IAAcD,EAAiB;AACjE,IAAA7J,IAAO,KAAK,IAAI,KAAK,IAAIA,GAAMgK,CAAO,GAAGC,CAAO;AAEhD,UAAMC,IAASN,EAAU,MAAMC,EAAiB,KAC1CM,IAASP,EAAU,SAASG,IAAeF,EAAiB;AAClE,IAAA5J,IAAM,KAAK,IAAI,KAAK,IAAIA,GAAKiK,CAAM,GAAGC,CAAM,GAG5Cd,EAAO,MAAM,WAAW,YACxBA,EAAO,MAAM,OAAO,GAAGrJ,CAAI,MAC3BqJ,EAAO,MAAM,MAAM,GAAGpJ,CAAG;AAAA,EAC7B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQA,gBAAgB,MAAY;AACxB,IAAI,KAAK,OAAO,QAAQ,QAAM,KAAK,MAAM,OAAO,MAAA,GAChD,KAAK,OAAO,QAAQ,OAAA,GAChB,KAAK,OAAO,cACZ,KAAK,MAAM,WAAW,OAAA,GAC1B,KAAK,sBAAA,GACL,KAAK,QAAQ;AAAA,EACjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAUQ,qBAAqB,CAACV,MAAuB;AACjD,IAAAA,EAAM,eAAA;AACN,UAAMgI,IAAOhI,EAAM,QAEb6K,IADW,IAAI,SAAS7C,CAAI,EACZ,IAAI,KAAK,EAAa,KAAA;AAC5C,IAAI,KAAK,SACL,QAAQ,MAAM,uCAAuC6C,CAAG,GAExD,KAAK,gBACDA,IACA,KAAK,UAAUA,CAAG,IAElB,KAAK,WAAA;AAAA,EAGjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAWA,UAAU,MAAW;AACjB,UAAM/H,IAAO,KAAK;AAClB,QAAI,CAACA,KAAQ,CAACA,EAAK,QAAS,QAAO;AACnC,UAAMxF,IAAQ,KAAK,UAAU,MAAM,SAASwF,CAAI,GAC1CnB,IAAU,KAAK,UAAU,MAAM,UAAUrE,GAAO,GAAG,KAAK,UAAU,MAAM,QAAQ,MAAM;AAC5F,WAAI,KAAK,SACL,QAAQ,MAAM,uCAAuCqE,CAAO,GAEzDA,EAAQ,QAAQ;AAAA,EAC3B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAWA,aAAa,MAAY;AACrB,UAAMW,IAAY,KAAK;AACvB,QAAI,CAACA,KAAa,CAACA,EAAU,QAAS;AACtC,QAAIwI,IAAcxI,EAAU;AAE5B,WAAOwI,KAAe,OAAOA,EAAY,WAAY,cAAY;AAE7D,UADgBA,EAAY,QAAA,EAChB,MAAM;AACd,QAAAA,EAAY,OAAO,QAAQ,IAAI;AAC/B;AAAA,MACJ;AACA,MAAAA,IAAcA,EAAY;AAAA,IAC9B;AACA,IAAI,KAAK,SACL,QAAQ,MAAM,yDAAyDA,CAAW,GAEtF,KAAK,cAAA,GACL,KAAK,cAAc,WAAW;AAAA,EAClC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASA,YAAY,CAACD,MAAsB;AAC/B,IAAIA,MAAQ,KAAK,cACb,KAAK,WAAA,GACL,KAAK,aAAa,OAAO,QAAQA,CAAG,GACpC,KAAK,cAAc,WAAY,CAAC,CAACA,IAErC,KAAK,cAAA;AAAA,EACT;AACJ;ACpZA,MAAqBE,UAAkBxE,EAAS;AAAA,EAC9C;AAAA,EAEA,YAAY5J,GAA0B;AACpC,UAAMA,CAAS,GACf,KAAK,MAAM;AAAA,EACb;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,OAAO,MAAY;AACjB,SAAK,UAAU,MAAM,KAAK,iBAAiB,SAAS,KAAK,OAAO;AAAA,EAClE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAYA,aAAa,MAAqB;AAChC,UAAM6J,IAAU,MAAM,WAAA;AACtB,WAAI,KAAK,UAAU,QAAQ,MAAM,YAAY,iBAC3CA,EAAQ,KAAK,IAAIqD,EAAW,KAAK,SAAS,CAAC,GAEzC,KAAK,UAAU,QAAQ,MAAM,qBAC/BrD,EAAQ,KAAK,IAAIkB,EAAgB,KAAK,SAAS,CAAC,GAE9C,KAAK,UAAU,QAAQ,MAAM,mBAAmBc,EAAe,yBAAyB,KAAK,GAAG,KAClGhC,EAAQ,KAAK,IAAIgC,EAAe,KAAK,SAAS,CAAC,GAE1ChC;AAAA,EACT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,mBAAmB,MACV,KAAK;AAAA;AAAA;AAAA;AAAA;AAAA,EAOd,SAAS,MAAY;AACnB,SAAK,MAAM;AAAA,EACb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAUA,UAAU,CAACxG,MAA4B;AACrC,UAAMgL,IAAKhL,EAAM;AACjB,IAAI,KAAK,UAAU,WAAWgL,aAAc,qBAE1ChL,EAAM,yBAAA,GACNA,EAAM,eAAA,GACN,KAAK,MAAMgL,GACX,KAAK,UAAU,KAAK,IAAI;AAAA,EAE5B;AACF;AC5FA,MAAMC,IAAkB,sVAClBC,IAAe,qvBACfC,IAAiB,0kBAEVC,IAA0B;AAAA,EACrC,OAAO;AAAA,IACLL;AAAA,IACAtD;AAAA,EAAA;AAAA,EAEF,SAAS;AAAA,IACP,WAAW;AAAA,IACX,OAAO;AAAA,MACL,UAAU;AAAA,MACV,WAAW;AAAA,MACX,QAAQ;AAAA,MACR,iBAAiB;AAAA,MACjB,UAAU;AAAA,MACV,QAAQ;AAAA,IAAA;AAAA,IAEV,eAAe;AAAA,MACb,UAAU;AAAA,MACV,OAAO;AAAA,MACP,iBAAiB;AAAA,MACjB,KAAK;AAAA,MACL,MAAM;AAAA,MACN,WAAW;AAAA,MACX,SAAS;AAAA,MACT,UAAU;AAAA,MACV,UAAU;AAAA,MACV,SAAS;AAAA,MACT,YAAY;AAAA,IAAA;AAAA,EACd;AAAA,EAEF,OAAO;AAAA,IACL,eAAe;AAAA,IACf,YAAY,CAAC,QAAQ,UAAU,OAAO;AAAA,EAAA;AAAA,EAExC,QAAQ;AAAA,IACN,eAAe;AAAA,IACf,uBAAuB;AAAA,IACvB,yBAAyB;AAAA,IACzB,iBAAiB;AAAA,IACjB,aAAa;AAAA,MACX,UAAU;AAAA,MACV,QAAQ;AAAA,MACR,OAAO;AAAA,MACP,iBAAiB;AAAA,MACjB,QAAQ;AAAA,MACR,WAAW;AAAA,MACX,SAAS;AAAA,MACT,QAAQ;AAAA,IAAA;AAAA,IAEV,iBAAiB;AAAA,IACjB,gBAAgB;AAAA,EAAA;AAAA,EAElB,QAAQ;AAAA,IACN,qBAAqB;AAAA,EAAA;AAAA,EAEvB,SAAS;AAAA,IACP,OAAO;AAAA,MACL,MAAM;AAAA,MACN,QAAQ;AAAA,MACR,OAAO;AAAA,MACP,WAAW;AAAA,MACX,YAAY;AAAA,MACZ,UAAU;AAAA,MACV,MAAM;AAAA,IAAA;AAAA,IAER,UAAU;AAAA,MACR,MAAM;AAAA,MACN,QAAQ;AAAA,MACR,OAAO;AAAA,MACP,WAAW;AAAA,MACX,YAAY;AAAA,MACZ,UAAU;AAAA,MACV,MAAM;AAAA,IAAA;AAAA,IAER,eAAe;AAAA,IACf,WAAW;AAAA,MACT,UAAU;AAAA,MACV,SAAS;AAAA,MACT,KAAK;AAAA,MACL,OAAO;AAAA,MACP,MAAM;AAAA,MACN,WAAW;AAAA,MACX,gBAAgB;AAAA,MAChB,UAAU;AAAA,MACV,OAAO;AAAA,MACP,QAAQ;AAAA,IAAA;AAAA,IAEV,iBAAiB;AAAA,IACjB,aAAa;AAAA,MACX,SAAS;AAAA,MACT,OAAO;AAAA,MACP,QAAQ;AAAA,MACR,YAAY;AAAA,MACZ,QAAQ;AAAA,MACR,QAAQ;AAAA,MACR,QAAQ;AAAA,IAAA;AAAA,IAEV,yBAAyB;AAAA,IACzB,qBAAqB;AAAA,MACnB,QAAQ;AAAA,IAAA;AAAA,IAEV,UAAU;AAAA,MACR,SAAS;AAAA,MACT,OAAO;AAAA,MACP,QAAQ;AAAA,MACR,YAAY;AAAA,MACZ,eAAe;AAAA,IAAA;AAAA,EACjB;AAAA,EAEF,OAAO;AAAA,IACL,mBAAmB;AAAA,IACnB,wBAAwB;AAAA,IACxB,uBAAuB;AAAA,IACvB,sBAAsB;AAAA,MACpB,QAAQ;AAAA,QACN,iBAAiB;AAAA,UACf,UAAU;AAAA,UACV,KAAK;AAAA,UACL,MAAM;AAAA,UACN,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,iBAAiB;AAAA,UACjB,SAAS;AAAA,UACT,YAAY;AAAA,UACZ,gBAAgB;AAAA,UAChB,QAAQ;AAAA,QAAA;AAAA,QAEV,gBAAgB;AAAA,UACd,iBAAiB;AAAA,UACjB,SAAS;AAAA,UACT,cAAc;AAAA,UACd,UAAU;AAAA,UACV,OAAO;AAAA,UACP,UAAU;AAAA,UACV,WAAW;AAAA,QAAA;AAAA,QAEb,OAAO;AAAA,UACL,SAAS;AAAA,UACT,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,UAAU;AAAA,QAAA;AAAA,QAEZ,UAAU;AAAA,UACR,iBAAiB;AAAA,UACjB,UAAU;AAAA,UACV,SAAS;AAAA,UACT,QAAQ;AAAA,UACR,OAAO;AAAA,UACP,SAAS;AAAA,UACT,QAAQ;AAAA,UACR,cAAc;AAAA,UACd,WAAW;AAAA,QAAA;AAAA,QAEb,cAAc;AAAA,UACZ,SAAS;AAAA,UACT,YAAY;AAAA,UACZ,WAAW;AAAA,UACX,QAAQ;AAAA,UACR,QAAQ;AAAA,UACR,SAAS;AAAA,UACT,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,OAAO;AAAA,QAAA;AAAA,QAET,cAAc;AAAA,UACZ,SAAS;AAAA,UACT,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,UAAU;AAAA,UACV,SAAS;AAAA,UACT,KAAK;AAAA,UACL,OAAO;AAAA,UACP,YAAY;AAAA,UACZ,QAAQ;AAAA,UACR,cAAc;AAAA,UACd,QAAQ;AAAA,UACR,YAAY;AAAA,UACZ,OAAO;AAAA,QAAA;AAAA,MACT;AAAA,MAEF,OAAO;AAAA,QACL,cAAcyD;AAAA,QACd,cAAcD;AAAA,MAAA;AAAA,MAEhB,QAAQ;AAAA,QACN,KAAK;AAAA,QACL,OAAO;AAAA,MAAA;AAAA,IACT;AAAA,IAEF,iBAAiB;AAAA,IACjB,mBAAmB;AAAA,MACjB,aAAa;AAAA,MACb,QAAQ;AAAA,QACN,iBAAiB;AAAA,UACf,UAAU;AAAA,UACV,KAAK;AAAA,UACL,MAAM;AAAA,UACN,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,iBAAiB;AAAA,UACjB,SAAS;AAAA,UACT,YAAY;AAAA,UACZ,gBAAgB;AAAA,UAChB,QAAQ;AAAA,QAAA;AAAA,QAEV,gBAAgB;AAAA,UACd,iBAAiB;AAAA,UACjB,QAAQ;AAAA,UACR,WAAW;AAAA,UACX,SAAS;AAAA,UACT,cAAc;AAAA,UACd,UAAU;AAAA,UACV,UAAU;AAAA,UACV,WAAW;AAAA,UACX,YAAY;AAAA,QAAA;AAAA,QAEd,iBAAiB;AAAA,UACf,qBAAqB;AAAA,UACrB,SAAS;AAAA,UACT,KAAK;AAAA,UACL,cAAc;AAAA,UACd,WAAW;AAAA,UACX,YAAY;AAAA,QAAA;AAAA,QAEd,SAAS;AAAA,UACP,OAAO;AAAA,UACP,QAAQ;AAAA,UACR,SAAS;AAAA,UACT,iBAAiB;AAAA,UACjB,QAAQ;AAAA,UACR,QAAQ;AAAA,QAAA;AAAA,MACV;AAAA,MAEF,SAAS;AAAA,QACP,UAAU;AAAA,UACR,WAAW;AAAA,UACX,OAAO;AAAA,YACL,OAAO;AAAA,UAAA;AAAA,QACT;AAAA,QAEF,QAAQ;AAAA,UACN,WAAW;AAAA,UACX,OAAO;AAAA,YACL,OAAO;AAAA,UAAA;AAAA,QACT;AAAA,QAEF,UAAU;AAAA,UACR,WAAW;AAAA,UACX,OAAO;AAAA,YACL,OAAO;AAAA,UAAA;AAAA,QACT;AAAA,MACF;AAAA,MAEF,MAAM;AAAA,QACJ,QAAQ;AAAA,QACR,UAAU;AAAA,QACV,cAAc;AAAA,QACd,aAAa;AAAA,MAAA;AAAA,MAEf,OAAO;AAAA,QACL,QAAQ,0CAA0CA,CAAe;AAAA,QACjE,UAAUE;AAAA,QACV,UAAUD;AAAA,MAAA;AAAA,IACZ;AAAA,IAEF,aAAa;AAAA,MACX,eAAe;AAAA,MACf,OAAO;AAAA,QACL,QAAQ;AAAA,UACN,WAAW;AAAA,UACX,OAAO;AAAA;AAAA,YACL,QAAQ;AAAA,YACR,iBAAiB;AAAA,YACjB,QAAQ;AAAA,YACR,WAAW;AAAA,YACX,OAAO;AAAA,YACP,SAAS;AAAA,YACT,YAAY;AAAA,YACZ,cAAc;AAAA,YACd,UAAU;AAAA,YACV,UAAU;AAAA,YACV,UAAU;AAAA,YACV,QAAQ;AAAA;AAAA,UAAA;AAAA,QACV;AAAA,QAEF,YAAY;AAAA,UACV,WAAW;AAAA,UACX,OAAO;AAAA,YACL,UAAU;AAAA,YACV,OAAO;AAAA,YACP,YAAY;AAAA,YACZ,QAAQ;AAAA,UAAA;AAAA,QACV;AAAA,QAEF,MAAM;AAAA,UACJ,WAAW;AAAA,UACX,OAAO;AAAA,YACL,SAAS;AAAA,YACT,UAAU;AAAA,YACV,WAAW;AAAA,YACX,YAAY;AAAA,YACZ,QAAQ;AAAA,UAAA;AAAA,QACV;AAAA,QAEF,OAAO;AAAA,UACL,WAAW;AAAA,UACX,OAAO;AAAA,YACL,cAAc;AAAA,YACd,UAAU;AAAA,UAAA;AAAA,UAEZ,MAAM;AAAA,QAAA;AAAA,QAER,OAAO;AAAA,UACL,WAAW;AAAA,UACX,OAAO;AAAA,YACL,QAAQ;AAAA,YACR,cAAc;AAAA,YACd,WAAW;AAAA,YACX,UAAU;AAAA,YACV,QAAQ;AAAA,YACR,QAAQ;AAAA,YACR,SAAS;AAAA,YACT,OAAO;AAAA,YACP,SAAS;AAAA,UAAA;AAAA,UAEX,aAAa;AAAA,QAAA;AAAA,QAEf,SAAS;AAAA,UACP,QAAQ;AAAA,YACN,WAAW;AAAA,YACX,OAAO;AAAA,cACL,QAAQ;AAAA,cACR,cAAc;AAAA,cACd,SAAS;AAAA,cACT,QAAQ;AAAA,cACR,YAAY;AAAA,cACZ,OAAO;AAAA,cACP,QAAQ;AAAA,cACR,OAAO;AAAA,cACP,SAAS;AAAA,cACT,cAAc;AAAA,cACd,gBAAgB;AAAA,YAAA;AAAA,YAElB,MAAM;AAAA,YACN,SAAS;AAAA,UAAA;AAAA,UAEX,QAAQ;AAAA,YACN,WAAW;AAAA,YACX,OAAO;AAAA,cACL,SAAS;AAAA,cACT,OAAO;AAAA,cACP,QAAQ;AAAA,cACR,UAAU;AAAA,cACV,KAAK;AAAA,cACL,OAAO;AAAA,cACP,SAAS;AAAA,cACT,YAAY;AAAA,cACZ,QAAQ;AAAA,cACR,cAAc;AAAA,cACd,QAAQ;AAAA,cACR,YAAY;AAAA,cACZ,OAAO;AAAA,YAAA;AAAA,YAET,MAAMD;AAAA,YACN,SAAS;AAAA,UAAA;AAAA,UAEX,QAAQ;AAAA,YACN,WAAW;AAAA,YACX,OAAO;AAAA,cACL,QAAQ;AAAA,cACR,SAAS;AAAA,cACT,QAAQ;AAAA,cACR,YAAY;AAAA,cACZ,OAAO;AAAA,cACP,QAAQ;AAAA,cACR,MAAM;AAAA,cACN,SAAS;AAAA,cACT,cAAc;AAAA,cACd,gBAAgB;AAAA,YAAA;AAAA,YAElB,MAAM;AAAA,YACN,SAAS;AAAA,UAAA;AAAA,QACX;AAAA,MACF;AAAA,IACF;AAAA,IAEF,YAAY;AAAA,EAAA;AAAA,EAEd,OAAO;AAAA,IACL,UAAU;AAAA,IACV,yBAAyB;AAAA,IACzB,sBAAsB;AAAA,IACtB,oBAAoB;AAAA,IACpB,YAAY,CAAA;AAAA,EAAC;AAEjB,GCpYMI,KAAY,CAAC/L,GAAyBb,MAAuBA;AA0DnE,MAAqB6M,GAAc;AAAA,EACjC;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACQ,WAAoB;AAAA,EACpB,UAAkB;AAAA;AAAA,EAClB,UAAkB;AAAA,EAClB;AAAA,EACA;AAAA,EACA;AAAA,EACR;AAAA,EACA;AAAA,EAEA,YAAYlO,GAAYiB,IAA4B,IAAI;AACtD,SAAK,QAAQjB,EAAM,aACnB,KAAK,QAAQA,GACb,KAAK,cAAc,MACnB,KAAK,UAAU,CAAA,GACXiB,EAAQ,UACT,OAAe,gBAAgB;AAIlC,UAAMkN,IAAkBnJ,EAA2B,KAAK,KAAK,GACvDoJ,IAAmB1J,EAA4B,KAAK,KAAK;AAG/D,SAAK,aAAa,IAAIyJ,EAAgBlN,EAAQ,KAAK,GACnD,KAAK,cAAc,IAAImN,EAAiBnN,EAAQ,KAAK,GAGjDA,EAAQ,SAAO,QAAQ,MAAM,oCAAoC,KAAK,YAAY,KAAK,WAAW,GACtG,KAAK,MAAM,SAAS;AAAA,MAClB,sBAAsB,KAAK;AAAA,MAC3B,gCAAgC,KAAK;AAAA,MACrC,uBAAuB,KAAK;AAAA,MAC5B,iCAAiC,KAAK;AAAA,IAAA,GACrC,EAAI,GAGP,KAAK,UAAUC,EAAU8M,GAAgB/M,GAAS,EAAE,YAAYgN,IAAW,GACvEhN,EAAQ,SAAO,QAAQ,MAAM,yBAAyB,KAAK,OAAO,GAGtE,KAAK,WAAW,EAAE,KAAK,MAAM,QAAQ,YAAY,KAAK,MAAM,UAAU,UAAU,SAAS,aAAa;AACtG,UAAMkF,IAAQ,SAAS,cAAc,OAAO;AAC5C,IAAAA,EAAM,YAAY,8DAClB,SAAS,KAAK,YAAYA,CAAK,GAG/B,CAAC,KAAK,SAAS,KAAK,QAAQ,IAAI,KAAK,eAAA,GACrC,KAAK,mBAAA,GAEL,KAAK,UAAU,IAAIxD,EAAQ,IAAI,GAC3B1B,EAAQ,SAAO,QAAQ,MAAM,yBAAyB,KAAK,OAAO,GAEtE,KAAK,QAAQ,KAAK,QAAQ,MAAM;AAAA,MAC9B,CAACoN,MAA0D,IAAIA,EAAU,IAAI;AAAA,IAAA,GAE/E,KAAK,MAAM,QAAQ,CAAAC,MAAQA,EAAK,MAAM,GAClCrN,EAAQ,SAAO,QAAQ,MAAM,uBAAuB,KAAK,KAAK,GAElE,KAAK,MAAM,UAAU,MAAM,WAAW,KAAK,MAAM,UAAU,MAAM,YAAY,YAE7E,KAAK,qBAAA,GAEL,KAAK,kBAAA,GAED,KAAK,QAAQ,SAAO,QAAQ,MAAM,kBAAkB,KAAK,QAAQ,SAAS,sBAAsB,GAChG,KAAK,QAAQ,SAAS,2BACxB,KAAK,0BAA0B,IAAI+B,EAAuB,KAAK,OAAO,KAAK,QAAQ,KAAK;AAAA,EAG5F;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQA,UAAU,MAAY;AACpB,QAAI;AACF,WAAK,KAAA,GACL,KAAK,sBAAA,GACL,KAAK,gBAAA,GACL,KAAK,SAAS,QAAA,GAGV,KAAK,SAAS,cAChB,KAAK,QAAQ,WAAW,YAAY,KAAK,OAAO,GAIlD,KAAK,cAAc,MACnB,KAAK,QAAQ,CAAA,GACb,KAAK,UAAU,CAAA,GAEX,KAAK,QAAQ,SAAS,0BAA0B,KAAK,2BACvD,KAAK,yBAAyB,QAAA,GAI3B,OAAe,OAAO,QACzB,OAAQ,OAAe,IAGzB,KAAK,QAAQ,MACT,KAAK,QAAQ,SAAO,QAAQ,MAAM,yBAAyB;AAAA,IACjE,SAASqE,GAAO;AACd,cAAQ,MAAM,gCAAgCA,CAAK;AAAA,IACrD;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAUA,IAAI,UAAmB;AACrB,WAAO,KAAK;AAAA,EACd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAYA,IAAI,QAAQ9G,GAAgB;AAC1B,IAAKA,KAAO,KAAK,KAAA,GACjB,KAAK,WAAWA;AAAA,EAClB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAyBQ,sBAAsB,IAAI,iBAAiB,CAAAwD,MAAa;AAC9D,IAAAA,EAAU,QAAQ,CAAAwK,MAAY;AAC5B,MAAIA,EAAS,SAAS,gBAAgBA,EAAS,kBAAkB,YAC/D,KAAK,UAAU,CAAC,KAAK,MAAM,UAAU,UAAU,SAAS,aAAa;AAAA,IAEzE,CAAC;AAAA,EACH,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAqBD,OAAO,CAACD,MAAyB;AAC/B,QAAI;AAEF,UAAI,CAAC,KAAK,QAAS;AAEnB,WAAK,MAAM,UAAU,iBAAiB,6BAA6B,EAAE;AAAA,QACnE,CAACrL,MAAyB;AACxB,UAAAA,EAAQ,UAAU,IAAI,WAAW;AAAA,QACnC;AAAA,MAAA,GAGE,KAAK,QAAQ,UAAQ,OAAe,gBAAgB,OAExD,KAAK,KAAA,GACL,KAAK,cAAcqL,GACnB,KAAK,YAAY,aAAA,GACjB,KAAK,eAAe,MAAM,GAC1B,KAAK,MAAM,UAAU,YAAY,KAAK,OAAO,GAC7C,KAAK,mBAAA,GACL,KAAK,eAAeA,CAAI,GACxB,KAAK,QAAQ,OAAA,GACb,KAAK,uBAAuB,KAAK,QAAQ,OAAO,GAChD,SAAS,iBAAiB,eAAe,KAAK,sBAAsB,GAChE,KAAK,QAAQ,SAAO,QAAQ,MAAM,sBAAsBA,CAAI;AAAA,IAClE,SAASjH,GAAO;AACd,oBAAQ,MAAM,gCAAgCA,CAAK,GACnD,KAAK,KAAA,GAECA;AAAA,IACR;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAYA,OAAO,CAACzE,IAA6B,SAAe;AAClD,QAAI,KAAK,aAAa;AACpB,UAAIA,GAAO;AACT,cAAM3C,IAAa,KAAK,YAAa,cAAA;AACrC,YAAIA,GAAY;AACd,gBAAM2G,IAAW,KAAK,kBAAkBhE,CAAK;AAC7C,UAAIgE,MAAa,UACX,KAAK,QAAQ,SAAO,QAAQ,MAAM,sBAAsB,GAC5DpH,EAAY,qBAAqB,KAAK,OAAOS,CAAU,KAC9C2G,MAAa,YAClB,KAAK,QAAQ,SAAO,QAAQ,MAAM,uBAAuB,GAC7DpH,EAAY,oBAAoB,KAAK,OAAOS,CAAU;AAAA,QAE1D;AAAA,MACF;AACA,WAAK,YAAY,OAAA,GACjB,KAAK,cAAc,MACnB,KAAK,MAAM,UAAU,YAAY,KAAK,OAAO,GAC7C,SAAS,oBAAoB,eAAe,KAAK,sBAAsB,GACvE,KAAK,QAAQ,MAAM,YAAY,WAAW,MAAM,GAChD,KAAK,eAAe,EAAE,GACtB,KAAK,gBAAA,GACL,KAAK,QAAQ,QAAA,GAEb,KAAK,MAAM,QAAQ;AAAA,QACjB,KAAK,MAAM,YAAY,OAAO;AAAA,QAAa;AAAA,QAAG,KAAK,MAAM,UAAA;AAAA,QAAa;AAAA,MAAA;AAAA,IAE1E;AACA,IAAI,KAAK,QAAQ,SAAO,QAAQ,MAAM,oBAAoB;AAAA,EAC5D;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAWA,SAAS,MAAY;AACnB,SAAK,mBAAA,GACL,KAAK,QAAQ,QAAQ,CAAA6C,MAAUA,EAAO,UAAU,GAC5C,KAAK,QAAQ,SAAO,QAAQ,MAAM,sBAAsB;AAAA,EAC9D;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAWQ,iBAAiB,CAACwL,MAAyB;AACjD,SAAK,UAAUA,EAAK,WAAA,EAAa,IAAI,CAACxL,OACpCA,EAAO,SAAA,GACH,KAAK,QAAQ,SAAO,QAAQ,MAAM,gCAAgCA,CAAM,GACrEA,EACR;AAAA,EACH;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQQ,kBAAkB,MAAY;AACpC,SAAK,QAAQ,QAAQ,CAACA,MAAmBA,EAAO,WAAW,GAC3D,KAAK,UAAU,CAAA,GACX,KAAK,QAAQ,SAAO,QAAQ,MAAM,iCAAiC;AAAA,EACzE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAUQ,iBAAiB,MAAkC;AACzD,UAAM0L,IAAU,SAAS,cAAc,KAAK;AAE5C,IAAAA,EAAQ,UAAU,IAAI,KAAK,QAAQ,QAAQ,SAAS,GAChD,KAAK,QAAQ,QAAQ,SACvB,OAAO,OAAOA,EAAQ,OAAO,KAAK,QAAQ,QAAQ,KAAK,GAGzDA,EAAQ,MAAM,aAAa,QAC3BA,EAAQ,MAAM,YAAY,uBAAuB,MAAM,GACvDA,EAAQ,MAAM,YAAY,oBAAoB,MAAM,GACpDA,EAAQ,MAAM,YAAY,mBAAmB,MAAM;AAEnD,UAAMC,IAAW,SAAS,cAAc,KAAK;AAC7C,WAAI,KAAK,QAAQ,QAAQ,iBACvB,OAAO,OAAOA,EAAS,OAAO,KAAK,QAAQ,QAAQ,aAAa,GAElED,EAAQ,YAAYC,CAAQ,GACxB,KAAK,QAAQ,iBAAe,MAAM,iCAAiCD,GAASC,CAAQ,GACjF,CAACD,GAASC,CAAQ;AAAA,EAC3B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAWQ,yBAAyB,OAAOC,MAA+C;AACrF,QAAIC,IAAcD,EAAe,sBAAA;AACjC,UAAMzB,IAAY,KAAK,MAAM,UAAU,sBAAA,GAEjC1G,IAAgB,KAAK,aAAa,iBAAA;AACxC,IAAIoI,EAAY,MAAM1B,EAAU,MAAM,KAChC1G,MAEF,MAAM,KAAK,0BAA0BA,GAAeoI,EAAY,MAAM,GAEtEA,IAAcD,EAAe,sBAAA,IAI7BC,EAAY,MAAM,MAChB,KAAK,QAAQ,SACf,QAAQ,MAAM,oBAAoBA,EAAY,MAAMA,EAAY,MAAM,+BAA+B,GAEvG,OAAO,SAAS,EAAE,KAAKA,EAAY,MAAMA,EAAY,QAAQ,UAAU,UAAU;AAAA,EAErF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAYQ,4BAA4B,CAACf,GAAiBgB,IAAS,OACtD,IAAI,QAAQ,CAACC,MAAY;AAC9B,QAAIC,IAAmC;AAEvC,aAASC,IAAWnB,EAAG,eAAemB,GAAUA,IAAWA,EAAS,eAAe;AACjF,YAAM,EAAE,WAAAC,EAAA,IAAc,iBAAiBD,CAAQ;AAC/C,UAAI,CAAC,CAAC,QAAQ,QAAQ,EAAE,SAASC,CAAS,KAAKD,EAAS,gBAAgBA,EAAS,aAAc;AAE/F,YAAM3L,IAAgB2L,EAAS,sBAAA,GACzBE,IAASrB,EAAG,sBAAA;AAElB,UAAIqB,EAAO,MAAM7L,EAAc,MAAMwL,GAAQ;AAC3C,QAAAE,IAAmBC,GACnBA,EAAS,SAAS;AAAA,UAChB,KAAKA,EAAS,YAAYE,EAAO,MAAM7L,EAAc,MAAMwL;AAAA,QAAA,CAC5D,GACG,KAAK,QAAQ,SACf,QAAQ,MAAM,sBAAsBG,EAAS,OAAO,2CAA2CH,CAAM,IAAI;AAE3G;AAAA,MACF;AAAA,IACF;AAEA,IAAIE,IAgBF,WAduB,MAAM;AAC3B,UAAII,IAAgBJ,EAAkB;AACtC,YAAMK,IAAgB,YAAY,MAAM;AACtC,QAAIL,EAAkB,cAAcI,KAElC,cAAcC,CAAa,GAC3BN,EAAA,KAEAK,IAAgBJ,EAAkB;AAAA,MAEtC,GAAG,EAAE;AAAA,IACP,GAG2B,GAAG,IAG9BD,EAAA;AAAA,EAEJ,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAoBK,qBAAqB,MAAY;AACvC,SAAK,mBAAmB,IAAI,gBAAA;AAC5B,UAAM,EAAE,QAAAO,MAAW,KAAK;AAIxB,SAAK,QAAQ,iBAAiB,SAAS,KAAK,wBAAwB,EAAE,SAAS,IAAO,QAAAA,GAAQ,GAC9F,KAAK,QAAQ,iBAAiB,cAAc,KAAK,qBAAqB,EAAE,SAAS,IAAO,QAAAA,GAAQ,GAChG,KAAK,QAAQ,iBAAiB,aAAa,KAAK,oBAAoB,EAAE,SAAS,IAAO,QAAAA,GAAQ,GAE9F,KAAK,QAAQ,iBAAiB,eAAe,KAAK,qBAAqB,EAAE,QAAAA,GAAQ,GAEjF,KAAK,MAAM,KAAK,iBAAiB,SAAS,KAAK,UAAU,EAAE,QAAAA,GAAQ,GAInE,KAAK,MAAM,KAAK,iBAAiB,UAAU,KAAK,oBAAoB,EAAE,QAAAA,GAAQ,GAE9E,KAAK,kBAAkB,IAAI,eAAe,KAAK,kBAAkB,GACjE,KAAK,gBAAgB,QAAQ,KAAK,MAAM,IAAI,GAG5C,KAAK,oBAAoB,QAAQ,KAAK,MAAM,WAAW;AAAA,MACrD,YAAY;AAAA,MACZ,iBAAiB,CAAC,OAAO;AAAA,IAAA,CAC1B;AAAA,EACH;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAUQ,wBAAwB,MAAY;AAC1C,SAAK,kBAAkB,MAAA,GACvB,KAAK,iBAAiB,WAAA,GACtB,KAAK,oBAAoB,WAAA;AAAA,EAC3B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOQ,sBAAsB,CAACxM,MAAuB;AACpD,IAAAA,EAAM,gBAAA,GACNA,EAAM,eAAA;AAAA,EACR;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAYQ,qBAAqB,MAAY;AACvC,QAAI,KAAK,aAAa;AACpB,YAAMyM,IAAgB,KAAK,YAAY,kBAAA;AACvC,UAAIA,GAAe;AACjB,cAAMjM,IAAyB,KAAK,MAAM,UAAU,sBAAA,GAC9CkM,IAAoBD,EAAc,sBAAA,GAClCrC,IAAyB;AAAA,UAC7B,MAAM,GAAGsC,EAAS,OAAOlM,EAAc,OAAO,IAAI,KAAK,MAAM,UAAU,UAAU;AAAA,UACjF,KAAK,GAAGkM,EAAS,MAAMlM,EAAc,MAAM,KAAK,MAAM,UAAU,SAAS;AAAA,UACzE,OAAO,GAAGkM,EAAS,KAAK;AAAA,UACxB,QAAQ,GAAGA,EAAS,MAAM;AAAA,QAAA;AAE5B,eAAO,OAAO,KAAK,QAAQ,OAAO;AAAA,UAChC,SAAS;AAAA,UACT,GAAGtC;AAAA,QAAA,CACJ,GACG,KAAK,QAAQ,SACf,QAAQ,MAAM,oCAAoC,aAAasC,GAAU,gBAAgBtC,CAAW;AAAA,MACxG;AAAA,IACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAWQ,iBAAiB,CAACzM,MAAwB;AAQhD,IAPwB;AAAA,MACtB;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,IAAA,EAGI,QAAQ,CAACgP,MAAiB;AAE9B,WAAK,MAAM,KAAK,MAAM,YAAYA,GAAMhP,CAAK,GACzC,SAAS,mBACX,SAAS,gBAAgB,MAAM,YAAYgP,GAAMhP,CAAK;AAAA,IAE1D,CAAC,GACG,KAAK,QAAQ,SAAO,QAAQ,MAAM,gCAAgCA,CAAK;AAAA,EAC7E;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAUQ,yBAAyB,CAACqC,MAA8B;AAE9D,UAAMxB,IAASwB,EAAM;AACrB,IACE,KAAK,MAAM,KAAK,WAAW,SAASxB,CAAM,KAC1CA,EAAO,QAAQ,6BAA6B,KAC5CA,EAAO,UAAU,SAAS,6BAA6B,KAEvD,KAAK,KAAKwB,CAAK;AAAA,EAEnB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAUQ,WAAW,CAACA,MAA8B;AAChD,IAAI,KAAK,QAAQ,SAAO,QAAQ,MAAM,0BAA0BA,CAAK,GACjE,KAAK,WAAS,KAAK,KAAKA,CAAK;AAAA,EACnC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAYA,yBAAyB,CAACA,MAA4B;AAEpD,SAAK,MAAM,KAAK,cAAcA,EAAM,QACpC,KAAK,MAAM,KAAK,aAAaA,EAAM,QAC/B,KAAK,QAAQ,SACf,QAAQ,MAAM,yCAAyCA,EAAM,MAAM,QAAQA,EAAM,MAAM,EAAE;AAAA,EAC7F;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASA,sBAAsB,CAACA,MAA4B;AAEjD,QAAIA,EAAM,QAAQ,WAAW,GAAG;AAC9B,YAAM4M,IAAQ5M,EAAM,QAAQ,CAAC;AAC7B,WAAK,UAAU4M,EAAM,SACrB,KAAK,UAAUA,EAAM,SACjB,KAAK,QAAQ,SACf,QAAQ,MAAM,qCAAqC,MAAM,KAAK,OAAO,QAAQ,KAAK,OAAO,EAAE;AAAA,IAC/F;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAkBA,qBAAqB,CAAC5M,MAA4B;AAChD,QAAIA,EAAM,QAAQ,WAAW,GAAG;AAC9B,YAAM4M,IAAQ5M,EAAM,QAAQ,CAAC,GACvB6E,IAAS,KAAK,UAAU+H,EAAM,SAC9BC,IAAS,KAAK,UAAUD,EAAM;AAGpC,UAAI,KAAK,IAAI/H,CAAM,IAAI,KAAK,KAAK,IAAIgI,CAAM,IAAI,EAAG;AAElD,YAAMC,IAAO,KAAK,MAAM,MAGlBC,IAAQD,EAAK,cAAc,GAC3BE,IAAWF,EAAK,YAAYA,EAAK,iBAAiBA,EAAK,cACvDG,IAASH,EAAK,eAAe,GAC7BI,IAAUJ,EAAK,aAAaA,EAAK,gBAAgBA,EAAK,aAGtDK,IAAwB,KAAK,IAAIN,CAAM,IAAI,KAAK,IAAIhI,CAAM,GAC1DuI,IAA0B,KAAK,IAAIvI,CAAM,IAAI,KAAK,IAAIgI,CAAM;AAElE,UAAIQ,IAAiB;AAGrB,MAAIF,KACE,EAAEJ,KAASF,IAAS,MAAM,EAAEG,KAAYH,IAAS,OACnDQ,IAAiB,IACjBP,EAAK,aAAaD,IAKlBO,KACE,EAAEH,KAAUpI,IAAS,MAAM,EAAEqI,KAAWrI,IAAS,OACnDwI,IAAiB,IACjBP,EAAK,cAAcjI,IAInBwI,KACFrN,EAAM,eAAA,GAIR,KAAK,UAAU4M,EAAM,SACrB,KAAK,UAAUA,EAAM,SACjB,KAAK,QAAQ,SACf,QAAQ,MAAM,kCAAkC,MAAM,KAAK,OAAO,QAAQ,KAAK,OAAO,EAAE;AAAA,IAC5F;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAcQ,uBAAuB,MAAY;AAEzC,QAAI,KAAK,QAAQ,MAAM,wBAAwB;AAC7C,YAAMU,IAAoBhM,EAA6B,KAAK,KAAK;AACjE,MAAI,KAAK,QAAQ,SAAO,QAAQ,MAAM,iCAAiCgM,CAAiB,GACxF,KAAK,MAAM,SAAS,EAAE,iBAAiBA,EAAA,GAAqB,EAAI,GAC5D,KAAK,QAAQ,SACf,QAAQ,MAAM,iCAAiC,KAAK,MAAM,OAAO,eAAe,CAAC;AAAA,IAErF;AAEA,QAAI,KAAK,QAAQ,MAAM,yBAAyB;AAC9C,YAAMC,IAAkB7K,EAA+B,KAAK,KAAK;AACjE,MAAI,KAAK,QAAQ,UACf,QAAQ,MAAM,iCAAiC6K,CAAe,GAC9D,QAAQ,MAAM,+CAA+C,KAAK,QAAQ,MAAM,kBAAkB,IAGpGA,EAAgB,cAAc,KAAK,QAAQ,MAAM,oBACjD,KAAK,MAAM,SAAS,EAAE,iBAAiBA,EAAA,GAAmB,EAAI,GAC1D,KAAK,QAAQ,SACf,QAAQ,MAAM,iCAAiC,KAAK,MAAM,OAAO,eAAe,CAAC;AAAA,IAErF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAgBQ,oBAAoB,MAAY;AAGtC,QAAI,KAAK,QAAQ,MAAM,sBAAsB;AAC3C,MAAK,KAAK,MAAM,SAAS,SAAS,cAChC,KAAK,MAAM,SAAS,SAAS,YAAY,CAAA;AAE3C,YAAMC,IAAgB;AAAA,QACpB,KAAK;AAAA,QACL,OAAO;AAAA,QACP,MAAM;AAAA,UACJ,SAAS;AAAA,YACP,SAAS;AAAA,UAAA;AAAA,QACX;AAAA,QAEF,SAAS,CAACxQ,MAAe;AACvB,eAAK,MAAM,WAAWA,EAAM,QAAQ,GAAG,GAAG,MAAM;AAAA,QAClD;AAAA,MAAA;AAEF,WAAK,MAAM,SAAS,SAAS,UAAU,QAAQwQ,CAAa,GACxD,KAAK,QAAQ,SACf,QAAQ,MAAM,kDAAkDA,CAAa;AAAA,IACjF;AAIA,QAAI,KAAK,QAAQ,MAAM,uBAAuB;AAC5C,MAAK,KAAK,MAAM,SAAS,SAAS,eAChC,KAAK,MAAM,SAAS,SAAS,aAAa,CAAA;AAE5C,YAAMC,IAAoB;AAAA,QACxB,KAAK;AAAA,QACL,WAAW;AAAA,QACX,OAAO;AAAA,QACP,QAAQ;AAAA,QACR,MAAM;AAAA,UACJ,SAAS;AAAA,YACP,SAAS;AAAA,UAAA;AAAA,QACX;AAAA,QAEF,SAAS,CAACzQ,GAAYkK,MAAiB;AACrC,gBAAM5J,IAAQN,EAAM,QAAQA,EAAM,QAC5BO,IAAiB,KAAK,MAAM,UAAA;AAClC,UAAID,IAAQ,KAAKC,IAAiB,IAEhC,KAAK,MAAM,aAAaA,IAAiB,GAAG,GAAG,MAAM,KAIrD,KAAK,MAAM,aAAaD,IAAQ,GAAG,GAAG,MAAM,GAC5CV,EAAY,cAAc,CAAC;AAAA,QAE/B;AAAA,MAAA;AAEF,WAAK,MAAM,SAAS,SAAS,WAAW,QAAQ6Q,CAAiB,GAC7D,KAAK,QAAQ,SACf,QAAQ,MAAM,sDAAsDA,CAAiB;AAAA,IACzF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAaA,eAAe,CAAC9J,MAAwC;AACtD,QAAI+J,IAAwB,KAAK,QAAQ,OAAO;AAChD,QAAI,KAAK,QAAQ,OAAO,uBAAuB;AAE7C,YAAM/M,IAAuBgD,EAAc,aAAa,OAAO;AAC/D,MAAKhD,IAGH+M,IAAe/M,EAAM,SAAS,GAAG,IAFjC+M,IAAe,KAAK,QAAQ,OAAO;AAAA,IAIvC;AACA,WAAI,KAAK,QAAQ,SACf,QAAQ,MAAM,8BAA8BA,GAAc,eAAe/J,CAAa,GAEjF+J;AAAA,EACT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAiBQ,oBAAoB,CAAC1N,MAAyC;AAEpE,UAAM2E,IADS,KAAK,QACA,sBAAA;AACpB,QAAIX;AACJ,WAAIhE,EAAM,UAAU2E,EAAK,MACvBX,IAAW,UACFhE,EAAM,UAAU2E,EAAK,SAC9BX,IAAW,UACFhE,EAAM,UAAU2E,EAAK,OAC9BX,IAAW,SACFhE,EAAM,UAAU2E,EAAK,QAC9BX,IAAW,UAEXA,IAAW,UAET,KAAK,QAAQ,SACf,QAAQ,MAAM,mCAAmCA,GAAU,aAAahE,CAAK,GAExEgE;AAAA,EACT;AACF;","x_google_ignoreList":[2]}