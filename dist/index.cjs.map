{"version":3,"file":"index.cjs","sources":["../src/actions/Action.ts","../src/actions/CaretAction.ts","../node_modules/deepmerge/dist/cjs.js","../src/actions/toolbar/Toolbar.ts","../src/tooltip/TooltipContainPosition.ts","../src/blots/Image.ts","../src/actions/align/AlignFormats.ts","../src/blots/Video.ts","../src/actions/align/DefaultAligner.ts","../src/actions/toolbar/ToolbarButton.ts","../src/actions/align/AlignAction.ts","../src/actions/DeleteAction.ts","../src/actions/ResizeAction.ts","../src/specs/BlotSpec.ts","../src/specs/UnclickableBlotSpec.ts","../src/specs/IframeVideoSpec.ts","../src/actions/AttributeAction.ts","../src/actions/CompressAction.ts","../src/actions/LinkAction.ts","../src/specs/ImageSpec.ts","../src/DefaultOptions.ts","../src/BlotFormatter.ts"],"sourcesContent":["import BlotFormatter from '../BlotFormatter';\nimport ToolbarButton from './toolbar/ToolbarButton';\n\n/**\n * Represents a base class for actions used within the BlotFormatter.\n * \n * This class provides a structure for actions that can be performed by the formatter,\n * including lifecycle hooks for creation, destruction, and updates. Subclasses should\n * override the lifecycle methods as needed.\n * \n * @remarks\n * - Each action holds a reference to the parent `BlotFormatter` instance.\n * - Actions can define their own toolbar buttons by populating the `toolbarButtons` array.\n * - Debug logging is available if the formatter's options enable it.\n * \n * @example\n * ```typescript\n * class CustomAction extends Action {\n *   onCreate = (): void => {\n *     // Custom initialization logic\n *   }\n *   onDestroy = (): void => {\n *     // Custom destruction logic\n *   }\n *   onUpdate = (): void => {\n *     // Custom update logic\n *   }\n * }\n * ```\n * \n * @public\n */\nexport default class Action {\n  formatter: BlotFormatter;\n  toolbarButtons: ToolbarButton[] = [];\n  debug: boolean;\n\n  constructor(formatter: BlotFormatter) {\n    this.formatter = formatter;\n    this.debug = this.formatter.options.debug || false;\n    if (this.debug) console.debug('Action created:', this.constructor.name);\n  }\n\n  /**\n   * Called when the action is created.\n   * Override this method to implement custom initialization logic.\n   */\n  onCreate = (): void => {}\n\n  /**\n   * Called when the action is being destroyed.\n   * Override this method to implement custom cleanup logic.\n   */\n  onDestroy = (): void => {}\n\n  /**\n   * Called when the action should be updated.\n   * Override this method to implement custom update logic.\n   */\n  onUpdate = (): void => {}\n\n}\n","import Action from './Action';\nimport { Blot } from '../specs/BlotSpec';\n\n/**\n * Provides caret (text cursor) manipulation actions for the Quill editor, including moving the caret\n * backward, placing the caret before or after a specified blot, and handling keyboard navigation events.\n *\n * This class is designed to work with the Quill editor and the Blot Formatter overlay, enabling precise\n * caret placement and navigation around custom blots (such as images or embeds) within the editor.\n *\n * @remarks\n * - Integrates with the Quill editor instance and its formatting specifications.\n * - Handles keyboard events to facilitate intuitive caret movement for users.\n * - Ensures proper event listener management to prevent memory leaks.\n *\n * @public\n */\nexport default class CaretAction extends Action {\n\n  /**\n   * Moves the caret (text cursor) backward by a specified number of characters within the current selection.\n   *\n   * If the caret is at the beginning of a text node, it attempts to move to the end of the previous sibling text node.\n   * If there is no previous sibling or the selection is not valid, the caret position remains unchanged.\n   *\n   * @param n - The number of characters to move the caret back. Defaults to 1.\n   */\n  static sendCaretBack = (n = 1, debug = false): void => {\n    const selection = window.getSelection();\n    if (selection && selection.rangeCount > 0) {\n      const range = selection.getRangeAt(0);\n      const currentNode = range.startContainer;\n      const currentOffset = range.startOffset;\n\n      // Move the cursor back by n characters\n      if (currentOffset > 0) {\n        range.setStart(currentNode, currentOffset - n);\n      } else if (currentNode.previousSibling) {\n        // Move to end of previous text node\n        const prevNode = currentNode.previousSibling;\n        if (prevNode.nodeType === Node.TEXT_NODE) {\n          range.setStart(prevNode, prevNode.textContent?.length || 0);\n        }\n      }\n\n      range.collapse(true);\n      selection.removeAllRanges();\n      selection.addRange(range);\n      if (debug) {\n        console.debug('Caret moved back by', n, 'characters');\n      }\n    }\n  }\n\n  /**\n   * Places the caret (text cursor) immediately before the specified blot in the Quill editor.\n   *\n   * @param quill - The Quill editor instance.\n   * @param targetBlot - The blot before which the caret should be placed.\n   */\n  static placeCaretBeforeBlot = (quill: any, targetBlot: Blot, debug = false): void => {\n    const index = quill.getIndex(targetBlot);\n    quill.setSelection(index, 0, \"user\");\n    if (debug) {\n      console.debug('Caret placed before blot at index:', index, targetBlot);\n    }\n  }\n\n  /**\n   * Places the caret (text cursor) immediately after the specified blot in the Quill editor.\n   *\n   * This method first clears any existing selection and ensures the editor is focused.\n   * It then calculates the index of the target blot and determines whether it is the last blot in the document.\n   * - If the target blot is the last one, the caret is placed at the very end of the document.\n   * - Otherwise, the caret is positioned just after the target blot, using a combination of Quill's selection API\n   *   and a native browser adjustment to avoid placing the caret inside a formatting span wrapper.\n   *\n   * @param quill - The Quill editor instance.\n   * @param targetBlot - The blot after which the caret should be placed.\n   */\n  static placeCaretAfterBlot = (quill: any, targetBlot: Blot, debug = false): void => {\n    quill.setSelection(null); // Clear selection first\n    quill.root.focus(); // Ensure the editor is focused\n    const index = quill.getIndex(targetBlot);\n    const documentLength = quill.getLength();\n\n    // Check if this is the last blot in the document\n    if (index + 1 >= documentLength - 1) {\n      // For the last blot, place cursor at the very end\n      quill.setSelection(documentLength - 1, 0, \"user\");\n      if (debug) {\n        console.debug('Caret placed at the end of the document after blot:', targetBlot);\n      }\n    } else {\n      // overshoot by one then use native browser API to send caret back one\n      // without this, caret will be placed inside formatting span wrapper\n      if (debug) {\n        console.debug('Caret placed after character following blot at index:', index, targetBlot);\n      } \n      quill.setSelection(index + 2, 0, \"user\");\n      this.sendCaretBack(1, debug); // Move cursor back by 1 character\n    }\n  }\n\n  /**\n   * Initializes event listeners for the CaretAction.\n   *\n   * Adds a 'keyup' event listener to the document and an 'input' event listener\n   * to the Quill editor's root element. Both listeners trigger the `onKeyUp` handler.\n   *\n   * @remarks\n   * This method should be called when the action is created to ensure proper\n   * caret handling and formatting updates in response to user input.\n   */\n  onCreate = (): void => {\n    document.addEventListener('keyup', this.onKeyUp);\n    this.formatter.quill.root.addEventListener('input', this.onKeyUp);\n  }\n\n  /**\n   * Cleans up event listeners attached by this action.\n   *\n   * Removes the 'keyup' event listener from the document and the 'input' event listener\n   * from the Quill editor's root element to prevent memory leaks and unintended behavior\n   * after the action is destroyed.\n   */\n  onDestroy = (): void => {\n    document.removeEventListener('keyup', this.onKeyUp);\n    this.formatter.quill.root.removeEventListener('input', this.onKeyUp);\n  }\n\n  /**\n   * Handles the keyup event for caret navigation around a target blot in the editor.\n   *\n   * - If a modal is open or there is no current formatting specification, the handler exits early.\n   * - If the left arrow key is pressed, places the caret before the target blot and hides the formatter UI.\n   * - If the right arrow key is pressed, places the caret after the target blot and hides the formatter UI.\n   *\n   * @param e - The keyboard event triggered by the user's keyup action.\n   */\n  onKeyUp = (e: KeyboardEvent) => {\n    const modalOpen: boolean = !!document.querySelector('[data-blot-formatter-modal]')\n    if (!this.formatter.currentSpec || modalOpen) {\n      return;\n    }\n    const targetBlot = this.formatter.currentSpec.getTargetBlot();\n    if (!targetBlot) {\n      return;\n    }\n\n    // if left arrow, place cursor before targetBlot\n    // if right arrow, place cursor after targetBlot\n    if (e.code === 'ArrowLeft') {\n      CaretAction.placeCaretBeforeBlot(this.formatter.quill, targetBlot, this.debug);\n      this.formatter.hide();\n    } else if (e.code === 'ArrowRight') {\n      CaretAction.placeCaretAfterBlot(this.formatter.quill, targetBlot, this.debug);\n      this.formatter.hide();\n    }\n  };\n}\n","'use strict';\n\nvar isMergeableObject = function isMergeableObject(value) {\n\treturn isNonNullObject(value)\n\t\t&& !isSpecial(value)\n};\n\nfunction isNonNullObject(value) {\n\treturn !!value && typeof value === 'object'\n}\n\nfunction isSpecial(value) {\n\tvar stringValue = Object.prototype.toString.call(value);\n\n\treturn stringValue === '[object RegExp]'\n\t\t|| stringValue === '[object Date]'\n\t\t|| isReactElement(value)\n}\n\n// see https://github.com/facebook/react/blob/b5ac963fb791d1298e7f396236383bc955f916c1/src/isomorphic/classic/element/ReactElement.js#L21-L25\nvar canUseSymbol = typeof Symbol === 'function' && Symbol.for;\nvar REACT_ELEMENT_TYPE = canUseSymbol ? Symbol.for('react.element') : 0xeac7;\n\nfunction isReactElement(value) {\n\treturn value.$$typeof === REACT_ELEMENT_TYPE\n}\n\nfunction emptyTarget(val) {\n\treturn Array.isArray(val) ? [] : {}\n}\n\nfunction cloneUnlessOtherwiseSpecified(value, options) {\n\treturn (options.clone !== false && options.isMergeableObject(value))\n\t\t? deepmerge(emptyTarget(value), value, options)\n\t\t: value\n}\n\nfunction defaultArrayMerge(target, source, options) {\n\treturn target.concat(source).map(function(element) {\n\t\treturn cloneUnlessOtherwiseSpecified(element, options)\n\t})\n}\n\nfunction getMergeFunction(key, options) {\n\tif (!options.customMerge) {\n\t\treturn deepmerge\n\t}\n\tvar customMerge = options.customMerge(key);\n\treturn typeof customMerge === 'function' ? customMerge : deepmerge\n}\n\nfunction getEnumerableOwnPropertySymbols(target) {\n\treturn Object.getOwnPropertySymbols\n\t\t? Object.getOwnPropertySymbols(target).filter(function(symbol) {\n\t\t\treturn Object.propertyIsEnumerable.call(target, symbol)\n\t\t})\n\t\t: []\n}\n\nfunction getKeys(target) {\n\treturn Object.keys(target).concat(getEnumerableOwnPropertySymbols(target))\n}\n\nfunction propertyIsOnObject(object, property) {\n\ttry {\n\t\treturn property in object\n\t} catch(_) {\n\t\treturn false\n\t}\n}\n\n// Protects from prototype poisoning and unexpected merging up the prototype chain.\nfunction propertyIsUnsafe(target, key) {\n\treturn propertyIsOnObject(target, key) // Properties are safe to merge if they don't exist in the target yet,\n\t\t&& !(Object.hasOwnProperty.call(target, key) // unsafe if they exist up the prototype chain,\n\t\t\t&& Object.propertyIsEnumerable.call(target, key)) // and also unsafe if they're nonenumerable.\n}\n\nfunction mergeObject(target, source, options) {\n\tvar destination = {};\n\tif (options.isMergeableObject(target)) {\n\t\tgetKeys(target).forEach(function(key) {\n\t\t\tdestination[key] = cloneUnlessOtherwiseSpecified(target[key], options);\n\t\t});\n\t}\n\tgetKeys(source).forEach(function(key) {\n\t\tif (propertyIsUnsafe(target, key)) {\n\t\t\treturn\n\t\t}\n\n\t\tif (propertyIsOnObject(target, key) && options.isMergeableObject(source[key])) {\n\t\t\tdestination[key] = getMergeFunction(key, options)(target[key], source[key], options);\n\t\t} else {\n\t\t\tdestination[key] = cloneUnlessOtherwiseSpecified(source[key], options);\n\t\t}\n\t});\n\treturn destination\n}\n\nfunction deepmerge(target, source, options) {\n\toptions = options || {};\n\toptions.arrayMerge = options.arrayMerge || defaultArrayMerge;\n\toptions.isMergeableObject = options.isMergeableObject || isMergeableObject;\n\t// cloneUnlessOtherwiseSpecified is added to `options` so that custom arrayMerge()\n\t// implementations can use it. The caller may not replace it.\n\toptions.cloneUnlessOtherwiseSpecified = cloneUnlessOtherwiseSpecified;\n\n\tvar sourceIsArray = Array.isArray(source);\n\tvar targetIsArray = Array.isArray(target);\n\tvar sourceAndTargetTypesMatch = sourceIsArray === targetIsArray;\n\n\tif (!sourceAndTargetTypesMatch) {\n\t\treturn cloneUnlessOtherwiseSpecified(source, options)\n\t} else if (sourceIsArray) {\n\t\treturn options.arrayMerge(target, source, options)\n\t} else {\n\t\treturn mergeObject(target, source, options)\n\t}\n}\n\ndeepmerge.all = function deepmergeAll(array, options) {\n\tif (!Array.isArray(array)) {\n\t\tthrow new Error('first argument should be an array')\n\t}\n\n\treturn array.reduce(function(prev, next) {\n\t\treturn deepmerge(prev, next, options)\n\t}, {})\n};\n\nvar deepmerge_1 = deepmerge;\n\nmodule.exports = deepmerge_1;\n","import BlotFormatter from '../../BlotFormatter';\nimport ToolbarButton from './ToolbarButton';\n\n/**\n * Manages the creation, display, and destruction of a toolbar for BlotFormatter actions.\n *\n * The `Toolbar` class is responsible for rendering toolbar buttons associated with registered actions,\n * handling their lifecycle, and appending/removing the toolbar element from the formatter's overlay.\n *\n * @remarks\n * - The toolbar is initialized and shown via the `create()` method, which collects all action buttons and appends them to the DOM.\n * - The `destroy()` method cleans up the toolbar, removes it from the DOM, and destroys all associated buttons to prevent memory leaks.\n *\n * @example\n * ```typescript\n * const toolbar = new Toolbar(formatter);\n * toolbar.create(); // Show toolbar\n * // ... later\n * toolbar.destroy(); // Hide and clean up toolbar\n * ```\n *\n * @public\n */\nexport default class Toolbar {\n    formatter: BlotFormatter;\n    element: HTMLElement;\n    buttons: Record<string, ToolbarButton> = {};\n\n    constructor(formatter: BlotFormatter) {\n        this.formatter = formatter;\n        this.element = document.createElement('div');\n        this.element.classList.add(this.formatter.options.toolbar.mainClassName);\n        this.element.addEventListener('mousedown', (event: MouseEvent) => {\n            event.stopPropagation();\n        });\n        if (this.formatter.options.toolbar.mainStyle) {\n            Object.assign(this.element.style, this.formatter.options.toolbar.mainStyle);\n        }\n    }\n\n    /**\n     * Creates and appends toolbar action buttons to the toolbar element. \n     * Called by BlotFormatter.show() to initialize the toolbar.\n     * \n     * Iterates through all actions registered in the formatter, collects their toolbar buttons,\n     * stores each button in the `buttons` map by its action name, and appends the created button elements\n     * to the toolbar's DOM element. Finally, appends the toolbar element to the formatter's overlay.\n     */\n    create = (): void => {\n        const actionButtons: HTMLElement[] = [];\n        this.formatter.actions.forEach(action => {\n            action.toolbarButtons.forEach(button => {\n                this.buttons[button.action] = button;\n                actionButtons.push(button.create());\n            });\n        });\n        this.element.append(...actionButtons);\n        this.formatter.overlay.append(this.element);\n        if (this.formatter.options.debug) {\n            console.debug('Toolbar created with buttons:', Object.keys(this.buttons), actionButtons);\n        }\n    }\n\n    /**\n     * Cleans up the toolbar by removing its element from the overlay,\n     * destroying all associated buttons, and clearing internal references.\n     * Called by BlotFormatter.hide() to remove the toolbar from the DOM.\n     * \n     * This should be called when the toolbar is no longer needed to prevent memory leaks.\n     */\n    destroy = (): void => {\n        if (this.element) {\n            this.formatter.overlay.removeChild(this.element);\n        }\n        for (const button of Object.values(this.buttons)) {\n            button.destroy();\n        }\n        this.buttons = {};\n        this.element.innerHTML = '';\n        if (this.formatter.options.debug) {\n            console.debug('Toolbar destroyed');\n        }\n    }\n}","import type Quill from 'quill';\n\nexport default class TooltipContainPosition {\n  /**\n   * Repositions a tooltip element within a given container to ensure it does not overflow\n   * the container's boundaries. Adjusts the tooltip's `top` and `left` CSS properties if\n   * necessary to keep it fully visible. Optionally logs debug information about the repositioning.\n   *\n   * @param tooltip - The tooltip HTMLDivElement to reposition.\n   * @param container - The container HTMLElement within which the tooltip should remain visible.\n   * @param debug - If true, logs debug information to the console. Defaults to false.\n   */\n  private static _repositionTooltip = (tooltip: HTMLDivElement, container: HTMLElement, debug = false) => {\n    const tooltipRect = tooltip.getBoundingClientRect();\n    const containerRect = container.getBoundingClientRect();\n\n    // Calculate position relative to the container\n    let left = tooltipRect.left - containerRect.left;\n    let top = tooltipRect.top - containerRect.top;\n    const width = tooltipRect.width;\n    const height = tooltipRect.height;\n    const maxWidth = container.clientWidth;\n    const maxHeight = container.clientHeight;\n\n    let changed = false;\n    const newStyles: { top?: string; left?: string } = {};\n\n    // 1) Top overflow \n    if (top < 0) {\n      newStyles.top = `${tooltipRect.height}px`;\n      changed = true;\n    }\n\n    // 2) Bottom overflow\n    if (top + height > maxHeight) {\n      newStyles.top = `${maxHeight - height}px`;\n      changed = true;\n    }\n\n    // 3) Left overflow\n    if (left < 0) {\n      newStyles.left = '0px';\n      changed = true;\n    }\n\n    // 4) Right overflow\n    if (left + width > maxWidth) {\n      newStyles.left = `${maxWidth - width}px`;\n      changed = true;\n    }\n\n    if (changed) {\n      if (debug) {\n        console.debug('Repositioning tooltip', newStyles);\n      }\n\n      // Apply all style changes at once to minimize mutations\n      if (newStyles.top !== undefined) {\n        tooltip.style.top = newStyles.top;\n      }\n      if (newStyles.left !== undefined) {\n        tooltip.style.left = newStyles.left;\n      }\n\n      if (tooltip.classList.contains('ql-flip')) {\n        tooltip.classList.remove('ql-flip');\n      }\n    } else {\n      if (debug) {\n        console.debug('Tooltip position is fine, no changes needed');\n      }\n    }\n  }\n  \n  // Static property to store observers\n  private static observers = new WeakMap<HTMLDivElement, MutationObserver>();\n\n  /**\n   * Observes changes to the tooltip's attributes and triggers repositioning when necessary.\n   *\n   * @param quill - The Quill editor instance containing the tooltip.\n   * @param debug - Optional flag to enable debug logging of attribute mutations.\n   *\n   * @remarks\n   * Uses a MutationObserver to monitor changes to the tooltip's `style` and `class` attributes.\n   * When a mutation is detected, the tooltip is repositioned within the container.\n   * If `debug` is true, mutation details are logged to the console.\n   */\n  static watchTooltip(quill: Quill, debug = false): void {\n    const tooltip = quill.container.querySelector('.ql-tooltip') as HTMLDivElement;\n    const container = quill.container;\n    if (!tooltip) {\n      console.warn('No tooltip found to watch for adjustments.');\n      return;\n    }\n    // Clean up any existing observer for this tooltip\n    this.removeTooltipWatcher(tooltip, debug);\n\n    let isRepositioning = false;\n\n    const observer = new MutationObserver((mutations: MutationRecord[]) => {\n      // Ignore mutations caused by our own repositioning\n      if (isRepositioning) return;\n\n      if (debug) {\n        for (const m of mutations) {\n          console.debug('Tooltip mutation:', m.attributeName, tooltip.getAttribute(m.attributeName!));\n        }\n      }\n\n      isRepositioning = true;\n      this._repositionTooltip(tooltip, container, debug);\n      // Use setTimeout to reset the flag after the current execution context\n      setTimeout(() => {\n        isRepositioning = false;\n      }, 0);\n    });\n\n    observer.observe(tooltip, {\n      attributes: true,\n      attributeFilter: ['style', 'class'],\n    });\n\n    // Store the observer for later cleanup\n    this.observers.set(tooltip, observer);\n  }\n\n  /**\n   * Removes the MutationObserver for the specified tooltip element.\n   *\n   * @param tooltip - The HTMLDivElement or Quill instance to stop watching.\n   *                  If a Quill instance is provided, finds the tooltip within its container.\n   */\n  static removeTooltipWatcher(tooltip: HTMLDivElement | Quill, debug = false): void {\n    let tooltipElement: HTMLDivElement | null = null;\n\n    if (tooltip instanceof HTMLDivElement) {\n      tooltipElement = tooltip;\n    } else {\n      // Assume it's a Quill instance\n      tooltipElement = tooltip.container.querySelector('.ql-tooltip') as HTMLDivElement;\n    }\n\n    if (tooltipElement && this.observers.has(tooltipElement)) {\n      const observer = this.observers.get(tooltipElement);\n      observer?.disconnect();\n      this.observers.delete(tooltipElement);\n      if (debug) {\n        console.debug('Tooltip watcher removed for:', tooltipElement);\n      }\n    }\n  }\n\n  /**\n   * Initializes the tooltip adjustment watcher when the action is created.\n   * Searches for the tooltip element within the Quill container and, if found,\n   * sets up observation for tooltip adjustments. Logs a warning if the tooltip\n   * element is not present.\n   *\n   * @remarks\n   * This method should be called during the creation lifecycle of the action.\n   */\n  constructor(private readonly quill: Quill, private readonly debug = false) {\n    const tooltip = quill.container.querySelector('.ql-tooltip') as HTMLDivElement;\n    console.debug('tooltip:', tooltip);\n    if (tooltip) {\n      TooltipContainPosition.watchTooltip(quill, debug);\n      if (debug) {\n        console.debug('Tooltip watcher initialized for:', tooltip);\n      }\n    } else {\n      console.warn('No tooltip found to watch for adjustments.');\n    }\n  }\n\n  /**\n   * Cleans up resources when the action is destroyed.\n   * Specifically, it finds the tooltip element within the Quill editor container\n   * and removes its associated watcher if the tooltip exists.\n   */\n  destroy = (): void => {\n    const tooltip = this.quill.container.querySelector('.ql-tooltip') as HTMLDivElement;\n    if (tooltip) {\n      TooltipContainPosition.removeTooltipWatcher(this.quill, this.debug);\n      if (this.debug) {\n        console.debug('Tooltip watcher removed on destroy');\n      }\n    }\n  }\n\n}\n","\n/**\n * Factory function to create a custom Quill Image blot class supporting additional attributes.\n *\n * This function returns a class extending Quill's native Image blot, adding support for the `title` attribute\n * (in addition to `alt`, `height`, and `width`). The returned class overrides the static `formats` method\n * to extract these attributes from the DOM node, and the instance `format` method to set or remove them.\n *\n * @param QuillConstructor - The Quill constructor or instance used to import the base Image blot.\n * @returns A custom Image blot class supporting `alt`, `height`, `width`, and `title` attributes.\n *\n * @remarks\n * - This is useful for enabling the `title` attribute on images in Quill editors, which is not supported by default.\n * - See https://github.com/slab/quill/pull/4350 for related discussion.\n *\n * @example\n * ```typescript\n * const CustomImageBlot = createAltTitleImageBlotClass(Quill);\n * Quill.register(CustomImageBlot);\n * ```\n */\nexport const createAltTitleImageBlotClass = (QuillConstructor: any): any => {\n    const ImageBlot = QuillConstructor.import('formats/image') as any;\n\n    const ATTRIBUTES = ['alt', 'height', 'width', 'title'];\n\n    /**\n     * Represents a custom image blot for Quill editor, extending the base `ImageBlot`.\n     * \n     * This class provides custom formatting logic to allow managing the `title` attribute missing from the native Quill image blot.\n     * See PR https://github.com/slab/quill/pull/4350 for more details.\n     * \n     * @remarks\n     * - The static `formats` method extracts supported attributes from a DOM node and returns them as a record.\n     * - The `format` method sets or removes supported attributes on the image DOM node, delegating to the superclass for unsupported attributes.\n     * \n     * @example\n     * ```typescript\n     * // Extract formats from an image DOM node\n     * const formats = Image.formats(domNode);\n     * \n     * // Format an image blot\n     * imageBlot.format('alt', 'A description');\n     * ```\n     */\n    return class Image extends ImageBlot {\n        static blotName = 'image';\n        static formats(domNode: Element) {\n            return ATTRIBUTES.reduce(\n                (formats: Record<string, string | null>, attribute) => {\n                    if (domNode.hasAttribute(attribute)) {\n                        formats[attribute] = domNode.getAttribute(attribute);\n                    }\n                    return formats;\n                },\n                {},\n            );\n        }\n\n        format(name: string, value: string) {\n            if (ATTRIBUTES.indexOf(name) > -1) {\n                if (value || name === 'alt') {\n                    this.domNode.setAttribute(name, value);\n                } else {\n                    this.domNode.removeAttribute(name);\n                }\n            } else {\n                super.format(name, value);\n            }\n        }\n    }\n}\n","interface IframeAlignValue {\n  align: string;\n  width: string;\n  relativeSize: string;\n}\n\ninterface ImageAlignInputValue {\n  align: string;\n  title: string;\n}\n\ninterface ImageAlignValue extends ImageAlignInputValue {\n  width: string;\n  contenteditable: string;\n  relativeSize: string;\n}\n\n/**\n * Represents a class type for Attributors, which are used to define and manage\n * custom attributes in Quill editors. This type describes a constructor signature\n * for Attributor classes, including their prototype and the attribute name they handle.\n *\n * @template T The instance type created by the constructor.\n * @property {string} attrName - The name of the attribute managed by the Attributor.\n */\nexport type AttributorClass = {\n  new (...args: any[]): any;\n  prototype: any;\n  attrName: string;\n}\n\n/**\n * Creates a custom Quill Attributor class for handling iframe alignment.\n *\n * This attributor allows alignment of iframe elements within the Quill editor by\n * applying a CSS class and managing related dataset properties. It also handles\n * width styling and tracks whether the width is relative (percentage-based).\n *\n * @param QuillConstructor - The Quill constructor or Quill instance used to import Parchment.\n * @returns A class extending Quill's ClassAttributor, customized for iframe alignment.\n *\n * @example\n *   this.Quill = this.quill.constructor\n *   const IframeAlignClass = createIframeAlignAttributor(this.Quill);\n *   this.IframeAlign = new IframeAlignClass();\n *   this.Quill.register({\n *     'formats/iframeAlign': this.IframeAlign,\n *     'attributors/class/iframeAlign': this.IframeAlign,\n *   }, true);\n * \n * @remarks\n * - Supported alignments: 'left', 'center', 'right'.\n * - Adds/removes the `ql-iframe-align` class and manages `data-blot-align` and `--resize-width` style.\n * - Handles both string and object values for alignment.\n */\nexport const createIframeAlignAttributor = (QuillConstructor: any): AttributorClass => {\n  const parchment = QuillConstructor.import('parchment') as any;\n  const { ClassAttributor, Scope } = parchment;\n\n  return class IframeAlignAttributor extends ClassAttributor {\n    static attrName = 'iframeAlign';\n\n    constructor(private debug = false) {\n      super('iframeAlign', 'ql-iframe-align', {\n        scope: Scope.BLOCK,\n        whitelist: ['left', 'center', 'right'],\n      });\n    }\n\n    /**\n     * Adds alignment and width-related formatting to the specified HTML element node.\n     *\n     * - Sets the alignment using the provided value, which can be either a string or an object containing an `align` property.\n     * - Stores the alignment value in the element's `data-blot-align` attribute.\n     * - Handles the element's `width` attribute:\n     *   - If present, ensures the width value includes units (appends 'px' if numeric only).\n     *   - Sets the CSS custom property `--resize-width` to the processed width value.\n     *   - Sets the `data-relative-size` attribute to `'true'` if the width ends with '%', otherwise `'false'`.\n     *   - If no width is specified, removes the `--resize-width` property and sets `data-relative-size` to `'false'`.\n     *\n     * @param node - The DOM element to which alignment and width formatting will be applied.\n     * @param value - The alignment value, either as a string or an object with an `align` property.\n     * @returns `true` if the formatting was successfully applied to an HTMLElement, otherwise `false`.\n     */\n    add(node: Element, value: IframeAlignValue): boolean {\n      if (this.debug) {\n        console.debug('IframeAlignAttributor.add', node, value);\n      }\n      if (node instanceof HTMLElement) {\n        if (typeof value === 'object') {\n          super.add(node, value.align);\n          node.dataset.blotAlign = value.align;\n        } else {\n          super.add(node, value);\n          node.dataset.blotAlign = value;\n        }\n        let width: string | null = node.getAttribute('width');\n        if (width) {\n          // width style value must include units, add 'px' if numeric only\n          if (!isNaN(Number(width.trim().slice(-1)))) {\n            width = `${width}px`\n          }\n          node.style.setProperty('--resize-width', width);\n          node.dataset.relativeSize = `${width.endsWith('%')}`;\n        } else {\n          node.style.removeProperty('--resize-width');\n          node.dataset.relativeSize = 'false';\n        }\n        if (this.debug) {\n          console.debug('IframeAlignAttributor.add - node:', node, 'aligned with:', value);\n        }\n        return true;\n      } else {\n        if (this.debug) {\n          console.debug('IframeAlignAttributor.add - node is not an HTMLElement, skipping alignment');\n        }\n        return false;\n      }\n    }\n\n    /**\n     * Removes the alignment formatting from the specified DOM element.\n     * \n     * If the provided node is an instance of HTMLElement, this method first calls the\n     * parent class's `remove` method to perform any additional removal logic, and then\n     * deletes the `data-blot-align` attribute from the element's dataset.\n     *\n     * @param node - The DOM element from which to remove the alignment formatting.\n     */\n    remove(node: Element): void {\n      if (this.debug) {\n        console.debug('IframeAlignAttributor.remove', node);\n      }\n      if (node instanceof HTMLElement) {\n        super.remove(node);\n        delete node.dataset.blotAlign;\n      }\n    }\n\n    /**\n     * Extracts alignment and width information from a given DOM element.\n     *\n     * @param node - The DOM element from which to extract alignment and width values.\n     * @returns An object containing:\n     *   - `align`: The alignment class name derived from the superclass's value method.\n     *   - `width`: The width value, determined from the element's CSS custom property '--resize-width', \n     *     its 'width' attribute, or an empty string if not present.\n     *   - `relativeSize`: A string indicating whether the width ends with a '%' character, representing a relative size.\n     */\n    value(node: Element): IframeAlignValue {\n      const className = super.value(node);\n      const width = (node instanceof HTMLElement) ?\n        node.style.getPropertyValue('--resize-width') || node.getAttribute('width') || '' :\n        '';\n      const value = {\n        align: className,\n        width: width,\n        relativeSize: `${width.endsWith('%')}`\n      };\n      if (this.debug) {\n        console.debug('IframeAlignAttributor.value', node, value);\n      }\n      return value;\n    }\n\n  }\n}\n\n/**\n * Creates a custom Quill Attributor class for handling image alignment within a span wrapper.\n * \n * This attributor enables alignment formatting (`left`, `center`, `right`) for images by wrapping them in a `<span>`\n * element with a specific class and managing related attributes such as `data-title` for captions and width handling.\n * It also ensures that the image's alignment and caption are properly reflected in the DOM and Quill's internal model.\n * \n * @param QuillConstructor - The Quill constructor or instance used to import Parchment and related classes.\n * @returns A custom AttributorClass for image alignment formatting.\n * \n * @example\n *   this.Quill = this.quill.constructor\n *   const ImageAlignClass = createImageAlignAttributor(this.Quill);\n *   this.ImageAlign = new ImageAlignClass();\n *   this.Quill.register({\n *     'formats/imageAlign': this.ImageAlign,\n *     'attributors/class/imageAlign': this.ImageAlign,\n *   }, true);\n *\n * @remarks\n * - The attributor manages both string and object values for alignment, supporting additional metadata like `title`.\n * - It ensures the wrapper span is not editable and synchronizes width information for correct CSS rendering.\n * - Handles edge cases where Quill merges inline styles, ensuring the image alignment format is reapplied as needed.\n * - The `remove` and `value` methods ensure proper cleanup and retrieval of alignment state.\n */\nexport const createImageAlignAttributor = (QuillConstructor: any): AttributorClass => {\n  const parchment = QuillConstructor.import('parchment') as any;\n  const { ClassAttributor, Scope } = parchment;\n\n  return class ImageAlignAttributor extends ClassAttributor {\n    static tagName = 'SPAN';\n    static attrName = 'imageAlign';\n\n    constructor(private debug = false) {\n      super('imageAlign', 'ql-image-align', {\n        scope: Scope.INLINE,\n        whitelist: ['left', 'center', 'right'],\n      });\n    }\n\n    /**\n     * Adds or updates alignment and related formatting for an image wrapper node.\n     *\n     * This method applies alignment, caption, and width formatting to a given node containing an image.\n     * It handles both object-based and string-based alignment values, updates relevant attributes,\n     * and ensures the wrapper is styled correctly for Quill's image formatting.\n     *\n     * - If the node is an HTMLSpanElement, it sets alignment, caption (data-title), and width attributes.\n     * - If the node is not a span, it attempts to find an image child and reapply the imageAlign format.\n     * - Handles Quill's inline style merging quirks to avoid redundant wrappers.\n     *\n     * @param node - The DOM element (typically a span or container) to apply formatting to.\n     * @param value - The alignment value, which can be a string or an object containing alignment and optional title.\n     * @returns `true` if formatting was applied or handled, `false` otherwise.\n     */\n    add(node: Element, value: ImageAlignInputValue | string): boolean {\n      if (this.debug) {\n        console.debug('ImageAlignAttributor.add', node, value);\n      }\n      if (node instanceof HTMLSpanElement && value) {\n        let imageElement = node.querySelector('img') as HTMLImageElement;\n        if (typeof value === 'object' && value.align) {\n          super.add(node, value.align);\n          node.setAttribute('contenteditable', 'false');\n          // data-title used to populate caption via ::after\n          if (!!value.title) {\n            node.setAttribute('data-title', value.title);\n          } else {\n            node.removeAttribute('data-title');\n          }\n          if (value.align) {\n            imageElement.dataset.blotAlign = value.align;\n          }\n          if (this.debug) {\n            console.debug('ImageAlignAttributor.add - imageElement:', imageElement, 'aligned with:', value.align);\n          }\n        } else if (typeof value === 'string') {\n          super.add(node, value);\n          imageElement.dataset.blotAlign = value;\n          if (this.debug) {\n            console.debug('ImageAlignAttributor.add - imageElement:', imageElement, 'aligned with:', value);\n          }\n        } else {\n          if (this.debug) {\n            console.debug('ImageAlignAttributor.add - no value provided, skipping alignment');\n          }\n          return false;\n        }\n        // set width style property on wrapper if image and has imageAlign format\n        // fallback to image natural width if width attribute missing (image not resized))\n        // width needed to size wrapper correctly via css\n        // width style value must include units, add 'px' if numeric only\n        let width: string | null = this.getImageWidth(imageElement);\n        node.setAttribute('data-relative-size', `${width?.endsWith('%')}`)\n        return true;\n      } else {\n        // bug fix - Quill's inline styles merge elements and remove span element if styles nested\n        // for the first outer style, reapply imageAlign format on image \n        // for subsequent outer styles, skip reformat and just return true - will nest multiple span wrappers otherwise\n        const imageElement = node instanceof HTMLImageElement ? node : node.querySelector('img');\n        if (this.debug)\n          console.debug(`ImageAlignAttributor.add - ${node.tagName} is not a span, checking for image:`, imageElement);\n        if (imageElement instanceof HTMLImageElement) {\n          // Use QuillConstructor.find to find the image blot, using global Quill static methods will always return null \n          //   in some environments such as vite, react, etc.\n          const imageBlot = QuillConstructor.find(imageElement) as any;\n          if (this.debug) {\n            console.debug('ImageAlignAttributor.add - found image blot:', imageBlot);\n          }\n          if (\n            imageBlot &&\n            (\n              node.firstChild instanceof HTMLSpanElement ||\n              !(imageElement.parentElement?.matches('span[class^=\"ql-image-align-\"]'))\n            )\n          ) {\n            imageBlot.format('imageAlign', value);\n            if (this.debug) {\n              console.debug('ImageAlignAttributor.add - reapplying imageAlign format to image blot:', value, imageBlot);\n            }\n          }\n          return true;\n        }\n        return false;\n      }\n    }\n\n    /**\n     * Removes alignment formatting from the given DOM node.\n     *\n     * If the node is an HTMLElement, it first calls the parent class's remove method.\n     * Then, if the node's first child is also an HTMLElement, it deletes the `blotAlign`\n     * data attribute from that child element.\n     *\n     * @param node - The DOM element from which to remove alignment formatting.\n     */\n    remove(node: Element): void {\n      if (this.debug) {\n        console.debug('ImageAlignAttributor.remove', node);\n      }\n      if (node instanceof HTMLElement) {\n        super.remove(node);\n        if (node.firstChild && (node.firstChild instanceof HTMLElement)) {\n          delete node.firstChild.dataset.blotAlign;\n        }\n      }\n    }\n\n    /**\n     * Retrieves alignment and metadata information for an image element within a given DOM node.\n     *\n     * This method attempts to find an `<img>` element within the provided node, then extracts its alignment,\n     * title, and width attributes. If the width attribute is missing or invalid, it tries to determine the width\n     * either immediately (if the image is loaded) or by setting an `onload` handler. The method returns an object\n     * containing the alignment, title, width, a `contenteditable` flag, and a boolean string indicating if the width\n     * is specified as a percentage.\n     *\n     * @param node - The DOM element to search for an image and extract alignment and metadata from.\n     * @returns An object containing the image's alignment, title, width, contenteditable status, and relative size flag.\n     */\n    value(node: Element): ImageAlignValue {\n      // in case nested style, find image element and span wrapper\n      const imageElement = node.querySelector('img') as HTMLImageElement;\n      if (!imageElement) return null as any; // this can happen during certain 'undo' operations\n      const parentElement = imageElement.parentElement as HTMLElement;\n      const align = super.value(parentElement);\n      const title: string = imageElement.getAttribute('title') || '';\n      let width: string = imageElement.getAttribute('width') || '';\n      // attempt to get width if missing or image not loaded\n      if (!parseFloat(width)) {\n        if (imageElement.complete) {\n          width = this.getImageWidth(imageElement);\n        } else {\n          imageElement.onload = (event) => {\n            width = this.getImageWidth(event.target as HTMLImageElement);\n          }\n        }\n      }\n      const value = {\n        align: align,\n        title: title,\n        width: width,\n        contenteditable: 'false',\n        relativeSize: `${width.endsWith('%')}`\n      };\n      if (this.debug) {\n        console.debug('ImageAlignAttributor.value', node, value);\n      }\n      return value;\n    }\n\n    /**\n     * Retrieves the width of the given HTMLImageElement, ensuring it is set as an attribute and formatted with 'px' units.\n     * \n     * - If the 'width' attribute is not present, it uses the image's natural width and sets it as the 'width' attribute in pixels.\n     * - If the 'width' attribute exists but does not end with a non-numeric character (i.e., is a number), it appends 'px' to the value.\n     * - Updates the parent element's CSS variable '--resize-width' with the computed width.\n     * \n     * @param imageElement - The HTMLImageElement whose width is to be retrieved and set.\n     * @returns The width of the image as a string with 'px' units.\n     */\n    getImageWidth(imageElement: HTMLImageElement) {\n      let width = imageElement.getAttribute('width');\n      if (!width) {\n        width = `${imageElement.naturalWidth}px`;\n        imageElement.setAttribute('width', width);\n      } else {\n        if (!isNaN(Number(width.trim().slice(-1)))) {\n          width = `${width}px`\n          imageElement.setAttribute('width', width);\n        }\n      }\n      (imageElement.parentElement as HTMLElement).style.setProperty('--resize-width', width);\n      return width;\n    }\n\n  }\n}\n","/**\n * Factory function to create a custom Quill video blot class with responsive styling.\n *\n * @param QuillConstructor - The Quill constructor or instance used to import the base video format.\n * @returns A class extending Quill's VideoEmbed, enforcing a 16:9 aspect ratio and full width for embedded videos.\n *\n * @remarks\n * The returned class, `VideoResponsive`, overrides the default video blot to ensure videos are displayed responsively.\n * The aspect ratio is controlled via the static `aspectRatio` property and applied to the video element's style.\n *\n * @example\n * ```typescript\n * const VideoResponsive = createResponsiveVideoBlotClass(Quill);\n * Quill.register(VideoResponsive);\n * ```\n */\nexport const createResponsiveVideoBlotClass = (QuillConstructor: any): any => {\n    const VideoEmbed = QuillConstructor.import(\"formats/video\") as any;\n\n    /**\n     * A custom Quill blot for embedding responsive videos.\n     * Extends `VideoEmbed` to ensure videos use a 16:9 aspect ratio and full width.\n     *\n     * @remarks\n     * The aspect ratio is set via the `aspectRatio` static property and applied to the video element's style.\n     *\n     * @example\n     * ```typescript\n     * const videoBlot = VideoResponsive.create('https://example.com/video.mp4');\n     * ```\n     *\n     * @extends VideoEmbed\n     */\n    return class VideoResponsive extends VideoEmbed {\n        static blotName = 'video';\n        static aspectRatio: string = \"16 / 9 auto\"\n        static create(value: string) {\n            const node = super.create(value);\n            node.setAttribute('width', '100%');\n            node.style.aspectRatio = this.aspectRatio;\n            return node;\n        }\n        html() {\n            return this.domNode.outerHTML;\n        }\n    }\n}\n","import BlotFormatter from '../../BlotFormatter';\nimport { Aligner } from './Aligner';\nimport type { Alignment } from './Alignment';\nimport type { Blot } from '../../specs/BlotSpec';\nimport type { Options } from '../../Options';\n\n/**\n * The `DefaultAligner` class provides alignment management for Quill editor blots (such as images and iframes).\n * It implements the `Aligner` interface and is responsible for applying, clearing, and querying alignment\n * formatting on supported blots within the editor.\n *\n * This class supports both inline and block-level blots, and can be configured with custom alignment options.\n * It interacts with Quill's Parchment module to determine blot types and scopes, and uses formatter options\n * to control alignment and resizing behaviors.\n *\n * Key features:\n * - Registers available alignments and exposes them via `getAlignments()`.\n * - Applies alignment to blots using `setAlignment()`, handling both inline (e.g., images) and block (e.g., iframes) elements.\n * - Clears alignment formatting from blots with `clear()`.\n * - Determines blot type and scope with utility methods (`isInlineBlot`, `isBlockBlot`, `hasInlineScope`, `hasBlockScope`).\n * - Checks and retrieves current alignment with `isAligned()` and `getAlignment()`.\n * - Optionally sets relative width for images if configured.\n * - Ensures editor usability by adding a new paragraph if the editor contains only an aligned image.\n *\n * @remarks\n * This class is intended for internal use by the BlotFormatter module and expects a properly configured\n * `BlotFormatter` instance with alignment and resize options.\n *\n * @example\n * ```typescript\n * const aligner = new DefaultAligner(formatter);\n * aligner.setAlignment(blot, 'center');\n * ```\n *\n * @see Aligner\n * @see BlotFormatter\n */\nexport default class DefaultAligner implements Aligner {\n  alignments: Record<string, Alignment> = {};\n  options: Options;\n  formatter: BlotFormatter;\n  private debug: boolean;\n  private Scope: any;\n\n  constructor(formatter: BlotFormatter) {\n    this.formatter = formatter;    // Get Scope from the formatter's Quill constructor\n    this.debug = formatter.options.debug ?? false;\n    const parchment = formatter.Quill.import('parchment') as any;\n    this.Scope = parchment.Scope;\n    this.options = formatter.options;\n    this.options.align.alignments.forEach(alignment => {\n      this.alignments[alignment] = {\n        name: alignment,\n        apply: (blot: Blot | null) => {\n          this.setAlignment(blot, alignment);\n        },\n      }\n    })\n    if (this.debug) {\n      console.debug('DefaultAligner created with alignments:', this.alignments);\n    }\n  }\n\n  /**\n   * Retrieves all available alignment options.\n   *\n   * @returns {Alignment[]} An array of alignment objects defined in the `alignments` property.\n   */\n  getAlignments = (): Alignment[] => {\n    return Object.keys(this.alignments).map(k => this.alignments[k]);\n  }\n\n  /**\n   * Clears alignment formatting from the given blot if it is an image or iframe.\n   *\n   * - For image blots (`IMG`), if the parent is a `SPAN`, removes the alignment attribute from the parent.\n   * - For iframe blots (`IFRAME`), removes the alignment attribute directly from the blot.\n   *\n   * @param blot - The blot to clear alignment formatting from, or `null` if none.\n   */\n  clear = (blot: Blot | null): void => {\n    if (blot != null) {\n      if (blot.domNode.tagName === 'IMG') {\n        if (blot.parent !== null && blot.parent.domNode.tagName === 'SPAN') {\n          blot.parent.format(this.formatter.ImageAlign.attrName, false)\n          if (this.debug) {\n            console.debug('Cleared image alignment from parent span:', blot.parent);\n          }\n        }\n      } else if (blot.domNode.tagName === 'IFRAME') {\n        blot.format(this.formatter.IframeAlign.attrName, false)\n        if (this.debug) {\n          console.debug('Cleared iframe alignment:', blot);\n        }\n      }\n    }\n  }\n\n  /**\n   * Determines whether the given blot is an inline blot.\n   *\n   * Checks if the provided `blot` has a scope that matches the inline blot scope.\n   *\n   * @param blot - The blot instance to check.\n   * @returns `true` if the blot is an inline blot; otherwise, `false`.\n   */\n  isInlineBlot = (blot: Blot): boolean => {\n    return (blot.statics?.scope & this.Scope.INLINE) === this.Scope.INLINE_BLOT;\n  }\n\n  /**\n   * Determines if the provided blot is a block-level blot.\n   *\n   * Checks the blot's static scope against the BLOCK scope constant,\n   * and returns true if it matches the BLOCK_BLOT type.\n   *\n   * @param blot - The blot instance to check.\n   * @returns True if the blot is a block blot; otherwise, false.\n   */\n  isBlockBlot = (blot: Blot): boolean => {\n    return (blot.statics?.scope & this.Scope.BLOCK) === this.Scope.BLOCK_BLOT;\n  }\n\n  /**\n   * Determines whether the given blot has an inline scope.\n   *\n   * @param blot - The blot instance to check.\n   * @returns `true` if the blot's scope includes the inline scope; otherwise, `false`.\n   */\n  hasInlineScope = (blot: Blot): boolean => {\n    return (blot.statics.scope & this.Scope.INLINE) === this.Scope.INLINE;\n  }\n\n  /**\n   * Determines whether the given blot has block-level scope.\n   *\n   * @param blot - The blot instance to check.\n   * @returns `true` if the blot's scope includes block-level formatting; otherwise, `false`.\n   */\n  hasBlockScope = (blot: Blot): boolean => {\n    return (blot.statics.scope & this.Scope.BLOCK) === this.Scope.BLOCK;\n  }\n\n  /**\n   * Determines whether the given blot is aligned.\n   *\n   * If an alignment is specified, returns `true` only if the blot's alignment matches the specified alignment.\n   * If no alignment is specified, returns `true` if the blot has any alignment.\n   *\n   * @param blot - The blot to check for alignment.\n   * @param alignment - The alignment to compare against, or `null` to check for any alignment.\n   * @returns `true` if the blot is aligned (and matches the specified alignment, if provided); otherwise, `false`.\n   */\n  isAligned = (blot: Blot, alignment: Alignment | null): boolean => {\n    // true if blot is aligned, if alignment specfied then true only if alignment matches\n    const existingAlignment = this.getAlignment(blot);\n    if (alignment) {\n      return existingAlignment === alignment.name;\n    } else {\n      return (!!existingAlignment);\n    }\n  }\n\n  /**\n   * Retrieves the alignment value from the given blot's DOM node.\n   *\n   * @param blot - The blot instance whose alignment is to be determined.\n   * @returns The alignment value as a string if present, otherwise `undefined`.\n   */\n  getAlignment = (blot: Blot): string | undefined => {\n    return blot.domNode.dataset.blotAlign;\n  }\n\n  /**\n   * Sets the alignment for a given blot (content element) in the editor.\n   *\n   * This method checks if the blot is already aligned as requested. If not, it clears any existing alignment,\n   * and applies the new alignment based on the blot type (inline or block). For inline blots (such as images),\n   * it may also set a relative width attribute if required by the configuration. For block blots (such as iframes),\n   * it applies the alignment directly.\n   *\n   * Additionally, if the editor contains only an image, it ensures a new paragraph is added underneath to maintain\n   * editor usability.\n   *\n   * @param blot - The blot (content element) to align. Can be `null`, in which case no action is taken.\n   * @param alignment - The alignment to apply (e.g., 'left', 'center', 'right'). Must correspond to a key in `this.alignments`.\n   */\n  setAlignment = (blot: Blot | null, alignment: string): void => {\n    if (blot === null) {\n      if (this.debug) console.debug('DefaultAligner.setAlignment called with null blot, no action taken');\n      return;\n    }\n    const hasAlignment = this.isAligned(blot, this.alignments[alignment]);\n    if (this.debug) console.debug('hasAlignment', hasAlignment);\n    this.clear(blot);\n    if (!hasAlignment) {\n      if (this.isInlineBlot(blot) || this.hasInlineScope(blot)) {\n        if (this.debug) console.debug('setting alignment', (this.isInlineBlot(blot) || this.hasInlineScope(blot)));\n        // if no width attr and use relative mandatory, try to set relative width attr\n        if (\n          !blot.domNode.getAttribute('width') &&\n          this.options.resize.useRelativeSize &&\n          !this.options.resize.allowResizeModeChange\n        ) {\n          try {\n            const editorStyle = getComputedStyle(this.formatter.quill.root);\n            const editorWidth = this.formatter.quill.root.clientWidth -\n              parseFloat(editorStyle.paddingLeft) -\n              parseFloat(editorStyle.paddingRight);\n            blot.domNode.setAttribute(\n              'width',\n              `${Math.min(Math.round(100 * (blot.domNode as HTMLImageElement).naturalWidth / editorWidth), 100)}%`\n            )\n          } catch {\n            if (this.debug) console.debug('DefaultAligner.setAlignment Error setting image width:', blot);\n          }\n        }\n        if (this.debug) console.debug(\n          'DefaultAligner.setAlignment formatting image with',\n          this.formatter.ImageAlign.attrName,\n          {\n            align: this.alignments[alignment].name,\n            title: blot.domNode.getAttribute('title') || ''\n          }\n        )\n        blot.format(\n          this.formatter.ImageAlign.attrName,\n          {\n            align: this.alignments[alignment].name,\n            title: blot.domNode.getAttribute('title') || ''\n          }\n        );\n        // if image only item in editor, add new paragraph underneath otherwise no selectable item in editor\n        try {\n          const ops: any = this.formatter.quill.getContents().ops;\n          if (ops.length === 2 && ops[1].insert === '\\n') {\n            this.formatter.quill.insertText(this.formatter.quill.getLength(), '\\n', 'user');\n          }\n        } catch { }\n      } else if (this.isBlockBlot(blot) || this.hasBlockScope(blot)) {\n        if (this.debug) console.debug(\n          'DefaultAligner.setAlignment formatting iframe with',\n          this.formatter.IframeAlign.attrName,\n          {\n            align: this.alignments[alignment].name\n          }\n        )\n        blot.format(\n          this.formatter.IframeAlign.attrName,\n          this.alignments[alignment].name\n        );\n      }\n    }\n  }\n}\n\n","import { ToolbarOptions } from \"../../Options\";\n\nexport interface _ToolbarButton {\n    action: string;\n    element: HTMLElement | null;\n    icon: string;\n    selected: boolean;\n    visible: boolean;\n    onClick: EventListener;\n    options: ToolbarOptions;\n    create(action: string, icon: string): HTMLElement;\n}\n\n/**\n * Represents a toolbar button used in the Quill editor's formatting toolbar.\n * \n * The `ToolbarButton` class encapsulates the creation, management, and styling of a single toolbar button.\n * It provides methods for initializing the button element, handling selection and visibility states,\n * applying custom styles, and cleaning up resources when the button is destroyed.\n * Instances of this class should be added to the `toolbarButtons` array of an `Action` class.\n * \n * @implements {_ToolbarButton}\n * \n * @remarks\n * - The button's icon, action, and event handler are configured via the constructor.\n * - Customization options for styling, tooltips, and class names are provided through the `ToolbarOptions` object.\n * - Selection and visibility states are managed via getter/setter properties.\n * - The class is designed to be extended for custom selection logic via the `preselect` method.\n * \n * @example\n * ```typescript\n *     someAction.toolbarButtons = [\n *         new ToolbarButton(\n *             'someActionName',\n *             this.onClickHandler,\n *             this.formatter.options.toolbar,\n *         )\n *     ]\n * ```\n */\nexport default class ToolbarButton implements _ToolbarButton {\n    action: string;\n    icon: string;\n    onClick: EventListener;\n    options: ToolbarOptions;\n    element: HTMLElement | null = null;\n    initialVisibility: boolean = true; // preset visibility before button is created\n\n    constructor(\n        action: string,\n        onClickHandler: EventListener,\n        options: ToolbarOptions\n    ) {\n        this.action = action;\n        this.icon = options.icons[action as keyof typeof options.icons];\n        this.onClick = onClickHandler;\n        this.options = options;\n    }\n\n    /**\n     * Creates and initializes the toolbar button element.\n     * \n     * This method constructs a `span` element, sets its inner HTML to the provided icon,\n     * assigns the appropriate class name and action data attribute, and attaches the click handler.\n     * If tooltips are configured for the action, it sets the tooltip text.\n     * The button's selected and visible states are initialized, and custom styling is applied.\n     * \n     * @returns {HTMLElement} The created and configured toolbar button element.\n     */\n    create = (): HTMLElement => {\n        this.element = document.createElement('span');\n        this.element.innerHTML = this.icon;\n        this.element.className = this.options.buttonClassName;\n        this.element.dataset.action = this.action;\n        this.element.onclick = this.onClick;\n        if (this.options.tooltips && this.options.tooltips[this.action]) {\n            this.element.title = this.options.tooltips[this.action];\n        }\n        this.selected = this.preselect();\n        this.visible = this.initialVisibility;\n        this._styleButton();\n        return this.element;\n    }\n\n    /**\n     * Cleans up the toolbar button by removing its click event handler,\n     * detaching it from the DOM, and clearing the reference to the element.\n     * This method should be called when the button is no longer needed to\n     * prevent memory leaks.\n     */\n    destroy = (): void => {\n        if (this.element) {\n            this.element.onclick = null;\n            this.element.remove();\n            this.element = null;\n        }\n    }\n\n    /**\n     * Determines whether the toolbar button should appear as selected (active) when loaded.\n     * Override this method to provide custom logic for button selection state.\n     *\n     * @returns {boolean} `true` if the button should be preselected; otherwise, `false`.\n     */\n    preselect = (): boolean => {\n        // override this with logic to show if button is selected (active) when loaded\n        // someCriteria: boolean = true / false;\n        // return someCriteria;\n        return false;\n    }\n\n    /**\n     * Indicates whether the toolbar button is currently selected.\n     *\n     * Returns `true` if the underlying element's `data-selected` attribute is set to `'true'`, otherwise returns `false`.\n     */\n    get selected(): boolean {\n        return this.element?.dataset.selected === 'true';\n    }\n\n    /**\n     * Sets the selected state of the toolbar button.\n     * \n     * When set to `true`, applies the selected class and style to the button element.\n     * When set to `false`, removes the selected class and style, and reapplies the default button style if provided.\n     * Also updates the `data-selected` attribute on the element.\n     *\n     * @param value - Indicates whether the button should be in the selected state.\n     */\n    set selected(value: boolean) {\n        if (this.element) {\n            this.element.dataset.selected = value.toString();\n            // apply styles to indicate selected state\n            if (value) {\n                this.element.classList.add(this.options.buttonSelectedClassName);\n                if (this.options.buttonSelectedStyle) {\n                    Object.assign(this.element.style, this.options.buttonSelectedStyle);\n                }\n            } else {\n                this.element.classList.remove(this.options.buttonSelectedClassName);\n                if (this.options.buttonSelectedStyle) {\n                    this.element.removeAttribute('style');\n                    if (this.options.buttonStyle)\n                        Object.assign(this.element.style, this.options.buttonStyle);\n                }\n            }\n        }\n    }\n\n    /**\n     * Indicates whether the toolbar button is currently visible.\n     * Returns `true` if the button's element is not hidden (`display` is not set to `'none'`), otherwise returns `false`.\n     */\n    get visible(): boolean {\n        return this.element?.style.display !== 'none';\n    }\n\n    /**\n     * Sets the visibility of the toolbar button element.\n     * Accepts a CSS display value as a string or a boolean.\n     * If a boolean is provided, `true` sets the display to 'inline-block', and `false` sets it to 'none'.\n     * If a string is provided, it is used directly as the CSS display value.\n     *\n     * @param style - The desired visibility state, either as a CSS display string or a boolean.\n     */\n    set visible(style: string | boolean) {\n        if (this.element) {\n            if (typeof style === 'boolean') {\n                style = style ? 'inline-block' : 'none';\n            }\n            this.element.style.display = style\n        }\n    }\n\n    /**\n     * Applies custom styles to the toolbar button and its SVG child element, if provided in the options.\n     *\n     * - If `options.buttonStyle` is defined, it merges the style properties into the button's element.\n     * - If `options.svgStyle` is defined, it merges the style properties into the first child element (assumed to be an SVG).\n     *\n     * @private\n     */\n    private _styleButton = (): void => {\n        if (this.element) {\n            if (this.options.buttonStyle) {\n                Object.assign(this.element.style, this.options.buttonStyle);\n            }\n            if (this.options.svgStyle) {\n                const childElement = this.element.children[0] as HTMLElement; // Type assertion\n                if (childElement) {\n                    Object.assign(childElement.style, this.options.svgStyle);\n                }\n            }\n        }\n    }\n\n}","import Action from '../Action';\nimport BlotFormatter from '../../BlotFormatter';\nimport DefaultAligner from './DefaultAligner';\nimport ToolbarButton from '../toolbar/ToolbarButton';\nimport { Alignment } from './Alignment';\n\n/**\n * Provides alignment actions for Quill editor blots, including creating, managing,\n * and handling alignment toolbar buttons. Integrates with a `DefaultAligner` to\n * apply, clear, and detect alignment on selected blots. Handles UI state for\n * alignment buttons and supports debug logging.\n *\n * @remarks\n * This class is intended to be used as part of a Quill blot formatter extension,\n * enabling users to align embedded content (such as images or videos) via a toolbar.\n *\n * @extends Action\n *\n * @example\n * ```typescript\n * const alignAction = new AlignAction(formatter);\n * alignAction.onCreate();\n * // ... user interacts with toolbar ...\n * alignAction.onDestroy();\n * ```\n */\nexport default class AlignAction extends Action {\n  aligner: DefaultAligner;\n  alignButtons: Record<string, ToolbarButton> = {};\n\n  constructor(formatter: BlotFormatter) {\n    super(formatter);\n    this.aligner = new DefaultAligner(formatter);\n    if (formatter.options.debug) console.debug('AlignAction Aligner created:', this.aligner);\n  }\n\n  /**\n   * Creates alignment toolbar buttons for each available alignment option.\n   * \n   * Iterates over the alignments provided by the aligner and creates a `ToolbarButton`\n   * for each alignment, storing them in the `alignButtons` map. If there is a currently\n   * selected blot, it checks its alignment and preselects the corresponding button.\n   * Optionally logs debug information about the created buttons and the current alignment.\n   *\n   * @private\n   */\n  private _createAlignmentButtons = (): void => {\n    for (const alignment of Object.values(this.aligner.alignments)) {\n      this.alignButtons[alignment.name] = new ToolbarButton(\n        alignment.name,\n        this.onClickHandler,\n        this.formatter.options.toolbar\n      )\n    }\n    const targetBlot = this.formatter.currentSpec?.getTargetBlot();\n    if (targetBlot) {\n      const alignment: string | undefined = this.aligner.getAlignment(targetBlot);\n      if (alignment && this.alignButtons[alignment]) {\n        this.alignButtons[alignment].preselect = () => { return true };\n      }\n      if (this.debug) {\n        console.debug('AlignAction alignment buttons created:', this.alignButtons);\n        console.debug('Blot alignment on load:', alignment);\n      }\n    }\n  }\n\n  /**\n   * Clears the selection state of all alignment buttons.\n   *\n   * Iterates through all buttons in the `alignButtons` collection and sets their\n   * `selected` property to `false`. If debugging is enabled, logs a message to the console.\n   *\n   * @private\n   */\n  private _clearButtons = (): void => {\n    for (const button of Object.values(this.alignButtons)) {\n      button.selected = false;\n    }\n    if (this.debug) console.debug('AlignAction alignment buttons cleared');\n  }\n\n  /**\n   * Handles click events on alignment toolbar buttons.\n   *\n   * This event handler determines which alignment action was triggered by the user,\n   * retrieves the corresponding alignment configuration, and applies or clears the alignment\n   * on the currently selected blot in the editor. It also updates the toolbar button states\n   * and logs debug information if enabled.\n   *\n   * @param event - The click event triggered by the user on a toolbar button.\n   */\n  onClickHandler: EventListener = (event: Event): void => {\n    const button: HTMLElement | null = (event.target as HTMLElement)\n      .closest(`span.${this.formatter.options.toolbar.buttonClassName}`);\n    if (!!button) {\n      const action:string = button.dataset.action || '';\n      const targetBlot = this.formatter.currentSpec?.getTargetBlot();\n      if (!!action && !!targetBlot) {\n        const alignment: Alignment = this.aligner.alignments[action];\n        this._clearButtons();\n        if (this.aligner.isAligned(targetBlot, alignment)) {\n          this.aligner.clear(targetBlot);\n          if (this.debug) {\n            console.debug('AlignAction clear alignment:', action, targetBlot);\n          }\n        } else {\n          this.aligner.setAlignment(targetBlot, action);\n          this.alignButtons[action].selected = true;\n          if (this.debug) {\n            console.debug('AlignAction set alignment:', action, targetBlot);\n          }\n        }\n      }\n    }\n    this.formatter.update();\n  }\n\n  /**\n   * Initializes the alignment action by creating alignment buttons and storing them in the toolbar.\n   * If debug mode is enabled in the formatter options, logs the created alignment buttons to the console.\n   *\n   * @returns {void}\n   */\n  onCreate = (): void => {\n    this._createAlignmentButtons();\n    this.toolbarButtons = Object.values(this.alignButtons);\n    if (this.formatter.options.debug) console.debug('AlignAction alignment buttons created:', this.toolbarButtons);\n  }\n\n  /**\n   * Cleans up resources used by the alignment action.\n   * \n   * This method resets the `alignButtons` object and clears the `toolbarButtons` array.\n   * If debug mode is enabled in the formatter options, a debug message is logged to the console.\n   *\n   * @returns {void}\n   */\n  onDestroy = (): void => {\n    this.alignButtons = {};\n    this.toolbarButtons = [];\n    if (this.formatter.options.debug) console.debug('AlignAction alignment buttons destroyed');\n  }\n}\n","import Action from './Action';\n\n/**\n * Represents an action that handles deletion of a selected blot in a Quill editor.\n * \n * The `DeleteAction` class listens for keyboard and input events to detect when the user\n * presses the 'Delete' or 'Backspace' keys. If a blot is selected and no modal is open,\n * it deletes the corresponding blot from the editor and hides the formatter UI.\n * \n * @remarks\n * - Event listeners are attached on creation and removed on destruction to prevent memory leaks.\n * - The action only triggers when a blot is selected and no modal dialog with attribute `data-blot-formatter-modal` is open.\n * \n * @example\n * ```typescript\n * const deleteAction = new DeleteAction(formatter);\n * deleteAction.onCreate();\n * // ... later\n * deleteAction.onDestroy();\n * ```\n */\nexport default class DeleteAction extends Action {\n  /**\n   * Initializes event listeners for the delete action.\n   * \n   * - Adds a 'keyup' event listener to the document that triggers `_onKeyUp`.\n   * - Adds an 'input' event listener to the Quill editor's root element that also triggers `_onKeyUp`.\n   * \n   * This method should be called when the delete action is created to ensure\n   * proper handling of keyboard and input events.\n   */\n  onCreate = (): void => {\n    document.addEventListener('keyup', this._onKeyUp);\n    this.formatter.quill.root.addEventListener('input', this._onKeyUp);\n  }\n\n  /**\n   * Cleans up event listeners associated with the action.\n   * \n   * Removes the 'keyup' event listener from the document and the 'input' event listener\n   * from the Quill editor's root element to prevent memory leaks and unintended behavior\n   * after the action is destroyed.\n   */\n  onDestroy = (): void => {\n    document.removeEventListener('keyup', this._onKeyUp);\n    this.formatter.quill.root.removeEventListener('input', this._onKeyUp);\n  }\n\n  /**\n   * Handles the keyup event for delete and backspace actions.\n   * \n   * If no modal is open and a current spec is selected, checks if the pressed key is\n   * 'Delete' or 'Backspace'. If so, finds the target blot element in the Quill editor,\n   * determines its index, and deletes one character at that index. Afterwards, hides the formatter UI.\n   * \n   * @param e - The keyboard event triggered by the user.\n   */\n  private _onKeyUp = (e: KeyboardEvent): void => {\n    const modalOpen: boolean = !!document.querySelector('[data-blot-formatter-modal]')\n    if (!this.formatter.currentSpec || modalOpen) {\n      return;\n    }\n    // delete or backspace\n    if (e.code === 'Delete' || e.code === 'Backspace') {\n      if (this.debug) {\n        console.debug('DeleteAction keyup detected:', e.code);\n      }\n      // Get the target element from the current spec\n      const targetElement = this.formatter.currentSpec.getTargetElement();\n      if (targetElement) {\n        const blot = this.formatter.Quill.find(targetElement);\n        if (blot) {\n          const index = this.formatter.quill.getIndex(blot);\n          this.formatter.quill.deleteText(index, 1, \"user\"); // Deletes 1 character from index position\n        }\n      }\n      this.formatter.hide();\n    }\n  };\n}\n","import Action from './Action';\nimport BlotFormatter from '../BlotFormatter';\nimport ToolbarButton from './toolbar/ToolbarButton';\n\ninterface HandleStyle {\n  width?: string;\n  height?: string;\n}\n\n/**\n * Provides interactive resizing functionality for elements within a Quill editor overlay.\n * \n * `ResizeAction` manages the creation, positioning, and behavior of resize handles for supported elements\n * (such as images, videos, and iframes), allowing users to adjust their size via mouse or touch gestures.\n * It supports both absolute (pixel-based) and relative (percentage-based) sizing modes, aspect ratio maintenance,\n * and optional oversize protection for images. The class also integrates with a toolbar for toggling resize modes,\n * displays live size information, and ensures proper cleanup of DOM elements and event listeners.\n * \n * @remarks\n * - Handles mouse and touch events for resizing, including pinch-to-resize gestures.\n * - Maintains aspect ratio and supports custom aspect ratios for unclickable elements.\n * - Integrates with a toolbar for resize mode switching.\n * - Displays live size info and manages fade-out transitions.\n * - Supports oversize protection for images and SVG detection.\n * - Ensures proper cleanup to prevent memory leaks.\n * \n * @example\n * ```typescript\n * const resizeAction = new ResizeAction(formatter);\n * resizeAction.onCreate();\n * // ... user interacts with overlay ...\n * resizeAction.onDestroy();\n * ```\n */\nexport default class ResizeAction extends Action {\n  private _topLeftHandle: HTMLElement;\n  private _topRightHandle: HTMLElement;\n  private _bottomRightHandle: HTMLElement;\n  private _bottomLeftHandle: HTMLElement;\n  private _dragHandle: HTMLElement | null | undefined = null;\n  private _dragStartX: number = 0;\n  private _dragCursorStyle: HTMLElement;\n  private _preDragWidth: number = 0;\n  private _pinchStartDistance: number = 0;\n  private _calculatedAspectRatio: number = 0;\n  private _computedAspectRatio: string | undefined = undefined;\n  private _target: HTMLElement | null | undefined;\n  private _editorStyle: CSSStyleDeclaration | undefined;\n  private _editorWidth: number = 0;\n  private _useRelativeSize: boolean;\n  private _resizeModeButton: ToolbarButton | null = null;\n  private _isUnclickable: boolean = false;\n  private _hasResized: boolean = false;\n  private _formattedWidth: string = '';\n  private _sizeInfoTimerId: ReturnType<typeof setTimeout> | null = null;\n  private _isImage: boolean = false;\n  private _isSVG: boolean = false;\n  private _naturalWidth: number | undefined = undefined;\n\n  constructor(formatter: BlotFormatter) {\n    super(formatter);\n    this._topLeftHandle = this._createHandle('top-left', 'nwse-resize');\n    this._topRightHandle = this._createHandle('top-right', 'nesw-resize');\n    this._bottomRightHandle = this._createHandle('bottom-right', 'nwse-resize');\n    this._bottomLeftHandle = this._createHandle('bottom-left', 'nesw-resize');\n    this._dragCursorStyle = document.createElement('style');\n    this._useRelativeSize = this.formatter.options.resize.useRelativeSize;\n    if (formatter.options.resize.allowResizeModeChange) {\n      this._resizeModeButton = this._createResizeModeButton();\n      this.toolbarButtons = [\n        this._resizeModeButton\n      ]\n    }\n  }\n\n  /**\n   * Initializes the resize action by setting up the target element, determining its type,\n   * and appending resize handles to the overlay. Also attaches mouse and touch event listeners\n   * to the overlay for handling user interactions. Finally, positions the handles according to\n   * the specified style options.\n   *\n   * @remarks\n   * This method should be called when the resize action is created to ensure all necessary\n   * DOM elements and event listeners are properly initialized.\n   */\n  onCreate = (): void => {\n    this._target = this.formatter.currentSpec?.getTargetElement();\n    this._isUnclickable = this.formatter.currentSpec?.isUnclickable || false;\n    this._isImage = this._target instanceof HTMLImageElement;\n    if (this._isImage) {\n      this._isSVG = this._isSvgImage();\n    }\n\n    this.formatter.overlay.append(\n      this._topLeftHandle, this._topRightHandle,\n      this._bottomRightHandle, this._bottomLeftHandle\n    );\n    this.formatter.overlay.addEventListener('mousedown', this._onOverlayMouseDown)\n    this.formatter.overlay.addEventListener('mouseup', this._onOverlayMouseUp)\n\n    const passiveFalse = { passive: false } as EventListenerOptions;\n    this.formatter.overlay.addEventListener('touchstart', this._onOverlayTouchStart, passiveFalse);\n    this.formatter.overlay.addEventListener('touchmove', this._onOverlayTouchMove, passiveFalse);\n    this.formatter.overlay.addEventListener('touchend', this._onOverlayTouchEnd, passiveFalse);\n\n    const handleStyle: HandleStyle = this.formatter.options.resize.handleStyle || {};\n    this._repositionHandles(handleStyle);\n    if (this.debug) {\n      console.debug('ResizeAction created with target:', this._target, 'isUnclickable:', this._isUnclickable);\n    }\n  }\n\n  /**\n   * Cleans up resources and event listeners associated with the resize action.\n   * \n   * This method resets internal state, removes resize handles from the overlay,\n   * detaches mouse and touch event listeners, and triggers an update on the formatter.\n   * \n   * Should be called when the resize action is no longer needed to prevent memory leaks\n   * and unintended behavior.\n   */\n  onDestroy = (): void => {\n    this._target = null;\n    this._isUnclickable = false;\n    this._isImage = false;\n    this._naturalWidth = undefined;\n    this._isSVG = false;\n    this._setCursor('');\n    [\n      this._topLeftHandle, this._topRightHandle,\n      this._bottomRightHandle, this._bottomLeftHandle\n    ].forEach(handle => { handle.remove(); });\n    this.formatter.overlay.removeEventListener('mousedown', this._onOverlayMouseDown);\n    this.formatter.overlay.removeEventListener('mouseup', this._onOverlayMouseUp);\n\n    const passiveFalse = { passive: false } as EventListenerOptions;\n    this.formatter.overlay.removeEventListener('touchstart', this._onOverlayTouchStart, passiveFalse);\n    this.formatter.overlay.removeEventListener('touchmove', this._onOverlayTouchMove, passiveFalse);\n    this.formatter.overlay.removeEventListener('touchend', this._onOverlayTouchEnd, passiveFalse);\n    this.formatter.update();\n  }\n\n  /**\n   * Creates a resize handle element for the specified position with the given cursor style.\n   *\n   * The handle is styled using the class name and optional style provided in the formatter's options.\n   * It also sets a `data-position` attribute and attaches a pointer down event listener.\n   *\n   * @param position - The position identifier for the handle (e.g., 'top-left', 'bottom-right').\n   * @param cursor - The CSS cursor style to apply when hovering over the handle.\n   * @returns The created HTMLElement representing the resize handle.\n   */\n  private _createHandle = (position: string, cursor: string): HTMLElement => {\n    // create resize handles\n    const box = document.createElement('div');\n    box.classList.add(this.formatter.options.resize.handleClassName);\n    box.setAttribute('data-position', position);\n    box.style.cursor = cursor;\n    if (this.formatter.options.resize.handleStyle) {\n      Object.assign(box.style, this.formatter.options.resize.handleStyle);\n    }\n    box.addEventListener('pointerdown', this._onHandlePointerDown);\n    return box;\n  }\n\n  /**\n   * Repositions the resize handles around an element based on the provided handle style.\n   *\n   * @param handleStyle - Optional style object containing width and height properties for the handles.\n   *                      If provided, the handles are offset by half their width and height to center them.\n   *                      If not provided, default offsets of '0px' are used.\n   *\n   * The method updates the `left`, `right`, `top`, and `bottom` CSS properties of the four handles\n   * (`_topLeftHandle`, `_topRightHandle`, `_bottomRightHandle`, `_bottomLeftHandle`) to ensure they are\n   * correctly positioned relative to the element being resized.\n   */\n  private _repositionHandles = (handleStyle?: HandleStyle): void => {\n    // Cache offset calculations\n    const handleXOffset = handleStyle?.width ? `${-parseFloat(handleStyle.width) / 2}px` : '0px';\n    const handleYOffset = handleStyle?.height ? `${-parseFloat(handleStyle.height) / 2}px` : '0px';\n\n    // Use direct property assignment instead of Object.assign for better performance\n    const { style: topLeftStyle } = this._topLeftHandle;\n    topLeftStyle.left = handleXOffset;\n    topLeftStyle.top = handleYOffset;\n\n    const { style: topRightStyle } = this._topRightHandle;\n    topRightStyle.right = handleXOffset;\n    topRightStyle.top = handleYOffset;\n\n    const { style: bottomRightStyle } = this._bottomRightHandle;\n    bottomRightStyle.right = handleXOffset;\n    bottomRightStyle.bottom = handleYOffset;\n\n    const { style: bottomLeftStyle } = this._bottomLeftHandle;\n    bottomLeftStyle.left = handleXOffset;\n    bottomLeftStyle.bottom = handleYOffset;\n  }\n\n  /**\n   * Sets the cursor style for the document body and all its children.\n   * When a non-empty value is provided, it applies the specified cursor style\n   * globally by injecting a style element into the document head.\n   * When an empty value is provided, it removes the previously injected style element,\n   * reverting the cursor to its default behavior.\n   *\n   * @param value - The CSS cursor value to apply (e.g., 'pointer', 'col-resize').\n   */\n  private _setCursor = (value: string): void => {\n    if (!document.body) {\n      console.warn('ResizeAction: Cannot set cursor - document.body is null');\n      return;\n    }\n\n    try {\n      if (value) {\n        this._dragCursorStyle.innerHTML = `body, body * { cursor: ${value} !important; }`;\n        if (!document.head.contains(this._dragCursorStyle)) {\n          document.head.appendChild(this._dragCursorStyle);\n        }\n      } else {\n        if (document.head.contains(this._dragCursorStyle)) {\n          document.head.removeChild(this._dragCursorStyle);\n        }\n      }\n    } catch (error) {\n      console.error('ResizeAction: Error setting cursor style:', error);\n    }\n  }\n\n  /**\n   * Activates or deactivates the resize mode for the target element.\n   * \n   * When activated, prepares the target for resizing by determining the resize mode (absolute or relative),\n   * calculating editor and target dimensions, handling aspect ratio logic, and displaying size information.\n   * When deactivated, applies the finalized width to the _target, updates toolbar button states, sets style attributes,\n   * clears cached natural width, updates the formatter, and hides the size info box.\n   * \n   * @param activate - If `true`, activates resize mode; if `false`, finalizes and deactivates resize mode.\n   */\n  private _resizeMode = (activate: boolean): void => {\n    if (activate) {\n      // activate resize mode, show size info\n      this._hasResized = false;\n      this._formattedWidth = '';\n      if (!!this._target) {\n        // determine resize mode to use (absolute/relative)\n        this._useRelativeSize = this.formatter._useRelative(this._target);\n        // get inner editor width to calculate % values\n        this._editorStyle = getComputedStyle(this.formatter.quill.root);\n        this._editorWidth = this.formatter.quill.root.clientWidth -\n          parseFloat(this._editorStyle.paddingLeft) -\n          parseFloat(this._editorStyle.paddingRight);\n\n        const rect = this._target.getBoundingClientRect();\n        // prevent division by zero in the case that rect.height is 0 for some reason\n        if (rect.height === undefined || rect.height === 0) {\n          rect.height = this._target.clientHeight + 1;\n        }\n        this._preDragWidth = rect.width;\n        this._computedAspectRatio = getComputedStyle(this._target).aspectRatio || 'auto'\n        this._calculatedAspectRatio = rect.width / rect.height;\n\n        if (this._useRelativeSize) {\n          if (this._isUnclickable) {\n            // strip height for relative iframe sizing, rely on aspect-ratio instead\n            if (this._computedAspectRatio === 'auto') {\n              // relative size on iframe requires aspect-ratio to be set - use default from options\n              this._target.style.aspectRatio = this.formatter.options.video.defaultAspectRatio;\n              console.warn(\n                `No iframe aspect-ratio set. Set an aspect ratio either via custom blot or css.\\n` +\n                `Using temporary aspect ratio \"${this.formatter.options.video.defaultAspectRatio}\"`\n              );\n            }\n          }\n        } else {\n          if (this._isUnclickable && this._computedAspectRatio !== 'auto') {\n            // if aspect-ratio set via blot or css, try to use that ratio for new height instead\n            const ratio = this._computedAspectRatio.match(/(\\d+)\\s*\\/\\s*(\\d+)/);\n            if (ratio) {\n              try {\n                this._calculatedAspectRatio = parseFloat(ratio[1]) / parseFloat(ratio[2]);\n              } catch { }\n            }\n          }\n        }\n        // get natural width if oversize protection on and resize mode is absolute (not relative) - excludes SVG\n        if (this._isImage && !this._useRelativeSize && !this._isSVG && this.formatter.options.resize.imageOversizeProtection) {\n          this._naturalWidth = (this._target as HTMLImageElement).naturalWidth;\n        }\n        // show size info box\n        this._showSizeInfo(true, rect.width, rect.height);\n        if (this.debug) {\n          console.debug('ResizeAction resize mode activated:', {\n            target: this._target,\n            useRelativeSize: this._useRelativeSize,\n            editorWidth: this._editorWidth,\n            preDragWidth: this._preDragWidth,\n            aspectRatio: this._calculatedAspectRatio,\n            computedAspectRatio: this._computedAspectRatio\n          });\n        }\n      }\n    } else {\n      if (this._target && this._hasResized) {\n        // round dimensions to whole numbers\n        let width: string = this._roundDimension(this._formattedWidth);\n        this._target.setAttribute('width', width);\n        // set resize mode button selected status if inuded in toolbar\n        if (this.formatter.toolbar.buttons['resizeMode']) {\n          this.formatter.toolbar.buttons['resizeMode'].selected = this.isRelative;\n        }\n        // set --resize-width style attribute and data-relative-size attribute\n        if (this._isUnclickable) {\n          this._target.style.setProperty('--resize-width', `${width}`);\n          this._target.dataset.relativeSize = `${this.isRelative}`\n        } else {\n          if (this.isAligned && this._target.parentElement) {\n            this._target.parentElement.style.setProperty('--resize-width', `${width}`);\n            this._target.parentElement.dataset.relativeSize = `${this.isRelative}`\n          }\n        }\n        if (this.debug) {\n          console.debug('ResizeAction resize mode deactivated:', {\n            target: this._target,\n            width: width,\n            isRelative: this.isRelative,\n            isAligned: this.isAligned\n          });\n        }\n      }\n      // clear any cached image natural width\n      this._naturalWidth = undefined;\n\n      this.formatter.update();\n      // fade out size info box\n      this._showSizeInfo(false);\n    }\n  };\n\n  /**\n   * Handles the pointer down event on a resize handle.\n   * \n   * Initiates the resize mode, sets up the drag handle, and stores the starting X position.\n   * Adds event listeners for pointer move and pointer up to enable drag behavior.\n   * \n   * @param event - The pointer event triggered when the user presses down on a resize handle.\n   */\n  private _onHandlePointerDown = (event: PointerEvent): void => {\n    this._resizeMode(true);\n    if (event.target instanceof HTMLElement && !!this._target) {\n      this._dragHandle = event.target;\n      this._setCursor(this._dragHandle.style.cursor);\n      this._dragStartX = event.clientX;\n      // enable drag behaviour until pointer up event\n      document.addEventListener('pointermove', this._onHandleDrag);\n      document.addEventListener('pointerup', this._onHandlePointerUp);\n    }\n  };\n\n  /**\n   * Handles the drag event for a resize handle, updating the target element's width.\n   *\n   * Calculates the new width based on the pointer's movement and the initial drag position.\n   * Ensures the new width stays within the editor's bounds and does not shrink below the minimum allowed width.\n   * Applies the new width to both the target element and its overlay.\n   *\n   * @param event - The pointer event triggered during dragging.\n   */\n  private _onHandleDrag = (event: PointerEvent): void => {\n    // If no target element or drag handle is set, exit early\n    if (!this._target || !this._dragHandle) return;\n\n    // Mark that a resize has occurred\n    this._hasResized = true;\n\n    // Calculate horizontal movement since drag started\n    const deltaX = event.clientX - this._dragStartX;\n\n    // Determine if the dragged handle is on the left side\n    const isLeftHandle =\n      this._dragHandle === this._topLeftHandle ||\n      this._dragHandle === this._bottomLeftHandle;\n\n    // Calculate new width: subtract delta for left handles, add for right handles\n    const newWidth = Math.round(\n      isLeftHandle ? this._preDragWidth - deltaX : this._preDragWidth + deltaX\n    );\n\n    // Constrain the new width between minimum and editor width\n    const constrainedWidth = Math.max(\n      Math.min(newWidth, this._editorWidth),\n      this.formatter.options.resize.minimumWidthPx\n    );\n\n    // Resize the target element to the constrained width\n    this._resizeTarget(constrainedWidth);\n  };\n\n  /**\n   * Handles the pointer up event on the resize handle.\n   * \n   * This method disables resize mode, resets the cursor style,\n   * and removes the event listeners for pointer movement and pointer up events.\n   * It is typically called when the user releases the pointer after resizing.\n   */\n  private _onHandlePointerUp = (): void => {\n    // disable resize mode, reset cursor, tidy up\n    this._setCursor('');\n    this._resizeMode(false);\n    // remove resize event listeners\n    document.removeEventListener('pointermove', this._onHandleDrag);\n    document.removeEventListener('pointerup', this._onHandlePointerUp);\n  };\n\n  /**\n   * Handles the touch start event on the overlay element.\n   * If the overlay itself is the _target, enables resize mode.\n   * When two fingers touch the target element, prevents default scrolling,\n   * calculates the initial distance between the fingers for pinch-to-resize,\n   * and stores the initial width of the target element.\n   *\n   * @param event - The touch event triggered on the overlay.\n   */\n  private _onOverlayTouchStart = (event: TouchEvent): void => {\n    if (event.target === this.formatter.overlay) {\n      this._resizeMode(true);\n      if (!!this._target && event.touches.length === 2) {\n        event.preventDefault(); // Prevent default touch behavior like scrolling\n        // Calculate the initial distance between two fingers\n        this._pinchStartDistance = this._calculateDistance(event.touches[0], event.touches[1]);\n        // Get the initial width of the element\n        this._preDragWidth = this._target.clientWidth;\n      }\n    }\n  }\n\n  /**\n   * Handles touch move events on the overlay for resizing the target element via pinch gestures.\n   *\n   * When two fingers are detected on the overlay, calculates the distance between them to determine\n   * the scale factor for resizing. The new width is constrained between a minimum of 10px and the\n   * maximum editor width. Prevents default touch behavior such as scrolling during the gesture.\n   *\n   * @param event - The touch event triggered by user interaction.\n   */\n  private _onOverlayTouchMove = (event: TouchEvent): void => {\n    if (event.target === this.formatter.overlay) {\n      if (!!this._target && event.touches.length === 2 && this._pinchStartDistance !== null && this._preDragWidth !== null) {\n        event.preventDefault(); // Prevent default touch behaviour like scrolling\n        if (this._target) {\n          this._hasResized = true;\n          // Calculate the current distance between two fingers\n          const currentDistance = this._calculateDistance(event.touches[0], event.touches[1]);\n          // Calculate the scale factor & new width\n          const scale = currentDistance / this._pinchStartDistance;\n          let newWidth: number = Math.round(this._preDragWidth * scale);\n          // ensure width does not grow beyond editor width or shrink below 10px\n          newWidth = Math.max(Math.min(newWidth, this._editorWidth), 10);\n          // resize target + overlay\n          this._resizeTarget(newWidth);\n        }\n      }\n    }\n  }\n\n  /**\n   * Handles the touch end event on the overlay element.\n   * If the touch event's target is the formatter's overlay, it disables resize mode.\n   *\n   * @param event - The touch event triggered on the overlay.\n   */\n  private _onOverlayTouchEnd = (event: TouchEvent): void => {\n    if (event.target === this.formatter.overlay) {\n      this._resizeMode(false);\n    }\n  }\n\n  /**\n   * Handles the mouse down event on the overlay element.\n   * If the event target is the formatter's overlay, enables resize mode.\n   *\n   * @param event - The mouse event triggered by the user interaction.\n   */\n  private _onOverlayMouseDown = (event: MouseEvent): void => {\n    if (event.target === this.formatter.overlay) {\n      this._resizeMode(true);\n    }\n  }\n\n  /**\n   * Handles the mouse up event on the overlay element.\n   * If the event target is the formatter's overlay, it disables resize mode.\n   *\n   * @param event - The mouse event triggered when the user releases the mouse button.\n   */\n  private _onOverlayMouseUp = (event: MouseEvent): void => {\n    if (event.target === this.formatter.overlay) {\n      this._resizeMode(false);\n    }\n  }\n\n  /**\n   * Resizes the target element to the specified width, maintaining aspect ratio and updating related UI elements.\n   *\n   * - Limits the new width if image oversize protection is enabled.\n   * - Calculates the new height based on the aspect ratio.\n   * - Updates the size information display.\n   * - Sets the new width and height attributes on the target element.\n   * - Applies the width style property to the wrapper if the image is aligned.\n   * - Handles special cases for unclickable elements and absolute sizing.\n   * - Triggers an update to the overlay position.\n   *\n   * @param newWidth - The desired new width for the target element.\n   */\n  private _resizeTarget = (newWidth: number): void => {\n    if (!this._target) {\n      console.warn('ResizeAction: Cannot resize - target element is null');\n      return;\n    }\n\n    try {\n      // if image oversize protection on, limit newWidth\n      // this._naturalWidth only has value when target is image and protextion is on (set in _resizeMode)\n      newWidth = Math.min(this._naturalWidth ?? Infinity, newWidth);\n      // update size info display\n      const newHeight: number = newWidth / this._calculatedAspectRatio;\n      this._updateSizeInfo(newWidth, newHeight);\n      // set new dimensions on _target\n      if (this.formatter._useRelative(this._target)) {\n        this._formattedWidth = `${100 * newWidth / this._editorWidth}%`;\n      } else {\n        this._formattedWidth = `${newWidth}px`;\n      }\n      this._target.setAttribute('width', this._formattedWidth);\n      this._target.setAttribute('height', 'auto');\n\n      // update width style property to wrapper if image and has imageAlign format\n      // width needed to size wrapper correctly via css\n      // set fixed height to unclickable if using absolute size mode and no aspect ratio given\n      if (this._isUnclickable) {\n        if (!this._useRelativeSize && this._computedAspectRatio === 'auto') {\n          this._target.setAttribute('height', `${newHeight | 0}px`);\n        }\n        this._target.style.setProperty('--resize-width', this._formattedWidth);\n      } else {\n        if (this.isAligned && !!this._target.parentElement) {\n          this._target.parentElement.style.setProperty('--resize-width', this._formattedWidth);\n        }\n        if (!this._useRelativeSize && !this.formatter.options.image.autoHeight) {\n          this._target.setAttribute('height', `${newHeight | 0}px`);\n        }\n      }\n      // updates overlay position\n      this.formatter.update();\n    } catch (error) {\n      console.error('ResizeAction: Error resizing target element:', error);\n    }\n  }\n\n  /**\n   * Shows or hides the size information box for the formatter.\n   *\n   * When `show` is `true`, cancels any existing size info timer, updates the size info\n   * if `width` and `height` are provided, and makes the size info box visible.\n   * When `show` is `false`, fades out and closes the size info box.\n   *\n   * @param show - Whether to show (`true`) or hide (`false`) the size info box.\n   * @param width - The width to display in the size info box (optional).\n   * @param height - The height to display in the size info box (optional).\n   */\n  private _showSizeInfo = (show: boolean, width: number | null = null, height: number | null = null): void => {\n    if (show) {\n      this._cancelSizeInfoTimer();\n      if (width !== null && height !== null) {\n        this._updateSizeInfo(width, height);\n      }\n      this.formatter.sizeInfo.style.transition = '';\n      this.formatter.sizeInfo.style.opacity = '1';\n    }\n    else {\n      // fade out size info box\n      this._closeSizeInfo();\n    }\n  }\n\n  /**\n   * Updates the size information display for the selected blot.\n   *\n   * - Rounds the provided width and height to the nearest integer.\n   * - Formats the size string as \"width x height px\".\n   * - If the size is relative, displays the percentage relative to the editor width,\n   *   with the actual pixel size in brackets.\n   * - If the size is absolute and the blot has not been resized:\n   *   - If the target element has a `width` attribute that differs from the displayed width,\n   *     shows the attribute value and its calculated height, with the displayed size in brackets.\n   *   - If the target is an image and its natural dimensions differ from the displayed size,\n   *     shows the natural dimensions with the displayed size in brackets.\n   * - Updates the `sizeInfo` element in the formatter with the computed size string.\n   *\n   * @param width - The displayed width of the blot.\n   * @param height - The displayed height of the blot.\n   */\n  private _updateSizeInfo = (width: number, height: number): void => {\n    // Round width and height to nearest integer for display\n    const roundedWidth = Math.round(width);\n    const roundedHeight = Math.round(height);\n    // Default size string in \"width x height px\" format\n    let size = `${roundedWidth} x ${roundedHeight}px`;\n\n    if (this.isRelative) {\n      // If using relative sizing, calculate percentage of editor width\n      const percentage = Math.round(100 * width / this._editorWidth);\n      // Show percentage and actual pixel size in brackets\n      size = `${percentage}% (${size})`;\n    } else if (!this._hasResized && this._target) {\n      // If not resized yet and target exists, check for set width attribute\n      const setWidth = this._target.getAttribute('width');\n      if (setWidth) {\n        // If set width differs from current width, show set width and calculated height\n        const setWidthNum = parseFloat(setWidth);\n        if (setWidthNum !== width) {\n          const aspectRatio = width / height;\n          const calculatedHeight = Math.round(setWidthNum / aspectRatio);\n          size = `${setWidth} x ${calculatedHeight}px (${size})`;\n        }\n      } else if (this._target instanceof HTMLImageElement) {\n        // For images, if natural width differs, show natural dimensions\n        const { naturalWidth, naturalHeight } = this._target;\n        if (naturalWidth !== width) {\n          size = `${naturalWidth} x ${naturalHeight}px (${size})`;\n        }\n      }\n    }\n\n    // Update the formatter's size info element with the computed size string\n    this.formatter.sizeInfo.innerText = size;\n  }\n\n  get isRelative(): boolean {\n    return this._target?.getAttribute('width')?.endsWith('%') || false;\n  }\n\n  get isAligned(): boolean {\n    if (this._target) {\n      return this._target.hasAttribute('data-blot-align');\n    } else {\n      return false;\n    }\n  }\n\n  /**\n   * Creates a toolbar button for toggling the resize mode.\n   *\n   * The button is initialized with a unique identifier, a click handler, and toolbar options.\n   * The `preselect` property is set to indicate whether the resize mode is currently relative.\n   *\n   * @returns {ToolbarButton} The configured resize mode toolbar button.\n   */\n  private _createResizeModeButton = (): ToolbarButton => {\n    const button = new ToolbarButton(\n      'resizeMode',\n      this._onResizeModeClickHandler,\n      this.formatter.options.toolbar,\n    );\n    button.preselect = () => {\n      return this.isRelative;\n    }\n    return button\n  }\n\n  /**\n   * Handles the click event for the resize mode control.\n   * Stops the event from propagating further and swaps the resize mode.\n   *\n   * @param event - The event object triggered by the click.\n   */\n  private _onResizeModeClickHandler: EventListener = (event: Event): void => {\n    event.stopImmediatePropagation();\n    this._swapResizeMode(true);\n  }\n\n  /**\n   * Swaps the resize mode of the target element between relative (percentage-based) and absolute (pixel-based) sizing.\n   * Updates the _target's width and height attributes, as well as relevant CSS custom properties and data attributes,\n   * depending on the current resize mode and alignment. Also updates the toolbar button state and optionally displays\n   * size information.\n   *\n   * @param showInfo - If true, displays size information after resizing.\n   */\n  private _swapResizeMode = (showInfo: boolean = false): void => {\n    if (this._target) {\n      const rect: DOMRect = this._target.getBoundingClientRect();\n      this._editorStyle = getComputedStyle(this.formatter.quill.root);\n      this._editorWidth = this.formatter.quill.root.clientWidth -\n        parseFloat(this._editorStyle.paddingLeft) -\n        parseFloat(this._editorStyle.paddingRight);\n      let newWidth, newHeight: string;\n      if (this.isRelative) {\n        newWidth = `${Math.round(rect.width)}px`;\n        newHeight = this.formatter.options.image.autoHeight \n          ? 'auto' \n          : `${Math.round(rect.height)}px`;\n      } else {\n        newWidth = `${Math.round(100 * rect.width / this._editorWidth)}%`;\n        newHeight = 'auto';\n      }\n      this._target.setAttribute('width', `${newWidth}`);\n      this._target.setAttribute('height', `${newHeight}`);\n      if (this.formatter.currentSpec?.isUnclickable) {\n        this._target.style.setProperty('--resize-width', `${newWidth}`);\n        this._target.dataset.relativeSize = `${this.isRelative}`;\n      } else {\n        if (this.isAligned && this._target.parentElement) {\n          this._target.parentElement.style.setProperty('--resize-width', `${newWidth}`);\n          this._target.parentElement.dataset.relativeSize = `${this.isRelative}`;\n        }\n      }\n      this.formatter.toolbar.buttons['resizeMode'].selected = this.isRelative;\n      this.formatter.update();\n      if (showInfo) {\n        this._showSizeInfo(true, rect.width, rect.height);\n        this._showSizeInfo(false);\n      }\n      if (this.debug) {\n        console.debug('ResizeAction resize mode swapped:', {\n          target: this._target,\n          newWidth: newWidth,\n          isRelative: this.isRelative,\n          isAligned: this.isAligned\n        });\n      }\n    }\n  }\n\n  /**\n   * Initiates a timer to fade out the size information element after a delay.\n   * Sets the opacity of the `sizeInfo` element to 0 with a transition effect after 1 second.\n   * Stores the timer ID in `_sizeInfoTimerId` for potential future reference or cancellation.\n   */\n  private _closeSizeInfo = (): void => {\n    this._sizeInfoTimerId = setTimeout(() => {\n      this.formatter.sizeInfo.style.transition = 'opacity 1s';\n      this.formatter.sizeInfo.style.opacity = '0';\n    }, 1000);\n  }\n\n  /**\n   * Cancels the active size info timer, if one exists.\n   * Clears the timeout associated with `_sizeInfoTimerId` and resets the timer ID to `null`.\n   */\n  private _cancelSizeInfoTimer = (): void => {\n    if (this._sizeInfoTimerId !== null) {\n      clearTimeout(this._sizeInfoTimerId);\n      this._sizeInfoTimerId = null;\n    }\n  }\n\n  /**\n   * Calculates the Euclidean distance between two touch points.\n   *\n   * @param touch1 - The first touch point.\n   * @param touch2 - The second touch point.\n   * @returns The distance in pixels between the two touch points.\n   */\n  private _calculateDistance = (touch1: Touch, touch2: Touch): number => {\n    const dx = touch2.clientX - touch1.clientX;\n    const dy = touch2.clientY - touch1.clientY;\n    return Math.sqrt(dx * dx + dy * dy);\n  }\n\n  /**\n   * Rounds the numeric part of a dimension string to the nearest integer, preserving any prefix or suffix.\n   *\n   * Examples:\n   * - '-$34.565c' becomes '-$35c'\n   * - '21.244px' becomes '21px'\n   *\n   * @param dim - The dimension string containing a number and optional prefix/suffix.\n   * @returns The dimension string with the numeric part rounded to the nearest integer.\n   */\n  private _roundDimension = (dim: string): string => {\n    // round string number with units (prefix and/or suffix): '-$34.565c' -> '-$35c', '21.244px' -> '24px'\n    return dim.replace(/([^0-9.-]*)(-?[\\d.]+)(.*)/, (_, prefix, num, suffix) => `${prefix}${Math.round(Number(num))}${suffix}`);\n  }\n\n  /**\n   * Determines whether the target image is an SVG image.\n   *\n   * Checks if the target is an HTMLImageElement and then verifies:\n   * - If the image source is a data URL, it checks for the 'image/svg+xml' MIME type.\n   * - Otherwise, it checks if the image source URL ends with '.svg'.\n   *\n   * @returns {boolean} True if the target image is an SVG, otherwise false.\n   */\n  private _isSvgImage = (): boolean => {\n    if (this._target instanceof HTMLImageElement) {\n      if (this._target.src.startsWith('data:image/')) {\n        return this._target.src.includes('image/svg+xml');\n      }\n      return this._target.src.endsWith('.svg');\n    }\n    return false;\n  }\n}\n","import Action from '../actions/Action';\nimport AlignAction from '../actions/align/AlignAction';\nimport BlotFormatter from '../BlotFormatter';\nimport CaretAction from '../actions/CaretAction';\nimport DeleteAction from '../actions/DeleteAction';\nimport ResizeAction from '../actions/ResizeAction';\n\nexport interface Blot {\n  domNode: HTMLElement;\n  parent: Blot | null;\n  next: Blot | null;\n  prev: Blot | null;\n  statics: any | null;\n  format(name: string, value: any): void | undefined;\n  formats(): { [key: string]: any };\n  length(): number;\n}\n\n/**\n * Abstract base class representing a specification for a Quill blot.\n *\n * `BlotSpec` provides a framework for defining custom blot behaviors and actions\n * within the Quill editor. Subclasses can override methods to implement specific\n * initialization, action handling, and element targeting logic for different blot types.\n *\n * @remarks\n * - Designed to be extended by concrete blot specification classes.\n * - Manages formatter instance and provides utility methods for blot manipulation.\n *\n * @example\n * ```typescript\n * class ImageBlotSpec extends BlotSpec {\n *   // Custom implementation for image blots\n * }\n * ```\n *\n * @property formatter - The `BlotFormatter` instance associated with this spec.\n * @property isUnclickable - Indicates whether the blot is unclickable.\n *\n * @method init - Initializes the blot specification. Intended to be overridden.\n * @method getActions - Returns an array of enabled `Action` objects for the current formatter. Intended to be extended.\n * @method getTargetElement - Returns the target HTML element for the blot. Intended to be overridden.\n * @method getTargetBlot - Retrieves the target blot associated with the current selection.\n * @method getOverlayElement - Returns the overlay element associated with the blot.\n * @method setSelection - Clears the current selection in the Quill editor.\n * @method onHide - Callback invoked when the blot is hidden. Intended to be overridden.\n */\nexport default class BlotSpec {\n  // abstract class for Blot specifications\n\n  formatter: BlotFormatter;\n  isUnclickable: boolean = false;\n\n  constructor(formatter: BlotFormatter) {\n    this.formatter = formatter;\n  }\n\n  /**\n   * Initializes the blot specification.\n   *\n   * This method is intended to perform any setup required for the blot spec.\n   * It can be overridden by subclasses to provide specific initialization logic.\n   * \n   */\n  init = (): void => {}\n\n  /**\n   * Returns an array of `Action` instances based on the formatter's configuration options.\n   * \n   * The returned actions may include:\n   * - `AlignAction` if aligning is allowed (`options.align.allowAligning`)\n   * - `ResizeAction` if resizing is allowed (`options.resize.allowResizing`)\n   * - `DeleteAction` if keyboard deletion is allowed (`options.delete.allowKeyboardDelete`)\n   * - Always includes `CaretAction`\n   *\n   * It can be overridden by subclasses to provide additional actions specific to the blot type.\n   * \n   * @returns {Array<Action>} An array of enabled `Action` objects for the current formatter.\n   */\n  getActions(): Array<Action> {\n    const actions: Array<Action> = [];\n    if (this.formatter.options.align.allowAligning) {\n      actions.push(new AlignAction(this.formatter));\n    }\n    if (this.formatter.options.resize.allowResizing) {\n      actions.push(new ResizeAction(this.formatter));\n    }\n    if (this.formatter.options.delete.allowKeyboardDelete) {\n      actions.push(new DeleteAction(this.formatter));\n    }\n    actions.push(new CaretAction(this.formatter));\n\n    return actions;\n  }\n\n  /**\n   * Returns the target HTML element associated with this blot.\n   * \n   * This method is intended to be overridden by subclasses to provide the specific target element\n   * for the blot type.\n   *\n   * @returns {HTMLElement | null} The target element, or `null` if none exists.\n   */\n  getTargetElement = (): HTMLElement | null => {\n    return null;\n  }\n\n  /**\n   * Retrieves the target blot associated with the current selection.\n   *\n   * This method first obtains the target DOM element using `getTargetElement()`.\n   * If a target element exists, it uses the Quill instance to find and return the corresponding blot.\n   * If no target element is found, it returns `null`.\n   * \n   * @remarks\n   * This method uses the quill instance constructor to overcome issue encountered with `Quill.find()`\n   * with certain environments where the `Quill` global differs from the one used in the quill instance.\n   * In those cases, the `find()` method will always return `null`. These environments include: vite,\n   * react and angular.\n   *\n   * @returns {Blot | null} The blot corresponding to the target element, or `null` if not found.\n   */\n  getTargetBlot = (): Blot | null => {\n    const target = this.getTargetElement();\n    if (!!target) {\n      return this.formatter.Quill.find(target) as Blot | null;\n    } else {\n      return null;\n    }\n  }\n\n  /**\n   * Returns the overlay element associated with the blot.\n   * \n   * @returns {HTMLElement | null} The overlay element, or `null` if none exists.\n   */\n  getOverlayElement = (): HTMLElement | null => {\n    return this.getTargetElement();\n  }\n\n  /**\n   * Clears the current selection in the Quill editor by setting it to `null`.\n   * This effectively removes any active text selection.\n   *\n   * @remarks\n   * Useful for resetting the editor's selection state, such as after formatting actions.\n   */\n  setSelection = (): void => {\n    this.formatter.quill.setSelection(null);\n  }\n\n  /**\n   * Callback invoked when the blot is hidden.\n   * Override this method to implement custom hide behavior.\n   */\n  onHide = (): void => {}\n}\n","import BlotFormatter from '../BlotFormatter';\nimport BlotSpec from './BlotSpec';\n\nconst PROXY_IMAGE_CLASS = 'blot-formatter__proxy-image';\n\ntype UnclickableProxy = {\n  unclickable: HTMLElement;\n  proxyImage: HTMLElement;\n};\ntype UnclickableProxies = Record<string, UnclickableProxy>;\n\n/**\n * Represents a Quill BlotSpec for managing \"unclickable\" elements within the editor.\n * \n * This class overlays transparent proxy images on unclickable HTML elements (such as videos)\n * to intercept user interactions and enable custom formatting behaviour. It tracks proxies,\n * synchronizes their positions with the underlying elements, and manages event listeners\n * for editor changes, scrolling, and resizing.\n * \n * Key Features:\n * - Automatically creates and removes proxy overlays for unclickable elements.\n * - Repositions proxies on editor scroll and resize events.\n * - Handles click events on proxies to trigger formatter overlays.\n * - Passes through wheel and touch events for smooth scrolling.\n * \n * @remarks\n * - Proxies are managed using a randomly generated ID stored in the element's dataset.\n * - The proxy container is appended to the Quill editor's container and holds all proxy images.\n * - Designed to work with Quill's BlotFormatter extension for custom video or media formatting.\n * \n * @extends BlotSpec\n */\nexport default class UnclickableBlotSpec extends BlotSpec {\n  selector: string;\n  unclickable: HTMLElement | null;\n  proxyContainer: HTMLElement;\n  unclickableProxies: UnclickableProxies;\n  isUnclickable: boolean = true;\n\n  constructor(formatter: BlotFormatter) {\n    super(formatter);\n    this.selector = formatter.options.video.selector;\n    this.unclickable = null;\n    this.proxyContainer = this._createProxyContainer();\n    this.unclickableProxies = {};\n  }\n\n  /**\n   * Initializes event listeners and observers for unclickable blot proxies.\n   * - Sets up a listener for Quill's 'text-change' event to handle updates.\n   * - Adds a scroll event listener to the Quill root to reposition proxy images when scrolling occurs.\n   * - Observes editor resize events to maintain correct proxy positioning.\n   */\n  init = (): void => {\n    // create unclickable proxies, position proxies over unclickables\n    this.formatter.quill.on('text-change', this._onTextChange);\n    // reposition proxy image if quill root scrolls (only if target is child of quill root)\n    this.formatter.quill.root.addEventListener('scroll', () => {\n      this._repositionProxyImages();\n    });\n    this._observeEditorResize();\n  }\n\n  /**\n   * Observes the Quill editor's root element for resize events and triggers repositioning\n   * of proxy images when the editor's dimensions change (e.g., due to screen resize or editor grow/shrink).\n   * Uses a debounced approach to avoid excessive repositioning by waiting 200ms after the last resize event.\n   *\n   * @remarks\n   * This method sets up a `ResizeObserver` on the editor's root element and calls\n   * `_repositionProxyImages` whenever a resize is detected, with debouncing to improve performance.\n   */\n  private _observeEditorResize = (): void => {\n    // reposition proxies if editor dimensions change (e.g. screen resize or editor grow/shrink)\n    let resizeTimeout: number | null = null;\n    const resizeObserver = new ResizeObserver((entries) => {\n      for (const entry of entries) {\n        // Clear the previous timeout if there was one\n        if (resizeTimeout) {\n          clearTimeout(resizeTimeout);\n        }\n        // Set a new timeout to run after 200ms\n        resizeTimeout = window.setTimeout(() => {\n          this._repositionProxyImages();\n        }, 200);\n      }\n    });\n    // Start observing the element for size changes\n    resizeObserver.observe(this.formatter.quill.root);\n  }\n\n  /**\n   * Returns the target HTML element associated with this instance.\n   * \n   * @returns {HTMLElement | null} The unclickable HTML element, or `null` if not set.\n   */\n  getTargetElement = (): HTMLElement | null => {\n    return this.unclickable;\n  }\n\n  /**\n   * Returns the overlay HTML element associated with the blot, or `null` if none exists.\n   *\n   * @returns {HTMLElement | null} The unclickable overlay element, or `null` if not set.\n   */\n  getOverlayElement = (): HTMLElement | null => {\n    return this.unclickable;\n  }\n\n  /**\n   * Handles changes to the text content within the Quill editor.\n   *\n   * This method performs the following actions:\n   * 1. Checks if any \"unclickable\" elements tracked by proxies have been deleted from the editor.\n   *    If so, it removes their corresponding proxy images and cleans up the tracking object.\n   * 2. Searches for new \"unclickable\" elements that do not yet have a proxy image and creates proxies for them.\n   * 3. Repositions all proxy images to ensure they are correctly aligned with their associated elements.\n   *\n   * This method is intended to be called whenever the editor's content changes to keep proxy images in sync.\n   */\n  private _onTextChange = (): void => {\n    // check if any unclickable has been deleted, remove proxy if so\n    Object.entries(this.unclickableProxies).forEach(([key, { unclickable, proxyImage }]) => {\n      try {\n        if (!this.formatter.quill.root.contains(unclickable)) {\n          proxyImage.remove();\n          delete this.unclickableProxies[key];\n        }\n      } catch { }\n    });\n    // add proxy for any new unclickables\n    this.formatter.quill.root.querySelectorAll(`${this.selector}:not([data-blot-formatter-id])`)\n      .forEach((unclickable: HTMLElement) => {\n        this._createUnclickableProxyImage(unclickable);\n      });\n    this._repositionProxyImages();\n  };\n\n  /**\n   * Creates a transparent proxy image overlay for an unclickable HTML element.\n   * The proxy image is linked to the unclickable element via a randomly generated ID,\n   * which is stored in the element's dataset and used as a key in the `unclickableProxies` record.\n   * The proxy image is styled to be absolutely positioned and unselectable, and is appended to the proxy container.\n   * Event listeners are attached to the proxy image to handle click, context menu, wheel, and touch events,\n   * allowing interaction to be managed or passed through as needed.\n   *\n   * @param unclickable - The target HTMLElement to overlay with a transparent proxy image.\n   */\n  private _createUnclickableProxyImage = (unclickable: HTMLElement): void => {\n    const id = Array.from(crypto.getRandomValues(new Uint8Array(5)), (n) =>\n      String.fromCharCode(97 + (n % 26))\n    ).join('');\n    unclickable.dataset.blotFormatterId = id;\n\n    const canvas = document.createElement('canvas');\n    const context = canvas.getContext('2d');\n    if (context) {\n      context.globalAlpha = 0;\n      context.fillRect(0, 0, 1, 1);\n    }\n\n    const proxyImage = document.createElement('img');\n    proxyImage.src = canvas.toDataURL('image/png');\n    proxyImage.classList.add(PROXY_IMAGE_CLASS);\n    proxyImage.dataset.blotFormatterId = id;\n\n    const mergedStyle: Record<string, any> = {\n      ...this.formatter.options.video.proxyStyle,\n      ...{\n        position: 'absolute',\n        margin: '0',\n        userSelect: 'none',\n      }\n    }\n\n    Object.assign(proxyImage.style, mergedStyle);\n\n    proxyImage.style.setProperty('-webkit-user-select', 'none');\n    proxyImage.style.setProperty('-moz-user-select', 'none');\n    proxyImage.style.setProperty('-ms-user-select', 'none');\n\n    if (this.formatter.options.debug) {\n      proxyImage.style.setProperty('border', '3px solid red');\n    }\n\n    this.proxyContainer.appendChild(proxyImage);\n\n    // on click, hide proxy, show overlay\n    proxyImage.addEventListener('click', this._onProxyImageClick);\n    // disable context menu on proxy\n    proxyImage.addEventListener('contextmenu', (event) => {\n      event.stopPropagation();\n      event.preventDefault();\n    });\n    // scroll the quill root on pointer wheel event & touch scroll\n    proxyImage.addEventListener('wheel', this.formatter._passWheelEventThrough);\n    proxyImage.addEventListener('touchstart', this.formatter._onTouchScrollStart, { passive: false });\n    proxyImage.addEventListener('touchmove', this.formatter._onTouchScrollMove, { passive: false });\n\n    // used to reposition proxy and identify target unclickable\n    this.unclickableProxies[id] = {\n      unclickable: unclickable,\n      proxyImage: proxyImage\n    }\n\n    if (this.formatter.options.debug) {\n      console.debug('UnclickableBlotSpec created proxy for unclickable:', unclickable, 'with ID:', id, 'and proxy image:', proxyImage);\n    }\n  }\n\n  /**\n   * Repositions proxy images to overlay their corresponding \"unclickable\" elements\n   * within the Quill editor container. Calculates each unclickable element's position\n   * relative to the container, accounting for scroll offsets, and updates the proxy image's\n   * style properties (`left`, `top`, `width`, `height`) accordingly.\n   *\n   * Handles errors gracefully by logging any issues encountered during positioning.\n   *\n   * @private\n   */\n  private _repositionProxyImages = (): void => {\n    if (Object.keys(this.unclickableProxies).length > 0) {\n      const containerRect: DOMRect = this.formatter.quill.container.getBoundingClientRect();\n      const containerScrollLeft: number = this.formatter.quill.container.scrollLeft;\n      const containerScrollTop: number = this.formatter.quill.container.scrollTop;\n\n      Object.entries(this.unclickableProxies).forEach(([key, { unclickable, proxyImage }]) => {\n        try {\n          // Calculate the unclickable's position relative to the container\n          const unclickableRect: DOMRect = unclickable.getBoundingClientRect();\n          Object.assign(proxyImage.style, {\n              // display: 'block',\n              left: `${unclickableRect.left - containerRect.left - 1 + containerScrollLeft}px`,\n              top: `${unclickableRect.top - containerRect.top + containerScrollTop}px`,\n              width: `${unclickableRect.width}px`,\n              height: `${unclickableRect.height}px`,\n            },\n          );\n        } catch (error) {\n          const msg: string = `Error positioning proxy image with id ${key}: `\n          console.error(msg, `${error instanceof Error ? error.message : error}`);\n        }\n      });\n    }\n  }\n\n\n  /**\n   * Handles click events on proxy images representing unclickable blots.\n   * Retrieves the associated unclickable blot using the proxy's dataset ID,\n   * updates the `unclickable` property, and displays the formatter overlay.\n   *\n   * @param event - The mouse event triggered by clicking the proxy image.\n   */\n  private _onProxyImageClick = (event: MouseEvent): void => {\n    // get target unclickable (unclickable), show overlay\n    const targetElement = event.target as HTMLElement;\n    const id = targetElement.dataset.blotFormatterId;\n    this.unclickable = this.unclickableProxies[`${id}`].unclickable;\n    this.formatter.show(this);\n  };\n\n  /**\n   * Creates a proxy container element (`div`) with the class 'proxy-container' and appends it\n   * to the Quill editor's container. This container is used to hold all proxy images.\n   *\n   * @returns {HTMLElement} The newly created proxy container element.\n   * @private\n   */\n  private _createProxyContainer = (): HTMLElement => {\n    // create a child div on quill.container to hold all the proxy images\n    const proxyContainer = document.createElement('div');\n    proxyContainer.classList.add('proxy-container');\n    this.formatter.quill.container.appendChild(proxyContainer);\n    return proxyContainer;\n  }\n\n}\n","import BlotFormatter from '../BlotFormatter';\nimport UnclickableBlotSpec from './UnclickableBlotSpec';\n\n/**\n * Represents a specification for handling iframe-based video blots within the Quill editor.\n * Extends {@link UnclickableBlotSpec} to provide formatting capabilities for video iframes\n * that should not be clickable.\n *\n * @remarks\n * This class is intended to be used with the BlotFormatter to manage video embeds\n * that use iframes, such as YouTube or Vimeo videos.\n *\n * @param formatter - The {@link BlotFormatter} instance used to apply formatting logic.\n */\nexport default class IframeVideoSpec extends UnclickableBlotSpec {\n  constructor(formatter: BlotFormatter) {\n    super(formatter);\n  }\n}\n","import Action from './Action';\nimport BlotFormatter from '../BlotFormatter';\nimport ToolbarButton from './toolbar/ToolbarButton';\nimport type { Blot } from '../specs/BlotSpec';\n\ninterface AltTitleModal {\n    element: HTMLDivElement;\n    form: HTMLFormElement;\n    altInput: HTMLTextAreaElement;\n    titleInput: HTMLTextAreaElement;\n    cancelButton: HTMLButtonElement;\n}\n\nexport default class AttributeAction extends Action {\n    modal: AltTitleModal;\n    targetElement: HTMLElement | null | undefined = null;\n    currentBlot: Blot | null | undefined = null;\n\n    constructor(formatter: BlotFormatter) {\n        super(formatter);\n        this.toolbarButtons = [\n            new ToolbarButton(\n                'attribute',\n                this._onClickHandler,\n                this.formatter.options.toolbar,\n            )\n        ]\n        this.modal = this._createModal();\n    }\n\n    /**\n     * Initializes the target element and current blot for the action.\n     * Retrieves the target element and blot from the current formatter specification.\n     *\n     * @remarks\n     * This method should be called when the action is created to ensure\n     * that the necessary references are set up for further processing.\n     */\n    onCreate = (): void => {\n        this.targetElement = this.formatter.currentSpec?.getTargetElement();\n        this.currentBlot = this.formatter.currentSpec?.getTargetBlot();\n    }\n\n    /**\n     * Cleans up resources when the action is destroyed.\n     * Sets the target element to null and removes the modal element from the DOM.\n     */\n    onDestroy = (): void => {\n        this.targetElement = null;\n        this.modal.form.removeEventListener('submit', this._onSubmitHandler);\n        this.modal.form.removeEventListener('cancel', this._hideAltTitleModal);\n        this.modal.element.removeEventListener('pointerdown', this._onPointerDownHandler);\n        this.modal.cancelButton.removeEventListener('click', this._hideAltTitleModal);\n        this.modal.element.remove();\n    }\n\n    /**\n     * Event handler for click events that triggers the display of the Alt Title modal.\n     * \n     * @private\n     * @remarks\n     * This handler is assigned to UI elements to allow users to edit or view the Alt Title attribute.\n     */\n    private _onClickHandler: EventListener = (): void => {\n        this._showAltTitleModal();\n    }\n\n    /**\n     * Displays the modal for editing the 'alt' and 'title' attributes of the target element.\n     * \n     * If a target element is present, this method sets the modal's input fields to the current\n     * 'alt' and 'title' attribute values of the target element (or empty strings if not set),\n     * and appends the modal element to the document body.\n     *\n     * @private\n     */\n    private _showAltTitleModal = (): void => {\n        if (this.targetElement) {\n            this.modal.altInput.value = this.targetElement.getAttribute('alt') || '';\n            this.modal.titleInput.value = this.targetElement.getAttribute('title') || '';\n            document.body.append(this.modal.element);\n            if (this.formatter.options.debug) {\n                console.debug('Showing Alt Title modal for:', this.targetElement);\n            }\n        }\n    }\n\n    /**\n     * Hides and removes the alt/title modal from the DOM.\n     *\n     * This method removes the modal's element, effectively closing the modal UI.\n     * It is typically called when the modal should no longer be visible to the user.\n     *\n     * @private\n     */\n    private _hideAltTitleModal = (): void => {\n        this.modal.element.remove();\n    }\n\n    /**\n     * Updates the `alt` and `title` attributes of the target image element based on user input.\n     * If a title is provided, it sets the `title` attribute; otherwise, it removes it.\n     * Additionally, if an image alignment format is applied, it updates the alignment format\n     * to include the new title value.\n     *\n     * @private\n     */\n    private _setAltTitle = (): void => {\n        if (this.targetElement) {\n            const alt: string = typeof this.modal.altInput.value === \"string\" \n                ? this.modal.altInput.value \n                : \"\";\n            const title: string = this.modal.titleInput.value;\n            this.targetElement.setAttribute('alt', alt);\n            if (title) {\n                this.targetElement.setAttribute('title', title);\n            } else {\n                this.targetElement.removeAttribute('title');\n            }\n            if (this.formatter.options.debug) {\n                console.debug('Setting alt:', alt, 'title:', title, 'on target element:', this.targetElement);\n            }\n            // Update align format if applied\n            const imageAlignment = this.currentBlot?.parent?.formats()[this.formatter.ImageAlign.attrName]?.align;\n            if (this.currentBlot && imageAlignment) {\n                if (this.formatter.options.debug) {\n                    console.debug('Updating title of image with alignment:', imageAlignment);\n                }\n                // Reapply the existing alignment format if it exists\n                this.currentBlot.parent?.format(this.formatter.ImageAlign.attrName, false)\n                this.currentBlot.format(\n                    this.formatter.ImageAlign.attrName,\n                    {\n                        align: imageAlignment,\n                        title: title\n                    }\n                );\n            }\n        }\n    }\n\n    /**\n     * Creates and configures a modal dialog for editing image `alt` and `title` attributes.\n     *\n     * The modal includes:\n     * - A unique identifier for each instance.\n     * - A form with labeled textareas for `alt` and `title` values.\n     * - Submit and cancel buttons, with customizable icons and styles.\n     * - Event listeners for submitting, cancelling, and closing the modal by clicking outside.\n     *\n     * Styles and labels are sourced from `this.formatter.options.image.altTitleModalOptions` and `this.formatter.options.overlay.labels`.\n     *\n     * @returns {AltTitleModal} An object containing references to the modal element, form, alt and title inputs, and the cancel button.\n     */\n    private _createModal = (): AltTitleModal => {\n        const uuid: string = Array.from(crypto.getRandomValues(new Uint8Array(5)), (n) =>\n            String.fromCharCode(97 + (n % 26))\n        ).join('');\n\n        // Create modal background\n        const modal = document.createElement('div');\n        modal.id = `${uuid}-modal`;\n        modal.setAttribute('data-blot-formatter-modal', '');\n\n        // Create modal container\n        const modalContainer = document.createElement('div');\n\n        // Create form element\n        const form = document.createElement('form');\n        form.id = `${uuid}-form`;\n\n        // Create label for alt\n        const labelAlt = document.createElement('label');\n        labelAlt.setAttribute('for', 'alt');\n        labelAlt.textContent = this.formatter.options.overlay.labels?.alt || this.formatter.options.image.altTitleModalOptions.labels.alt;\n\n        // Create textarea for alt\n        const textareaAlt = document.createElement('textarea');\n        textareaAlt.name = 'alt';\n        textareaAlt.rows = 3;\n\n        // Create label for title\n        const labelTitle = document.createElement('label');\n        labelTitle.setAttribute('for', 'title');\n        labelTitle.textContent = this.formatter.options.overlay.labels?.title || this.formatter.options.image.altTitleModalOptions.labels.title;\n\n        // Create textarea for title\n        const textareaTitle = document.createElement('textarea');\n        textareaTitle.name = 'title';\n        textareaTitle.rows = 3;\n\n        // Create submit button\n        const buttonDiv = document.createElement('div');\n        const submitButton = document.createElement('button');\n        submitButton.type = 'submit';\n        submitButton.innerHTML = this.formatter.options.image.altTitleModalOptions.icons.submitButton;\n        buttonDiv.appendChild(submitButton);\n\n        // Append elements to the form\n        form.appendChild(labelAlt);\n        form.appendChild(textareaAlt);\n        form.appendChild(labelTitle);\n        form.appendChild(textareaTitle);\n        form.appendChild(buttonDiv);\n\n        // Create cancel button\n        const cancelButton = document.createElement('button');\n        cancelButton.id = `${uuid}-cancel`;\n        cancelButton.type = 'button';\n        cancelButton.innerHTML = this.formatter.options.image.altTitleModalOptions.icons.cancelButton;\n\n        // styles\n        if (this.formatter.options.image.altTitleModalOptions.styles) {\n            Object.assign(modal.style, this.formatter.options.image.altTitleModalOptions.styles.modalBackground);\n            Object.assign(modalContainer.style, this.formatter.options.image.altTitleModalOptions.styles.modalContainer);\n            Object.assign(labelAlt.style, this.formatter.options.image.altTitleModalOptions.styles.label);\n            Object.assign(textareaAlt.style, this.formatter.options.image.altTitleModalOptions.styles.textarea);\n            Object.assign(labelTitle.style, this.formatter.options.image.altTitleModalOptions.styles.label);\n            Object.assign(textareaTitle.style, this.formatter.options.image.altTitleModalOptions.styles.textarea);\n            Object.assign(submitButton.style, this.formatter.options.image.altTitleModalOptions.styles.submitButton);\n            Object.assign(cancelButton.style, this.formatter.options.image.altTitleModalOptions.styles.cancelButton);\n        }\n\n        // Append form and cancel button to the modal container\n        modalContainer.appendChild(form);\n        modalContainer.appendChild(cancelButton);\n\n        // Append modal container to the modal background\n        modal.appendChild(modalContainer);\n\n        // event listeners\n        form.addEventListener('submit', this._onSubmitHandler);\n        form.addEventListener('cancel', this._hideAltTitleModal);\n        modal.addEventListener('pointerdown', this._onPointerDownHandler);\n        cancelButton.addEventListener('click', this._hideAltTitleModal);\n\n        return {\n            element: modal,\n            form: form,\n            altInput: textareaAlt,\n            titleInput: textareaTitle,\n            cancelButton: cancelButton\n        };\n    }\n\n    private _onSubmitHandler = (event: SubmitEvent): void => {\n        event.preventDefault();\n        this._setAltTitle();\n        this._hideAltTitleModal();\n    }\n\n    private _onPointerDownHandler = (event: PointerEvent): void => {\n        if (event.target === this.modal.element) {\n            this._hideAltTitleModal();\n        }\n    }\n}\n","import Action from './Action';\nimport BlotFormatter from '../BlotFormatter';\nimport ToolbarButton from './toolbar/ToolbarButton';\nimport { CompressorOptions } from '../Options';\n\ntype CompressModal = {\n    element: HTMLDivElement;\n    moreInfoButton: HTMLButtonElement;\n    continueButton: HTMLButtonElement;\n    cancelButton: HTMLButtonElement;\n    moreInfoText: HTMLDivElement;\n}\n\ntype ImageDetails = {\n    naturalWidth: number;\n    naturalHeight: number;\n    targetWidth: number | null;\n    targetHeight: number | null;\n    size: number;\n    canCompress: boolean;\n}\n\n/**\n * CompressAction provides an interactive UI and logic for compressing images embedded in a Quill editor.\n * \n * This action enables users to reduce the file size of images by resizing and re-encoding them as JPEGs,\n * while preserving the aspect ratio and respecting user-defined options such as maximum width and JPEG quality.\n * \n * Key features:\n * - Determines image eligibility for compression (must be a data URL, not SVG or GIF).\n * - Parses image dimensions from HTML attributes, supporting various units (px, %, em, rem).\n * - Calculates image size from base64 data URLs.\n * - Presents a modal dialog for user interaction, including prompts, more info, and feedback.\n * - Handles image compression via canvas resizing and JPEG encoding.\n * - Updates the image in the editor if compression is successful and provides feedback on size reduction.\n * - Cleans up resources and UI elements when the action is destroyed.\n * \n * Usage:\n * - Instantiate with a BlotFormatter instance.\n * - Call `onCreate` to initialize and update toolbar button visibility.\n * - Call `onDestroy` to clean up when the action is no longer needed.\n * \n * @remarks\n * This class is intended for use within the Quill Blot Formatter extension and assumes integration with its toolbar and modal infrastructure.\n */\nexport default class CompressAction extends Action {\n    options: CompressorOptions;\n    modal: CompressModal;\n    targetElement: HTMLElement | null | undefined = null;\n    imageDetails: ImageDetails | null = null;\n\n    /**\n     * Determines whether the given HTML element is eligible for image compression.\n     *\n     * Eligibility criteria:\n     * - The element must be an `<img>` tag.\n     * - The image source must be a data URL (`data:image/`).\n     * - The image must not be an SVG (`svg+xml`) or GIF (`gif`).\n     *\n     * @param targetElement - The HTML element to check for compression eligibility.\n     * @returns `true` if the element is an eligible image for compression, otherwise `false`.\n     */\n    static isEligibleForCompression = (targetElement: HTMLElement | null | undefined, debug: boolean = false): boolean => {\n        // Must be image tag with data url and not gif or svg\n        let isEligible = false;\n        if (targetElement instanceof HTMLImageElement) {\n            if (targetElement.src.startsWith(\"data:image/\")) {\n                const mimeType = targetElement.src.substring(5, targetElement.src.indexOf(\";\"));\n                isEligible = mimeType !== \"svg+xml\" && mimeType !== \"gif\";\n            }\n        }\n        if (debug) {\n            console.debug('Image eligibility check:', {\n                element: targetElement,\n                isEligible\n            });\n        }\n        return isEligible;\n    }\n\n    constructor(formatter: BlotFormatter) {\n        super(formatter);\n        this.options = this.formatter.options.image.compressorOptions;\n        this.toolbarButtons = [\n            new ToolbarButton(\n                'compress',\n                this._onClickHandler,\n                this.formatter.options.toolbar,\n            )\n        ]\n        this.modal = this._createModal();\n    }\n\n    /**\n     * Initializes the CompressAction by setting the target element and updating the initial visibility\n     * of the first toolbar button based on whether the target element is eligible for compression.\n     *\n     * This method should be called when the action is created. It ensures that the toolbar button\n     * reflects the current eligibility state of the target element.\n     */\n    onCreate = (): void => {\n        this.targetElement = this.formatter.currentSpec?.getTargetElement();\n        // class should not be instantiated if not eligible - double check here\n        const isEligibleForCompression = CompressAction.isEligibleForCompression(this.targetElement, this.debug);\n        this.toolbarButtons[0].initialVisibility = isEligibleForCompression;\n        if (this.debug) {\n            console.debug('CompressAction initialized with target element:', this.targetElement, 'is eligible:', isEligibleForCompression);\n        }\n    }\n\n    /**\n     * Cleans up resources when the action is destroyed.\n     * Sets the target element to null and hides the modal dialog.\n     */\n    onDestroy = (): void => {\n        this.targetElement = null;\n        this._hideModal();\n\n        this.modal.continueButton.removeEventListener('click', this._onContinueClick);\n        this.modal.moreInfoButton.removeEventListener('click', this._onMoreInfoClick);\n        this.modal.cancelButton.removeEventListener('click', this._hideModal);\n        this.modal.element.removeEventListener('pointerdown', this._onBackgroundClick);\n    }\n\n    /**\n     * Handles the click event for the compress action.\n     * When triggered, it displays the modal dialog for compression options.\n     *\n     * @param event - The click event object.\n     */\n    private _onClickHandler: EventListener = () => {\n        this._showModal();\n    }\n\n    /**\n     * Displays a modal dialog for image compression if the target element is an image.\n     * If the image can be compressed, shows additional information and appends the modal to the document body.\n     * Otherwise, displays feedback indicating that no compression is possible.\n     *\n     * @private\n     */\n    private _showModal = (): void => {\n        if (this.targetElement instanceof HTMLImageElement) {\n            this.imageDetails = this._getImageDetails(this.targetElement);\n            if (this.imageDetails.canCompress) {\n                this.modal.moreInfoButton.style.visibility = 'visible';\n                this.modal.moreInfoText.style.display = 'none';\n                document.body.append(this.modal.element);\n            } else {\n                this._displayFeedback(this.options.text.nothingToDo);\n            }\n        }\n    }\n\n    /**\n     * Removes the modal element from the DOM, effectively hiding the modal.\n     *\n     * @private\n     */\n    private _hideModal = (): void => {\n        this.modal.element.remove();\n    }\n\n    /**\n     * Parses the `width` and `height` attributes of an HTMLImageElement and returns their numeric values.\n     * Handles values specified in pixels (`px`), percentages (`%`), em/rem units, or plain numbers.\n     * If the attribute is a percentage, uses the maximum width from options if available.\n     * For em/rem units, assumes 16px per unit.\n     * If the height is not specified or cannot be parsed, attempts to calculate it using the aspect ratio\n     * from the image's natural dimensions if width is available.\n     * \n     * @param img - The HTMLImageElement whose dimensions are to be parsed.\n     * @returns A tuple containing the parsed width and height as numbers, or `null` if parsing fails.\n     */\n    private _parseDimensions = (img: HTMLImageElement): [number | null, number | null] => {\n        let width: string | null = img.getAttribute('width');\n        let height: string | null = img.getAttribute('height');\n        let parsedWidth: number | null = null;\n        let parsedHeight: number | null = null;\n\n        // Parse width\n        if (width) {\n            if (width.toLowerCase().endsWith('px')) {\n                parsedWidth = parseFloat(width);\n            } else if (width.endsWith('%')) {\n                parsedWidth = this.options.maxWidth ?? null;\n            } else if (width.toLowerCase().endsWith('em') || width.toLowerCase().endsWith('rem')) {\n                parsedWidth = parseFloat(width) * 16; // assume 16px per unit\n            } else if (!isNaN(parseFloat(width))) {\n                parsedWidth = parseFloat(width); // Parse as number only if it's plain numeric string\n            } else {\n                // unknown width attribute, return null to skip resizing\n                return [null, null];\n            }\n        }\n\n        // Parse height\n        if (height) {\n            if (!isNaN(parseFloat(height))) {\n                parsedHeight = parseFloat(height);\n            } else if (height.toLowerCase().endsWith('px')) {\n                parsedHeight = parseFloat(height);\n            } else if (height.toLowerCase().endsWith('em') || height.toLowerCase().endsWith('rem')) {\n                parsedHeight = parseFloat(height) * 16; // assume 16px per unit\n            } else {\n                // use aspect ratio if width is available and natural dimensions are valid\n                if (parsedWidth && img.naturalWidth > 0 && img.naturalHeight > 0) {\n                    parsedHeight = parsedWidth / (img.naturalWidth / img.naturalHeight);\n                } else {\n                    return [null, null];\n                }\n            }\n        }\n\n        return [parsedWidth, parsedHeight];\n    }\n\n    /**\n     * Calculates the approximate byte size of an image from its data URL.\n     *\n     * @param img - The HTMLImageElement whose size is to be determined.\n     * @returns The size of the image in bytes if the `src` attribute is a valid base64-encoded data URL,\n     *          or `null` if the `src` is not a valid image data URL or does not contain base64 data.\n     */\n    private _getImageSize = (img: HTMLImageElement): number | null => {\n        const dataUrl = img.getAttribute('src');\n        if (!dataUrl || !dataUrl.startsWith('data:image/')) {\n            // Return null if the src is not a valid data URL or doesn't contain image data\n            return null;\n        }\n        // Extract the base64-encoded part of the data URL\n        const base64Data = dataUrl.split(',')[1]; // Ignore the data type metadata before the comma\n        if (!base64Data) {\n            return null;\n        }\n        // Return the byte size of the base64 string\n        return Math.ceil((base64Data.length * 3) / 4);\n    }\n\n    /**\n     * Displays a feedback message in the formatter's sizeInfo element.\n     * The message is shown with full opacity, then fades out after 2.5 seconds.\n     *\n     * @param msg - The feedback message to display.\n     */\n    private _displayFeedback = (msg: string): void => {\n        this.formatter.sizeInfo.innerHTML = msg;\n        this.formatter.sizeInfo.style.transition = '';\n        this.formatter.sizeInfo.style.opacity = '1';\n        setTimeout(() => {\n            this.formatter.sizeInfo.style.transition = 'opacity 1s';\n            this.formatter.sizeInfo.style.opacity = '0';\n        }, 2500);\n    }\n\n    /**\n     * Retrieves detailed information about an image element, including its natural and target dimensions,\n     * file size, and whether it is eligible for compression based on the provided options.\n     *\n     * @param img - The HTMLImageElement to extract details from.\n     * @returns An {@link ImageDetails} object containing the image's natural and target dimensions,\n     *          file size, and compression eligibility.\n     */\n    private _getImageDetails = (img: HTMLImageElement): ImageDetails => {\n        let [width, height] = this._parseDimensions(img);\n        if (!width && ((this.options.maxWidth ?? Infinity) < img.naturalWidth)) {\n            width = this.options.maxWidth as number;\n            height = width / (img.naturalWidth / img.naturalHeight);\n        }\n        const details = {\n            naturalWidth: img.naturalWidth,\n            naturalHeight: img.naturalHeight,\n            targetWidth: width,\n            targetHeight: height,\n            size: this._getImageSize(img) as number,\n            canCompress: !!(width && height && (width < img.naturalWidth) && CompressAction.isEligibleForCompression(img, this.debug))\n        }\n        if (this.debug) {\n            console.debug('Image details:', {\n                element: img,\n                ...details,\n            });\n        }\n        return details;\n    }\n\n    /**\n     * Compresses a given HTMLImageElement by resizing it to target dimensions and reducing its quality.\n     * If compression results in a smaller image, the image's `src` is updated with the compressed data URL.\n     * Displays feedback about the compression result, including size reduction and new dimensions.\n     *\n     * @param img - The HTMLImageElement to compress.\n     * @returns `true` if the compression process was initiated, `false` if image loading failed.\n     *\n     * @remarks\n     * - Compression only occurs if `imageDetails.canCompress` is `true`.\n     * - The image is resized to `imageDetails.targetWidth` and `imageDetails.targetHeight`.\n     * - JPEG quality is determined by `options.jpegQuality`.\n     * - Feedback is displayed using `_displayFeedback`.\n     * - If compression is not possible, a \"nothing to do\" message is shown.\n     */\n    private _compressImage = (img: HTMLImageElement): boolean => {\n        if (this.imageDetails?.canCompress) {\n            const newImg = new Image();\n            newImg.src = img.src;\n            // Once the image has loaded, resize it\n            newImg.onload = () => {\n                if (this.debug) {\n                    console.debug('Compressing Image Copy loaded:', newImg);\n                }\n                // Create a canvas element\n                const canvas = document.createElement('canvas');\n                canvas.width = this.imageDetails!.targetWidth as number;\n                canvas.height = this.imageDetails!.targetHeight as number;\n                // Draw the image onto the canvas\n                const ctx = canvas.getContext('2d') as CanvasRenderingContext2D;\n                ctx.drawImage(newImg, 0, 0, canvas.width, canvas.height);\n                // Get the resized image data URL in JPEG format with a quality of this.options.jpegQuality\n                const resizedDataUrl = canvas.toDataURL('image/jpeg', this.options.jpegQuality);\n                // Convert data URLs to byte length\n                const originalSize = new TextEncoder().encode(img.src).length;\n                const resizedSize = new TextEncoder().encode(resizedDataUrl).length;\n                // Check if the resized image is smaller than the original\n                if (resizedSize < originalSize) {\n                    // Set the resized image data URL to the original image\n                    img.src = resizedDataUrl;\n                }\n                const sizeDiff: string = `${Math.ceil((this.imageDetails!.size - (this._getImageSize(img) as number)) / 1024)}kB`\n                const msg: string = `${this.options.text.reducedLabel}: ${sizeDiff}<br>\n                            ${this.imageDetails!.naturalWidth} x ${this.imageDetails!.naturalHeight}px  ${canvas.width} x ${Math.round(canvas.height)}px\n                        `;\n                if (this.debug) {\n                    console.debug('Image compressed:', {\n                        'original size': originalSize,\n                        'resized size': resizedSize,\n                        'size diff': sizeDiff,\n                        'new dimensions': { width: canvas.width, height: Math.round(canvas.height) }\n                    });\n                }\n                this._displayFeedback(msg);\n                return true;\n            };\n            newImg.onerror = (error) => {\n                console.error('Image loading failed:', error);\n                this._displayFeedback(`Image loading failed: ${error}`);\n                return false;\n            };\n        } else {\n            this._displayFeedback(this.options.text.nothingToDo);\n        };\n        return true;\n    }\n\n    /**\n     * Creates and configures a modal dialog for the compress action.\n     *\n     * The modal includes a prompt, an optional \"more info\" section, and three buttons:\n     * Cancel, More Info, and Continue. Styles and content are applied based on the\n     * provided options. Event listeners are attached to handle user interactions:\n     * - Continue: triggers image compression and hides the modal.\n     * - More Info: displays additional information and hides the button.\n     * - Cancel: hides the modal.\n     * - Clicking the background: hides the modal if the background itself is clicked.\n     *\n     * @returns {CompressModal} An object containing the modal background element,\n     *          the \"More Info\" button, and the \"More Info\" text element.\n     */\n    private _createModal = (): CompressModal => {\n        const modalBackground: HTMLDivElement = document.createElement('div');\n        modalBackground.setAttribute('data-blot-formatter-compress-modal', '');\n        const modalContainer: HTMLDivElement = document.createElement('div');\n        const modalDefaultPrompt: HTMLDivElement = document.createElement('div');\n        const modalMoreInfo: HTMLDivElement = document.createElement('div');\n        const modalButtonContainer: HTMLDivElement = document.createElement('div');\n        const cancelButton: HTMLButtonElement = document.createElement('button');\n        const moreInfoButton: HTMLButtonElement = document.createElement('button');\n        const continueButton: HTMLButtonElement = document.createElement('button');\n        modalMoreInfo.style.display = 'none';\n        modalButtonContainer.append(cancelButton, moreInfoButton, continueButton);\n        modalContainer.append(modalDefaultPrompt, modalMoreInfo, modalButtonContainer);\n        modalBackground.appendChild(modalContainer);\n        modalDefaultPrompt.innerHTML = this.options.text.prompt;\n        modalMoreInfo.innerHTML = this.options.text.moreInfo || '';\n        if (this.options.styles) {\n            Object.assign(modalBackground.style, this.options.styles.modalBackground);\n            Object.assign(modalContainer.style, this.options.styles.modalContainer);\n            Object.assign(modalButtonContainer.style, this.options.styles.buttonContainer);\n            Object.assign(cancelButton.style, { ...this.options.styles.buttons, ...this.options.buttons.cancel.style });\n            if (this.options.text.moreInfo) {\n                Object.assign(moreInfoButton.style, { ...this.options.styles.buttons, ...this.options.buttons.moreInfo.style });\n            } else {\n                moreInfoButton.style.visibility = 'hidden';\n            }\n            Object.assign(continueButton.style, { ...this.options.styles.buttons, ...this.options.buttons.continue.style });\n        }\n        cancelButton.innerHTML = this.options.icons.cancel;\n        moreInfoButton.innerHTML = this.options.icons.moreInfo;\n        continueButton.innerHTML = this.options.icons.continue;\n\n        // event listeners\n        continueButton.addEventListener('click', this._onContinueClick);\n        moreInfoButton.addEventListener('click', this._onMoreInfoClick);\n        cancelButton.addEventListener('click', this._hideModal);\n        modalBackground.addEventListener('pointerdown', this._onBackgroundClick);\n        return {\n            element: modalBackground,\n            moreInfoButton: moreInfoButton,\n            cancelButton: cancelButton,\n            continueButton: continueButton,\n            moreInfoText: modalMoreInfo,\n        }\n    }\n\n    private _onContinueClick = (): void => {\n        if (this.targetElement instanceof HTMLImageElement) {\n            this._compressImage(this.targetElement);\n        }\n        this._hideModal();\n    }\n\n    private _onMoreInfoClick = (): void => {\n        this.modal.moreInfoText.innerHTML = this.options.text.moreInfo || '';\n        this.modal.moreInfoText.style.display = 'block';\n        this.modal.moreInfoButton.style.visibility = 'hidden';\n    }\n\n    private _onBackgroundClick = (event: PointerEvent) => {\n        event.stopImmediatePropagation();\n        if (event.target === this.modal.element) {\n            if (this.debug) {\n                console.debug('Modal background clicked, hiding modal');\n            }\n            this._hideModal();\n        }\n    }\n\n}","import Action from './Action';\nimport BlotFormatter from '../BlotFormatter';\nimport type Quill from 'quill';\nimport ToolbarButton from './toolbar/ToolbarButton';\nimport type { Blot } from '../specs/BlotSpec';\nimport type { LinkOptions } from '../Options';\n\n/**\n * Handles the link editing action for image blots within the Quill editor.\n * \n * `LinkAction` provides UI and logic for adding, editing, and removing links on image blots.\n * It manages the display and positioning of a modal dialog for link input, attaches and removes\n * event listeners for modal interaction, and applies or removes link formats on the target blot.\n * \n * @remarks\n * - Integrates with the BlotFormatter overlay and toolbar system.\n * - Ensures modal dialog is accessible and correctly positioned relative to the editor.\n * - Cleans up all resources and event listeners on destruction.\n * \n * @extends Action\n * \n * @public\n */\nexport default class LinkAction extends Action {\n    targetElement: HTMLElement | null | undefined = null;\n    currentBlot: Blot | null | undefined = null;\n    toolbarButton: ToolbarButton;\n    linkOptions: LinkOptions;\n    modal?: {\n        dialog: HTMLDialogElement;\n        background: HTMLDivElement;\n        form: HTMLFormElement;\n        label: HTMLLabelElement;\n        input: HTMLInputElement;\n        okButton: HTMLButtonElement;\n        cancelButton: HTMLButtonElement;\n        removeButton: HTMLButtonElement;\n    }\n\n    constructor(formatter: BlotFormatter) {\n        super(formatter);\n        this.linkOptions = this.formatter.options.image.linkOptions;\n        this.toolbarButton = new ToolbarButton(\n            'link',\n            this._onClickHandler,\n            this.formatter.options.toolbar\n        );\n        // override preselect method to show button active if img has link on load\n        this.toolbarButton.preselect = () => {\n            return !!this.getLink();\n        };\n        this.toolbarButtons = [this.toolbarButton];\n        (window as any).LinkAction = this; // For debugging purposes\n    }\n\n    /**\n     * Initializes the action by setting the `targetElement` property.\n     * Retrieves the target element from the current formatter specification, if available.\n     * This method is typically called when the action is created.\n     */\n    onCreate = (): void => {\n        this.targetElement = this.formatter.currentSpec?.getTargetElement();\n        this.currentBlot = this.formatter.currentSpec?.getTargetBlot();\n    }\n\n    /**\n     * Cleans up resources when the action is destroyed.\n     * - Sets the target element to null.\n     * - Removes any attached event listeners.\n     * - Hides the link modal if it is visible.\n     */\n    onDestroy = (): void => {\n        this.targetElement = null;\n        this._removeEventListeners();\n        this.hideLinkModal();\n    }\n\n    /**\n     * Attaches all necessary event listeners to the modal elements for handling\n     * link-related actions such as submitting the form, blocking certain key events,\n     * handling input changes, canceling, removing links, and managing background/context menu interactions.\n     *\n     * This method should be called after the modal elements are initialized to ensure\n     * proper event handling within the link modal dialog.\n     * \n     * @private\n     */\n    private _addEventListeners = (): void => {\n        if (this.modal) {\n            this.modal.form.addEventListener('submit', this._formSubmitHandler);\n            this.modal.cancelButton.addEventListener('click', this.hideLinkModal);\n            this.modal.removeButton.addEventListener('click', this.removeLink);\n            this.modal.background.addEventListener('click', this._onBackgroundClick);\n            this.modal.input.addEventListener('contextmenu', this._trapContextEvent);\n        }\n    }\n\n    /**\n     * Removes all event listeners attached to the modal elements.\n     * \n     * This method detaches event handlers from the modal's dialog, form, input,\n     * cancel button, remove button, background, and input context menu to prevent\n     * memory leaks and unintended behavior when the modal is no longer in use.\n     * \n     * @private\n     */\n    private _removeEventListeners = (): void => {\n        if (this.modal) {\n            this.modal.form.removeEventListener('submit', this._formSubmitHandler);\n            this.modal.cancelButton.removeEventListener('click', this.hideLinkModal);\n            this.modal.removeButton.removeEventListener('click', this.removeLink);\n            this.modal.background.removeEventListener('click', this._onBackgroundClick);\n            this.modal.input.removeEventListener('contextmenu', this._trapContextEvent);\n        }\n    }\n\n    /**\n     * Prevents the event from propagating further in the event chain.\n     * This method is typically used to trap context menu or similar events,\n     * ensuring that no other event listeners are triggered for the same event.\n     *\n     * @param e - The event to be stopped.\n     */\n    private _trapContextEvent = (e: Event): void => {\n        e.stopImmediatePropagation();\n    }\n\n    /**\n     * Event handler that is triggered when the associated element is clicked.\n     * Invokes the `showLinkModal` method to display the link editing modal.\n     *\n     * @private\n     * @remarks\n     * This handler is typically bound to a UI element to allow users to edit or add links.\n     */\n    private _onClickHandler: EventListener = (): void => {\n        this.showLinkModal();\n    }\n\n    /**\n     * Handles click events on the modal background.\n     * \n     * If the click event's target is the modal background, this method prevents the default behavior,\n     * stops the event from propagating further, and hides the link modal.\n     *\n     * @param e - The mouse event triggered by the user's click.\n     */\n    private _onBackgroundClick = (e: MouseEvent): void => {\n        if (e.target === this.modal?.background) {\n            e.stopImmediatePropagation();\n            e.preventDefault();\n            this.hideLinkModal();\n            if (this.debug) {\n                console.debug('LinkAction modal background clicked, hiding modal');\n            }   \n        }\n    }\n\n    /**\n     * Displays the link modal dialog for editing or inserting a link.\n     * \n     * If a target element is present, this method constructs the modal,\n     * appends it to the formatter's overlay, and sets up necessary event listeners.\n     * The modal is initially hidden to prevent flicker, then shown after being\n     * positioned correctly relative to the target element.\n     *\n     * @returns {void}\n     */\n    showLinkModal = (): void => {\n        if (this.targetElement) {\n            this.modal = this._buildModal();\n            if (!this.modal) return;\n\n            this.formatter.overlay.append(this.modal.dialog, this.modal.background);\n            this._addEventListeners();\n\n            // Hide to prevent flicker and force layout\n            this.modal.dialog.style.visibility = 'hidden';\n            this.modal.dialog.show();\n            this._positionModal(this.modal.dialog);\n            // Show after positioning\n            this.modal.dialog.style.visibility = \"visible\";\n            // Focus the input field\n            this.modal.input.focus();\n            this.modal.input.select();\n        }\n    }\n\n    /**\n     * Builds and returns the modal elements used for editing or inserting a link.\n     *\n     * This method creates a dialog element containing a form with a label, input field for the URL,\n     * and three buttons: OK (submit), Remove, and Cancel. It also creates a background mask element.\n     * All elements are styled and configured according to the `linkOptions` provided to the class.\n     *\n     * @returns An object containing references to the created modal elements:\n     * - `dialog`: The dialog element that serves as the modal container.\n     * - `background`: The background mask element for the modal.\n     * - `form`: The form element inside the dialog.\n     * - `label`: The label element for the input.\n     * - `input`: The input element for entering the link URL.\n     * - `okButton`: The submit button for confirming the link.\n     * - `cancelButton`: The button for cancelling the operation.\n     * - `removeButton`: The button for removing the link.\n     */\n    private _buildModal = (): typeof this.modal => {\n        const dialog = document.createElement('dialog');\n        dialog.className = this.linkOptions.modal.dialog.className;\n        dialog.dataset.blotFormatterModal = '';\n        Object.assign(dialog.style, this.linkOptions.modal.dialog.style);\n\n        // Create form\n        const form = document.createElement('form');\n        form.method = 'dialog';\n        form.className = this.linkOptions.modal.form.className;\n        Object.assign(form.style, this.linkOptions.modal.form.style);\n\n        // Label\n        const label = document.createElement('label');\n        label.htmlFor = 'link-url';\n        label.textContent = this.linkOptions.modal.label.text;\n        label.className = this.linkOptions.modal.label.className;\n        Object.assign(label.style, this.linkOptions.modal.label.style);\n\n        // Input\n        const input = document.createElement('input');\n        input.type = 'url';\n        input.id = 'link-url';\n        input.name = 'url';\n        input.value = this.getLink() || '';\n        input.select();\n        input.autofocus = true;\n        input.className = this.linkOptions.modal.input.className;\n        Object.assign(input.style, this.linkOptions.modal.input.style);\n        input.placeholder = this.linkOptions.modal.input.placeholder || '';\n\n        // OK button\n        const okButton = document.createElement('button');\n        okButton.type = 'submit';\n        okButton.innerHTML = this.linkOptions.modal.buttons.submit.icon;\n        okButton.className = this.linkOptions.modal.buttons.submit.className;\n        Object.assign(okButton.style, this.linkOptions.modal.buttons.submit.style);\n\n        // Cancel button\n        const cancelButton = document.createElement('button');\n        cancelButton.type = 'button';\n        cancelButton.innerHTML = this.linkOptions.modal.buttons.cancel.icon;\n        cancelButton.className = this.linkOptions.modal.buttons.cancel.className;\n        Object.assign(cancelButton.style, this.linkOptions.modal.buttons.cancel.style);\n\n        // Remove button\n        const removeButton = document.createElement('button');\n        removeButton.type = 'button';\n        removeButton.innerHTML = this.linkOptions.modal.buttons.remove.icon;\n        removeButton.className = this.linkOptions.modal.buttons.remove.className;\n        Object.assign(removeButton.style, this.linkOptions.modal.buttons.remove.style);\n\n        // Append modal\n        form.appendChild(label);\n        form.appendChild(input);\n        form.appendChild(okButton);\n        form.appendChild(removeButton);\n        form.appendChild(cancelButton);\n        dialog.appendChild(form);\n\n        // Background mask\n        const background = document.createElement('div');\n        background.className = this.linkOptions.modal.background.className || '';\n        Object.assign(background.style, this.linkOptions.modal.background.style);\n\n        return {\n            dialog,\n            background,\n            form,\n            label,\n            input,\n            okButton,\n            cancelButton,\n            removeButton\n        };\n    }\n\n    /**\n     * Positions the given dialog element centered over the formatter's overlay,\n     * ensuring it stays within the bounds of the Quill editor root element.\n     *\n     * The method calculates the overlay and Quill root bounding rectangles,\n     * determines the dialog's dimensions, and computes the appropriate\n     * `left` and `top` CSS properties to center the dialog over the overlay.\n     * The horizontal & vertical position is clamped so the dialog does not overflow\n     * the Quill root element.\n     *\n     * @param dialog - The HTMLDialogElement to position.\n     */\n    private _positionModal = (dialog: HTMLDialogElement): void => {\n        const overlayRect = this.formatter.overlay.getBoundingClientRect();\n        const quillRect = this.formatter.quill.root.getBoundingClientRect();\n        const offsetParentRect = dialog.offsetParent?.getBoundingClientRect() ?? { top: 0, left: 0 };\n\n        const dialogWidth = dialog.offsetWidth;\n        const dialogHeight = dialog.offsetHeight;\n\n        // Center horizontally relative to overlay\n        let left = overlayRect.left + overlayRect.width / 2 - dialogWidth / 2 - offsetParentRect.left;\n        let top = overlayRect.top + overlayRect.height / 2 - dialogHeight / 2 - offsetParentRect.top;\n\n        // Clamp left to stay within quill root, in same coordinate space\n        const minLeft = quillRect.left - offsetParentRect.left;\n        const maxLeft = quillRect.right - dialogWidth - offsetParentRect.left;\n        left = Math.min(Math.max(left, minLeft), maxLeft);\n\n        const minTop = quillRect.top - offsetParentRect.top;\n        const maxTop = quillRect.bottom - dialogHeight - offsetParentRect.top;\n        top = Math.min(Math.max(top, minTop), maxTop);\n\n        // Apply positioning\n        dialog.style.position = \"absolute\";\n        dialog.style.left = `${left}px`;\n        dialog.style.top = `${top}px`;\n    }\n\n    /**\n     * Hides and cleans up the link modal dialog.\n     *\n     * This method closes and removes the modal dialog and its background overlay if they exist,\n     * removes any associated event listeners, and resets the modal reference to undefined.\n     */\n    hideLinkModal = (): void => {\n        if (this.modal?.dialog?.open) this.modal.dialog.close();\n        this.modal?.dialog?.remove();\n        if (this.modal?.background)\n            this.modal.background.remove();\n        this._removeEventListeners();\n        this.modal = undefined;\n    }\n\n    /**\n     * Handles the form submission event for the link action.\n     * \n     * Prevents the default form submission behavior, extracts the URL from the form data,\n     * and applies or removes a link on the current blot based on the URL's presence.\n     *\n     * @param event - The form submission event.\n     */\n    private _formSubmitHandler = (event: Event): void => {\n        event.preventDefault();\n        const form = event.target as HTMLFormElement;\n        const formData = new FormData(form);\n        const url = (formData.get('url') as string).trim();\n        if (this.debug) {\n            console.debug('LinkAction form submitted with URL:', url);\n        }\n        if (this.currentBlot) {\n            if (url) {\n                this.applyLink(url);\n            } else {\n                this.removeLink();\n            }\n        }\n    }\n\n    /**\n     * Retrieves the link format associated with the current blot, if any.\n     *\n     * @returns {any | null} The link URL if the current blot has a link format, otherwise `null`.\n     *\n     * @remarks\n     * This method checks if the current blot exists and has a DOM node. It then retrieves the index of the blot\n     * in the Quill editor and fetches its formats. If a link format is present, it returns the link value; otherwise, it returns `null`.\n     */\n    getLink = (): any => {\n        const blot = this.currentBlot;\n        if (!blot || !blot.domNode) return null;\n        const index = this.formatter.quill.getIndex(blot);\n        const formats = this.formatter.quill.getFormat(index, 1, this.formatter.Quill.sources.SILENT);\n        if (this.debug) {\n            console.debug('LinkAction getLink called, formats:', formats);\n        }\n        return formats.link || null;\n    }\n\n    /**\n     * Removes the link format from the current image blot's parent wrapper, if present.\n     * \n     * Traverses up the blot hierarchy from the current image blot to find a parent blot\n     * with a 'link' format. If found, it removes the link format from that wrapper.\n     * After removing the link, it hides the link modal and deselects the toolbar button.\n     *\n     * @returns {void}\n     */\n    removeLink = (): void => {\n        const imageBlot = this.currentBlot;\n        if (!imageBlot || !imageBlot.domNode) return;\n        let wrapperBlot = imageBlot.parent;\n        // Traverse upward until we find the inline wrapper with the link format\n        while (wrapperBlot && typeof wrapperBlot.formats === 'function') {\n            const formats = wrapperBlot.formats();\n            if (formats.link) {\n                wrapperBlot.format('link', null);\n                break;\n            }\n            wrapperBlot = wrapperBlot.parent;\n        }\n        if (this.debug) {\n            console.debug('LinkAction removeLink called, removed link from blot:', wrapperBlot);\n        }\n        this.hideLinkModal();\n        this.toolbarButton.selected = false;\n    }\n\n    /**\n     * Applies a link to the current blot if the provided URL is different from the existing link.\n     * Removes any existing link, formats the current blot with the new link, and updates the toolbar button state.\n     * Hides the link modal after applying the link.\n     *\n     * @param url - The URL to apply as a link to the current blot.\n     */\n    applyLink = (url: string): void => {\n        if (url !== this.getLink()) {\n            this.removeLink();\n            this.currentBlot?.format('link', url);\n            this.toolbarButton.selected = (!!url);\n        }\n        this.hideLinkModal();\n    }\n}","import Action from '../actions/Action';\nimport AttributeAction from '../actions/AttributeAction';\nimport BlotFormatter from '../BlotFormatter';\nimport BlotSpec from './BlotSpec';\nimport CompressAction from '../actions/CompressAction';\nimport LinkAction from '../actions/LinkAction';\n\n/**\n * Represents a specification for handling image elements within a Quill editor instance.\n * \n * `ImageSpec` extends `BlotSpec` to provide image-specific functionality, including:\n * - Initializing event listeners for image selection.\n * - Determining available actions (link editing, alt/title editing, compression) based on formatter options.\n * - Managing the currently selected image element.\n * - Handling UI display and cleanup when the image overlay is shown or hidden.\n * \n * @remarks\n * This class is intended to be used as part of the Quill Blot Formatter extension for rich image editing.\n * \n * @extends BlotSpec\n */\nexport default class ImageSpec extends BlotSpec {\n  img: HTMLElement | null;\n\n  constructor(formatter: BlotFormatter) {\n    super(formatter);\n    this.img = null;\n  }\n\n  /**\n   * Initializes the image spec by attaching a click event listener to the Quill editor's root element.\n   * The event listener triggers the `onClick` handler when the root element is clicked.\n   */\n  init = (): void => {\n    this.formatter.quill.root.addEventListener('click', this.onClick);\n  }\n\n  /**\n   * Returns an array of available actions for the image spec, based on the current formatter options and image eligibility.\n   *\n   * The returned actions may include:\n   * - `LinkAction`: If link editing is allowed (`image.linkOptions.allowLinkEdit`).\n   * - `AttributeAction`: If alt/title editing is allowed (`image.allowAltTitleEdit`).\n   * - `CompressAction`: If compression is allowed (`image.allowCompressor`) and the image is eligible for compression.\n   *\n   * @returns {Array<Action>} The list of actions applicable to the current image spec.\n   */\n  getActions = (): Array<Action> => {\n    const actions = super.getActions();\n    if (this.formatter.options.image.linkOptions.allowLinkEdit) {\n      actions.push(new LinkAction(this.formatter));\n    }\n    if (this.formatter.options.image.allowAltTitleEdit) {\n      actions.push(new AttributeAction(this.formatter));\n    }\n    if (this.formatter.options.image.allowCompressor && CompressAction.isEligibleForCompression(this.img)) {\n      actions.push(new CompressAction(this.formatter));\n    }\n    return actions;\n  }\n\n  /**\n   * Returns the target HTML element associated with this instance.\n   *\n   * @returns {HTMLElement | null} The image element if available, otherwise `null`.\n   */\n  getTargetElement = (): HTMLElement | null => {\n    return this.img;\n  }\n\n  /**\n   * Handles the hide event by resetting the image reference to null.\n   * This is typically called when the overlay should no longer be displayed or interacted with.\n   */\n  onHide = (): void => {\n    this.img = null;\n  }\n\n  /**\n   * Handles click events on image elements.\n   * \n   * If the clicked element is an HTMLImageElement, prevents the default behaviour\n   * (such as opening links), stores a reference to the image, and displays the formatter UI.\n   * \n   * @param event - The mouse event triggered by the click.\n   */\n  onClick = (event: MouseEvent): void => {\n    const el = event.target;\n    if (this.formatter.enabled && el instanceof HTMLImageElement) {\n      // prevent <a> links from opening\n      event.stopImmediatePropagation();\n      event.preventDefault();\n      this.img = el;\n      this.formatter.show(this);\n    }\n  };\n}\n","import IframeVideoSpec from './specs/IframeVideoSpec';\nimport ImageSpec from './specs/ImageSpec';\nimport type { Options } from './Options';\n\nconst closeButtonIcon = `<svg viewBox=\"0 0 16 16\" fill=\"currentColor\" style=\"height:100%;width:auto\"><path d=\"M2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2zm3.354 4.646L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 1 1 .708-.708\"/></svg>`;\nconst okButtonIcon = `<svg viewBox=\"0 0 24 24\" fill=\"currentcolor\" style=\"height:100%;width:auto\"><path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M 12,24 C 6.34314,24 3.514716,24 1.757364,22.2426 0,20.48532 0,17.6568 0,12 0,6.34314 0,3.514716 1.757364,1.757364 3.514716,0 6.34314,0 12,0 17.6568,0 20.48532,0 22.2426,1.757364 24,3.514716 24,6.34314 24,12 24,17.6568 24,20.48532 22.2426,22.2426 20.48532,24 17.6568,24 12,24 Z M 16.83636,8.363604 c 0.35148,0.351468 0.35148,0.921324 0,1.272756 l -6,6 c -0.35148,0.35148 -0.92124,0.35148 -1.272756,0 l -2.4,-2.4 c -0.351468,-0.35148 -0.351468,-0.92124 0,-1.27272 0.351468,-0.35148 0.921324,-0.35148 1.272792,0 L 10.2,13.72716 15.56364,8.363604 c 0.35148,-0.351468 0.92124,-0.351468 1.27272,0 z\" style=\"stroke-width:1.2\" /></svg>`;\nconst infoButtonIcon = `<svg viewBox=\"0 0 512 512\" fill=\"currentcolor\" style=\"height:100%;width:auto\"><path d=\"M464 256A208 208 0 1 0 48 256a208 208 0 1 0 416 0zM0 256a256 256 0 1 1 512 0A256 256 0 1 1 0 256zm169.8-90.7c7.9-22.3 29.1-37.3 52.8-37.3l58.3 0c34.9 0 63.1 28.3 63.1 63.1c0 22.6-12.1 43.5-31.7 54.8L280 264.4c-.2 13-10.9 23.6-24 23.6c-13.3 0-24-10.7-24-24l0-13.5c0-8.6 4.6-16.5 12.1-20.8l44.3-25.4c4.7-2.7 7.6-7.7 7.6-13.1c0-8.4-6.8-15.1-15.1-15.1l-58.3 0c-3.4 0-6.4 2.1-7.5 5.3l-.4 1.2c-4.4 12.5-18.2 19-30.6 14.6s-19-18.2-14.6-30.6l.4-1.2zM224 352a32 32 0 1 1 64 0 32 32 0 1 1 -64 0z\" /></svg>`;\n\nexport const DefaultOptions: Options = {\n  specs: [\n    ImageSpec,\n    IframeVideoSpec,\n  ],\n  overlay: {\n    className: 'blot-formatter__overlay',\n    style: {\n      position: 'absolute',\n      boxSizing: 'border-box',\n      border: '1px dashed #444',\n      backgroundColor: 'rgba(255, 255, 255, 0.35)',\n      maxWidth: \"100%\",\n      zIndex: 9999\n    },\n    sizeInfoStyle: {\n      position: 'absolute',\n      color: 'rgba(255, 255, 255, 0.7)',\n      backgroundColor: 'rgba(0, 0, 0, 0.7)',\n      top: '50%',\n      left: '50%',\n      transform: 'translate(-50%, -50%)',\n      padding: '1em',\n      textWrap: 'nowrap',\n      fontSize: '1rem',\n      opacity: 0,\n      lineHeight: 1.2,\n    },\n  },\n  align: {\n    allowAligning: true,\n    alignments: ['left', 'center', 'right']\n  },\n  resize: {\n    allowResizing: true,\n    allowResizeModeChange: false,\n    imageOversizeProtection: false,\n    handleClassName: 'blot-formatter__resize-handle',\n    handleStyle: {\n      position: 'absolute',\n      height: '12px',\n      width: '12px',\n      backgroundColor: 'white',\n      border: '1px solid #777',\n      boxSizing: 'border-box',\n      opacity: '0.80',\n      zIndex: 999\n    },\n    useRelativeSize: false,\n    minimumWidthPx: 25,\n  },\n  delete: {\n    allowKeyboardDelete: true,\n  },\n  toolbar: {\n    icons: {\n      left: `<svg viewbox=\"0 0 18 18\"><line class=\"ql-stroke\" x1=\"3\" x2=\"15\" y1=\"9\" y2=\"9\"></line><line class=\"ql-stroke\" x1=\"3\" x2=\"13\" y1=\"14\" y2=\"14\"></line><line class=\"ql-stroke\" x1=\"3\" x2=\"9\" y1=\"4\" y2=\"4\"></line></svg>`,\n      center: `<svg viewbox=\"0 0 18 18\"><line class=\"ql-stroke\" x1=\"15\" x2=\"3\" y1=\"9\" y2=\"9\"></line><line class=\"ql-stroke\" x1=\"14\" x2=\"4\" y1=\"14\" y2=\"14\"></line><line class=\"ql-stroke\" x1=\"12\" x2=\"6\" y1=\"4\" y2=\"4\"></line></svg>`,\n      right: `<svg viewbox=\"0 0 18 18\"><line class=\"ql-stroke\" x1=\"15\" x2=\"3\" y1=\"9\" y2=\"9\"></line><line class=\"ql-stroke\" x1=\"15\" x2=\"5\" y1=\"14\" y2=\"14\"></line><line class=\"ql-stroke\" x1=\"15\" x2=\"9\" y1=\"4\" y2=\"4\"></line></svg>`,\n      attribute: `<svg viewBox=\"0 0 24 24\" fill=\"none\" class=\"ql-stroke\"><path d=\"M10 19H12M12 19H14M12 19V5M12 5H6V6M12 5H18V6\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/></svg>`,\n      resizeMode: `<svg viewBox=\"0 0 24 24\" class=\"ql-stroke\"><path d=\"m 7.7056591,11.853515 q -1.515179,0 -2.4160962,-0.993056 -0.9009172,-1.0032944 -0.9009172,-2.6720388 0,-1.8223098 0.9521057,-2.8665548 0.9521057,-1.0544826 2.5696616,-1.0544826 1.5663674,0 2.426334,0.9725811 0.870204,0.972581 0.870204,2.7334647 0,1.7608836 -0.972581,2.8256044 -0.9623435,1.054482 -2.5287109,1.054482 z M 7.8489868,5.3935293 q -0.9725811,0 -1.5356544,0.7268764 -0.5630732,0.7166387 -0.5630732,1.9758752 0,1.2387612 0.5528356,1.9349241 0.5528355,0.685926 1.5049412,0.685926 0.9623434,0 1.5049413,-0.716639 0.5425978,-0.7166384 0.5425978,-1.9861126 0,-1.2387612 -0.5425978,-1.9246868 Q 8.7806171,5.3935293 7.8489868,5.3935293 Z M 17.533847,4.4926121 8.1151669,19.275845 H 6.6511764 L 16.059619,4.4926121 Z M 16.448651,19.398697 q -1.515179,0 -2.416096,-1.003294 -0.900917,-1.003294 -0.900917,-2.661801 0,-1.82231 0.962343,-2.876793 0.962344,-1.06472 2.559424,-1.06472 1.55613,0 2.426334,0.982819 0.870204,0.982819 0.870204,2.75394 0,1.750646 -0.972581,2.815366 -0.962343,1.054483 -2.528711,1.054483 z m 0.143328,-6.449748 q -0.982819,0 -1.545892,0.716638 -0.552836,0.716639 -0.552836,1.986113 0,1.218286 0.552836,1.914449 0.552835,0.685926 1.504941,0.685926 0.962343,0 1.504941,-0.716639 0.542598,-0.726876 0.542598,-1.986113 0,-1.248998 -0.542598,-1.924686 -0.53236,-0.675688 -1.46399,-0.675688 z\" style=\"fill:currentColor;stroke:currentColor;stroke-width:0.3\"/></svg>`,\n      compress: `<svg viewBox=\"0 0 28 28\"><path d=\"m 19.250001,9.3125004 c 0.240623,0 0.437498,0.1968749 0.437498,0.4374991 V 18.49453 l -0.136717,-0.177734 -3.718751,-4.812498 c -0.123046,-0.161329 -0.317188,-0.254297 -0.51953,-0.254297 -0.202345,0 -0.39375,0.09297 -0.519532,0.254297 l -2.269532,2.936715 -0.833984,-1.167577 c -0.123047,-0.172265 -0.319922,-0.273437 -0.533204,-0.273437 -0.213281,0 -0.410156,0.101172 -0.533202,0.276172 l -2.1875003,3.0625 -0.1230462,0.169532 v -0.0082 -8.7500002 c 0,-0.2406242 0.1968749,-0.4374991 0.4374991,-0.4374991 z M 8.7499996,8 C 7.7847663,8 7,8.7847662 7,9.7499995 V 18.5 c 0,0.965233 0.7847663,1.75 1.7499996,1.75 H 19.250001 C 20.215235,20.25 21,19.465233 21,18.5 V 9.7499995 C 21,8.7847662 20.215235,8 19.250001,8 Z M 10.9375,13.250001 a 1.3125025,1.312501 0 1 0 0,-2.625002 1.3125025,1.312501 0 1 0 0,2.625002 z\" /><path d=\"m 25.298508,20 h -3.58209 C 21.286567,20 21,20.286571 21,20.716427 v 3.582131 c 0,0.429856 0.286567,0.716426 0.716418,0.716426 v 0 c 0.429851,0 0.716418,-0.28657 0.716418,-0.716426 v -2.865705 h 2.865672 c 0.429851,0 0.716418,-0.28657 0.716418,-0.716426 C 26.014926,20.286571 25.728359,20 25.298508,20 Z\" /><path d=\"M 6.298508,20 H 2.716418 C 2.2865673,20 2,20.286571 2,20.716427 c 0,0.429856 0.2865673,0.716426 0.716418,0.716426 H 5.58209 v 2.865705 c 0,0.429856 0.286567,0.716426 0.716418,0.716426 v 0 c 0.429851,0 0.716418,-0.28657 0.716418,-0.716426 V 20.716427 C 7.014926,20.286571 6.728359,20 6.298508,20 Z\" /><path d=\"M 6.298507,3 C 5.868656,3 5.582089,3.28657 5.582089,3.716426 V 6.582131 H 2.716417 C 2.286567,6.582131 2,6.868702 2,7.298557 2,7.728413 2.286567,8.014984 2.716417,8.014984 h 3.58209 c 0.429845,0 0.716412,-0.286571 0.716412,-0.716427 V 3.716426 C 7.014919,3.28657 6.728352,3 6.298507,3 Z\" /><path d=\"m 21.716418,8.014984 h 3.582089 c 0.429851,0 0.716418,-0.286571 0.716418,-0.716427 0,-0.429855 -0.286567,-0.716426 -0.716418,-0.716426 H 22.432836 V 3.716426 C 22.432836,3.28657 22.146269,3 21.716418,3 21.286567,3 21,3.28657 21,3.716426 v 3.582131 c 0,0.429856 0.286567,0.716427 0.716418,0.716427 z\" /></svg>`,\n      link: `<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 18 18\" style=\"fill: none;stroke: #444;stroke-linecap: round;stroke-linejoin: round;stroke-width: 1.5;\"><line x1=\"7\" x2=\"11\" y1=\"7\" y2=\"11\"/><path class=\"ql-even\" d=\"M8.9,4.577a3.476,3.476,0,0,1,.36,4.679A3.476,3.476,0,0,1,4.577,8.9C3.185,7.5,2.035,6.4,4.217,4.217S7.5,3.185,8.9,4.577Z\"/><path class=\"ql-even\" d=\"M13.423,9.1a3.476,3.476,0,0,0-4.679-.36,3.476,3.476,0,0,0,.36,4.679c1.392,1.392,2.5,2.542,4.679.36S14.815,10.5,13.423,9.1Z\"/></svg>`,\n    },\n    tooltips: {\n      left: 'Align Left',\n      center: 'Align Center',\n      right: 'Align Right',\n      attribute: 'Set Alt/Title',\n      resizeMode: 'Use Relative (%)/Absolute (px) Sizing',\n      compress: 'Compress Image',\n      link: 'Add/Edit Link',\n    },\n    mainClassName: 'blot-formatter__toolbar',\n    mainStyle: {\n      position: 'absolute',\n      display: 'flex',\n      top: '0',\n      right: '0',\n      left: '0',\n      transform: 'translateY(-50%)',\n      justifyContent: 'center',\n      flexWrap: 'wrap',\n      color: '#333',\n      zIndex: '1',\n    },\n    buttonClassName: 'blot-formatter__toolbar-button',\n    buttonStyle: {\n      display: 'inline-block',\n      width: '27px',\n      height: '26px',\n      background: 'white',\n      border: '1px solid #999',\n      cursor: 'pointer',\n      margin: '0 -1px 0 0'\n    },\n    buttonSelectedClassName: 'blot-formatter__toolbar-button--selected',\n    buttonSelectedStyle: {\n      filter: 'invert(20%)',\n    },\n    svgStyle: {\n      display: 'inline-block',\n      width: '100%',\n      height: '100%',\n      background: 'white',\n      verticalAlign: 'top',\n    },\n  },\n  image: {\n    allowAltTitleEdit: true,\n    registerImageTitleBlot: false,\n    registerArrowRightFix: true,\n    altTitleModalOptions: {\n      styles: {\n        modalBackground: {\n          position: 'fixed',\n          top: 0,\n          left: 0,\n          width: '100%',\n          height: '100%',\n          backgroundColor: 'rgba(0,0,0,0.5)',\n          display: 'flex',\n          alignItems: 'center',\n          justifyContent: 'center',\n          zIndex: 9999\n        },\n        modalContainer: {\n          backgroundColor: '#f2f2f2',\n          padding: '5px 10px 10px 10px',\n          borderRadius: '5px',\n          position: 'relative',\n          width: '90%',\n          maxWidth: '500px',\n          boxShadow: '6px 6px 5px #00000075'\n        },\n        label: {\n          display: 'block',\n          color: 'black',\n          margin: '7px 0 5px 0',\n          fontSize: '14px'\n        },\n        textarea: {\n          backgroundColor: 'white',\n          fontSize: '13px',\n          display: 'block',\n          resize: 'none',\n          width: '100%',\n          padding: '5px',\n          border: '1px solid lightgray',\n          borderRadius: '4px',\n          boxSizing: 'border-box'\n        },\n        submitButton: {\n          display: 'block',\n          marginLeft: 'auto',\n          marginTop: '5px',\n          cursor: 'pointer',\n          border: 0,\n          padding: 0,\n          width: '2rem',\n          height: '2rem',\n          color: '#198754'\n        },\n        cancelButton: {\n          display: 'flex',\n          width: '1.5rem',\n          height: '1.5rem',\n          position: 'absolute',\n          padding: 0,\n          top: '-0.7rem',\n          right: '-0.7rem',\n          background: 'white',\n          border: 'none',\n          borderRadius: '5px',\n          cursor: 'pointer',\n          alignItems: 'center',\n          color: 'rgb(197, 74, 71)'\n        },\n      },\n      icons: {\n        submitButton: okButtonIcon,\n        cancelButton: closeButtonIcon,\n      },\n      labels: {\n        alt: 'Alt Text',\n        title: 'Image Title'\n      }\n    },\n    allowCompressor: false,\n    compressorOptions: {\n      jpegQuality: 0.8,\n      styles: {\n        modalBackground: {\n          position: 'fixed',\n          top: 0,\n          left: 0,\n          width: '100%',\n          height: '100%',\n          backgroundColor: 'rgba(0,0,0,0.5)',\n          display: 'flex',\n          alignItems: 'center',\n          justifyContent: 'center',\n          zIndex: 9999\n        },\n        modalContainer: {\n          backgroundColor: 'rgb(253, 253, 253)',\n          border: '1px solid #ccc',\n          boxShadow: '6px 6px 5px #00000075',\n          padding: '15px',\n          borderRadius: '8px',\n          position: 'relative',\n          maxWidth: 'min(90%, 400px)',\n          textAlign: 'justify',\n          userSelect: 'none',\n        },\n        buttonContainer: {\n          gridTemplateColumns: 'auto 1fr auto',\n          display: 'grid',\n          gap: '1em',\n          justifyItems: 'center',\n          borderTop: '1px solid lightgray',\n          paddingTop: '12px'\n        },\n        buttons: {\n          width: '1.5rem',\n          height: '1.5rem',\n          padding: 0,\n          backgroundColor: 'transparent',\n          border: 0,\n          cursor: 'pointer',\n        }\n      },\n      buttons: {\n        continue: {\n          className: 'blot-formatter__compress-continue',\n          style: {\n            color: '#198754'\n          }\n        },\n        cancel: {\n          className: 'blot-formatter__compress-cancel',\n          style: {\n            color: 'rgb(197, 74, 71)'\n          }\n        },\n        moreInfo: {\n          className: 'blot-formatter__compress-more-info',\n          style: {\n            color: 'royalblue'\n          }\n        }\n      },\n      text: {\n        prompt: `<p style=\"font-style: large;margin: 0 0 0.5em;\">Compress image to its resized width?</p>`,\n        moreInfo: `<p style=\"font-size: smaller; line-height: 1.2;\">You can reduce the file size and save disk space by compressing pictures. The compression reduces both the file size and picture dimensions based on the width setting.</p><p style=\"font-size: smaller;\"><strong>NOTE:</strong> This process cannot be undone.</p>`,\n        reducedLabel: 'Reduced',\n        nothingToDo: 'Image already optimised.'\n      },\n      icons: {\n        cancel: `<span style=\"color: rgb(197, 74, 71);\">${closeButtonIcon}</span>`,\n        moreInfo: infoButtonIcon,\n        continue: okButtonIcon\n      }\n    },\n    linkOptions: {\n      allowLinkEdit: true,\n      modal: {\n        dialog: {\n          className: 'blot-formatter__link-modal',\n          style: { // NOTE: positioning handled programatically\n            margin: 0,\n            backgroundColor: '#fdfdfd',\n            border: '1px solid #ccc',\n            boxShadow: '6px 6px 5px #00000075',\n            color: '#444',\n            padding: '6px 13px 6px 10px',\n            whiteSpace: 'nowrap',\n            borderRadius: '5px',\n            minWidth: '300px',\n            maxWidth: '90%',\n            overflow: 'visible',\n            zIndex: 101, // Ensure it is above the background\n          }\n        },\n        background: {\n          className: 'blot-formatter__link-modal-background',\n          style: {\n            position: 'fixed',\n            inset: 0,\n            background: 'rgba(0, 0, 0, 0.5)',\n            zIndex: 100,\n          }\n        },\n        form: {\n          className: 'blot-formatter__link-form',\n          style: {\n            display: 'flex',\n            flexWrap: 'nowrap',\n            columnGap: '5px',\n            alignItems: 'center',\n            margin: 0\n          }\n        },\n        label: {\n          className: 'blot-formatter__link-label',\n          style: {\n            paddingRight: '5px',\n            fontSize: '13px',\n          },\n          text: 'URL:',\n        },\n        input: {\n          className: 'blot-formatter__link-input',\n          style: {\n            border: '1px solid #ccc',\n            borderRadius: '4px',\n            boxSizing: 'border-box',\n            fontSize: '13px',\n            height: '26px',\n            margin: '0 0.2rem 0 0',\n            padding: '3px 5px',\n            width: '100%',\n            outline: '1px auto #df9001c2',\n          },\n          placeholder: 'https://example.com',\n        },\n        buttons: {\n          submit: {\n            className: 'blot-formatter__link-submit',\n            style: {\n              border: 'none',\n              borderRadius: '3px',\n              padding: '0',\n              cursor: 'pointer',\n              background: 'transparent',\n              width: '26px',\n              height: '26px',\n              color: '#198754',\n              display: 'flex',\n              alignContent: 'center',\n              justifyContent: 'center',\n            },\n            icon: `<svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"currentColor\" viewBox=\"0 0 16 16\" style=\"height:100%;width:auto\"><path d=\"M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z\"/><path d=\"M10.97 4.97a.75.75 0 0 1 1.071 1.05l-3.992 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425z\"/></svg>`,\n            tooltip: 'Create Link'\n          },\n          cancel: {\n            className: 'blot-formatter__link-cancel',\n            style: {\n              display: 'flex',\n              width: '18px',\n              height: '18px',\n              position: 'absolute',\n              top: '-8px',\n              right: '-10px',\n              padding: '0',\n              background: 'white',\n              border: '1px solid rgb(157, 58, 56)',\n              borderRadius: '5px',\n              cursor: 'pointer',\n              alignItems: 'center',\n              color: 'rgb(197, 74, 71)',\n            },\n            icon: closeButtonIcon,\n            tooltip: 'Cancel'\n          },\n          remove: {\n            className: 'blot-formatter__link-remove',\n            style: {\n              border: 'none',\n              padding: '0',\n              cursor: 'pointer',\n              background: 'transparent',\n              width: '26px',\n              height: '26px',\n              fill: '#c54a47',\n              display: 'flex',\n              placeContent: 'center',\n              justifyContent: 'center',\n            },\n            icon: `<svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:svg=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 16 16\" style=\"height:100%;width:auto\"><path d=\"M 6.265625,3.3457031 6.125,3.625 H 4.25 c -0.3457031,0 -0.625,0.2792969 -0.625,0.625 0,0.3457031 0.2792969,0.625 0.625,0.625 h 7.5 c 0.345703,0 0.625,-0.2792969 0.625,-0.625 0,-0.3457031 -0.279297,-0.625 -0.625,-0.625 H 9.875 L 9.734375,3.3457031 C 9.6289062,3.1328125 9.4121094,3 9.1757812,3 H 6.8242188 C 6.5878906,3 6.3710938,3.1328125 6.265625,3.3457031 Z M 11.75,5.5 h -7.5 l 0.4140625,6.621094 C 4.6953125,12.615234 5.1054688,13 5.5996094,13 h 4.8007816 c 0.49414,0 0.904297,-0.384766 0.935547,-0.878906 z\" style=\"display:inline;stroke-width:0.0195312\"/><path d=\"m 14,1 a 1,1 0 0 1 1,1 v 12 a 1,1 0 0 1 -1,1 H 2 A 1,1 0 0 1 1,14 V 2 A 1,1 0 0 1 2,1 Z M 2,0 A 2,2 0 0 0 0,2 v 12 a 2,2 0 0 0 2,2 h 12 a 2,2 0 0 0 2,-2 V 2 A 2,2 0 0 0 14,0 Z\" style=\"display:inline\"/></svg>`,\n            tooltip: 'Remove Link'\n          }\n        }\n      }\n    },\n    autoHeight: true\n  },\n  video: {\n    selector: 'iframe.ql-video',\n    registerCustomVideoBlot: false,\n    registerBackspaceFix: true,\n    defaultAspectRatio: '16/9 auto',\n    proxyStyle: {}\n  }\n};\n","import Action from './actions/Action';\nimport BlotSpec from './specs/BlotSpec';\nimport CaretAction from './actions/CaretAction';\nimport deepmerge from 'deepmerge';\nimport type Quill from 'quill';\nimport Toolbar from './actions/toolbar/Toolbar';\nimport TooltipContainPosition from './tooltip/TooltipContainPosition';\nimport type { AttributorClass } from './actions/align/AlignFormats';\nimport { createAltTitleImageBlotClass } from './blots/Image';\nimport { createIframeAlignAttributor, createImageAlignAttributor } from './actions/align/AlignFormats';\nimport { createResponsiveVideoBlotClass } from './blots/Video';\nimport { DefaultOptions } from './DefaultOptions';\nimport type { Options } from './Options';\n\nconst dontMerge = (destination: Array<any>, source: Array<any>) => source;\n\n/**\n * Represents the possible positions of a pointer relative to the formatter overlay.\n *\n * - `LEFT`: The pointer is positioned to the left of the overlay.\n * - `RIGHT`: The pointer is positioned to the right of the overlay.\n * - `ABOVE`: The pointer is positioned above the overlay.\n * - `BELOW`: The pointer is positioned below the overlay.\n * - `INSIDE`: The pointer is positioned inside the overlay.\n */\nenum PointerPosition {\n  LEFT = 'left',\n  RIGHT = 'right',\n  ABOVE = 'above',\n  BELOW = 'below',\n  INSIDE = 'inside',\n}\n\ntype PxString = `${number}px`;\ntype CssRectPx = {\n  left: PxString;\n  top: PxString;\n  width: PxString;\n  height: PxString;\n};\n\n/**\n * BlotFormatter is a Quill module that provides an interactive overlay for formatting embedded blots\n * (such as images, iframes, and videos) within the Quill rich text editor. It enables resizing, alignment,\n * and other custom actions on supported blots via a floating UI, and manages all related event handling,\n * DOM manipulation, and integration with Quill's API.\n *\n * Features:\n * - Displays an overlay with handles and a toolbar for formatting selected blots.\n * - Supports custom actions, alignment, and resizing (with both relative and absolute sizing).\n * - Integrates with Quill's keyboard bindings to fix known issues with embedded content.\n * - Handles touch and mouse interactions, including scrolling and context menu suppression.\n * - Registers and manages custom blots and attributors for advanced formatting.\n * - Provides robust cleanup and destruction of all event listeners and DOM elements.\n * - Exposes debugging hooks and logs when enabled via options.\n *\n * Usage:\n * Instantiate with a Quill editor instance and optional configuration options.\n * The formatter automatically attaches to the editor and manages its own lifecycle.\n *\n * Example:\n * ```typescript\n * const quill = new Quill('#editor', { ... });\n * const blotFormatter = new BlotFormatter(quill, { debug: true });\n * ```\n *\n * @template Options - The configuration options type for the formatter.\n * @template BlotSpec - The specification interface for supported blots.\n * @template Action - The interface for custom actions available in the overlay.\n *\n * @public\n */\nexport default class BlotFormatter {\n  Quill: typeof Quill;\n  quill: any;\n  options: Options;\n  currentSpec: BlotSpec | null;\n  specs: BlotSpec[];\n  overlay: HTMLElement;\n  toolbar: Toolbar;\n  sizeInfo: HTMLElement;\n  actions: Action[];\n  private _enabled: boolean = true;\n  private _startX: number = 0; // touch scroll tracking\n  private _startY: number = 0;\n  private _abortController?: AbortController;\n  private _resizeObserver?: ResizeObserver;\n  private _tooltipContainPosition?: TooltipContainPosition;\n  ImageAlign: AttributorClass;\n  IframeAlign: AttributorClass;\n\n  constructor(quill: any, options: Partial<Options> = {}) {\n    this.Quill = quill.constructor;\n    this.quill = quill;\n    this.currentSpec = null;\n    this.actions = [];\n    if (options.debug) {\n      (window as any).blotFormatter = this;\n    }\n\n    // Register the custom align formats with Quill\n    const ImageAlignClass = createImageAlignAttributor(this.Quill);\n    const IframeAlignClass = createIframeAlignAttributor(this.Quill);\n\n    // Create instances of the classes\n    this.ImageAlign = new ImageAlignClass(options.debug);\n    this.IframeAlign = new IframeAlignClass(options.debug);\n\n    // Register the align formats with Quill\n    if (options.debug) console.debug('Registering custom align formats', this.ImageAlign, this.IframeAlign);\n    this.Quill.register({\n      'formats/imageAlign': this.ImageAlign,\n      'attributors/class/imageAlign': this.ImageAlign,\n      'formats/iframeAlign': this.IframeAlign,\n      'attributors/class/iframeAlign': this.IframeAlign,\n    }, true);\n\n    // merge custom options with default\n    this.options = deepmerge(DefaultOptions, options, { arrayMerge: dontMerge });\n    if (options.debug) console.debug('BlotFormatter options', this.options);\n\n    // set enabled, add css to hide proxy images when editor is disabled\n    this._enabled = !(this.quill.options.readOnly || this.quill.container.classList.contains('ql-disabled'));\n    const style = document.createElement('style');\n    style.innerHTML = `.ql-disabled .blot-formatter__proxy-image {display: none;}`;\n    document.head.appendChild(style);\n\n    // create overlay & size info plus associated event listeners \n    [this.overlay, this.sizeInfo] = this._createOverlay();\n    this._addEventListeners();\n    // create overlay toolbar\n    this.toolbar = new Toolbar(this);\n    if (options.debug) console.debug('BlotFormatter toolbar', this.toolbar);\n    // define which specs to be formatted, initialise each\n    this.specs = this.options.specs.map(\n      (SpecClass: new (formatter: BlotFormatter) => BlotSpec) => new SpecClass(this)\n    );\n    this.specs.forEach(spec => spec.init());\n    if (options.debug) console.debug('BlotFormatter specs', this.specs);\n    // set position relative on quill container for absolute positioning of overlay & proxies \n    this.quill.container.style.position = this.quill.container.style.position || 'relative';\n    // register custom blots as per options\n    this._registerCustomBlots();\n    // register keyboard bindings as per options\n    this._keyboardBindings();\n    // add tooltip position fix if enabled\n    if (this.options.debug) console.debug('tooltip option', this.options.tooltip?.containTooltipPosition)\n    if (this.options.tooltip?.containTooltipPosition) {\n      this._tooltipContainPosition = new TooltipContainPosition(this.quill, this.options.debug);\n    }\n\n  }\n\n  /**\n   * Destroys the BlotFormatter instance, cleaning up event listeners, actions, toolbar,\n   * and DOM references. Also removes any global references and clears internal state.\n   * Logs a debug message if the `debug` option is enabled.\n   * Catches and logs any errors that occur during the destruction process.\n   */\n  destroy = (): void => {\n    try {\n      this.hide();\n      this._removeEventListeners();\n      this._destroyActions();\n      this.toolbar?.destroy();\n\n      // Clean up DOM references\n      if (this.overlay?.parentNode) {\n        this.overlay.parentNode.removeChild(this.overlay);\n      }\n\n      // Clear references\n      this.currentSpec = null;\n      this.specs = [];\n      this.actions = [];\n\n      if (this.options.tooltip?.containTooltipPosition && this._tooltipContainPosition) {\n        this._tooltipContainPosition?.destroy();\n      }\n\n      // Remove global reference\n      if ((window as any).bf === this) {\n        delete (window as any).bf;\n      }\n\n      this.quill = null;\n      if (this.options.debug) console.debug('BlotFormatter destroyed');\n    } catch (error) {\n      console.error('BlotFormatter.destroy error:', error);\n    }\n  };\n\n  /**\n   * Indicates whether the blot formatter is currently active.\n   *\n   * When `true`, formatting controls and interactions are available.\n   * When `false`, the formatter is disabled and will not react to user input. Proxy images are hidden by css.\n   *\n   * @returns True if the formatter is enabled; otherwise false.\n   */\n  get enabled(): boolean {\n    return this._enabled;\n  }\n\n  /**\n   * Enables or disables the blot formatter UI.\n   *\n   * When set to false, any currently visible formatter interface (such as\n   * overlays, resize handles, or toolbars) is immediately hidden via `hide()`.\n   * While disabled, user interactions that would normally trigger the formatter\n   * are ignored until re-enabled.\n   *\n   * @param value True to enable the formatter; false to disable it and hide all active UI.\n   */\n  set enabled(value: boolean) {\n    if (!value) this.hide();\n    this._enabled = value;\n  }\n\n  /**\n   * MutationObserver monitoring the Quill editor container's class attribute to track disabled state.\n   *\n   * When the container gains or loses the 'ql-disabled' CSS class, this observer updates the\n   * formatter's `enabled` property accordingly, ensuring the formatter UI is automatically\n   * disabled/enabled in sync with the editor.\n   *\n   * Behavior:\n   * - Listens only for attribute mutations on the 'class' attribute.\n   * - Sets `this.enabled` to false if 'ql-disabled' is present; true otherwise.\n   *\n   * Rationale:\n   * Centralizes Quill's disabled state propagation without requiring explicit event hooks or\n   * modifications to Quill's core. This avoids polling and keeps formatter state consistent.\n   *\n   * Lifecycle:\n   * - Should be started after the editor container is available.\n   * - Must be disconnected during teardown (e.g., in a destroy/dispose method) to prevent memory leaks.\n   *\n   * Caveats:\n   * - Assumes the presence and semantic meaning of the 'ql-disabled' class as used by Quill.\n   * - If external code mutates classes frequently, this may fire often; the handler is intentionally lightweight.\n   */\n  private _qlDisabledObserver = new MutationObserver(mutations => {\n    mutations.forEach(mutation => {\n      if (mutation.type === 'attributes' && mutation.attributeName === 'class') {\n        this.enabled = !this.quill.container.classList.contains('ql-disabled');\n      }\n    });\n  });\n\n  /**\n   * Displays the blot formatter overlay for the specified blot.\n   *\n   * This method performs the following actions:\n   * - Hides any open Quill tooltips (such as hyperlink dialogs).\n   * - Optionally exposes the formatter instance for debugging.\n   * - Clears any existing overlay if active on another blot.\n   * - Sets the current blot specification and selection.\n   * - Disables user selection to prevent unwanted interactions.\n   * - Appends the overlay to the Quill editor container.\n   * - Repositions the overlay to match the blot's position.\n   * - Creates action buttons or controls for the current blot.\n   * - Initializes the toolbar for the formatter.\n   * - Adds a document-level pointerdown event listener to handle outside clicks.\n   * - Logs debug information if enabled in options.\n   *\n   * @param spec - The specification of the blot (*BlotSpec*) to be formatted.\n   * @returns void\n   */\n  show = (spec: BlotSpec): void => {\n    try {\n      // exit early if editor is readOnly or disabled\n      if (!this.enabled) return;\n      // hide any open tooltips (closes open hyperlink dialog and more)\n      this.quill.container.querySelectorAll('.ql-tooltip:not(.ql-hidden)').forEach(\n        (tooltip: HTMLElement) => {\n          tooltip.classList.add('ql-hidden');\n        }\n      );\n      // expose formatter for debugging\n      if (this.options.debug) (window as any).blotFormatter = this;\n      // clear overlay in case show called while overlay active on other blot\n      this.hide();\n      this.currentSpec = spec;\n      this.currentSpec.setSelection();\n      this._setUserSelect('none');\n      this.quill.container.appendChild(this.overlay);\n      this._repositionOverlay();\n      this._createActions(spec);\n      this.toolbar.create();\n      this._scrollToolbarIntoView(this.toolbar.element);\n      document.addEventListener('pointerdown', this._onDocumentPointerDown);\n      if (this.options.debug) console.debug('BlotFormatter show', spec);\n    } catch (error) {\n      console.error('Error showing BlotFormatter:', error);\n      this.hide();\n      // Re-throw the error to ensure it can be handled by the caller if needed\n      throw error;\n    }\n  }\n\n  /**\n   * Hides the blot formatter overlay and performs necessary cleanup.\n   *\n   * If a pointer event is provided, determines the click position relative to the target blot\n   * and places the caret before or after the blot accordingly. Calls the `onHide` method of the\n   * current spec, removes the overlay from the DOM, removes event listeners, resets user selection,\n   * destroys toolbar and actions, and emits a `TEXT_CHANGE` event to ensure the editor state is updated.\n   *\n   * @param event - Optional pointer event that triggered the hide action. Used to determine caret placement.\n   */\n  hide = (event: PointerEvent | null = null): void => {\n    if (this.currentSpec) {\n      if (event) {\n        const targetBlot = this.currentSpec!.getTargetBlot();\n        if (targetBlot) {\n          const position = this._getClickPosition(event);\n          if (position === PointerPosition.LEFT) {\n            if (this.options.debug) console.debug('Click position: LEFT');\n            CaretAction.placeCaretBeforeBlot(this.quill, targetBlot);\n          } else if (position === PointerPosition.RIGHT) {\n            if (this.options.debug) console.debug('Click position: RIGHT');\n            CaretAction.placeCaretAfterBlot(this.quill, targetBlot);\n          }\n        }\n      }\n      this.currentSpec.onHide();\n      this.currentSpec = null;\n      this.quill.container.removeChild(this.overlay);\n      document.removeEventListener('pointerdown', this._onDocumentPointerDown);\n      this.overlay.style.setProperty('display', 'none');\n      this._setUserSelect('');\n      this._destroyActions();\n      this.toolbar.destroy();\n      // TEXT_CHANGE event clears resize cursor from image when form is saved while overlay still active\n      this.quill.emitter.emit(\n        this.quill.constructor.events.TEXT_CHANGE, 0, this.quill.getLength(), 'api'\n      );\n    }\n    if (this.options.debug) console.debug('BlotFormatter hide');\n  }\n\n  /**\n   * Updates the state of the BlotFormatter overlay and its associated actions.\n   *\n   * This method repositions the overlay to match the current selection or formatting context,\n   * triggers the `onUpdate` method for each registered action, and logs a debug message if\n   * debugging is enabled in the options.\n   *\n   * @returns {void}\n   */\n  update = (): void => {\n    this._repositionOverlay();\n    this.actions.forEach(action => action.onUpdate());\n    if (this.options.debug) console.debug('BlotFormatter update');\n  }\n\n  /**\n   * Initializes the actions for the given blot specification.\n   * \n   * This method retrieves the list of actions from the provided `spec` using `getActions()`,\n   * calls the `onCreate()` lifecycle method on each action, and assigns the resulting array\n   * to the `actions` property. If debugging is enabled in the options, it logs each created action.\n   *\n   * @param spec - The blot specification containing the actions to initialize.\n   */\n  private _createActions = (spec: BlotSpec): void => {\n    this.actions = spec.getActions().map((action: Action) => {\n      action.onCreate();\n      if (this.options.debug) console.debug('BlotFormatter action created', action);\n      return action;\n    });\n  }\n\n  /**\n   * Destroys all registered actions by calling their `onDestroy` method and clearing the actions array.\n   * If debugging is enabled in the options, logs a debug message to the console.\n   *\n   * @private\n   */\n  private _destroyActions = (): void => {\n    this.actions.forEach((action: Action) => action.onDestroy());\n    this.actions = [];\n    if (this.options.debug) console.debug('BlotFormatter actions destroyed');\n  }\n\n  /**\n   * Creates and configures the overlay and size info HTML elements used for formatting blots.\n   *\n   * The overlay element is styled and configured to be non-selectable, and the size info element\n   * is appended to the overlay. Both elements can be customized via the `options.overlay` property.\n   * \n   * @returns A tuple containing the overlay HTMLElement and the size info HTMLElement.\n   */\n  private _createOverlay = (): [HTMLElement, HTMLElement] => {\n    const overlay = document.createElement('div');\n    // set up overlay element\n    overlay.classList.add(this.options.overlay.className);\n    if (this.options.overlay.style) {\n      Object.assign(overlay.style, this.options.overlay.style);\n    }\n    // prevent overlay being selectable\n    overlay.style.userSelect = 'none';\n    overlay.style.setProperty('-webkit-user-select', 'none');\n    overlay.style.setProperty('-moz-user-select', 'none');\n    overlay.style.setProperty('-ms-user-select', 'none');\n\n    const sizeInfo = document.createElement('div');\n    if (this.options.overlay.sizeInfoStyle) {\n      Object.assign(sizeInfo.style, this.options.overlay.sizeInfoStyle);\n    }\n    overlay.appendChild(sizeInfo);\n    if (this.options.debug) console.debug('BlotFormatter overlay created', overlay, sizeInfo);\n    return [overlay, sizeInfo]\n  }\n\n  /**\n   * Ensures that the toolbar element is visible within the viewport of the Quill editor.\n   * If the toolbar is positioned above the visible area of the editor, it scrolls the target element into view\n   * with an offset equal to the toolbar's height, then recalculates the toolbar's position.\n   * If the toolbar is still above the viewport, it scrolls the window to bring the toolbar into view smoothly.\n   *\n   * @param toolbarElement - The HTML element representing the toolbar to be scrolled into view.\n   * @returns A promise that resolves when any necessary scrolling has completed.\n   */\n  private _scrollToolbarIntoView = async (toolbarElement: HTMLElement): Promise<void> => {\n    let toolbarRect = toolbarElement.getBoundingClientRect();\n    const quillRect = this.quill.container.getBoundingClientRect();\n\n    const targetElement = this.currentSpec?.getTargetElement();\n    if (toolbarRect.top - quillRect.top < 0) {\n      if (targetElement) {\n        // Wait for the smooth scroll to complete\n        await this._scrollIntoViewWithOffset(targetElement, toolbarRect.height);\n        // Now recalculate the toolbar position\n        toolbarRect = toolbarElement.getBoundingClientRect();\n      }\n    }\n    // If toolbar is still above the viewport, scroll the window\n    if (toolbarRect.top < 0) {\n      if (this.options.debug) {\n        console.debug(`Scrolling window ${toolbarRect.top - toolbarRect.height}px to bring toolbar into view`);\n      }\n      window.scrollBy({ top: toolbarRect.top - toolbarRect.height, behavior: 'smooth' });\n    }\n  }\n\n  /**\n   * Scrolls the first scrollable ancestor of the given element into view with a specified offset.\n   * If the element is outside the visible bounds of its scrollable ancestor, the ancestor is scrolled\n   * so that the element is visible with the given offset from the top. Returns a promise that resolves\n   * when scrolling has completed (or immediately if no scrolling was necessary).\n   *\n   * @param el - The target HTMLElement to scroll into view.\n   * @param offset - The number of pixels to offset from the top of the scrollable ancestor (default: 10).\n   * @returns A promise that resolves when scrolling is finished.\n   */\n  private _scrollIntoViewWithOffset = (el: HTMLElement, offset = 10): Promise<void> => {\n    return new Promise((resolve) => {\n      let scrollingElement: Element | null = null;\n\n      for (let ancestor = el.parentElement; ancestor; ancestor = ancestor.parentElement) {\n        const { overflowY } = getComputedStyle(ancestor);\n        if (!['auto', 'scroll'].includes(overflowY) || ancestor.scrollHeight <= ancestor.clientHeight) continue;\n\n        const containerRect = ancestor.getBoundingClientRect();\n        const elRect = el.getBoundingClientRect();\n\n        if (elRect.top < containerRect.top + offset) {\n          scrollingElement = ancestor;\n          ancestor.scrollTo({\n            top: ancestor.scrollTop + elRect.top - containerRect.top - offset\n          });\n          if (this.options.debug) {\n            console.debug(`Scrolling ancestor ${ancestor.tagName} to bring element into view with offset ${offset}px`);\n          }\n          break; // Only scroll the first scrollable ancestor\n        }\n      }\n\n      if (scrollingElement) {\n        // Wait for smooth scroll to complete\n        const checkScrollEnd = () => {\n          let lastScrollTop = scrollingElement!.scrollTop;\n          const checkInterval = setInterval(() => {\n            if (scrollingElement!.scrollTop === lastScrollTop) {\n              // Scroll has stopped\n              clearInterval(checkInterval);\n              resolve();\n            } else {\n              lastScrollTop = scrollingElement!.scrollTop;\n            }\n          }, 50); // Check every 50ms\n        };\n\n        // Start checking after a brief delay\n        setTimeout(checkScrollEnd, 100);\n      } else {\n        // No scrolling occurred\n        resolve();\n      }\n    });\n  };\n\n  /**\n   * Adds all necessary event listeners to the overlay and Quill root elements.\n   *\n   * - For the overlay:\n   *   - Forwards mouse wheel and touch move events to allow scrolling.\n   *   - Disables the context menu to prevent default browser actions.\n   * - For the Quill root:\n   *   - Repositions the overlay on scroll and resize events.\n   *   - Dismisses the overlay when clicking on the Quill root.\n   * - For the quill container\n   *   - Observes class attribute changes to detect disabled state.\n   *\n   * This method ensures proper interaction and synchronization between the overlay\n   * and the Quill editor, handling user input and UI updates.\n   *\n   * @private\n   */\n  private _addEventListeners = (): void => {\n    this._abortController = new AbortController();\n    const { signal } = this._abortController;\n\n    // overlay event listeners\n    // scroll the quill root on mouse wheel & touch move event - do not use default 'passive' on these\n    this.overlay.addEventListener('wheel', this._passWheelEventThrough, { passive: false, signal });\n    this.overlay.addEventListener('touchstart', this._onTouchScrollStart, { passive: false, signal });\n    this.overlay.addEventListener('touchmove', this._onTouchScrollMove, { passive: false, signal });\n    // disable context menu on overlay\n    this.overlay.addEventListener('contextmenu', this._preventContextMenu, { signal });\n    // dismiss overlay if active and click on quill root\n    this.quill.root.addEventListener('click', this._onClick, { signal });\n\n    // quill root event listeners\n    // scroll visible overlay if editor is scrollable\n    this.quill.root.addEventListener('scroll', this._repositionOverlay, { signal });\n\n    this._resizeObserver = new ResizeObserver(this._repositionOverlay);\n    this._resizeObserver.observe(this.quill.root);\n\n    // observe quill container for disabled state changes\n    this._qlDisabledObserver.observe(this.quill.container, {\n      attributes: true,\n      attributeFilter: ['class']\n    });\n  }\n\n  /**\n   * Removes event listeners and observers associated with the instance.\n   * \n   * Aborts any ongoing operations managed by the internal AbortController,\n   * and disconnects the internal ResizeObserver to stop observing changes.\n   *\n   * @private\n   */\n  private _removeEventListeners = (): void => {\n    this._abortController?.abort();\n    this._resizeObserver?.disconnect();\n    this._qlDisabledObserver.disconnect();\n  };\n\n  /**\n   * Prevents the default context menu from appearing and stops the event from propagating further.\n   *\n   * @param event - The event object associated with the context menu action.\n   */\n  private _preventContextMenu = (event: Event): void => {\n    event.stopPropagation();\n    event.preventDefault();\n  };\n\n  /**\n   * Repositions the overlay element to align with the currently selected blot's overlay target.\n   *\n   * Calculates the position and size of the overlay based on the bounding rectangles of the\n   * Quill container and the overlay target element. Updates the overlay's style to match\n   * the target's position and dimensions, ensuring it is correctly displayed over the selected blot.\n   * Optionally logs debug information if the `debug` option is enabled.\n   *\n   * @private\n   */\n  private _repositionOverlay = (): void => {\n    if (this.currentSpec) {\n      const overlayTarget = this.currentSpec.getOverlayElement();\n      if (overlayTarget) {\n        const containerRect: DOMRect = this.quill.container.getBoundingClientRect();\n        const specRect: DOMRect = overlayTarget.getBoundingClientRect();\n        const overlayRect: CssRectPx = {\n          left: `${specRect.left - containerRect.left - 1 + this.quill.container.scrollLeft}px`,\n          top: `${specRect.top - containerRect.top + this.quill.container.scrollTop}px`,\n          width: `${specRect.width}px`,\n          height: `${specRect.height}px`,\n        };\n        Object.assign(this.overlay.style, {\n          display: 'block',\n          ...overlayRect\n        });\n        if (this.options.debug)\n          console.debug('Blotformatter _repositionOverlay', 'specRect:', specRect, 'overlayRect:', overlayRect);\n      }\n    }\n  }\n\n  /**\n   * Sets the CSS `user-select` property (and its vendor-prefixed variants) to the specified value\n   * on both the Quill editor root element and the document's root element.\n   *\n   * This method is typically used to enable or disable text selection within the editor and the page,\n   * which can be useful during formatting operations to prevent unwanted user interactions.\n   *\n   * @param value - The value to set for the `user-select` property (e.g., `'none'`, `'auto'`).\n   */\n  private _setUserSelect = (value: string): void => {\n    const props: string[] = [\n      'userSelect',\n      'mozUserSelect',\n      'webkitUserSelect',\n      'msUserSelect',\n    ];\n\n    props.forEach((prop: string) => {\n      // set on contenteditable document element and quill root\n      this.quill.root.style.setProperty(prop, value);\n      if (document.documentElement) {\n        document.documentElement.style.setProperty(prop, value);\n      }\n    });\n    if (this.options.debug) console.debug('BlotFormatter _setUserSelect', value);\n  }\n\n  /**\n   * Handles the `pointerdown` event on the document to determine whether the blot formatter overlay should be dismissed.\n   *\n   * If the pointer event target is outside the Quill editor, not within a blot formatter modal,\n   * and not a proxy image used by the blot formatter, the overlay is hidden.\n   *\n   * @param event - The pointer event triggered by user interaction.\n   */\n  private _onDocumentPointerDown = (event: PointerEvent): void => {\n    // if clicked outside of quill editor and not a blot formatter modal or iframe proxy image, dismiss overlay \n    const target = event.target as HTMLElement;\n    if (!(\n      this.quill.root.parentNode.contains(target) ||\n      target.closest('[data-blot-formatter-modal]') ||\n      target.classList.contains('blot-formatter__proxy-image')\n    )) {\n      this.hide(event);\n    }\n  }\n\n  /**\n   * Handles pointer click events on the editor.\n   * \n   * If debugging is enabled in the options, logs the click event to the console.\n   * Then, hides the formatter UI in response to the click event.\n   *\n   * @param event - The pointer event triggered by the user's click.\n   */\n  private _onClick = (event: PointerEvent): void => {\n    if (this.options.debug) console.debug('BlotFormatter _onClick', event);\n    if (this.enabled) this.hide(event);\n  }\n\n  /**\n   * Handles the wheel event by scrolling the Quill editor's root element.\n   * This method is intended to be used when the overlay or proxy receives a wheel event,\n   * ensuring that the scroll action is passed through to the underlying Quill editor.\n   *\n   * @param event - The wheel event containing scroll delta values.\n   *\n   * @remarks\n   * If the `debug` option is enabled, this method logs the scroll delta values to the console.\n   */\n  _passWheelEventThrough = (event: WheelEvent): void => {\n    // scroll the quill root element when overlay or proxy wheel scrolled\n    this.quill.root.scrollLeft += event.deltaX;\n    this.quill.root.scrollTop += event.deltaY;\n    if (this.options.debug)\n      console.debug(`BlotFormatter scrolling Quill root x: ${event.deltaX}, y: ${event.deltaY}`);\n  };\n\n  /**\n   * Handles the touch start event for scrolling interactions.\n   * Records the initial X and Y positions of the first touch point.\n   * Optionally logs debug information if enabled in options.\n   *\n   * @param event - The touch event triggered when the user starts touching the screen.\n   */\n  _onTouchScrollStart = (event: TouchEvent): void => {\n    // Record the initial touch positions\n    if (event.touches.length === 1) {\n      const touch = event.touches[0];\n      this._startX = touch.clientX;\n      this._startY = touch.clientY;\n      if (this.options.debug)\n        console.debug('BlotFormatter _onTouchScrollStart', `X: ${this._startX}, Y: ${this._startY}`);\n    }\n  };\n\n  /**\n   * Handles touch move events to enable custom scrolling behavior within the Quill editor root element.\n   * \n   * This method allows for both vertical and horizontal scrolling using touch gestures,\n   * and prevents default browser scrolling when appropriate to provide a smoother, controlled experience.\n   * It updates the scroll position of the editor root based on the movement of the touch point,\n   * and ensures scrolling does not exceed the bounds of the content.\n   * \n   * @param event - The touch event triggered by the user's finger movement.\n   * \n   * @remarks\n   * - Only processes single-touch events.\n   * - Prevents default scrolling if the editor can be scrolled further in the direction of the gesture.\n   * - Updates the starting touch coordinates after each move to track incremental movement.\n   * - Logs debug information if the `debug` option is enabled.\n   */\n  _onTouchScrollMove = (event: TouchEvent): void => {\n    if (event.touches.length === 1) {\n      const touch = event.touches[0];\n      const deltaX = this._startX - touch.clientX;\n      const deltaY = this._startY - touch.clientY;\n\n      // Early return if minimal movement\n      if (Math.abs(deltaX) < 2 && Math.abs(deltaY) < 2) return;\n\n      const root = this.quill.root;\n\n      // Check if we can scroll further vertically and horizontally\n      const atTop = root.scrollTop === 0;\n      const atBottom = root.scrollTop + root.clientHeight === root.scrollHeight;\n      const atLeft = root.scrollLeft === 0;\n      const atRight = root.scrollLeft + root.clientWidth === root.scrollWidth;\n\n      // Determine if we're scrolling vertically or horizontally\n      const isScrollingVertically = Math.abs(deltaY) > Math.abs(deltaX);\n      const isScrollingHorizontally = Math.abs(deltaX) > Math.abs(deltaY);\n\n      let preventDefault = false;\n\n      // If scrolling vertically\n      if (isScrollingVertically) {\n        if (!(atTop && deltaY < 0) && !(atBottom && deltaY > 0)) {\n          preventDefault = true; // Prevent default only if we can scroll further\n          root.scrollTop += deltaY;\n        }\n      }\n\n      // If scrolling horizontally\n      if (isScrollingHorizontally) {\n        if (!(atLeft && deltaX < 0) && !(atRight && deltaX > 0)) {\n          preventDefault = true; // Prevent default only if we can scroll further\n          root.scrollLeft += deltaX;\n        }\n      }\n\n      if (preventDefault) {\n        event.preventDefault(); // Prevent default scrolling if necessary\n      }\n\n      // Update start positions for the next move event\n      this._startX = touch.clientX;\n      this._startY = touch.clientY;\n      if (this.options.debug)\n        console.debug('BlotFormatter touch scroll end', `X: ${this._startX}, Y: ${this._startY}`);\n    }\n  };\n\n  /**\n   * Registers custom Quill blots based on the provided options.\n   *\n   * - If `options.image.registerImageTitleBlot` is enabled, registers a custom Image blot\n   *   that supports a title attribute.\n   * - If `options.video.registerCustomVideoBlot` is enabled, registers a custom Video blot\n   *   with responsive behavior and sets its default aspect ratio from the options.\n   *\n   * Debug information is logged to the console if `options.debug` is true.\n   *\n   * @private\n   */\n  private _registerCustomBlots = (): void => {\n    // register image bot with title attribute support\n    if (this.options.image.registerImageTitleBlot) {\n      const ImageAltTitleBlot = createAltTitleImageBlotClass(this.Quill);\n      if (this.options.debug) console.debug('Registering custom Image blot', ImageAltTitleBlot);\n      this.Quill.register({ 'formats/image': ImageAltTitleBlot }, true);\n      if (this.options.debug) {\n        console.debug('formats/image after register:', this.Quill.import('formats/image'));\n      }\n    }\n    // register custom video blot with initial width 100% & aspect ratio from options\n    if (this.options.video.registerCustomVideoBlot) {\n      const VideoResponsive = createResponsiveVideoBlotClass(this.Quill);\n      if (this.options.debug) {\n        console.debug('Registering custom Video blot', VideoResponsive);\n        console.debug('Setting default aspect ratio for Video blot', this.options.video.defaultAspectRatio);\n      }\n      // set default aspect ratio for video responsive blot\n      VideoResponsive.aspectRatio = this.options.video.defaultAspectRatio;\n      this.Quill.register({ 'formats/video': VideoResponsive }, true);\n      if (this.options.debug) {\n        console.debug('formats/video after register:', this.Quill.import('formats/video'));\n      }\n    }\n  }\n\n  /**\n   * Registers custom keyboard bindings to address specific Quill editor issues and enhance user experience.\n   *\n   * - Adds a Backspace key binding to fix Quill bug #4364, ensuring proper deletion behavior for embedded videos (e.g., iframes).\n   *   This is enabled if `options.video.registerBackspaceFix` is true.\n   * - Adds an ArrowRight key binding to fix cursor navigation issues when moving past images,\n   *   ensuring the cursor does not get stuck or hidden at the image location.\n   *   This is enabled if `options.image.registerArrowRightFix` is true.\n   *\n   * Both bindings are conditionally registered based on the provided options.\n   * Debug information is logged to the console if `options.debug` is enabled.\n   *\n   * @private\n   */\n  private _keyboardBindings = (): void => {\n    // add backspace keyboard bindings\n    // patch that fixes Quill bug #4364 (https://github.com/slab/quill/issues/4364)\n    if (this.options.video.registerBackspaceFix) {\n      if (!this.quill.keyboard.bindings.Backspace) {\n        this.quill.keyboard.bindings.Backspace = []\n      }\n      const backspaceRule = {\n        key: 'Backspace',\n        empty: true,\n        line: {\n          domNode: {\n            tagName: \"IFRAME\"\n          }\n        },\n        handler: (range: any) => {\n          this.quill.deleteText(range.index - 1, 1, \"user\");\n        }\n      }\n      this.quill.keyboard.bindings.Backspace.unshift(backspaceRule);\n      if (this.options.debug)\n        console.debug('BlotFormatter added Backspace keyboard binding', backspaceRule);\n    }\n\n    // handles moving the cursor past the image when format set\n    // without this, cursor stops and stays hidden at the image location\n    if (this.options.image.registerArrowRightFix) {\n      if (!this.quill.keyboard.bindings.ArrowRight) {\n        this.quill.keyboard.bindings.ArrowRight = []\n      }\n      const arrowRightFixRule = {\n        key: 'ArrowRight',\n        collapsed: true,\n        empty: false,\n        suffix: /^$/,\n        line: {\n          domNode: {\n            tagName: \"P\"\n          }\n        },\n        handler: (range: any, context: any) => {\n          const index = range.index + range.length;\n          const documentLength = this.quill.getLength();\n          if (index + 1 >= documentLength - 1) {\n            // For the last blot, place cursor at the very end\n            this.quill.setSelection(documentLength - 1, 0, \"user\");\n          } else {\n            // overshoot by one then use native browser API to send caret back one\n            // without this, caret will be placed inside formatting span wrapper\n            this.quill.setSelection(index + 2, 0, \"user\");\n            CaretAction.sendCaretBack(1); // Move cursor back by 1 character\n          }\n        }\n      };\n      this.quill.keyboard.bindings.ArrowRight.unshift(arrowRightFixRule);\n      if (this.options.debug)\n        console.debug('BlotFormatter added ArrowRightFix keyboard binding', arrowRightFixRule);\n    }\n  }\n\n  /**\n   * Determines whether the resizing of the target element should use relative sizing (percentages)\n   * or absolute sizing (pixels), based on the current configuration and the element's width attribute.\n   *\n   * @param targetElement - The HTML element whose sizing mode is being determined.\n   * @returns `true` if relative sizing should be used, `false` otherwise.\n   *\n   * The method checks the `useRelativeSize` option and, if `allowResizeModeChange` is enabled,\n   * inspects the element's `width` attribute to decide whether to use relative or absolute sizing.\n   * If debugging is enabled, logs the decision to the console.\n   */\n  _useRelative = (targetElement: HTMLElement): boolean => {\n    let _useRelative: boolean = this.options.resize.useRelativeSize;\n    if (this.options.resize.allowResizeModeChange) {\n      // if no width set, use useRelativeSize by default else respect existing type\n      const width: string | null = targetElement.getAttribute('width');\n      if (!width) {\n        _useRelative = this.options.resize.useRelativeSize;\n      } else {\n        _useRelative = width.endsWith('%');\n      }\n    }\n    if (this.options.debug) {\n      console.debug('BlotFormatter _useRelative', _useRelative, 'for element', targetElement);\n    }\n    return _useRelative;\n  }\n\n  /**\n   * Determines the relative position of a pointer event with respect to the overlay element.\n   *\n   * @param event - The pointer event to evaluate.\n   * @returns The position of the pointer relative to the overlay, as a `PointerPosition` enum value.\n   *\n   * The possible return values are:\n   * - `PointerPosition.ABOVE` if the pointer is above the overlay.\n   * - `PointerPosition.BELOW` if the pointer is below the overlay.\n   * - `PointerPosition.LEFT` if the pointer is to the left of the overlay.\n   * - `PointerPosition.RIGHT` if the pointer is to the right of the overlay.\n   * - `PointerPosition.INSIDE` if the pointer is inside the overlay.\n   *\n   * If the `debug` option is enabled, logs the determined position and event to the console.\n   */\n  private _getClickPosition = (event: PointerEvent): PointerPosition => {\n    const target = this.overlay;\n    const rect = target.getBoundingClientRect();\n    let position: PointerPosition;\n    if (event.clientY < rect.top) {\n      position = PointerPosition.ABOVE;\n    } else if (event.clientY > rect.bottom) {\n      position = PointerPosition.BELOW;\n    } else if (event.clientX < rect.left) {\n      position = PointerPosition.LEFT;\n    } else if (event.clientX > rect.right) {\n      position = PointerPosition.RIGHT;\n    } else {\n      position = PointerPosition.INSIDE;\n    }\n    if (this.options.debug) {\n      console.debug('BlotFormatter _getClickPosition', position, 'for event', event);\n    }\n    return position;\n  }\n}\n"],"names":["Action","formatter","CaretAction","n","debug","selection","range","currentNode","currentOffset","prevNode","quill","targetBlot","index","documentLength","e","modalOpen","isMergeableObject","value","isNonNullObject","isSpecial","stringValue","isReactElement","canUseSymbol","REACT_ELEMENT_TYPE","emptyTarget","val","cloneUnlessOtherwiseSpecified","options","deepmerge","defaultArrayMerge","target","source","element","getMergeFunction","key","customMerge","getEnumerableOwnPropertySymbols","symbol","getKeys","propertyIsOnObject","object","property","propertyIsUnsafe","mergeObject","destination","sourceIsArray","targetIsArray","sourceAndTargetTypesMatch","array","prev","next","deepmerge_1","cjs","Toolbar","event","actionButtons","action","button","TooltipContainPosition","tooltip","container","tooltipRect","containerRect","left","top","width","height","maxWidth","maxHeight","changed","newStyles","isRepositioning","observer","mutations","m","tooltipElement","createAltTitleImageBlotClass","QuillConstructor","ImageBlot","ATTRIBUTES","domNode","formats","attribute","name","createIframeAlignAttributor","parchment","ClassAttributor","Scope","node","className","createImageAlignAttributor","imageElement","imageBlot","parentElement","align","title","createResponsiveVideoBlotClass","VideoEmbed","DefaultAligner","alignment","blot","k","existingAlignment","hasAlignment","editorStyle","editorWidth","ops","ToolbarButton","onClickHandler","style","childElement","AlignAction","DeleteAction","targetElement","ResizeAction","passiveFalse","handleStyle","handle","position","cursor","box","handleXOffset","handleYOffset","topLeftStyle","topRightStyle","bottomRightStyle","bottomLeftStyle","error","activate","rect","ratio","deltaX","isLeftHandle","newWidth","constrainedWidth","scale","newHeight","show","roundedWidth","roundedHeight","size","setWidth","setWidthNum","aspectRatio","calculatedHeight","naturalWidth","naturalHeight","showInfo","touch1","touch2","dx","dy","dim","_","prefix","num","suffix","BlotSpec","actions","PROXY_IMAGE_CLASS","UnclickableBlotSpec","resizeTimeout","entries","entry","unclickable","proxyImage","id","canvas","context","mergedStyle","containerScrollLeft","containerScrollTop","unclickableRect","msg","proxyContainer","IframeVideoSpec","AttributeAction","alt","imageAlignment","uuid","modal","modalContainer","form","labelAlt","textareaAlt","labelTitle","textareaTitle","buttonDiv","submitButton","cancelButton","CompressAction","isEligible","mimeType","isEligibleForCompression","img","parsedWidth","parsedHeight","dataUrl","base64Data","details","newImg","resizedDataUrl","originalSize","resizedSize","sizeDiff","modalBackground","modalDefaultPrompt","modalMoreInfo","modalButtonContainer","moreInfoButton","continueButton","LinkAction","dialog","label","input","okButton","removeButton","background","overlayRect","quillRect","offsetParentRect","dialogWidth","dialogHeight","minLeft","maxLeft","minTop","maxTop","url","wrapperBlot","ImageSpec","el","closeButtonIcon","okButtonIcon","infoButtonIcon","DefaultOptions","dontMerge","BlotFormatter","ImageAlignClass","IframeAlignClass","SpecClass","spec","mutation","overlay","sizeInfo","toolbarElement","toolbarRect","offset","resolve","scrollingElement","ancestor","overflowY","elRect","lastScrollTop","checkInterval","signal","overlayTarget","specRect","prop","touch","deltaY","root","atTop","atBottom","atLeft","atRight","isScrollingVertically","isScrollingHorizontally","preventDefault","ImageAltTitleBlot","VideoResponsive","backspaceRule","arrowRightFixRule","_useRelative"],"mappings":"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","x_google_ignoreList":[2]}